{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/app/api/proxy/audio/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\n\nexport async function GET(request: NextRequest) {\n  const url = request.nextUrl.searchParams.get(\"url\");\n\n  if (!url) {\n    return NextResponse.json(\n      { error: \"URL parameter is required\" },\n      { status: 400 },\n    );\n  }\n\n  try {\n    // Validate URL to prevent SSRF attacks\n    const targetUrl = new URL(decodeURIComponent(url));\n\n    // Only allow HTTP and HTTPS protocols\n    if (![\"http:\", \"https:\"].includes(targetUrl.protocol)) {\n      return NextResponse.json({ error: \"Invalid protocol\" }, { status: 400 });\n    }\n\n    // Fetch the audio stream\n    const response = await fetch(targetUrl.toString(), {\n      headers: {\n        \"User-Agent\": \"RadioGlobeNext/1.0\",\n        Accept: \"audio/mpeg, audio/mp4, audio/aac, audio/ogg, audio/wav, */*\",\n        Range: request.headers.get(\"range\") || \"\",\n      },\n    });\n\n    if (!response.ok) {\n      return NextResponse.json(\n        { error: `Failed to fetch audio: ${response.status}` },\n        { status: response.status },\n      );\n    }\n\n    // Get the content type\n    const contentType = response.headers.get(\"content-type\") || \"audio/mpeg\";\n\n    // Create response with proper CORS headers\n    const proxyResponse = new NextResponse(response.body, {\n      status: response.status,\n      headers: {\n        \"Content-Type\": contentType,\n        \"Access-Control-Allow-Origin\": \"*\",\n        \"Access-Control-Allow-Methods\": \"GET, HEAD, OPTIONS\",\n        \"Access-Control-Allow-Headers\": \"Range, Content-Type\",\n        \"Cache-Control\": \"no-cache, no-store, must-revalidate\",\n        \"Accept-Ranges\": \"bytes\",\n      },\n    });\n\n    // Copy relevant headers from the original response\n    const headersToProxy = [\n      \"content-length\",\n      \"content-range\",\n      \"accept-ranges\",\n      \"last-modified\",\n      \"etag\",\n    ];\n\n    headersToProxy.forEach((header) => {\n      const value = response.headers.get(header);\n      if (value) {\n        proxyResponse.headers.set(header, value);\n      }\n    });\n\n    return proxyResponse;\n  } catch (error) {\n    console.error(\"Proxy error:\", error);\n    return NextResponse.json(\n      { error: \"Failed to proxy audio stream\" },\n      { status: 500 },\n    );\n  }\n}\n\nexport async function OPTIONS(request: NextRequest) {\n  return new NextResponse(null, {\n    status: 200,\n    headers: {\n      \"Access-Control-Allow-Origin\": \"*\",\n      \"Access-Control-Allow-Methods\": \"GET, HEAD, OPTIONS\",\n      \"Access-Control-Allow-Headers\": \"Range, Content-Type\",\n    },\n  });\n}\n"],"names":["GET","request","url","nextUrl","searchParams","get","json","error","status","targetUrl","URL","decodeURIComponent","includes","protocol","response","fetch","toString","headers","Accept","Range","ok","contentType","proxyResponse","body","headersToProxy","forEach","header","value","set","console","OPTIONS"],"mappings":";;;;;;AAAA;;AAEO,eAAeA,IAAIC,OAAoB;IAC5C,MAAMC,MAAMD,QAAQE,OAAO,CAACC,YAAY,CAACC,GAAG,CAAC;IAE7C,IAAI,CAACH,KAAK;QACR,OAAO,+JAAY,CAACI,IAAI,CACtB;YAAEC,OAAO;QAA4B,GACrC;YAAEC,QAAQ;QAAI;IAElB;IAEA,IAAI;QACF,uCAAuC;QACvC,MAAMC,YAAY,IAAIC,IAAIC,mBAAmBT;QAE7C,sCAAsC;QACtC,IAAI,CAAC;YAAC;YAAS;SAAS,CAACU,QAAQ,CAACH,UAAUI,QAAQ,GAAG;YACrD,OAAO,+JAAY,CAACP,IAAI,CAAC;gBAAEC,OAAO;YAAmB,GAAG;gBAAEC,QAAQ;YAAI;QACxE;QAEA,yBAAyB;QACzB,MAAMM,WAAW,MAAMC,MAAMN,UAAUO,QAAQ,IAAI;YACjDC,SAAS;gBACP,cAAc;gBACdC,QAAQ;gBACRC,OAAOlB,QAAQgB,OAAO,CAACZ,GAAG,CAAC,YAAY;YACzC;QACF;QAEA,IAAI,CAACS,SAASM,EAAE,EAAE;YAChB,OAAO,+JAAY,CAACd,IAAI,CACtB;gBAAEC,OAAO,CAAC,uBAAuB,EAAEO,SAASN,MAAM,EAAE;YAAC,GACrD;gBAAEA,QAAQM,SAASN,MAAM;YAAC;QAE9B;QAEA,uBAAuB;QACvB,MAAMa,cAAcP,SAASG,OAAO,CAACZ,GAAG,CAAC,mBAAmB;QAE5D,2CAA2C;QAC3C,MAAMiB,gBAAgB,IAAI,+JAAY,CAACR,SAASS,IAAI,EAAE;YACpDf,QAAQM,SAASN,MAAM;YACvBS,SAAS;gBACP,gBAAgBI;gBAChB,+BAA+B;gBAC/B,gCAAgC;gBAChC,gCAAgC;gBAChC,iBAAiB;gBACjB,iBAAiB;YACnB;QACF;QAEA,mDAAmD;QACnD,MAAMG,iBAAiB;YACrB;YACA;YACA;YACA;YACA;SACD;QAEDA,eAAeC,OAAO,CAAC,CAACC;YACtB,MAAMC,QAAQb,SAASG,OAAO,CAACZ,GAAG,CAACqB;YACnC,IAAIC,OAAO;gBACTL,cAAcL,OAAO,CAACW,GAAG,CAACF,QAAQC;YACpC;QACF;QAEA,OAAOL;IACT,EAAE,OAAOf,OAAO;QACdsB,QAAQtB,KAAK,CAAC,gBAAgBA;QAC9B,OAAO,+JAAY,CAACD,IAAI,CACtB;YAAEC,OAAO;QAA+B,GACxC;YAAEC,QAAQ;QAAI;IAElB;AACF;AAEO,eAAesB,QAAQ7B,OAAoB;IAChD,OAAO,IAAI,+JAAY,CAAC,MAAM;QAC5BO,QAAQ;QACRS,SAAS;YACP,+BAA+B;YAC/B,gCAAgC;YAChC,gCAAgC;QAClC;IACF;AACF"}}]
}