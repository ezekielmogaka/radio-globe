{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/utils/coordinates.ts"],"sourcesContent":["/**\n * Coordinate conversion utilities for geographic calculations\n * Compatible with both Cesium and general 3D applications\n */\n\n/**\n * Convert latitude/longitude to 3D Cartesian coordinates\n */\nexport function latLngToPosition(\n  lat: number,\n  lng: number,\n  radius: number = 2.02,\n): [number, number, number] {\n  const phi = (90 - lat) * (Math.PI / 180);\n  const theta = (lng + 180) * (Math.PI / 180);\n\n  const x = -(radius * Math.sin(phi) * Math.cos(theta));\n  const z = radius * Math.sin(phi) * Math.sin(theta);\n  const y = radius * Math.cos(phi);\n\n  return [x, y, z];\n}\n\n/**\n * Convert 3D Cartesian coordinates to latitude/longitude\n */\nexport function positionToLatLng(\n  x: number,\n  y: number,\n  z: number,\n): { lat: number; lng: number } {\n  const radius = Math.sqrt(x * x + y * y + z * z);\n  const lat = 90 - (Math.acos(y / radius) * 180) / Math.PI;\n  const lng = (Math.atan2(z, -x) * 180) / Math.PI - 180;\n\n  return { lat, lng };\n}\n\n/**\n * Calculate distance between two geographic points using Haversine formula\n */\nexport function calculateDistance(\n  lat1: number,\n  lon1: number,\n  lat2: number,\n  lon2: number,\n): number {\n  const R = 6371; // Earth's radius in kilometers\n  const dLat = ((lat2 - lat1) * Math.PI) / 180;\n  const dLon = ((lon2 - lon1) * Math.PI) / 180;\n  const a =\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos((lat1 * Math.PI) / 180) *\n      Math.cos((lat2 * Math.PI) / 180) *\n      Math.sin(dLon / 2) *\n      Math.sin(dLon / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c;\n}\n\n/**\n * Normalize longitude to [-180, 180] range\n */\nexport function normalizeLongitude(lng: number): number {\n  while (lng > 180) lng -= 360;\n  while (lng < -180) lng += 360;\n  return lng;\n}\n\n/**\n * Normalize latitude to [-90, 90] range\n */\nexport function normalizeLatitude(lat: number): number {\n  return Math.max(-90, Math.min(90, lat));\n}\n"],"names":["latLngToPosition","lat","lng","radius","phi","Math","PI","theta","x","sin","cos","z","y","positionToLatLng","sqrt","acos","atan2","calculateDistance","lat1","lon1","lat2","lon2","R","dLat","dLon","a","c","normalizeLongitude","normalizeLatitude","max","min"],"mappings":"AAAA;;;CAGC,GAED;;CAEC;;;;;;;;;;;;AACM,SAASA,iBACdC,GAAW,EACXC,GAAW,EACXC,SAAiB,IAAI;IAErB,MAAMC,MAAM,CAAC,KAAKH,GAAG,IAAI,CAACI,KAAKC,EAAE,GAAG,GAAG;IACvC,MAAMC,QAAQ,CAACL,MAAM,GAAG,IAAI,CAACG,KAAKC,EAAE,GAAG,GAAG;IAE1C,MAAME,IAAI,CAAC,CAACL,SAASE,KAAKI,GAAG,CAACL,OAAOC,KAAKK,GAAG,CAACH,MAAM;IACpD,MAAMI,IAAIR,SAASE,KAAKI,GAAG,CAACL,OAAOC,KAAKI,GAAG,CAACF;IAC5C,MAAMK,IAAIT,SAASE,KAAKK,GAAG,CAACN;IAE5B,OAAO;QAACI;QAAGI;QAAGD;KAAE;AAClB;AAKO,SAASE,iBACdL,CAAS,EACTI,CAAS,EACTD,CAAS;IAET,MAAMR,SAASE,KAAKS,IAAI,CAACN,IAAIA,IAAII,IAAIA,IAAID,IAAIA;IAC7C,MAAMV,MAAM,KAAK,AAACI,KAAKU,IAAI,CAACH,IAAIT,UAAU,MAAOE,KAAKC,EAAE;IACxD,MAAMJ,MAAM,AAACG,KAAKW,KAAK,CAACL,GAAG,CAACH,KAAK,MAAOH,KAAKC,EAAE,GAAG;IAElD,OAAO;QAAEL;QAAKC;IAAI;AACpB;AAKO,SAASe,kBACdC,IAAY,EACZC,IAAY,EACZC,IAAY,EACZC,IAAY;IAEZ,MAAMC,IAAI,MAAM,+BAA+B;IAC/C,MAAMC,OAAO,AAAC,CAACH,OAAOF,IAAI,IAAIb,KAAKC,EAAE,GAAI;IACzC,MAAMkB,OAAO,AAAC,CAACH,OAAOF,IAAI,IAAId,KAAKC,EAAE,GAAI;IACzC,MAAMmB,IACJpB,KAAKI,GAAG,CAACc,OAAO,KAAKlB,KAAKI,GAAG,CAACc,OAAO,KACrClB,KAAKK,GAAG,CAAC,AAACQ,OAAOb,KAAKC,EAAE,GAAI,OAC1BD,KAAKK,GAAG,CAAC,AAACU,OAAOf,KAAKC,EAAE,GAAI,OAC5BD,KAAKI,GAAG,CAACe,OAAO,KAChBnB,KAAKI,GAAG,CAACe,OAAO;IACpB,MAAME,IAAI,IAAIrB,KAAKW,KAAK,CAACX,KAAKS,IAAI,CAACW,IAAIpB,KAAKS,IAAI,CAAC,IAAIW;IACrD,OAAOH,IAAII;AACb;AAKO,SAASC,mBAAmBzB,GAAW;IAC5C,MAAOA,MAAM,IAAKA,OAAO;IACzB,MAAOA,MAAM,CAAC,IAAKA,OAAO;IAC1B,OAAOA;AACT;AAKO,SAAS0B,kBAAkB3B,GAAW;IAC3C,OAAOI,KAAKwB,GAAG,CAAC,CAAC,IAAIxB,KAAKyB,GAAG,CAAC,IAAI7B;AACpC"}},
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/stores/globe-store.ts"],"sourcesContent":["import { create } from \"zustand\";\nimport { subscribeWithSelector } from \"zustand/middleware\";\nimport type { GlobeState, RadioStation, StationMarker } from \"../types\";\nimport { latLngToPosition } from \"../utils/coordinates\";\n\n// Cesium-compatible camera position type\nexport interface CesiumCameraPosition {\n  longitude: number;\n  latitude: number;\n  height: number;\n  heading?: number;\n  pitch?: number;\n  roll?: number;\n}\n\ninterface GlobeStore extends GlobeState {\n  // Cesium-specific state\n  cesiumCameraPosition?: CesiumCameraPosition;\n\n  // Actions\n  selectStation: (station: RadioStation | null) => void;\n  hoverStation: (station: RadioStation | null) => void;\n  setCameraPosition: (position: [number, number, number]) => void;\n  setCesiumCameraPosition: (position: CesiumCameraPosition) => void;\n  setAutoRotating: (isAutoRotating: boolean) => void;\n  addMarker: (station: RadioStation) => void;\n  clearMarkers: () => void;\n  removeMarker: (stationId: string) => void;\n  updateMarkerVisibility: (stationId: string, isVisible: boolean) => void;\n  getStationsByRegion: (region: string) => RadioStation[];\n  searchStations: (query: string) => RadioStation[];\n  nextStation: () => void;\n  previousStation: () => void;\n  setPlaylist: (stations: RadioStation[]) => void;\n}\n\nexport const useGlobeStore = create<GlobeStore>()(\n  subscribeWithSelector((set, get) => ({\n    // Initial state\n    selectedStation: null,\n    hoveredStation: null,\n    cameraPosition: [0, 0, 2.5],\n    isAutoRotating: true,\n    markers: [],\n    playlist: [],\n    playlistIndex: -1,\n\n    // Actions\n    setPlaylist: (stations) => {\n      set({ playlist: stations });\n    },\n\n    selectStation: (station) => {\n      const state = get();\n      // If manually clearing selection\n      if (!station) {\n        set({ selectedStation: null, playlistIndex: -1 });\n        return;\n      }\n\n      // If station is already in current playlist, just update index\n      const existingIndex = state.playlist.findIndex(s => s.id === station.id);\n      \n      let newPlaylist = state.playlist;\n      let newIndex = existingIndex;\n\n      // If station not in playlist, or playlist is empty, rebuild playlist from markers\n      if (existingIndex === -1 || state.playlist.length === 0) {\n        const visibleStations = state.markers\n          .filter(m => m.isVisible)\n          .map(m => m.station);\n        \n        // If the station itself isn't in visible markers (e.g. search result), add it\n        const stationInMarkers = visibleStations.find(s => s.id === station.id);\n         \n        newPlaylist = stationInMarkers \n          ? visibleStations \n          : [station, ...visibleStations];\n          \n        newIndex = newPlaylist.findIndex(s => s.id === station.id);\n      }\n\n      set((state) => ({\n        selectedStation: station,\n        playlist: newPlaylist,\n        playlistIndex: newIndex,\n        markers: state.markers.map((marker) => ({\n          ...marker,\n          isSelected: marker.station.id === station.id,\n        })),\n      }));\n    },\n\n    nextStation: () => {\n      const { playlist, playlistIndex } = get();\n      if (playlist.length === 0) return;\n      \n      const nextIndex = (playlistIndex + 1) % playlist.length;\n      const nextStation = playlist[nextIndex];\n      get().selectStation(nextStation);\n    },\n\n    previousStation: () => {\n      const { playlist, playlistIndex } = get();\n      if (playlist.length === 0) return;\n      \n      const prevIndex = (playlistIndex - 1 + playlist.length) % playlist.length;\n      const prevStation = playlist[prevIndex];\n      get().selectStation(prevStation);\n    },\n\n    hoverStation: (station) => {\n      set((state) => ({\n        hoveredStation: station,\n        markers: state.markers.map((marker) => ({\n          ...marker,\n          isHovered: marker.station.id === station?.id,\n        })),\n      }));\n    },\n\n    setCameraPosition: (position) => {\n      set({ cameraPosition: position });\n    },\n\n    setCesiumCameraPosition: (position) => {\n      set({\n        cesiumCameraPosition: position,\n        // Also update legacy camera position for compatibility\n        cameraPosition: [\n          position.longitude,\n          position.latitude,\n          position.height,\n        ],\n      });\n    },\n\n    setAutoRotating: (isAutoRotating) => {\n      set({ isAutoRotating });\n    },\n\n    addMarker: (station) => {\n      const position = latLngToPosition(\n        station.location.lat,\n        station.location.lng,\n        2.02,\n      );\n      const marker: StationMarker = {\n        station,\n        position,\n        isVisible: true,\n        isHovered: false,\n        isSelected: false,\n      };\n\n      set((state) => ({\n        markers: [\n          ...state.markers.filter((m) => m.station.id !== station.id),\n          marker,\n        ],\n      }));\n    },\n\n    clearMarkers: () => {\n      set({ markers: [] });\n    },\n\n    removeMarker: (stationId) => {\n      set((state) => ({\n        markers: state.markers.filter((m) => m.station.id !== stationId),\n      }));\n    },\n\n    updateMarkerVisibility: (stationId, isVisible) => {\n      set((state) => ({\n        markers: state.markers.map((marker) =>\n          marker.station.id === stationId ? { ...marker, isVisible } : marker,\n        ),\n      }));\n    },\n\n    getStationsByRegion: (region: string) => {\n      const { markers } = get();\n      return markers\n        .filter(\n          (marker) =>\n            marker.station.location.country\n              .toLowerCase()\n              .includes(region.toLowerCase()) ||\n            marker.station.location.city\n              .toLowerCase()\n              .includes(region.toLowerCase()),\n        )\n        .map((marker) => marker.station);\n    },\n\n    searchStations: (query: string) => {\n      const { markers } = get();\n      const searchTerm = query.toLowerCase();\n      return markers\n        .filter(\n          (marker) =>\n            marker.station.name.toLowerCase().includes(searchTerm) ||\n            marker.station.location.city.toLowerCase().includes(searchTerm) ||\n            marker.station.location.country\n              .toLowerCase()\n              .includes(searchTerm) ||\n            marker.station.genre.toLowerCase().includes(searchTerm) ||\n            marker.station.language.toLowerCase().includes(searchTerm),\n        )\n        .map((marker) => marker.station);\n    },\n  })),\n);\n\n// Subscribe to state changes for analytics or side effects\nuseGlobeStore.subscribe(\n  (state) => state.selectedStation,\n  (selectedStation) => {\n    if (selectedStation) {\n      console.log(\"Station selected:\", selectedStation.name);\n      // Track analytics, update URL, etc.\n    }\n  },\n);\n"],"names":["useGlobeStore","set","get","selectedStation","hoveredStation","cameraPosition","isAutoRotating","markers","playlist","playlistIndex","setPlaylist","stations","selectStation","station","state","existingIndex","findIndex","s","id","newPlaylist","newIndex","length","visibleStations","filter","m","isVisible","map","stationInMarkers","find","marker","isSelected","nextStation","nextIndex","previousStation","prevIndex","prevStation","hoverStation","isHovered","setCameraPosition","position","setCesiumCameraPosition","cesiumCameraPosition","longitude","latitude","height","setAutoRotating","addMarker","location","lat","lng","clearMarkers","removeMarker","stationId","updateMarkerVisibility","getStationsByRegion","region","country","toLowerCase","includes","city","searchStations","query","searchTerm","name","genre","language","subscribe","console","log"],"mappings":"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"}},
    {"offset": {"line": 225, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/services/audioService.ts"],"sourcesContent":["import { RadioStation } from \"../types\";\n\nexport type AudioState = \"idle\" | \"loading\" | \"playing\" | \"paused\" | \"error\";\n\nexport interface AudioPlayerConfig {\n  volume: number;\n  crossOrigin: \"anonymous\" | \"use-credentials\";\n  preload: \"none\" | \"metadata\" | \"auto\";\n  retryAttempts: number;\n  retryDelay: number;\n}\n\nexport interface AudioPlayerEvents {\n  stateChange: (state: AudioState) => void;\n  error: (error: string) => void;\n  loadStart: () => void;\n  canPlay: () => void;\n  volumeChange: (volume: number) => void;\n  timeUpdate: (currentTime: number) => void;\n}\n\nexport class AudioService {\n  private audio: HTMLAudioElement | null = null;\n  private state: AudioState = \"idle\";\n  private config: AudioPlayerConfig;\n  private listeners: Partial<AudioPlayerEvents> = {};\n  private retryCount = 0;\n  private currentStation: RadioStation | null = null;\n  private lastTimeUpdate = 0;\n  private readonly TIME_UPDATE_THROTTLE = 100; // ms\n\n  constructor(config: Partial<AudioPlayerConfig> = {}) {\n    this.config = {\n      volume: 0.7,\n      crossOrigin: \"anonymous\",\n      preload: \"none\",\n      retryAttempts: 3,\n      retryDelay: 2000,\n      ...config,\n    };\n\n    this.initializeAudio();\n  }\n\n  private initializeAudio() {\n    this.audio = new Audio();\n    this.audio.volume = this.config.volume;\n    this.audio.crossOrigin = this.config.crossOrigin;\n    this.audio.preload = this.config.preload;\n\n    // Set up event listeners\n    this.audio.addEventListener(\"loadstart\", this.handleLoadStart.bind(this));\n    this.audio.addEventListener(\"canplay\", this.handleCanPlay.bind(this));\n    this.audio.addEventListener(\"play\", this.handlePlay.bind(this));\n    this.audio.addEventListener(\"pause\", this.handlePause.bind(this));\n    this.audio.addEventListener(\"error\", this.handleError.bind(this));\n    this.audio.addEventListener(\n      \"volumechange\",\n      this.handleVolumeChange.bind(this),\n    );\n    this.audio.addEventListener(\"timeupdate\", this.handleTimeUpdate.bind(this));\n  }\n\n  private handleLoadStart() {\n    this.setState(\"loading\");\n    this.listeners.loadStart?.();\n  }\n\n  private handleCanPlay() {\n    this.setState(\"paused\");\n    this.listeners.canPlay?.();\n  }\n\n  private handlePlay() {\n    this.setState(\"playing\");\n  }\n\n  private handlePause() {\n    this.setState(\"paused\");\n  }\n\n  private handleError() {\n    this.setState(\"error\");\n    const errorMessage = this.getErrorMessage();\n    \n    // specialized retry for protocol issues (http vs https)\n    if (this.audio && this.audio.error && this.audio.error.code === MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED) {\n       const currentSrc = this.audio.src;\n       // Check if it's an HTTP stream and we haven't tried HTTPS yet\n       if (currentSrc.startsWith('http://') && this.retryCount === 0) {\n           // Try upgrading to HTTPS first\n           console.log('Audio source not supported, trying HTTPS upgrade...');\n           const secureUrl = currentSrc.replace('http://', 'https://');\n           this.retryCount++;\n           this.audio.src = secureUrl;\n           this.audio.load();\n           return; // Don't report error yet\n       }\n    }\n\n    this.listeners.error?.(errorMessage);\n\n    // Attempt standard retry if configured\n    if (this.retryCount < this.config.retryAttempts) {\n      this.scheduleRetry();\n    }\n  }\n\n  private handleVolumeChange() {\n    if (this.audio) {\n      this.listeners.volumeChange?.(this.audio.volume);\n    }\n  }\n\n  private handleTimeUpdate() {\n    if (this.audio) {\n      const now = Date.now();\n      if (now - this.lastTimeUpdate >= this.TIME_UPDATE_THROTTLE) {\n        this.lastTimeUpdate = now;\n        this.listeners.timeUpdate?.(this.audio.currentTime);\n      }\n    }\n  }\n\n  private getErrorMessage(): string {\n    if (!this.audio?.error) return \"Unknown audio error\";\n\n    switch (this.audio.error.code) {\n      case MediaError.MEDIA_ERR_ABORTED:\n        return \"Audio loading was aborted\";\n      case MediaError.MEDIA_ERR_NETWORK:\n        return \"Network error occurred while loading audio\";\n      case MediaError.MEDIA_ERR_DECODE:\n        return \"Audio format not supported\";\n      case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:\n        return \"Audio source not supported\";\n      default:\n        return \"Audio playback failed\";\n    }\n  }\n\n  private scheduleRetry() {\n    setTimeout(() => {\n      if (this.audio && this.currentStation) {\n        this.retryCount++;\n        console.log(\n          `Retrying audio load (attempt ${this.retryCount}/${this.config.retryAttempts})`,\n        );\n        this.audio.load();\n      }\n    }, this.config.retryDelay);\n  }\n\n  private setState(state: AudioState) {\n    this.state = state;\n    this.listeners.stateChange?.(state);\n  }\n\n  // Public API\n  public on<T extends keyof AudioPlayerEvents>(\n    event: T,\n    callback: AudioPlayerEvents[T],\n  ) {\n    this.listeners[event] = callback as any;\n  }\n\n  public off<T extends keyof AudioPlayerEvents>(event: T) {\n    delete this.listeners[event];\n  }\n\n  private buildFallbackUrls(station: RadioStation): string[] {\n    const urls = [station.url];\n    \n    // Add HTTPS version if original is HTTP\n    if (station.url.startsWith('http://')) {\n      urls.push(station.url.replace('http://', 'https://'));\n    }\n    \n    // Add common streaming endpoint variations\n    if (station.url.includes(':8000')) {\n      urls.push(station.url.replace(':8000', ':80'));\n      urls.push(station.url.replace(':8000', ''));\n    }\n    \n    return urls;\n  }\n\n  public async loadStation(\n    station: RadioStation,\n    streamUrl?: string,\n  ): Promise<void> {\n    if (!this.audio) return;\n\n    this.currentStation = station;\n    this.retryCount = 0;\n\n    const url = streamUrl || station.url;\n    console.log('Loading station:', station.name, 'URL:', url);\n    \n    if (this.audio.src !== url) {\n      this.audio.src = url;\n      this.audio.load();\n    }\n  }\n\n  public async play(): Promise<void> {\n    if (!this.audio) return;\n\n    try {\n      await this.audio.play();\n    } catch (error) {\n      this.setState(\"error\");\n      throw error;\n    }\n  }\n\n  public pause(): void {\n    if (this.audio) {\n      this.audio.pause();\n    }\n  }\n\n  public setVolume(volume: number): void {\n    if (this.audio) {\n      this.audio.volume = Math.max(0, Math.min(1, volume));\n    }\n  }\n\n  public getVolume(): number {\n    return this.audio?.volume || 0;\n  }\n\n  public mute(): void {\n    this.setVolume(0);\n  }\n\n  public unmute(): void {\n    this.setVolume(this.config.volume);\n  }\n\n  public getState(): AudioState {\n    return this.state;\n  }\n\n  public getCurrentStation(): RadioStation | null {\n    return this.currentStation;\n  }\n\n  public getAudioElement(): HTMLAudioElement | null {\n    return this.audio;\n  }\n\n  public destroy(): void {\n    if (this.audio) {\n      this.audio.pause();\n      this.audio.removeAttribute(\"src\");\n      this.audio.load();\n      this.audio = null;\n    }\n    this.listeners = {};\n    this.currentStation = null;\n  }\n}\n"],"names":["AudioService","audio","state","config","listeners","retryCount","currentStation","lastTimeUpdate","TIME_UPDATE_THROTTLE","volume","crossOrigin","preload","retryAttempts","retryDelay","initializeAudio","Audio","addEventListener","handleLoadStart","bind","handleCanPlay","handlePlay","handlePause","handleError","handleVolumeChange","handleTimeUpdate","setState","loadStart","canPlay","errorMessage","getErrorMessage","error","code","MediaError","MEDIA_ERR_SRC_NOT_SUPPORTED","currentSrc","src","startsWith","console","log","secureUrl","replace","load","scheduleRetry","volumeChange","now","Date","timeUpdate","currentTime","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","setTimeout","stateChange","on","event","callback","off","buildFallbackUrls","station","urls","url","push","includes","loadStation","streamUrl","name","play","pause","setVolume","Math","max","min","getVolume","mute","unmute","getState","getCurrentStation","getAudioElement","destroy","removeAttribute"],"mappings":"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"}},
    {"offset": {"line": 427, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/services/stationCacheHelpers.ts"],"sourcesContent":["import { RadioStation } from \"../types\";\n\nexport type StationIndex = Map<string, RadioStation[]>;\n\nconst UNKNOWN = \"unknown\";\n\nexport function buildCountryIndex(stations: RadioStation[]): StationIndex {\n  const byCountry = new Map<string, RadioStation[]>();\n  stations.forEach((station) => {\n    const key = station.location.country?.toLowerCase() || UNKNOWN;\n    if (!byCountry.has(key)) {\n      byCountry.set(key, []);\n    }\n    byCountry.get(key)!.push(station);\n  });\n  return byCountry;\n}\n\nexport function buildCityIndex(stations: RadioStation[]): StationIndex {\n  const byCity = new Map<string, RadioStation[]>();\n  stations.forEach((station) => {\n    const city = station.location.city?.toLowerCase();\n    if (!city) return;\n    if (!byCity.has(city)) {\n      byCity.set(city, []);\n    }\n    byCity.get(city)!.push(station);\n  });\n  return byCity;\n}\n\nexport function buildGenreIndex(stations: RadioStation[]): StationIndex {\n  const byGenre = new Map<string, RadioStation[]>();\n  stations.forEach((station) => {\n    const genre = station.genre?.toLowerCase() || UNKNOWN;\n    if (!byGenre.has(genre)) {\n      byGenre.set(genre, []);\n    }\n    byGenre.get(genre)!.push(station);\n\n    station.tags?.forEach((tag) => {\n      const key = tag.toLowerCase();\n      if (!byGenre.has(key)) {\n        byGenre.set(key, []);\n      }\n      byGenre.get(key)!.push(station);\n    });\n  });\n  return byGenre;\n}\n\nexport function filterStationsByCountry(\n  stations: RadioStation[],\n  normalizedCountry: string,\n): RadioStation[] {\n  return stations\n    .filter((station) => {\n      const name = station.location?.country?.toLowerCase() || \"\";\n      const code = station.location?.countryCode?.toLowerCase() || \"\";\n      return (\n        name === normalizedCountry ||\n        name.startsWith(normalizedCountry) ||\n        code === normalizedCountry\n      );\n    })\n    .sort((a, b) => (b.listeners || 0) - (a.listeners || 0));\n}\n\nexport function filterStationsByCity(\n  stations: RadioStation[],\n  normalizedCity: string,\n): RadioStation[] {\n  return stations\n    .filter((station) => station.location.city?.toLowerCase().includes(normalizedCity))\n    .sort((a, b) => (b.listeners || 0) - (a.listeners || 0));\n}\n\nexport function filterStationsByTag(\n  stations: RadioStation[],\n  normalizedTag: string,\n): RadioStation[] {\n  return stations\n    .filter((station) => {\n      const genre = station.genre?.toLowerCase() || \"\";\n      const tags = station.tags?.map((tag) => tag.toLowerCase()) || [];\n      return genre.includes(normalizedTag) || tags.some((tag) => tag.includes(normalizedTag));\n    })\n    .sort((a, b) => (b.listeners || 0) - (a.listeners || 0));\n}\n\nexport function searchStationsInCache(stations: RadioStation[], query: string): RadioStation[] {\n  const searchTerm = query.trim().toLowerCase();\n  if (!searchTerm) return [];\n\n  const results = stations.filter((station) =>\n    station.name?.toLowerCase().includes(searchTerm) ||\n    station.location?.country?.toLowerCase().includes(searchTerm) ||\n    station.location?.city?.toLowerCase().includes(searchTerm) ||\n    station.genre?.toLowerCase().includes(searchTerm) ||\n    station.language?.toLowerCase().includes(searchTerm) ||\n    station.description?.toLowerCase().includes(searchTerm) ||\n    station.tags?.some((tag) => tag.toLowerCase().includes(searchTerm))\n  );\n\n  return results.sort((a, b) => {\n    const aExact = a.name?.toLowerCase() === searchTerm;\n    const bExact = b.name?.toLowerCase() === searchTerm;\n    if (aExact && !bExact) return -1;\n    if (!aExact && bExact) return 1;\n    return (b.listeners || 0) - (a.listeners || 0);\n  });\n}\n\nexport function distributeStationsByCountry(\n  stations: RadioStation[],\n  targetLimit: number,\n): RadioStation[] {\n  const byCountry = buildCountryIndex(stations);\n  const result: RadioStation[] = [];\n  const maxPerCountry = Math.min(20, Math.ceil(targetLimit / Math.max(byCountry.size, 1)));\n\n  const countryGroups = Array.from(byCountry.values());\n  for (let index = 0; index < countryGroups.length; index += 1) {\n    const selected = countryGroups[index].slice(0, maxPerCountry);\n    result.push(...selected);\n    if (result.length >= targetLimit) break;\n  }\n\n  return result.slice(0, targetLimit);\n}\n\nexport function summarizeCountries(stations: RadioStation[]): Array<{ name: string; iso: string; stationcount: number }> {\n  const counts = new Map<string, { name: string; iso: string; stationcount: number }>();\n  stations.forEach((station) => {\n    const country = station.location.country || \"Unknown\";\n    const iso = station.location.countryCode || \"\";\n    if (!counts.has(country)) {\n      counts.set(country, { name: country, iso, stationcount: 0 });\n    }\n    counts.get(country)!.stationcount += 1;\n  });\n  return Array.from(counts.values()).sort((a, b) => b.stationcount - a.stationcount);\n}\n\nexport function summarizeTags(stations: RadioStation[]): Array<{ name: string; stationcount: number }> {\n  const counts = new Map<string, number>();\n\n  stations.forEach((station) => {\n    if (station.genre) {\n      const key = station.genre.toLowerCase();\n      counts.set(key, (counts.get(key) || 0) + 1);\n    }\n    station.tags?.forEach((tag) => {\n      const key = tag.toLowerCase();\n      counts.set(key, (counts.get(key) || 0) + 1);\n    });\n  });\n\n  return Array.from(counts.entries())\n    .map(([name, stationcount]) => ({ name, stationcount }))\n    .sort((a, b) => b.stationcount - a.stationcount);\n}\n"],"names":["UNKNOWN","buildCountryIndex","stations","byCountry","Map","forEach","station","key","location","country","toLowerCase","has","set","get","push","buildCityIndex","byCity","city","buildGenreIndex","byGenre","genre","tags","tag","filterStationsByCountry","normalizedCountry","filter","name","code","countryCode","startsWith","sort","a","b","listeners","filterStationsByCity","normalizedCity","includes","filterStationsByTag","normalizedTag","map","some","searchStationsInCache","query","searchTerm","trim","results","language","description","aExact","bExact","distributeStationsByCountry","targetLimit","result","maxPerCountry","Math","min","ceil","max","size","countryGroups","Array","from","values","index","length","selected","slice","summarizeCountries","counts","iso","stationcount","summarizeTags","entries"],"mappings":"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"}},
    {"offset": {"line": 569, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/services/location/wofEnrichmentService.ts"],"sourcesContent":["import booleanPointInPolygon from \"@turf/boolean-point-in-polygon\";\nimport { point } from \"@turf/helpers\";\nimport type { Feature, Geometry } from \"geojson\";\nimport type { RadioStation, WofHierarchyEntry, WofLocationDetail } from \"../../types\";\nimport type {\n  NaturalEarthCollection,\n  NaturalEarthFeature,\n  NaturalEarthFeatureProperties,\n} from \"./naturalEarthService\";\n\ninterface Bounds {\n  minLat: number;\n  minLng: number;\n  maxLat: number;\n  maxLng: number;\n}\n\nfunction getBoundsFromFeature(feature: NaturalEarthFeature): Bounds {\n  const [minLng, minLat, maxLng, maxLat] = feature.bbox;\n  return {\n    minLat,\n    minLng,\n    maxLat,\n    maxLng,\n  };\n}\n\nfunction isWithinBounds(bounds: Bounds, lat: number, lng: number): boolean {\n  return lat >= bounds.minLat && lat <= bounds.maxLat && lng >= bounds.minLng && lng <= bounds.maxLng;\n}\n\nfunction containsPoint(feature: NaturalEarthFeature, lat: number, lng: number): boolean {\n  try {\n    return booleanPointInPolygon(point([lng, lat]), feature as any);\n  } catch (error) {\n    console.warn(\"Failed to evaluate Natural Earth polygon\", error);\n    return false;\n  }\n}\n\nfunction ensureNaturalEarthFeature(\n  feature: Feature<Geometry, NaturalEarthFeatureProperties> | NaturalEarthFeature | null | undefined,\n): NaturalEarthFeature | null {\n  if (!feature) return null;\n  const candidate = feature as NaturalEarthFeature;\n  if (Array.isArray(candidate.bbox) && candidate.bbox.length === 4) {\n    return candidate;\n  }\n  return null;\n}\n\nfunction hashIdentifier(value: string): number {\n  let hash = 0;\n  for (let index = 0; index < value.length; index += 1) {\n    hash = (hash * 31 + value.charCodeAt(index)) | 0;\n  }\n  return Math.abs(hash) || 1;\n}\n\nfunction buildHierarchyEntry(\n  id: number,\n  placetype: string,\n  name: string,\n  feature: NaturalEarthFeature,\n): WofHierarchyEntry {\n  const [minLng, minLat, maxLng, maxLat] = feature.bbox;\n  return {\n    id,\n    placetype,\n    name,\n    bbox: [minLng, minLat, maxLng, maxLat],\n  };\n}\n\nfunction pickCountryFeature(\n  station: RadioStation,\n  countries: NaturalEarthCollection,\n): NaturalEarthFeature | null {\n  const isoCandidates = [\n    station.location.countryCode?.toUpperCase(),\n  ].filter(Boolean) as string[];\n\n  for (const iso of isoCandidates) {\n    const match = countries.features.find((feature) => {\n      const props = feature.properties;\n      return props.isoA2?.toUpperCase() === iso || props.isoA3?.toUpperCase() === iso;\n    });\n    const natural = ensureNaturalEarthFeature(match);\n    if (natural) {\n      return natural;\n    }\n  }\n\n  const name = station.location.country.trim().toLowerCase();\n  if (name) {\n    const byName = ensureNaturalEarthFeature(\n      countries.features.find((feature) => feature.properties.name.toLowerCase() === name),\n    );\n    if (byName) return byName;\n  }\n\n  const { lat, lng } = station.location;\n  const fallback = countries.features.find((feature) => {\n      const candidate = ensureNaturalEarthFeature(feature);\n      if (!candidate) {\n        return false;\n      }\n      const bounds = getBoundsFromFeature(candidate);\n      return isWithinBounds(bounds, lat, lng) && containsPoint(candidate, lat, lng);\n    });\n\n  return ensureNaturalEarthFeature(fallback);\n}\n\nfunction pickRegionFeature(\n  station: RadioStation,\n  regions: NaturalEarthCollection,\n  countryFeature: NaturalEarthFeature | null,\n): NaturalEarthFeature | null {\n  if (!countryFeature) return null;\n  const iso3166Candidate = station.location.city ? `${countryFeature.properties.isoA2}-${station.location.city}` : null;\n  if (iso3166Candidate) {\n    const match = ensureNaturalEarthFeature(\n      regions.features.find((feature) => feature.properties.iso3166_2?.toUpperCase() === iso3166Candidate.toUpperCase()),\n    );\n    if (match) return match;\n  }\n\n  const { lat, lng } = station.location;\n  const countryIso = countryFeature.properties.isoA2?.toUpperCase();\n\n  const fallback = regions.features.find((feature) => {\n      const props = feature.properties;\n      if (countryIso && props.isoA2?.toUpperCase() !== countryIso) {\n        return false;\n      }\n      const candidate = ensureNaturalEarthFeature(feature);\n      if (!candidate) {\n        return false;\n      }\n      const bounds = getBoundsFromFeature(candidate);\n      return isWithinBounds(bounds, lat, lng) && containsPoint(candidate, lat, lng);\n    });\n\n  return ensureNaturalEarthFeature(fallback);\n}\n\nfunction createLocationDetail(\n  country: NaturalEarthFeature | null,\n  region: NaturalEarthFeature | null,\n): WofLocationDetail {\n  if (!country) {\n    return { hierarchy: [], source: \"natural-earth\" };\n  }\n\n  const countryId = hashIdentifier(country.properties.isoA3 || country.properties.name);\n  const hierarchy: WofHierarchyEntry[] = [\n    buildHierarchyEntry(countryId, \"country\", country.properties.name, country),\n  ];\n\n  const detail: WofLocationDetail = {\n    countryId,\n    hierarchy,\n    centroid: country.properties.centroid,\n    bbox: getBoundsFromFeature(country),\n    countryIsoA2: country.properties.isoA2 ?? undefined,\n    countryIsoA3: country.properties.isoA3 ?? undefined,\n    source: \"natural-earth\",\n  };\n\n  if (region) {\n    const regionId = hashIdentifier(region.properties.iso3166_2 || region.properties.name);\n    detail.regionId = regionId;\n    detail.regionIso3166 = region.properties.iso3166_2 ?? undefined;\n    detail.hierarchy.push(buildHierarchyEntry(regionId, \"region\", region.properties.name, region));\n    detail.bbox = getBoundsFromFeature(region);\n    detail.centroid = region.properties.centroid;\n  }\n\n  return detail;\n}\n\nexport async function enrichStationsWithWof(\n  stations: RadioStation[],\n  countries: NaturalEarthCollection,\n  regions: NaturalEarthCollection,\n): Promise<RadioStation[]> {\n  return stations.map((station) => {\n    if (station.location.wof?.source === \"natural-earth\") {\n      return station;\n    }\n\n    const countryFeature = pickCountryFeature(station, countries);\n    const regionFeature = pickRegionFeature(station, regions, countryFeature);\n    const wofDetail = createLocationDetail(countryFeature, regionFeature);\n\n    return {\n      ...station,\n      location: {\n        ...station.location,\n        wof: wofDetail,\n      },\n    };\n  });\n}\n"],"names":["getBoundsFromFeature","feature","minLng","minLat","maxLng","maxLat","bbox","isWithinBounds","bounds","lat","lng","containsPoint","error","console","warn","ensureNaturalEarthFeature","candidate","Array","isArray","length","hashIdentifier","value","hash","index","charCodeAt","Math","abs","buildHierarchyEntry","id","placetype","name","pickCountryFeature","station","countries","isoCandidates","location","countryCode","toUpperCase","filter","Boolean","iso","match","features","find","props","properties","isoA2","isoA3","natural","country","trim","toLowerCase","byName","fallback","pickRegionFeature","regions","countryFeature","iso3166Candidate","city","iso3166_2","countryIso","createLocationDetail","region","hierarchy","source","countryId","detail","centroid","countryIsoA2","undefined","countryIsoA3","regionId","regionIso3166","push","enrichStationsWithWof","stations","map","wof","regionFeature","wofDetail"],"mappings":"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"}},
    {"offset": {"line": 733, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/services/location/naturalEarthService.ts"],"sourcesContent":["import type { Feature, FeatureCollection, Geometry } from \"geojson\";\n\nexport interface NaturalEarthFeatureProperties {\n  name: string;\n  isoA2?: string | null;\n  isoA3?: string | null;\n  iso3166_2?: string | null;\n  parentA3?: string | null;\n  type?: string | null;\n  population?: number | null;\n  source: \"natural-earth\";\n  centroid: { lat: number; lng: number };\n}\n\nexport type NaturalEarthFeature = Feature<Geometry, NaturalEarthFeatureProperties> & {\n  bbox: [number, number, number, number];\n};\n\nexport type NaturalEarthCollection = FeatureCollection<Geometry, NaturalEarthFeatureProperties> & {\n  features: NaturalEarthFeature[];\n};\n\nconst NATURAL_EARTH_BASE_PATH = \"/naturalearth\";\nconst COUNTRIES_PATH = `${NATURAL_EARTH_BASE_PATH}/admin0-countries.json`;\nconst REGIONS_PATH = `${NATURAL_EARTH_BASE_PATH}/admin1-regions.json`;\n\nlet countryCache: NaturalEarthCollection | null = null;\nlet regionCache: NaturalEarthCollection | null = null;\n\nfunction normalizeCollection(parsed: NaturalEarthCollection): NaturalEarthCollection {\n  return {\n    ...parsed,\n    features: parsed.features ?? [],\n  };\n}\n\nasync function fetchCollection(path: string): Promise<NaturalEarthCollection> {\n  if (typeof window === \"undefined\") {\n    const relative = path.startsWith(\"/\") ? path.slice(1) : path;\n    const [{ readFile }, { join }] = await Promise.all([\n      import(\"node:fs/promises\"),\n      import(\"node:path\"),\n    ]);\n    const absolutePath = join(process.cwd(), \"public\", relative);\n    const contents = await readFile(absolutePath, \"utf8\");\n    const parsed = JSON.parse(contents) as NaturalEarthCollection;\n    return normalizeCollection(parsed);\n  }\n\n  const response = await fetch(path, { cache: \"force-cache\" });\n  if (!response.ok) {\n    throw new Error(`Failed to load Natural Earth data from ${path}: ${response.status} ${response.statusText}`);\n  }\n\n  const parsed = (await response.json()) as NaturalEarthCollection;\n  return normalizeCollection(parsed);\n}\n\nexport async function loadNaturalEarthCountries(): Promise<NaturalEarthCollection> {\n  if (!countryCache) {\n    countryCache = await fetchCollection(COUNTRIES_PATH);\n  }\n  return countryCache;\n}\n\nexport async function loadNaturalEarthRegions(): Promise<NaturalEarthCollection> {\n  if (!regionCache) {\n    regionCache = await fetchCollection(REGIONS_PATH);\n  }\n  return regionCache;\n}\n\nfunction ensureFeature(feature: Feature<Geometry, NaturalEarthFeatureProperties> | null | undefined): NaturalEarthFeature | null {\n  if (!feature) return null;\n  const candidate = feature as NaturalEarthFeature;\n  return Array.isArray(candidate.bbox) && candidate.bbox.length === 4 ? candidate : null;\n}\n\nexport function findCountryFeatureByIso(isoCode: string | null | undefined): NaturalEarthFeature | null {\n  if (!countryCache || !isoCode) return null;\n  const normalized = isoCode.trim().toUpperCase();\n  const byIsoA2 = ensureFeature(\n    countryCache.features.find((feature) => feature.properties.isoA2?.toUpperCase() === normalized),\n  );\n  if (byIsoA2) return byIsoA2;\n\n  return ensureFeature(\n    countryCache.features.find((feature) => feature.properties.isoA3?.toUpperCase() === normalized),\n  );\n}\n\nexport function findRegionFeature(\n  isoA2: string | null | undefined,\n  iso3166_2: string | null | undefined,\n): NaturalEarthFeature | null {\n  if (!regionCache) return null;\n  const inCountry = isoA2 ? isoA2.trim().toUpperCase() : null;\n  const normalizedIso3166 = iso3166_2 ? iso3166_2.trim().toUpperCase() : null;\n\n  const directMatch = ensureFeature(\n    regionCache.features.find((feature) => {\n      const props = feature.properties;\n      if (normalizedIso3166 && props.iso3166_2?.toUpperCase() === normalizedIso3166) {\n        return true;\n      }\n      if (normalizedIso3166 && props.isoA3?.toUpperCase() === normalizedIso3166) {\n        return true;\n      }\n      return false;\n    }),\n  );\n  if (directMatch) return directMatch;\n\n  const fallback = ensureFeature(\n    regionCache.features.find((feature) => {\n      const props = feature.properties;\n      if (inCountry && props.isoA2?.toUpperCase() !== inCountry) {\n        return false;\n      }\n      return true;\n    }),\n  );\n\n  return fallback;\n}\n"],"names":["NATURAL_EARTH_BASE_PATH","COUNTRIES_PATH","REGIONS_PATH","countryCache","regionCache","normalizeCollection","parsed","features","fetchCollection","path","relative","startsWith","slice","readFile","join","Promise","all","absolutePath","process","cwd","contents","JSON","parse","response","loadNaturalEarthCountries","loadNaturalEarthRegions","ensureFeature","feature","candidate","Array","isArray","bbox","length","findCountryFeatureByIso","isoCode","normalized","trim","toUpperCase","byIsoA2","find","properties","isoA2","isoA3","findRegionFeature","iso3166_2","inCountry","normalizedIso3166","directMatch","props","fallback"],"mappings":";;;;;;;;;;AAsBA,MAAMA,0BAA0B;AAChC,MAAMC,iBAAiB,GAAGD,wBAAwB,sBAAsB,CAAC;AACzE,MAAME,eAAe,GAAGF,wBAAwB,oBAAoB,CAAC;AAErE,IAAIG,eAA8C;AAClD,IAAIC,cAA6C;AAEjD,SAASC,oBAAoBC,MAA8B;IACzD,OAAO;QACL,GAAGA,MAAM;QACTC,UAAUD,OAAOC,QAAQ,IAAI,EAAE;IACjC;AACF;AAEA,eAAeC,gBAAgBC,IAAY;IACzC,wCAAmC;QACjC,MAAMC,WAAWD,KAAKE,UAAU,CAAC,OAAOF,KAAKG,KAAK,CAAC,KAAKH;QACxD,MAAM,CAAC,EAAEI,QAAQ,EAAE,EAAE,EAAEC,IAAI,EAAE,CAAC,GAAG,MAAMC,QAAQC,GAAG,CAAC;;;SAGlD;QACD,MAAMC,eAAeH,KAAKI,QAAQC,GAAG,IAAI,UAAUT;QACnD,MAAMU,WAAW,MAAMP,SAASI,cAAc;QAC9C,MAAMX,SAASe,KAAKC,KAAK,CAACF;QAC1B,OAAOf,oBAAoBC;IAC7B;;;IAEA,MAAMiB;IAKN,MAAMjB;AAER;AAEO,eAAekB;IACpB,IAAI,CAACrB,cAAc;QACjBA,eAAe,MAAMK,gBAAgBP;IACvC;IACA,OAAOE;AACT;AAEO,eAAesB;IACpB,IAAI,CAACrB,aAAa;QAChBA,cAAc,MAAMI,gBAAgBN;IACtC;IACA,OAAOE;AACT;AAEA,SAASsB,cAAcC,OAA4E;IACjG,IAAI,CAACA,SAAS,OAAO;IACrB,MAAMC,YAAYD;IAClB,OAAOE,MAAMC,OAAO,CAACF,UAAUG,IAAI,KAAKH,UAAUG,IAAI,CAACC,MAAM,KAAK,IAAIJ,YAAY;AACpF;AAEO,SAASK,wBAAwBC,OAAkC;IACxE,IAAI,CAAC/B,gBAAgB,CAAC+B,SAAS,OAAO;IACtC,MAAMC,aAAaD,QAAQE,IAAI,GAAGC,WAAW;IAC7C,MAAMC,UAAUZ,cACdvB,aAAaI,QAAQ,CAACgC,IAAI,CAAC,CAACZ,UAAYA,QAAQa,UAAU,CAACC,KAAK,EAAEJ,kBAAkBF;IAEtF,IAAIG,SAAS,OAAOA;IAEpB,OAAOZ,cACLvB,aAAaI,QAAQ,CAACgC,IAAI,CAAC,CAACZ,UAAYA,QAAQa,UAAU,CAACE,KAAK,EAAEL,kBAAkBF;AAExF;AAEO,SAASQ,kBACdF,KAAgC,EAChCG,SAAoC;IAEpC,IAAI,CAACxC,aAAa,OAAO;IACzB,MAAMyC,YAAYJ,QAAQA,MAAML,IAAI,GAAGC,WAAW,KAAK;IACvD,MAAMS,oBAAoBF,YAAYA,UAAUR,IAAI,GAAGC,WAAW,KAAK;IAEvE,MAAMU,cAAcrB,cAClBtB,YAAYG,QAAQ,CAACgC,IAAI,CAAC,CAACZ;QACzB,MAAMqB,QAAQrB,QAAQa,UAAU;QAChC,IAAIM,qBAAqBE,MAAMJ,SAAS,EAAEP,kBAAkBS,mBAAmB;YAC7E,OAAO;QACT;QACA,IAAIA,qBAAqBE,MAAMN,KAAK,EAAEL,kBAAkBS,mBAAmB;YACzE,OAAO;QACT;QACA,OAAO;IACT;IAEF,IAAIC,aAAa,OAAOA;IAExB,MAAME,WAAWvB,cACftB,YAAYG,QAAQ,CAACgC,IAAI,CAAC,CAACZ;QACzB,MAAMqB,QAAQrB,QAAQa,UAAU;QAChC,IAAIK,aAAaG,MAAMP,KAAK,EAAEJ,kBAAkBQ,WAAW;YACzD,OAAO;QACT;QACA,OAAO;IACT;IAGF,OAAOI;AACT"}},
    {"offset": {"line": 823, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/services/radioDiscoveryService.ts"],"sourcesContent":["import { RadioStation } from \"../types\";\nimport {\n  buildCityIndex,\n  buildCountryIndex,\n  buildGenreIndex,\n  distributeStationsByCountry,\n  filterStationsByCity,\n  filterStationsByCountry,\n  filterStationsByTag,\n  searchStationsInCache,\n  summarizeCountries,\n  summarizeTags,\n} from \"./stationCacheHelpers\";\nimport { enrichStationsWithWof } from \"./location/wofEnrichmentService\";\nimport { loadNaturalEarthCountries, loadNaturalEarthRegions } from \"./location/naturalEarthService\";\n\ninterface CachedStations {\n  data: RadioStation[];\n  timestamp: number;\n  source: \"file\" | \"fallback\" | \"api\";\n}\n\ninterface CatalogMeta {\n  total: number;\n  version: string | null;\n  generatedAt: number | null;\n}\n\ntype CacheKey = \"all\" |\n  `country:${string}` |\n  `genre:${string}` |\n  `city:${string}` |\n  `tag:${string}` |\n  `search:${string}` |\n  `region:${string}` |\n  `top:${number}` |\n  `progressive:${number}` |\n  `global_distributed`;\n\nfunction resolveApiUrl(path: string): string {\n  if (typeof window !== \"undefined\") {\n    return path;\n  }\n\n  const envBase = process.env.NEXT_PUBLIC_APP_URL\n    || process.env.NEXT_PUBLIC_SITE_URL\n    || process.env.NEXTAUTH_URL\n    || (process.env.VERCEL_URL ? `https://${process.env.VERCEL_URL}` : undefined);\n\n  const fallbackBase = `http://localhost:${process.env.PORT ?? \"3000\"}`;\n  const base = envBase ?? fallbackBase;\n  const normalizedBase = base.includes(\"://\") ? base : `http://${base}`;\n  return new URL(path, normalizedBase).toString();\n}\n\n/**\n * Radio discovery service that favours our server-side JSON cache before hitting the public API.\n * This reduces latency, avoids rate limits, and keeps the UI snappy even with large datasets.\n */\nexport class RadioDiscoveryService {\n  private readonly cache = new Map<CacheKey, CachedStations>();\n  private readonly meta = new Map<string, CatalogMeta>();\n  private readonly cacheExpiryMs = 5 * 60 * 1000;\n  private readonly cacheWarmupPromise: Promise<void>;\n  private hydrated = false;\n\n  constructor() {\n    this.cacheWarmupPromise = this.hydrateFromServerCache();\n  }\n\n  /**\n   * Get ALL stations from server-side cache (JSON file)\n   */\n  async getAllStations(): Promise<RadioStation[]> {\n    await this.cacheWarmupPromise;\n    const cached = this.cache.get(\"all\");\n    if (cached) {\n      return cached.data;\n    }\n    return this.getFallbackStations();\n  }\n\n  /**\n   * Force refresh the server cache\n   */\n  async refreshCache(): Promise<void> {\n    try {\n      const response = await fetch(resolveApiUrl(\"/api/stations/refresh\"), {\n        method: \"POST\",\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to trigger cache refresh\");\n      }\n\n      await this.hydrateFromServerCache(true);\n    } catch (error) {\n      console.warn(\"Failed to refresh cache:\", error);\n    }\n  }\n\n  /**\n   * Search radio stations from Radio Browser API\n   */\n  async searchOnlineStations(\n    query: string,\n    limit: number = 50,\n  ): Promise<RadioStation[]> {\n    await this.cacheWarmupPromise;\n    const cacheKey = `search:${query.toLowerCase()}` as CacheKey;\n    const cached = this.getFromCache(cacheKey);\n    if (cached) {\n      return cached.slice(0, limit);\n    }\n\n    const stations = searchStationsInCache(this.getAllCachedStations(), query);\n    this.setCache(cacheKey, stations);\n    return stations.slice(0, limit);\n  }\n\n  /**\n   * Get stations by country from Radio Browser API\n   */\n  async getStationsByCountry(\n    country: string,\n    limit: number = 100,\n  ): Promise<RadioStation[]> {\n    await this.cacheWarmupPromise;\n    const normalized = this.normalizeCountryKey(country);\n    const cacheKey = `country:${normalized}` as CacheKey;\n    const cached = this.getFromCache(cacheKey);\n    const base = cached || filterStationsByCountry(this.getAllCachedStations(), normalized);\n    this.setCache(cacheKey, base);\n    return base.slice(0, limit);\n  }\n\n  /**\n   * Get top stations globally with country-based distribution\n   */\n  async getTopStations(limit: number = 5000): Promise<RadioStation[]> {\n    await this.cacheWarmupPromise;\n    const cacheKey = `top:${limit}` as CacheKey;\n    const cached = this.getFromCache(cacheKey);\n    if (cached) {\n      return cached;\n    }\n\n    const sorted = this.getAllCachedStations()\n      .slice()\n      .sort((a, b) => (b.listeners || 0) - (a.listeners || 0));\n\n    const result = sorted.slice(0, limit);\n    this.setCache(cacheKey, result);\n    return result;\n  }\n\n  /**\n   * Load stations with geographic distribution for better global coverage\n   */\n  async getGlobalStationsWithDistribution(): Promise<RadioStation[]> {\n    await this.cacheWarmupPromise;\n    const cacheKey = \"global_distributed\" as CacheKey;\n    const cached = this.getFromCache(cacheKey);\n    if (cached) return cached;\n\n    const distributed = distributeStationsByCountry(this.getAllCachedStations(), 5000);\n\n    this.setCache(cacheKey, distributed);\n    return distributed;\n  }\n\n  /**\n   * Get stations within a geographic region\n   */\n  async getStationsByRegion(\n    bounds: {\n      north: number;\n      south: number;\n      east: number;\n      west: number;\n    },\n    limit: number = 500\n  ): Promise<RadioStation[]> {\n    const cacheKey = `region:${bounds.north}:${bounds.south}:${bounds.east}:${bounds.west}:${limit}` as CacheKey;\n    const cached = this.getFromCache(cacheKey);\n    if (cached) return cached.slice(0, limit);\n\n    try {\n      // Radio Browser doesn't have direct geographic bounds API, so we'll get by popular countries in region\n      const countriesInRegion = this.getCountriesInBounds(bounds);\n      const allStations: RadioStation[] = [];\n\n      for (const country of countriesInRegion) {\n        const countryStations = await this.getStationsByCountry(country, Math.floor(limit / countriesInRegion.length));\n        allStations.push(...countryStations);\n      }\n\n      // Filter stations that are actually within bounds\n      const stationsInBounds = allStations.filter(station => \n        station.location.lat >= bounds.south &&\n        station.location.lat <= bounds.north &&\n        station.location.lng >= bounds.west &&\n        station.location.lng <= bounds.east\n      );\n\n      this.setCache(cacheKey, stationsInBounds);\n      return stationsInBounds.slice(0, limit);\n    } catch (error) {\n      console.warn(\"Failed to fetch regional stations:\", error);\n      return [];\n    }\n  }\n\n  /**\n   * Get progressive stations based on zoom level\n   */\n  async getProgressiveStations(\n    zoomLevel: number,\n    visibleRegion?: {\n      north: number;\n      south: number; \n      east: number;\n      west: number;\n    }\n  ): Promise<RadioStation[]> {\n    // Adjust station count based on zoom level\n    const stationCount = Math.min(2000, Math.max(100, Math.floor(zoomLevel * 300)));\n\n    if (visibleRegion && zoomLevel > 3) {\n      // High zoom - get regional stations\n      return this.getStationsByRegion(visibleRegion, stationCount);\n    } else {\n      // Low zoom - get global top stations\n      return this.getTopStations(stationCount);\n    }\n  }\n\n  /**\n   * Get stations by tag/genre\n   */\n  async getStationsByTag(\n    tag: string,\n    limit: number = 50,\n  ): Promise<RadioStation[]> {\n    const normalized = tag.trim().toLowerCase();\n    const cacheKey = `tag:${normalized}` as CacheKey;\n    const cached = this.getFromCache(cacheKey);\n    if (cached) return cached.slice(0, limit);\n\n    const sorted = filterStationsByTag(this.getAllCachedStations(), normalized);\n    this.setCache(cacheKey, sorted);\n    return sorted.slice(0, limit);\n  }\n\n  /**\n   * Get stations by city from Radio Browser API\n   */\n  async getStationsByCity(\n    city: string,\n    limit: number = 50,\n  ): Promise<RadioStation[]> {\n    const normalized = city.trim().toLowerCase();\n    const cacheKey = `city:${normalized}` as CacheKey;\n    const cached = this.getFromCache(cacheKey);\n    if (cached) return cached.slice(0, limit);\n\n    const sorted = filterStationsByCity(this.getAllCachedStations(), normalized);\n    this.setCache(cacheKey, sorted);\n    return sorted.slice(0, limit);\n  }\n\n  /**\n   * Get available countries\n   */\n  async getCountries(): Promise<\n    Array<{ name: string; iso: string; stationcount: number }>\n  > {\n    await this.cacheWarmupPromise;\n    return summarizeCountries(this.getAllCachedStations());\n  }\n\n  /**\n   * Get available tags/genres\n   */\n  async getTags(): Promise<Array<{ name: string; stationcount: number }>> {\n    await this.cacheWarmupPromise;\n    return summarizeTags(this.getAllCachedStations());\n  }\n\n  /**\n   * Map Radio Browser API response to our RadioStation format\n   */\n  private mapRadioBrowserStations(data: any[]): RadioStation[] {\n    return data\n      .filter((station) => station.url && station.name)\n      .map((station, index) => {\n        let lat = parseFloat(station.geo_lat) || 0;\n        let lng = parseFloat(station.geo_long) || 0;\n\n        // If no coordinates, assign default location based on country\n        if (lat === 0 && lng === 0) {\n          const defaultCoords = this.getDefaultCountryCoordinates(\n            station.country,\n          );\n          lat = defaultCoords.lat + (Math.random() - 0.5) * 2; // Add small random offset\n          lng = defaultCoords.lng + (Math.random() - 0.5) * 2;\n        }\n\n        return {\n          id: station.stationuuid || `station-${index}`,\n          name: station.name || \"Unknown Station\",\n          url: station.url,\n          location: {\n            city: station.state || \"Unknown\",\n            country: station.country || \"Unknown\",\n            countryCode: station.countrycode || undefined,\n            lat,\n            lng,\n          },\n          genre: station.tags || station.genre || \"Various\",\n          language: station.language || \"Unknown\",\n          listeners: station.clickcount || 0,\n          bitrate: station.bitrate || 128,\n          description: station.homepage || \"\",\n          isPublic: true,\n          source: \"radio-browser\" as const,\n        };\n      })\n      .filter(\n        (station) => station.location.lat !== 0 || station.location.lng !== 0,\n      ); // Filter out stations without coordinates\n  }\n\n  /**\n   * Cache management\n   */\n  private wrap(data: RadioStation[], source: CachedStations[\"source\"]): CachedStations {\n    return {\n      data,\n      timestamp: Date.now(),\n      source,\n    };\n  }\n\n  private getAllCachedStations(): RadioStation[] {\n    return this.cache.get(\"all\")?.data || [];\n  }\n\n  private getFromCache(key: CacheKey): RadioStation[] | null {\n    const cached = this.cache.get(key);\n    if (!cached) return null;\n    if (Date.now() - cached.timestamp > this.cacheExpiryMs) {\n      this.cache.delete(key);\n      return null;\n    }\n    return cached.data;\n  }\n\n  private setCache(key: CacheKey, data: RadioStation[], source: CachedStations[\"source\"] = \"file\"): void {\n    this.cache.set(key, this.wrap(data, source));\n  }\n\n  private async hydrateFromServerCache(force = false): Promise<void> {\n    if (this.hydrated && !force) return;\n\n    const [countries, regions] = await Promise.all([\n      loadNaturalEarthCountries(),\n      loadNaturalEarthRegions(),\n    ]);\n\n    try {\n      const response = await fetch(resolveApiUrl(\"/api/stations\"));\n      if (!response.ok) {\n        throw new Error(\"Failed to fetch stations from cache API\");\n      }\n\n      const payload = await response.json();\n      const mappedStations = this.mapRadioBrowserStations(payload.stations || []);\n      const stations = await enrichStationsWithWof(mappedStations, countries, regions);\n      this.setCache(\"all\", stations, payload.cached ? \"file\" : \"api\");\n      this.meta.set(\"all\", {\n        total: stations.length,\n        version: payload.version ?? null,\n        generatedAt: payload.timestamp ?? null,\n      });\n\n      // Precompute indexes for quicker lookups\n      this.indexCountries(stations);\n      this.indexGenres(stations);\n      this.indexCities(stations);\n\n      this.hydrated = true;\n    } catch (error) {\n      console.warn(\"Failed to hydrate cache:\", error);\n      const fallback = await enrichStationsWithWof(this.getFallbackStations(), countries, regions);\n      this.setCache(\"all\", fallback, \"fallback\");\n    }\n  }\n\n  private indexCountries(stations: RadioStation[]): void {\n    const countryIndex = buildCountryIndex(stations);\n    countryIndex.forEach((list, key) => {\n      this.setCache(`country:${key}` as CacheKey, list);\n    });\n  }\n\n  private indexGenres(stations: RadioStation[]): void {\n    const genreIndex = buildGenreIndex(stations);\n    genreIndex.forEach((list, key) => {\n      this.setCache(`genre:${key}` as CacheKey, list);\n      this.setCache(`tag:${key}` as CacheKey, list);\n    });\n  }\n\n  private indexCities(stations: RadioStation[]): void {\n    const cityIndex = buildCityIndex(stations);\n    cityIndex.forEach((list, key) => {\n      this.setCache(`city:${key}` as CacheKey, list);\n    });\n  }\n\n  /**\n   * Get default coordinates for a country\n   */\n  private getDefaultCountryCoordinates(country: string): {\n    lat: number;\n    lng: number;\n  } {\n    const countryDefaults: { [key: string]: { lat: number; lng: number } } = {\n      Germany: { lat: 51.1657, lng: 10.4515 },\n      \"United States\": { lat: 39.8283, lng: -98.5795 },\n      USA: { lat: 39.8283, lng: -98.5795 },\n      \"United Kingdom\": { lat: 55.3781, lng: -3.436 },\n      UK: { lat: 55.3781, lng: -3.436 },\n      France: { lat: 46.2276, lng: 2.2137 },\n      Italy: { lat: 41.8719, lng: 12.5674 },\n      Spain: { lat: 40.4637, lng: -3.7492 },\n      Canada: { lat: 56.1304, lng: -106.3468 },\n      Australia: { lat: -25.2744, lng: 133.7751 },\n      Japan: { lat: 36.2048, lng: 138.2529 },\n      Brazil: { lat: -14.235, lng: -51.9253 },\n      Netherlands: { lat: 52.1326, lng: 5.2913 },\n      Austria: { lat: 47.5162, lng: 14.5501 },\n      Switzerland: { lat: 46.8182, lng: 8.2275 },\n    };\n\n    return countryDefaults[country] || { lat: 0, lng: 0 };\n  }\n\n  /**\n   * Calculate distance between two coordinates\n   */\n  private calculateDistance(\n    lat1: number,\n    lon1: number,\n    lat2: number,\n    lon2: number,\n  ): number {\n    const R = 6371; // Earth's radius in kilometers\n    const dLat = ((lat2 - lat1) * Math.PI) / 180;\n    const dLon = ((lon2 - lon1) * Math.PI) / 180;\n    const a =\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n      Math.cos((lat1 * Math.PI) / 180) *\n        Math.cos((lat2 * Math.PI) / 180) *\n        Math.sin(dLon / 2) *\n        Math.sin(dLon / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    return R * c;\n  }\n\n  /**\n   * Get countries that intersect with geographic bounds\n   */\n  private getCountriesInBounds(bounds: {\n    north: number;\n    south: number;\n    east: number;\n    west: number;\n  }): string[] {\n    // Simplified region to country mapping\n    const allCountries = [\n      \"United States\", \"Canada\", \"Mexico\", \"Brazil\", \"Argentina\", \"Chile\",\n      \"United Kingdom\", \"France\", \"Germany\", \"Italy\", \"Spain\", \"Netherlands\",\n      \"Russia\", \"China\", \"Japan\", \"South Korea\", \"India\", \"Australia\",\n      \"South Africa\", \"Egypt\", \"Nigeria\", \"Kenya\"\n    ];\n\n    // For now, return all major countries. In a real implementation,\n    // you'd have a proper geographic database\n    return allCountries.slice(0, 8);\n  }\n\n  /**\n   * Get fallback stations when API fails\n   */\n  private getFallbackStations(): RadioStation[] {\n    // Return a small set of popular global stations as fallback\n    return [\n      {\n        id: \"fallback-bbc1\",\n        name: \"BBC Radio 1\",\n        url: \"http://stream.live.vc.bbcmedia.co.uk/bbc_radio_one\",\n        location: { city: \"London\", country: \"United Kingdom\", lat: 51.5074, lng: -0.1278 },\n        genre: \"Pop\",\n        language: \"English\",\n        listeners: 1000000,\n        source: \"curated\" as const\n      },\n      {\n        id: \"fallback-npr\",\n        name: \"NPR News\",\n        url: \"https://npr-ice.streamguys1.com/live.mp3\",\n        location: { city: \"Washington DC\", country: \"United States\", lat: 38.9072, lng: -77.0369 },\n        genre: \"News\",\n        language: \"English\", \n        listeners: 500000,\n        source: \"curated\" as const\n      }\n    ];\n  }\n\n  private normalizeCountryKey(country: string): string {\n    return country.trim().toLowerCase();\n  }\n}\n\n// Singleton instance\nexport const radioDiscoveryService = new RadioDiscoveryService();\n"],"names":["resolveApiUrl","path","envBase","process","env","NEXT_PUBLIC_APP_URL","NEXT_PUBLIC_SITE_URL","NEXTAUTH_URL","VERCEL_URL","undefined","fallbackBase","PORT","base","normalizedBase","includes","URL","toString","RadioDiscoveryService","cache","Map","meta","cacheExpiryMs","cacheWarmupPromise","hydrated","hydrateFromServerCache","getAllStations","cached","get","data","getFallbackStations","refreshCache","response","fetch","method","ok","Error","error","console","warn","searchOnlineStations","query","limit","cacheKey","toLowerCase","getFromCache","slice","stations","getAllCachedStations","setCache","getStationsByCountry","country","normalized","normalizeCountryKey","getTopStations","sorted","sort","a","b","listeners","result","getGlobalStationsWithDistribution","distributed","getStationsByRegion","bounds","north","south","east","west","countriesInRegion","getCountriesInBounds","allStations","countryStations","Math","floor","length","push","stationsInBounds","filter","station","location","lat","lng","getProgressiveStations","zoomLevel","visibleRegion","stationCount","min","max","getStationsByTag","tag","trim","getStationsByCity","city","getCountries","getTags","mapRadioBrowserStations","url","name","map","index","parseFloat","geo_lat","geo_long","defaultCoords","getDefaultCountryCoordinates","random","id","stationuuid","state","countryCode","countrycode","genre","tags","language","clickcount","bitrate","description","homepage","isPublic","source","wrap","timestamp","Date","now","key","delete","set","force","countries","regions","Promise","all","payload","json","mappedStations","total","version","generatedAt","indexCountries","indexGenres","indexCities","fallback","countryIndex","forEach","list","genreIndex","cityIndex","countryDefaults","Germany","USA","UK","France","Italy","Spain","Canada","Australia","Japan","Brazil","Netherlands","Austria","Switzerland","calculateDistance","lat1","lon1","lat2","lon2","R","dLat","PI","dLon","sin","cos","c","atan2","sqrt","allCountries","radioDiscoveryService"],"mappings":"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"}},
    {"offset": {"line": 1262, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/services/radioStationService.ts"],"sourcesContent":["// import { globalRadioStations } from '../data/globalRadioStations'\nimport { RadioStation } from \"../types/index\";\nimport { radioDiscoveryService } from \"./radioDiscoveryService\";\n\nexport class RadioStationService {\n  private stations: RadioStation[] = [];\n  private proxyUrl = \"/api/proxy/audio\";\n  private discoveredStations: RadioStation[] = [];\n  private isDiscoveryEnabled = true;\n  private allCachedStations: RadioStation[] = [];\n  private cacheLoaded = false;\n\n  /**\n   * Load all stations from cache (once per session)\n   */\n  private async ensureCacheLoaded(): Promise<void> {\n    if (this.cacheLoaded) return;\n    \n    try {\n      this.allCachedStations = await radioDiscoveryService.getAllStations();\n      this.cacheLoaded = true;\n      console.log(`Loaded ${this.allCachedStations.length} stations into search cache`);\n    } catch (error) {\n      console.warn('Failed to load station cache:', error);\n      this.allCachedStations = [];\n    }\n  }\n\n  /**\n   * Get all radio stations (curated + discovered)\n   */\n  getAllStations(): RadioStation[] {\n    return [...this.stations, ...this.discoveredStations];\n  }\n\n  /**\n   * Get curated stations only\n   */\n  getCuratedStations(): RadioStation[] {\n    return this.stations;\n  }\n\n  /**\n   * Enhanced search that searches ALL cached stations (fast, comprehensive)\n   */\n  async searchStations(\n    query: string,\n    includeOnline: boolean = true,\n  ): Promise<RadioStation[]> {\n    await this.ensureCacheLoaded();\n    \n    const searchTerm = query.toLowerCase().trim();\n    if (!searchTerm) return [];\n\n    // Search across ALL cached stations (fast in-memory search)\n    const results = this.allCachedStations.filter(\n      (station) =>\n        station.name.toLowerCase().includes(searchTerm) ||\n        station.location?.country?.toLowerCase().includes(searchTerm) ||\n        station.location?.city?.toLowerCase().includes(searchTerm) ||\n        station.genre?.toLowerCase().includes(searchTerm) ||\n        station.language?.toLowerCase().includes(searchTerm) ||\n        (station.description && station.description.toLowerCase().includes(searchTerm))\n    );\n\n    // Sort by relevance: exact matches first, then by listeners/popularity\n    const sorted = results.sort((a, b) => {\n      const aExact = a.name.toLowerCase() === searchTerm;\n      const bExact = b.name.toLowerCase() === searchTerm;\n      if (aExact && !bExact) return -1;\n      if (!aExact && bExact) return 1;\n      return (b.listeners || 0) - (a.listeners || 0);\n    });\n\n    return sorted.slice(0, 100); // Return top 100 matches\n  }\n\n  /**\n   * Search only local curated stations\n   */\n  private searchLocalStations(query: string): RadioStation[] {\n    const searchTerm = query.toLowerCase();\n\n    return this.stations.filter(\n      (station) =>\n        station.name.toLowerCase().includes(searchTerm) ||\n        station.location.city.toLowerCase().includes(searchTerm) ||\n        station.location.country.toLowerCase().includes(searchTerm) ||\n        station.genre.toLowerCase().includes(searchTerm) ||\n        station.language.toLowerCase().includes(searchTerm) ||\n        (station.description &&\n          station.description.toLowerCase().includes(searchTerm)),\n    );\n  }\n\n  /**\n   * Enhanced country search that works with comprehensive cached data\n   */\n  async getStationsByCountry(\n    country: string,\n    includeOnline: boolean = true,\n  ): Promise<RadioStation[]> {\n    await this.ensureCacheLoaded();\n    \n    const countryLower = country.trim().toLowerCase();\n    const normalizedCode = this.getCountryCode(countryLower) || (countryLower.length > 0 && countryLower.length <= 3 ? countryLower.toUpperCase() : null);\n    const normalizedCodeLower = normalizedCode?.toLowerCase() || null;\n\n    const countryStations = this.allCachedStations.filter((station) => {\n      const name = station.location?.country?.toLowerCase() || \"\";\n      const code = station.location?.countryCode?.toLowerCase() || \"\";\n\n      if (normalizedCodeLower && code === normalizedCodeLower) {\n        return true;\n      }\n\n      if (name === countryLower) {\n        return true;\n      }\n\n      // Support partial matches while avoiding overly broad contains() matches\n      return !normalizedCodeLower && name.startsWith(countryLower);\n    });\n    \n    // Sort by popularity (listeners/clicks)\n    const sorted = countryStations.sort((a, b) => (b.listeners || 0) - (a.listeners || 0));\n    \n    console.log(`Found ${sorted.length} stations for country: ${country}`);\n    return sorted.slice(0, 100); // Return top 100\n  }\n\n  /**\n   * Get popular/top stations with online integration\n   */\n  async getPopularStations(\n    limit: number = 20,\n    includeOnline: boolean = true,\n  ): Promise<RadioStation[]> {\n    const localPopular = [...this.stations]\n      .sort((a, b) => b.listeners - a.listeners)\n      .slice(0, limit);\n\n    if (!includeOnline || !this.isDiscoveryEnabled) {\n      return localPopular;\n    }\n\n    try {\n      const onlineTop = await radioDiscoveryService.getTopStations(limit);\n      return this.mergeStationResults(localPopular, onlineTop).slice(0, limit);\n    } catch (error) {\n      console.warn(\"Failed to fetch online top stations:\", error);\n      return localPopular;\n    }\n  }\n\n  /**\n   * Get stations by genre from cached data (fast search)\n   */\n  async getStationsByGenre(\n    genre: string,\n    includeOnline: boolean = true,\n  ): Promise<RadioStation[]> {\n    await this.ensureCacheLoaded();\n    \n    const genreLower = genre.toLowerCase();\n    const genreStations = this.allCachedStations.filter((station) =>\n      station.genre?.toLowerCase().includes(genreLower) ||\n      station.tags?.some(tag => tag.toLowerCase().includes(genreLower))\n    );\n    \n    // Sort by popularity\n    const sorted = genreStations.sort((a, b) => (b.listeners || 0) - (a.listeners || 0));\n    \n    console.log(`Found ${sorted.length} stations for genre: ${genre}`);\n    return sorted.slice(0, 100);\n  }\n\n  /**\n   * Get all unique cities from cached stations\n   */\n  async getAvailableCities(): Promise<string[]> {\n    await this.ensureCacheLoaded();\n    \n    const cities = Array.from(\n      new Set(\n        this.allCachedStations\n          .map((station) => station.location?.city)\n          .filter(city => city && city.trim() !== '')\n      )\n    );\n    \n    return cities.sort();\n  }\n\n  /**\n   * Get stations by city from cached data (fast search)\n   */\n  async getStationsByCity(\n    city: string,\n    includeOnline: boolean = true,\n  ): Promise<RadioStation[]> {\n    await this.ensureCacheLoaded();\n    \n    const cityLower = city.toLowerCase();\n    const cityStations = this.allCachedStations.filter(\n      (station) =>\n        station.location?.city?.toLowerCase().includes(cityLower)\n    );\n    \n    // Sort by popularity\n    const sorted = cityStations.sort((a, b) => (b.listeners || 0) - (a.listeners || 0));\n    \n    console.log(`Found ${sorted.length} stations for city: ${city}`);\n    return sorted.slice(0, 100);\n  }\n\n  /**\n   * Private helper methods\n   */\n  private mergeStationResults(\n    local: RadioStation[],\n    online: RadioStation[],\n  ): RadioStation[] {\n    const merged = [...local];\n    const existingUrls = new Set(local.map((s) => s.url));\n\n    for (const station of online) {\n      if (!existingUrls.has(station.url)) {\n        merged.push(station);\n      }\n    }\n\n    return merged;\n  }\n\n  private getCountryCode(countryName: string): string | null {\n    // Comprehensive country code mapping for global radio stations\n    const countryMap: Record<string, string> = {\n      // North America\n      \"united states\": \"US\", \"usa\": \"US\", \"us\": \"US\",\n      \"canada\": \"CA\", \"ca\": \"CA\",\n      \"mexico\": \"MX\", \"mx\": \"MX\",\n      \n      // Europe\n      \"united kingdom\": \"GB\", \"uk\": \"GB\", \"gb\": \"GB\", \"britain\": \"GB\",\n      \"germany\": \"DE\", \"de\": \"DE\",\n      \"france\": \"FR\", \"fr\": \"FR\",\n      \"italy\": \"IT\", \"it\": \"IT\",\n      \"spain\": \"ES\", \"es\": \"ES\",\n      \"netherlands\": \"NL\", \"nl\": \"NL\", \"holland\": \"NL\",\n      \"sweden\": \"SE\", \"se\": \"SE\",\n      \"norway\": \"NO\", \"no\": \"NO\",\n      \"denmark\": \"DK\", \"dk\": \"DK\",\n      \"finland\": \"FI\", \"fi\": \"FI\",\n      \"switzerland\": \"CH\", \"ch\": \"CH\",\n      \"austria\": \"AT\", \"at\": \"AT\",\n      \"belgium\": \"BE\", \"be\": \"BE\",\n      \"poland\": \"PL\", \"pl\": \"PL\",\n      \"russia\": \"RU\", \"ru\": \"RU\",\n      \"turkey\": \"TR\", \"tr\": \"TR\",\n      \n      // Asia-Pacific\n      \"japan\": \"JP\", \"jp\": \"JP\",\n      \"south korea\": \"KR\", \"korea\": \"KR\", \"kr\": \"KR\",\n      \"china\": \"CN\", \"cn\": \"CN\",\n      \"india\": \"IN\", \"in\": \"IN\",\n      \"australia\": \"AU\", \"au\": \"AU\",\n      \"new zealand\": \"NZ\", \"nz\": \"NZ\",\n      \"singapore\": \"SG\", \"sg\": \"SG\",\n      \"thailand\": \"TH\", \"th\": \"TH\",\n      \"malaysia\": \"MY\", \"my\": \"MY\",\n      \"indonesia\": \"ID\", \"id\": \"ID\",\n      \"philippines\": \"PH\", \"ph\": \"PH\",\n      \n      // Latin America\n      \"brazil\": \"BR\", \"br\": \"BR\",\n      \"argentina\": \"AR\", \"ar\": \"AR\",\n      \"chile\": \"CL\", \"cl\": \"CL\",\n      \"colombia\": \"CO\", \"co\": \"CO\",\n      \"peru\": \"PE\", \"pe\": \"PE\",\n      \"venezuela\": \"VE\", \"ve\": \"VE\",\n      \"uruguay\": \"UY\", \"uy\": \"UY\",\n      \n      // Africa\n      \"south africa\": \"ZA\", \"za\": \"ZA\",\n      \"nigeria\": \"NG\", \"ng\": \"NG\",\n      \"egypt\": \"EG\", \"eg\": \"EG\",\n      \"kenya\": \"KE\", \"ke\": \"KE\",\n      \"ethiopia\": \"ET\", \"et\": \"ET\",\n      \"ghana\": \"GH\", \"gh\": \"GH\",\n      \"tunisia\": \"TN\", \"tn\": \"TN\",\n      \"morocco\": \"MA\", \"ma\": \"MA\",\n      \"zambia\": \"ZM\", \"zm\": \"ZM\",\n      \"zimbabwe\": \"ZW\", \"zw\": \"ZW\",\n      \"tanzania\": \"TZ\", \"tz\": \"TZ\",\n      \"uganda\": \"UG\", \"ug\": \"UG\",\n      \"mozambique\": \"MZ\", \"mz\": \"MZ\",\n      \"botswana\": \"BW\", \"bw\": \"BW\",\n      \"namibia\": \"NA\", \"na\": \"NA\",\n      \"angola\": \"AO\", \"ao\": \"AO\",\n      \"mali\": \"ML\", \"ml\": \"ML\",\n      \"senegal\": \"SN\", \"sn\": \"SN\",\n      \"burkina faso\": \"BF\", \"bf\": \"BF\",\n      \"ivory coast\": \"CI\", \"ci\": \"CI\", \"cote divoire\": \"CI\",\n      \"cameroon\": \"CM\", \"cm\": \"CM\",\n      \"democratic republic of congo\": \"CD\", \"drc\": \"CD\", \"congo\": \"CG\",\n      \"rwanda\": \"RW\", \"rw\": \"RW\",\n      \"madagascar\": \"MG\", \"mg\": \"MG\",\n      \"algeria\": \"DZ\", \"dz\": \"DZ\",\n      \"libya\": \"LY\", \"ly\": \"LY\",\n      \"sudan\": \"SD\", \"sd\": \"SD\",\n      \"chad\": \"TD\", \"td\": \"TD\",\n      \"niger\": \"NE\", \"ne\": \"NE\",\n      \n      // Middle East\n      \"israel\": \"IL\", \"il\": \"IL\",\n      \"saudi arabia\": \"SA\", \"sa\": \"SA\",\n      \"united arab emirates\": \"AE\", \"uae\": \"AE\", \"ae\": \"AE\",\n      \"qatar\": \"QA\", \"qa\": \"QA\",\n      \"kuwait\": \"KW\", \"kw\": \"KW\",\n      \"iran\": \"IR\", \"ir\": \"IR\"\n    };\n\n    return countryMap[countryName.toLowerCase()] || null;\n  }\n\n  /**\n   * Get stations by continent\n   */\n  getStationsByContinent(continent: string): RadioStation[] {\n    const continentCountries: Record<string, string[]> = {\n      \"north-america\": [\"United States\", \"Canada\", \"Mexico\"],\n      \"south-america\": [\"Brazil\", \"Argentina\", \"Chile\", \"Colombia\", \"Peru\"],\n      europe: [\n        \"United Kingdom\",\n        \"France\",\n        \"Germany\",\n        \"Italy\",\n        \"Spain\",\n        \"Netherlands\",\n        \"Switzerland\",\n      ],\n      asia: [\"Japan\", \"South Korea\", \"China\", \"India\", \"Singapore\", \"Thailand\"],\n      africa: [\"South Africa\", \"Nigeria\", \"Kenya\", \"Egypt\", \"Zambia\", \"Zimbabwe\", \"Tanzania\", \"Uganda\", \"Ghana\", \"Ethiopia\", \"Morocco\", \"Algeria\", \"Tunisia\", \"Rwanda\", \"Botswana\", \"Namibia\", \"Angola\", \"Mozambique\", \"Mali\", \"Senegal\", \"Cameroon\", \"Madagascar\"],\n      oceania: [\"Australia\", \"New Zealand\"],\n    };\n\n    const countries = continentCountries[continent.toLowerCase()] || [];\n    return this.stations.filter((station) =>\n      countries.includes(station.location.country),\n    );\n  }\n\n  /**\n   * Get unique countries from cached stations\n   */\n  async getAvailableCountries(): Promise<string[]> {\n    await this.ensureCacheLoaded();\n    \n    const countries = Array.from(\n      new Set(\n        this.allCachedStations\n          .map((station) => station.location?.country)\n          .filter(country => country && country !== 'Unknown')\n      )\n    );\n    \n    return countries.sort((a, b) => a.localeCompare(b));\n  }\n\n  /**\n   * Get unique countries\n   */\n  getCountries(): string[] {\n    const countries = Array.from(\n      new Set(this.stations.map((station) => station.location.country)),\n    );\n    return countries.sort();\n  }\n\n  /**\n   * Get unique cities for a country\n   */\n  getCitiesInCountry(country: string): string[] {\n    const cities = this.stations\n      .filter((station) => station.location.country === country)\n      .map((station) => station.location.city);\n\n    return Array.from(new Set(cities)).sort();\n  }\n\n  /**\n   * Get unique genres\n   */\n  getGenres(): string[] {\n    const genres = Array.from(\n      new Set(this.stations.map((station) => station.genre)),\n    );\n    return genres.sort();\n  }\n\n  /**\n   * Get unique languages\n   */\n  getLanguages(): string[] {\n    const languages = Array.from(\n      new Set(this.stations.map((station) => station.language)),\n    );\n    return languages.sort();\n  }\n\n  /**\n   * Get proxied stream URL to avoid CORS issues\n   */\n  getProxiedStreamUrl(station: RadioStation): string {\n    // For known CORS-free streams, return direct URL\n    const corsFreeHosts = [\n      \"ice1.somafm.com\",\n      \"stream.srg-ssr.ch\",\n      \"streams.kqed.org\",\n    ];\n\n    try {\n      const url = new URL(station.url);\n      if (corsFreeHosts.some((host) => url.hostname.includes(host))) {\n        return station.url;\n      }\n    } catch {\n      // Invalid URL, use proxy\n    }\n\n    // Use proxy for potentially CORS-blocked streams\n    return `${this.proxyUrl}?url=${encodeURIComponent(station.url)}`;\n  }\n\n  /**\n   * Get station by ID\n   */\n  getStationById(id: string): RadioStation | undefined {\n    return this.stations.find((station) => station.id === id);\n  }\n\n  /**\n   * Get random stations\n   */\n  getRandomStations(count: number = 5): RadioStation[] {\n    const shuffled = [...this.stations].sort(() => 0.5 - Math.random());\n    return shuffled.slice(0, count);\n  }\n\n  /**\n   * Calculate distance between two points (Haversine formula)\n   */\n  private calculateDistance(\n    lat1: number,\n    lng1: number,\n    lat2: number,\n    lng2: number,\n  ): number {\n    const R = 6371; // Earth's radius in km\n    const dLat = this.toRad(lat2 - lat1);\n    const dLng = this.toRad(lng2 - lng1);\n\n    const a =\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n      Math.cos(this.toRad(lat1)) *\n        Math.cos(this.toRad(lat2)) *\n        Math.sin(dLng / 2) *\n        Math.sin(dLng / 2);\n\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    return R * c;\n  }\n\n  private toRad(degrees: number): number {\n    return degrees * (Math.PI / 180);\n  }\n}\n\n// Export singleton instance\nexport const radioStationService = new RadioStationService();\n"],"names":["RadioStationService","stations","proxyUrl","discoveredStations","isDiscoveryEnabled","allCachedStations","cacheLoaded","ensureCacheLoaded","getAllStations","console","log","length","error","warn","getCuratedStations","searchStations","query","includeOnline","searchTerm","toLowerCase","trim","results","filter","station","name","includes","location","country","city","genre","language","description","sorted","sort","a","b","aExact","bExact","listeners","slice","searchLocalStations","getStationsByCountry","countryLower","normalizedCode","getCountryCode","toUpperCase","normalizedCodeLower","countryStations","code","countryCode","startsWith","getPopularStations","limit","localPopular","onlineTop","getTopStations","mergeStationResults","getStationsByGenre","genreLower","genreStations","tags","some","tag","getAvailableCities","cities","Array","from","Set","map","getStationsByCity","cityLower","cityStations","local","online","merged","existingUrls","s","url","has","push","countryName","countryMap","getStationsByContinent","continent","continentCountries","europe","asia","africa","oceania","countries","getAvailableCountries","localeCompare","getCountries","getCitiesInCountry","getGenres","genres","getLanguages","languages","getProxiedStreamUrl","corsFreeHosts","URL","host","hostname","encodeURIComponent","getStationById","id","find","getRandomStations","count","shuffled","Math","random","calculateDistance","lat1","lng1","lat2","lng2","R","dLat","toRad","dLng","sin","cos","c","atan2","sqrt","degrees","PI","radioStationService"],"mappings":"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"}},
    {"offset": {"line": 1724, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/hooks/useModularAudio.ts"],"sourcesContent":["import { useState, useRef, useEffect, useCallback, useMemo } from \"react\";\nimport { RadioStation } from \"../types\";\nimport { AudioService, AudioState } from \"../services/audioService\";\nimport { radioStationService } from \"../services/radioStationService\";\n\ninterface UseModularAudioOptions {\n  volume?: number;\n  autoPlay?: boolean;\n  retryAttempts?: number;\n  retryDelay?: number;\n}\n\ninterface ModularAudioState {\n  isPlaying: boolean;\n  isLoading: boolean;\n  error: string | null;\n  volume: number;\n  isMuted: boolean;\n  currentTime: number;\n  state: AudioState;\n  currentStation: RadioStation | null;\n}\n\ninterface ModularAudioActions {\n  play: () => Promise<void>;\n  pause: () => void;\n  setVolume: (volume: number) => void;\n  toggleMute: () => void;\n  loadStation: (station: RadioStation) => Promise<void>;\n  clearError: () => void;\n  getAudioElement: () => HTMLAudioElement | null;\n}\n\nexport function useModularAudio(\n  options: UseModularAudioOptions = {},\n): [ModularAudioState, ModularAudioActions] {\n  const audioServiceRef = useRef<AudioService | null>(null);\n\n  // Memoize options to prevent infinite loops\n  const memoizedOptions = useMemo(\n    () => ({\n      volume: options.volume || 0.7,\n      autoPlay: options.autoPlay || false,\n      retryAttempts: options.retryAttempts || 3,\n      retryDelay: options.retryDelay || 2000,\n    }),\n    [\n      options.volume,\n      options.autoPlay,\n      options.retryAttempts,\n      options.retryDelay,\n    ],\n  );\n\n  const [state, setState] = useState<ModularAudioState>(() => ({\n    isPlaying: false,\n    isLoading: false,\n    error: null,\n    volume: memoizedOptions.volume,\n    isMuted: false,\n    currentTime: 0,\n    state: \"idle\",\n    currentStation: null,\n  }));\n\n  // Initialize audio service\n  useEffect(() => {\n    audioServiceRef.current = new AudioService({\n      volume: memoizedOptions.volume,\n      retryAttempts: memoizedOptions.retryAttempts,\n      retryDelay: memoizedOptions.retryDelay,\n    });\n\n    const service = audioServiceRef.current;\n\n    // Set up event listeners\n    service.on(\"stateChange\", (audioState) => {\n      setState((prev) => ({\n        ...prev,\n        state: audioState,\n        isPlaying: audioState === \"playing\",\n        isLoading: audioState === \"loading\",\n      }));\n    });\n\n    service.on(\"error\", (error) => {\n      setState((prev) => ({\n        ...prev,\n        error,\n        isLoading: false,\n        isPlaying: false,\n      }));\n    });\n\n    service.on(\"volumeChange\", (volume) => {\n      setState((prev) => ({\n        ...prev,\n        volume,\n        isMuted: volume === 0,\n      }));\n    });\n\n    service.on(\"timeUpdate\", (currentTime) => {\n      setState((prev) => ({\n        ...prev,\n        currentTime,\n      }));\n    });\n\n    return () => {\n      service.destroy();\n    };\n  }, [\n    memoizedOptions.volume,\n    memoizedOptions.retryAttempts,\n    memoizedOptions.retryDelay,\n  ]);\n\n  const play = useCallback(async () => {\n    if (!audioServiceRef.current) return;\n\n    try {\n      await audioServiceRef.current.play();\n      setState((prev) => ({ ...prev, error: null }));\n    } catch (error) {\n      setState((prev) => ({\n        ...prev,\n        error: \"Failed to play audio. Please try again.\",\n      }));\n    }\n  }, []);\n\n  const pause = useCallback(() => {\n    if (!audioServiceRef.current) return;\n    audioServiceRef.current.pause();\n  }, []);\n\n  const setVolume = useCallback((volume: number) => {\n    if (!audioServiceRef.current) return;\n    audioServiceRef.current.setVolume(volume);\n  }, []);\n\n  const toggleMute = useCallback(() => {\n    if (!audioServiceRef.current) return;\n\n    if (state.isMuted) {\n      audioServiceRef.current.setVolume(state.volume > 0 ? state.volume : 0.7);\n    } else {\n      audioServiceRef.current.mute();\n    }\n  }, [state.isMuted, state.volume]);\n\n  const loadStation = useCallback(\n    async (station: RadioStation) => {\n      if (!audioServiceRef.current) return;\n\n      try {\n        setState((prev) => ({\n          ...prev,\n          error: null,\n          currentStation: station,\n        }));\n\n        // Get proxied URL to avoid CORS issues\n        const streamUrl = radioStationService.getProxiedStreamUrl(station);\n\n        await audioServiceRef.current.loadStation(station, streamUrl);\n\n        // Auto-play if enabled\n        if (memoizedOptions.autoPlay) {\n          await play();\n        }\n      } catch (error) {\n        setState((prev) => ({\n          ...prev,\n          error: \"Failed to load radio station.\",\n        }));\n      }\n    },\n    [memoizedOptions.autoPlay, play],\n  );\n\n  const clearError = useCallback(() => {\n    setState((prev) => ({ ...prev, error: null }));\n  }, []);\n\n  const getAudioElement = useCallback((): HTMLAudioElement | null => {\n    return audioServiceRef.current?.getAudioElement() || null;\n  }, []);\n\n  const playerState: ModularAudioState = useMemo(\n    () => ({\n      ...state,\n      currentStation:\n        audioServiceRef.current?.getCurrentStation() || state.currentStation,\n    }),\n    [state],\n  );\n\n  const actions: ModularAudioActions = useMemo(\n    () => ({\n      play,\n      pause,\n      setVolume,\n      toggleMute,\n      loadStation,\n      clearError,\n      getAudioElement,\n    }),\n    [\n      play,\n      pause,\n      setVolume,\n      toggleMute,\n      loadStation,\n      clearError,\n      getAudioElement,\n    ],\n  );\n\n  return [playerState, actions];\n}\n"],"names":["useModularAudio","options","audioServiceRef","memoizedOptions","volume","autoPlay","retryAttempts","retryDelay","state","setState","isPlaying","isLoading","error","isMuted","currentTime","currentStation","current","service","on","audioState","prev","destroy","play","pause","setVolume","toggleMute","mute","loadStation","station","streamUrl","getProxiedStreamUrl","clearError","getAudioElement","playerState","getCurrentStation","actions"],"mappings":"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"}},
    {"offset": {"line": 1904, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/services/audioVisualizationService.ts"],"sourcesContent":["export type VisualizationType = \"bars\" | \"waveform\" | \"circular\" | \"particles\";\n\nexport interface VisualizerConfig {\n  fftSize: number;\n  smoothingTimeConstant: number;\n  minDecibels: number;\n  maxDecibels: number;\n  backgroundColor: string;\n  primaryColor: string;\n  secondaryColor: string;\n}\n\nexport interface VisualizerRenderer {\n  render(\n    data: Uint8Array,\n    canvas: HTMLCanvasElement,\n    config: VisualizerConfig,\n  ): void;\n}\n\nexport class BarsRenderer implements VisualizerRenderer {\n  render(\n    data: Uint8Array,\n    canvas: HTMLCanvasElement,\n    config: VisualizerConfig,\n  ): void {\n    const ctx = canvas.getContext(\"2d\")!;\n    const width = canvas.width;\n    const height = canvas.height;\n    const barWidth = (width / data.length) * 2;\n\n    // Clear canvas with fade effect\n    ctx.fillStyle = config.backgroundColor;\n    ctx.fillRect(0, 0, width, height);\n\n    // Draw bars\n    for (let i = 0; i < data.length; i++) {\n      const barHeight = (data[i] / 255) * height * 0.8;\n      const x = i * barWidth;\n      const y = height - barHeight;\n\n      // Create gradient\n      const gradient = ctx.createLinearGradient(0, y, 0, height);\n      gradient.addColorStop(0, config.primaryColor);\n      gradient.addColorStop(0.5, config.secondaryColor);\n      gradient.addColorStop(1, config.primaryColor);\n\n      ctx.fillStyle = gradient;\n      ctx.fillRect(x, y, barWidth - 1, barHeight);\n    }\n  }\n}\n\nexport class WaveformRenderer implements VisualizerRenderer {\n  render(\n    data: Uint8Array,\n    canvas: HTMLCanvasElement,\n    config: VisualizerConfig,\n  ): void {\n    const ctx = canvas.getContext(\"2d\")!;\n    const width = canvas.width;\n    const height = canvas.height;\n\n    // Clear canvas with fade effect\n    ctx.fillStyle = config.backgroundColor;\n    ctx.fillRect(0, 0, width, height);\n\n    // Draw waveform\n    ctx.lineWidth = 2;\n    ctx.strokeStyle = config.primaryColor;\n    ctx.beginPath();\n\n    const sliceWidth = width / data.length;\n    let x = 0;\n\n    for (let i = 0; i < data.length; i++) {\n      const v = data[i] / 128.0;\n      const y = (v * height) / 2;\n\n      if (i === 0) {\n        ctx.moveTo(x, y);\n      } else {\n        ctx.lineTo(x, y);\n      }\n\n      x += sliceWidth;\n    }\n\n    ctx.stroke();\n  }\n}\n\nexport class CircularRenderer implements VisualizerRenderer {\n  render(\n    data: Uint8Array,\n    canvas: HTMLCanvasElement,\n    config: VisualizerConfig,\n  ): void {\n    const ctx = canvas.getContext(\"2d\")!;\n    const width = canvas.width;\n    const height = canvas.height;\n    const centerX = width / 2;\n    const centerY = height / 2;\n    const radius = Math.min(width, height) * 0.3;\n\n    // Clear canvas with fade effect\n    ctx.fillStyle = config.backgroundColor;\n    ctx.fillRect(0, 0, width, height);\n\n    // Draw center circle\n    ctx.fillStyle = config.primaryColor + \"40\";\n    ctx.beginPath();\n    ctx.arc(centerX, centerY, radius * 0.8, 0, Math.PI * 2);\n    ctx.fill();\n\n    // Draw circular visualization\n    const angleStep = (Math.PI * 2) / data.length;\n\n    for (let i = 0; i < data.length; i++) {\n      const amplitude = (data[i] / 255) * radius;\n      const angle = i * angleStep;\n\n      const x1 = centerX + Math.cos(angle) * radius;\n      const y1 = centerY + Math.sin(angle) * radius;\n      const x2 = centerX + Math.cos(angle) * (radius + amplitude);\n      const y2 = centerY + Math.sin(angle) * (radius + amplitude);\n\n      // Create gradient\n      const gradient = ctx.createLinearGradient(x1, y1, x2, y2);\n      gradient.addColorStop(0, config.primaryColor + \"CC\");\n      gradient.addColorStop(1, config.secondaryColor + \"66\");\n\n      ctx.strokeStyle = gradient;\n      ctx.lineWidth = 2;\n      ctx.beginPath();\n      ctx.moveTo(x1, y1);\n      ctx.lineTo(x2, y2);\n      ctx.stroke();\n    }\n  }\n}\n\nexport class ParticlesRenderer implements VisualizerRenderer {\n  private particles: Array<{\n    x: number;\n    y: number;\n    vx: number;\n    vy: number;\n    life: number;\n  }> = [];\n\n  render(\n    data: Uint8Array,\n    canvas: HTMLCanvasElement,\n    config: VisualizerConfig,\n  ): void {\n    const ctx = canvas.getContext(\"2d\")!;\n    const width = canvas.width;\n    const height = canvas.height;\n\n    // Clear canvas\n    ctx.fillStyle = config.backgroundColor;\n    ctx.fillRect(0, 0, width, height);\n\n    // Calculate average amplitude\n    const avgAmplitude = data.reduce((sum, val) => sum + val, 0) / data.length;\n\n    // Generate new particles based on audio intensity\n    if (avgAmplitude > 50) {\n      for (let i = 0; i < Math.floor(avgAmplitude / 20); i++) {\n        this.particles.push({\n          x: Math.random() * width,\n          y: height,\n          vx: (Math.random() - 0.5) * 4,\n          vy: -Math.random() * 5 - 2,\n          life: 1.0,\n        });\n      }\n    }\n\n    // Update and draw particles\n    this.particles = this.particles.filter((particle) => {\n      particle.x += particle.vx;\n      particle.y += particle.vy;\n      particle.vy += 0.1; // gravity\n      particle.life -= 0.02;\n\n      if (particle.life > 0) {\n        ctx.fillStyle =\n          config.primaryColor +\n          Math.floor(particle.life * 255)\n            .toString(16)\n            .padStart(2, \"0\");\n        ctx.beginPath();\n        ctx.arc(particle.x, particle.y, 2, 0, Math.PI * 2);\n        ctx.fill();\n        return true;\n      }\n      return false;\n    });\n  }\n}\n\nexport class AudioVisualizationService {\n  private audioContext: AudioContext | null = null;\n  private analyser: AnalyserNode | null = null;\n  private source: MediaElementAudioSourceNode | null = null;\n  private dataArray: Uint8Array | null = null;\n  private animationFrame: number | null = null;\n  private renderers: Map<VisualizationType, VisualizerRenderer>;\n  private currentRenderer: VisualizerRenderer | null = null;\n  private currentType: VisualizationType = \"bars\";\n  private config: VisualizerConfig;\n  private initialized: boolean = false;\n\n  constructor(config: Partial<VisualizerConfig> = {}) {\n    this.config = {\n      fftSize: 256,\n      smoothingTimeConstant: 0.8,\n      minDecibels: -90,\n      maxDecibels: -10,\n      backgroundColor: \"rgba(0, 0, 0, 0.1)\",\n      primaryColor: \"#60a5fa\",\n      secondaryColor: \"#3b82f6\",\n      ...config,\n    };\n\n    this.renderers = new Map([\n      [\"bars\", new BarsRenderer()],\n      [\"waveform\", new WaveformRenderer()],\n      [\"circular\", new CircularRenderer()],\n      [\"particles\", new ParticlesRenderer()],\n    ]);\n  }\n\n  public initialize(audioElement: HTMLAudioElement): boolean {\n    // Prevent re-initialization\n    if (this.initialized) {\n      return true;\n    }\n\n    try {\n      this.audioContext = new (\n        window.AudioContext || (window as any).webkitAudioContext\n      )();\n      \n      // Create source node only once\n      // Note: This will fail if the element is already connected to a source\n      try {\n        this.source = this.audioContext.createMediaElementSource(audioElement);\n      } catch (sourceError) {\n        console.warn(\"Cannot create media element source (already in use). Visualization disabled.\");\n        // Clean up and return true - audio will still work without visualization\n        this.audioContext.close();\n        this.audioContext = null;\n        this.initialized = true; // Mark as initialized to prevent retrying\n        return true; // Return true so audio continues to work\n      }\n      \n      this.analyser = this.audioContext.createAnalyser();\n\n      // Configure analyser\n      this.analyser.fftSize = this.config.fftSize;\n      this.analyser.smoothingTimeConstant = this.config.smoothingTimeConstant;\n      this.analyser.minDecibels = this.config.minDecibels;\n      this.analyser.maxDecibels = this.config.maxDecibels;\n\n      // Connect audio graph: source -> analyser -> destination\n      // This ensures audio passes through the analyser but still plays\n      this.source.connect(this.analyser);\n      this.analyser.connect(this.audioContext.destination);\n\n      this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n\n      // Resume audio context if suspended\n      if (this.audioContext.state === \"suspended\") {\n        this.audioContext.resume();\n      }\n\n      this.initialized = true;\n      return true;\n    } catch (error) {\n      console.warn(\"Audio visualization initialization failed:\", error);\n      this.initialized = true; // Mark as initialized to prevent retrying\n      return true; // Return true so audio continues to work\n    }\n  }\n\n  public start(\n    canvas: HTMLCanvasElement,\n    type: VisualizationType = \"bars\",\n  ): void {\n    this.currentType = type;\n    this.currentRenderer = this.renderers.get(type) || null;\n\n    if (!this.analyser || !this.dataArray || !this.currentRenderer) {\n      return;\n    }\n\n    // Resume audio context if suspended (required for iOS and other browsers)\n    if (this.audioContext && this.audioContext.state === \"suspended\") {\n      this.audioContext.resume();\n    }\n\n    const animate = () => {\n      if (!this.analyser || !this.dataArray || !this.currentRenderer) return;\n\n      if (this.dataArray) {\n        if (this.currentType === \"waveform\") {\n          this.analyser.getByteTimeDomainData(this.dataArray as any);\n        } else {\n          this.analyser.getByteFrequencyData(this.dataArray as any);\n        }\n      }\n      this.currentRenderer.render(this.dataArray, canvas, this.config);\n\n      this.animationFrame = requestAnimationFrame(animate);\n    };\n\n    animate();\n  }\n\n  public stop(): void {\n    if (this.animationFrame) {\n      cancelAnimationFrame(this.animationFrame);\n      this.animationFrame = null;\n    }\n  }\n\n  public changeType(type: VisualizationType): void {\n    this.currentType = type;\n    this.currentRenderer = this.renderers.get(type) || null;\n  }\n\n  public updateConfig(newConfig: Partial<VisualizerConfig>): void {\n    const oldFftSize = this.config.fftSize;\n    this.config = { ...this.config, ...newConfig };\n\n    if (this.analyser) {\n      this.analyser.smoothingTimeConstant = this.config.smoothingTimeConstant;\n      this.analyser.minDecibels = this.config.minDecibels;\n      this.analyser.maxDecibels = this.config.maxDecibels;\n\n      if (this.config.fftSize !== oldFftSize) {\n        this.analyser.fftSize = this.config.fftSize;\n        this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n      }\n    }\n  }\n\n  // Get available visualization types\n  public getAvailableTypes(): VisualizationType[] {\n    return Array.from(this.renderers.keys());\n  }\n\n  public destroy(): void {\n    this.stop();\n    \n    // Disconnect audio nodes\n    if (this.source) {\n      this.source.disconnect();\n      this.source = null;\n    }\n    \n    if (this.analyser) {\n      this.analyser.disconnect();\n      this.analyser = null;\n    }\n    \n    if (this.audioContext) {\n      this.audioContext.close();\n      this.audioContext = null;\n    }\n    \n    this.dataArray = null;\n    this.currentRenderer = null;\n    this.initialized = false;\n  }\n}\n"],"names":["BarsRenderer","render","data","canvas","config","ctx","getContext","width","height","barWidth","length","fillStyle","backgroundColor","fillRect","i","barHeight","x","y","gradient","createLinearGradient","addColorStop","primaryColor","secondaryColor","WaveformRenderer","lineWidth","strokeStyle","beginPath","sliceWidth","v","moveTo","lineTo","stroke","CircularRenderer","centerX","centerY","radius","Math","min","arc","PI","fill","angleStep","amplitude","angle","x1","cos","y1","sin","x2","y2","ParticlesRenderer","particles","avgAmplitude","reduce","sum","val","floor","push","random","vx","vy","life","filter","particle","toString","padStart","AudioVisualizationService","audioContext","analyser","source","dataArray","animationFrame","renderers","currentRenderer","currentType","initialized","fftSize","smoothingTimeConstant","minDecibels","maxDecibels","Map","initialize","audioElement","window","AudioContext","webkitAudioContext","createMediaElementSource","sourceError","console","warn","close","createAnalyser","connect","destination","Uint8Array","frequencyBinCount","state","resume","error","start","type","get","animate","getByteTimeDomainData","getByteFrequencyData","requestAnimationFrame","stop","cancelAnimationFrame","changeType","updateConfig","newConfig","oldFftSize","getAvailableTypes","Array","from","keys","destroy","disconnect"],"mappings":"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"}},
    {"offset": {"line": 2206, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/components/ModularAudioVisualizer.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\nimport { motion } from \"framer-motion\";\nimport {\n  AudioVisualizationService,\n  VisualizationType,\n} from \"../services/audioVisualizationService\";\n\ninterface ModularAudioVisualizerProps {\n  audioElement?: HTMLAudioElement | null;\n  isPlaying: boolean;\n  className?: string;\n  type?: VisualizationType;\n  width?: number;\n  height?: number;\n  colors?: {\n    primary?: string;\n    secondary?: string;\n    background?: string;\n  };\n}\n\nexport function ModularAudioVisualizer({\n  audioElement,\n  isPlaying,\n  className = \"\",\n  type = \"bars\",\n  width = 300,\n  height = 100,\n  colors = {},\n}: ModularAudioVisualizerProps) {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const visualizationServiceRef = useRef<AudioVisualizationService | null>(\n    null,\n  );\n  const [isSupported, setIsSupported] = useState(true);\n  const [currentType, setCurrentType] = useState<VisualizationType>(type);\n\n  // Initialize visualization service\n  useEffect(() => {\n    visualizationServiceRef.current = new AudioVisualizationService({\n      fftSize: type === \"waveform\" ? 2048 : 256,\n      primaryColor: colors.primary || \"#60a5fa\",\n      secondaryColor: colors.secondary || \"#3b82f6\",\n      backgroundColor: colors.background || \"rgba(0, 0, 0, 0.1)\",\n    });\n\n    return () => {\n      visualizationServiceRef.current?.destroy();\n    };\n  }, []);\n\n  // Handle audio element changes\n  useEffect(() => {\n    if (!audioElement || !visualizationServiceRef.current) {\n      return;\n    }\n\n    const success = visualizationServiceRef.current.initialize(audioElement);\n    if (!success) {\n      console.warn(\"Audio visualization disabled - element already in use\");\n      setIsSupported(false);\n    }\n  }, [audioElement]);\n\n  // Handle playback state changes\n  useEffect(() => {\n    if (!visualizationServiceRef.current || !canvasRef.current) {\n      return;\n    }\n\n    if (isPlaying && isSupported) {\n      visualizationServiceRef.current.start(canvasRef.current, currentType);\n    } else {\n      visualizationServiceRef.current.stop();\n    }\n\n    return () => {\n      visualizationServiceRef.current?.stop();\n    };\n  }, [isPlaying, isSupported, currentType]);\n\n  // Handle prop changes (type, colors)\n  useEffect(() => {\n    if (visualizationServiceRef.current) {\n      visualizationServiceRef.current.updateConfig({\n        fftSize: type === \"waveform\" ? 2048 : 256,\n        primaryColor: colors.primary || \"#60a5fa\",\n        secondaryColor: colors.secondary || \"#3b82f6\",\n        backgroundColor: colors.background || \"rgba(0, 0, 0, 0.1)\",\n      });\n      visualizationServiceRef.current.changeType(type);\n    }\n    setCurrentType(type);\n  }, [type, colors.primary, colors.secondary, colors.background]);\n\n  if (!isSupported) {\n    return (\n      <div className={`flex items-center justify-center ${className}`}>\n        <div className=\"text-gray-500 text-sm\">\n          Audio visualization not supported\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <motion.div\n      className={`relative ${className}`}\n      initial={{ opacity: 0, scale: 0.8 }}\n      animate={{\n        opacity: isPlaying ? 1 : 0.5,\n        scale: 1,\n        filter: isPlaying ? \"blur(0px)\" : \"blur(1px)\",\n      }}\n      transition={{ duration: 0.3 }}\n    >\n      <canvas\n        ref={canvasRef}\n        width={width}\n        height={height}\n        className=\"w-full h-full rounded-lg bg-black/20 backdrop-blur-sm border border-white/10\"\n        style={{\n          imageRendering: \"pixelated\",\n        }}\n      />\n\n      {/* Overlay effects */}\n      {isPlaying && (\n        <>\n          <div className=\"absolute inset-0 rounded-lg bg-gradient-to-t from-blue-500/10 to-transparent pointer-events-none\" />\n          <div className=\"absolute inset-0 rounded-lg shadow-inner pointer-events-none\" />\n        </>\n      )}\n\n      {/* Loading indicator when audio is initializing */}\n      {!isPlaying && (\n        <div className=\"absolute inset-0 flex items-center justify-center\">\n          <div className=\"flex items-center gap-2 text-gray-400 text-xs\">\n            <div className=\"w-3 h-3 border border-gray-400 border-t-transparent rounded-full animate-spin\" />\n            Ready\n          </div>\n        </div>\n      )}\n    </motion.div>\n  );\n}\n\n// Hook for easier visualization type cycling\nexport function useVisualizationType() {\n  const [type, setType] = useState<VisualizationType>(\"bars\");\n  const types: VisualizationType[] = [\n    \"bars\",\n    \"waveform\",\n    \"circular\",\n    \"particles\",\n  ];\n\n  const nextType = () => {\n    const currentIndex = types.indexOf(type);\n    const nextIndex = (currentIndex + 1) % types.length;\n    setType(types[nextIndex]);\n  };\n\n  const setVisualizationType = (newType: VisualizationType) => {\n    setType(newType);\n  };\n\n  return {\n    currentType: type,\n    availableTypes: types,\n    nextType,\n    setType: setVisualizationType,\n  };\n}\n"],"names":["ModularAudioVisualizer","audioElement","isPlaying","className","type","width","height","colors","canvasRef","visualizationServiceRef","isSupported","setIsSupported","currentType","setCurrentType","current","fftSize","primaryColor","primary","secondaryColor","secondary","backgroundColor","background","destroy","success","initialize","console","warn","start","stop","updateConfig","changeType","div","initial","opacity","scale","animate","filter","transition","duration","ref","style","imageRendering","useVisualizationType","setType","types","nextType","currentIndex","indexOf","nextIndex","length","setVisualizationType","newType","availableTypes"],"mappings":"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"}},
    {"offset": {"line": 2408, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/components/ModularAudioPlayer.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport {\n  Play,\n  Pause,\n  Volume2,\n  VolumeX,\n  MoreVertical,\n  SkipBack,\n  SkipForward,\n  Settings,\n  Heart,\n  Clock,\n  MapPin,\n} from \"lucide-react\";\nimport { useGlobeStore } from \"../stores/globe-store\";\nimport { useModularAudio } from \"../hooks/useModularAudio\";\nimport {\n  ModularAudioVisualizer,\n  useVisualizationType,\n} from \"./ModularAudioVisualizer\";\n\ninterface ModularAudioPlayerProps {\n  className?: string;\n  showVisualizer?: boolean;\n  compactMode?: boolean;\n  autoPlay?: boolean;\n}\n\nexport function ModularAudioPlayer({\n  className = \"\",\n  showVisualizer = true,\n  compactMode = false,\n  autoPlay = false,\n}: ModularAudioPlayerProps) {\n  const {\n    selectedStation,\n    playlist,\n    playlistIndex,\n    currentRegion,\n    nextStation,\n    previousStation,\n  } = useGlobeStore();\n  const [showSettings, setShowSettings] = useState(false);\n  const [audioState, audioActions] = useModularAudio({ autoPlay, volume: 0.7 });\n  const { currentType, availableTypes, nextType, setType } =\n    useVisualizationType();\n\n  // Enhanced features state\n  const [localTime, setLocalTime] = useState<string>(\"\");\n  const [stationLocalTime, setStationLocalTime] = useState<string>(\"\");\n\n  // Load station when selected\n  useEffect(() => {\n    if (selectedStation) {\n      audioActions.loadStation(selectedStation);\n    }\n  }, [selectedStation, audioActions.loadStation]);\n\n  // Local time updates\n  useEffect(() => {\n    const updateTimes = () => {\n      const now = new Date();\n      setLocalTime(now.toLocaleTimeString('en-US', {\n        hour: '2-digit',\n        minute: '2-digit',\n        hour12: true\n      }));\n      \n      if (selectedStation) {\n        // Calculate estimated local time based on longitude (15 degrees = 1 hour)\n        // This is an approximation of solar time, which is robust offline solution\n        const lng = selectedStation.location.lng;\n        const offsetHours = lng / 15;\n        const utc = now.getTime() + (now.getTimezoneOffset() * 60000);\n        const stationTime = new Date(utc + (3600000 * offsetHours));\n        \n        setStationLocalTime(stationTime.toLocaleTimeString('en-US', {\n          hour: '2-digit',\n          minute: '2-digit',\n          hour12: true\n        }));\n      }\n    };\n    \n    updateTimes();\n    const interval = setInterval(updateTimes, 60000);\n    return () => clearInterval(interval);\n  }, [selectedStation]);\n\n  const formatTime = (time: number): string => {\n    const minutes = Math.floor(time / 60);\n    const seconds = Math.floor(time % 60);\n    return `${minutes}:${seconds.toString().padStart(2, \"0\")}`;\n  };\n\n  if (!selectedStation) {\n    return (\n      <motion.div\n        className={`glass rounded-xl p-6 text-center ${className}`}\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n      >\n        <div className=\"text-gray-400 mb-2\">\n          <Volume2 className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n        </div>\n        <p className=\"text-white text-sm mb-1\">Select a Radio Station</p>\n        <p className=\"text-gray-400 text-xs\">\n          Click on any station marker on the globe\n        </p>\n        <div className=\"mt-3 flex items-center justify-center space-x-1 text-white/60\">\n          <Clock className=\"w-4 h-4\" />\n          <span className=\"text-sm\">Local time: {localTime}</span>\n        </div>\n      </motion.div>\n    );\n  }\n\n  return (\n    <motion.div\n      className={`glass rounded-xl overflow-hidden ${compactMode ? \"p-3\" : \"p-4\"} ${className}`}\n      initial={{ y: 100, opacity: 0 }}\n      animate={{ y: 0, opacity: 1 }}\n      exit={{ y: 100, opacity: 0 }}\n      layout\n    >\n      {/* Station Info Header */}\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className=\"flex items-center space-x-3 flex-1 min-w-0\">\n          {!compactMode && (\n            <div className=\"flex-shrink-0\">\n              <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center\">\n                <span className=\"text-white font-bold text-sm\">\n                  {selectedStation.name.charAt(0)}\n                </span>\n              </div>\n            </div>\n          )}\n\n          <div className=\"min-w-0 flex-1\">\n            <h3\n              className={`text-white font-semibold truncate ${compactMode ? \"text-sm\" : \"\"}`}\n            >\n              {selectedStation.name}\n            </h3>\n            <p\n              className={`text-gray-400 truncate ${compactMode ? \"text-xs\" : \"text-sm\"}`}\n            >\n              {selectedStation.location.city},{\" \"}\n              {selectedStation.location.country}  {selectedStation.genre}\n            </p>\n          </div>\n        </div>\n\n        {/* Time Display */}\n        <div className=\"text-right\">\n          <div className=\"flex items-center space-x-1 text-white text-sm font-medium\">\n            <Clock className=\"w-4 h-4\" />\n            <span>{localTime}</span>\n          </div>\n          {stationLocalTime && stationLocalTime !== localTime && (\n            <div className=\"text-white/60 text-xs\">\n              Station: {stationLocalTime}\n            </div>\n          )}\n        </div>\n\n        {/* Settings Button */}\n        <motion.button\n          onClick={() => setShowSettings(!showSettings)}\n          className=\"text-white/60 hover:text-white transition-colors p-1 rounded ml-2\"\n          whileHover={{ scale: 1.1 }}\n          whileTap={{ scale: 0.9 }}\n        >\n          <Settings className=\"w-4 h-4\" />\n        </motion.button>\n      </div>\n\n      {/* Audio Visualizer - Disabled for now to prevent audio issues */}\n      {/* TODO: Re-implement visualization without Web Audio API interference */}\n      \n      {/* Main Controls */}\n      <div className=\"flex items-center space-x-4\">\n        {/* Previous Station */}\n        <motion.button\n          onClick={previousStation}\n          className=\"text-white hover:text-blue-300 transition-colors p-1\"\n          whileHover={{ scale: 1.1 }}\n          whileTap={{ scale: 0.9 }}\n          title=\"Previous Station\"\n        >\n          <SkipBack className={compactMode ? \"w-5 h-5\" : \"w-6 h-6\"} />\n        </motion.button>\n\n        {/* Play/Pause Button */}\n        <motion.button\n          onClick={\n            audioState.isPlaying ? audioActions.pause : audioActions.play\n          }\n          disabled={audioState.isLoading}\n          className={`flex-shrink-0 ${compactMode ? \"w-10 h-10\" : \"w-12 h-12\"} bg-blue-500 hover:bg-blue-600 disabled:bg-gray-600 rounded-full flex items-center justify-center transition-all shadow-lg shadow-blue-500/30`}\n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n        >\n          {audioState.isLoading ? (\n            <div\n              className={`${compactMode ? \"w-4 h-4\" : \"w-5 h-5\"} border-2 border-white border-t-transparent rounded-full animate-spin`}\n            />\n          ) : audioState.isPlaying ? (\n            <Pause\n              className={`${compactMode ? \"w-4 h-4\" : \"w-5 h-5\"} text-white`}\n            />\n          ) : (\n            <Play\n              className={`${compactMode ? \"w-4 h-4\" : \"w-5 h-5\"} text-white ml-0.5`}\n            />\n          )}\n        </motion.button>\n\n        {/* Next Station */}\n        <motion.button\n          onClick={nextStation}\n          className=\"text-white hover:text-blue-300 transition-colors p-1\"\n          whileHover={{ scale: 1.1 }}\n          whileTap={{ scale: 0.9 }}\n          title=\"Next Station\"\n        >\n          <SkipForward className={compactMode ? \"w-5 h-5\" : \"w-6 h-6\"} />\n        </motion.button>\n\n        {/* Volume Control */}\n        <div className=\"flex items-center space-x-2 flex-1\">\n          <motion.button\n            onClick={audioActions.toggleMute}\n            className=\"text-white hover:text-blue-300 transition-colors\"\n            whileHover={{ scale: 1.1 }}\n          >\n            {audioState.isMuted ? (\n              <VolumeX className={compactMode ? \"w-4 h-4\" : \"w-5 h-5\"} />\n            ) : (\n              <Volume2 className={compactMode ? \"w-4 h-4\" : \"w-5 h-5\"} />\n            )}\n          </motion.button>\n\n          <div className=\"flex-1 max-w-24\">\n            <input\n              type=\"range\"\n              min=\"0\"\n              max=\"100\"\n              value={audioState.isMuted ? 0 : audioState.volume * 100}\n              onChange={(e) =>\n                audioActions.setVolume(Number(e.target.value) / 100)\n              }\n              className=\"w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer\n                        [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 \n                        [&::-webkit-slider-thumb]:bg-blue-500 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer\n                        [&::-moz-range-thumb]:w-3 [&::-moz-range-thumb]:h-3 [&::-moz-range-thumb]:bg-blue-500 [&::-moz-range-thumb]:rounded-full \n                        [&::-moz-range-thumb]:border-0 [&::-moz-range-thumb]:cursor-pointer\"\n            />\n          </div>\n\n          <span className=\"text-white/60 text-xs min-w-8\">\n            {Math.round((audioState.isMuted ? 0 : audioState.volume) * 100)}%\n          </span>\n        </div>\n\n        {/* Now Playing Indicator */}\n        {audioState.isPlaying && !compactMode && (\n          <motion.div\n            className=\"flex items-center space-x-2\"\n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n          >\n            <div className=\"flex space-x-0.5\">\n              {[...Array(3)].map((_, i) => (\n                <motion.div\n                  key={i}\n                  className=\"w-1 bg-green-500 rounded-full\"\n                  animate={{\n                    height: [4, 16, 4],\n                  }}\n                  transition={{\n                    duration: 0.8,\n                    repeat: Infinity,\n                    delay: i * 0.1,\n                  }}\n                />\n              ))}\n            </div>\n            <span className=\"text-green-500 text-xs font-medium\">LIVE</span>\n          </motion.div>\n        )}\n      </div>\n\n      {/* Error Display */}\n      <AnimatePresence>\n        {audioState.error && (\n          <motion.div\n            className=\"mt-3 p-2 bg-red-500/20 border border-red-500/50 rounded text-red-300 text-sm flex items-center justify-between\"\n            initial={{ opacity: 0, height: 0 }}\n            animate={{ opacity: 1, height: \"auto\" }}\n            exit={{ opacity: 0, height: 0 }}\n          >\n            <div className=\"flex-1 flex flex-col\">\n              <span className=\"font-medium\">{audioState.error}</span>\n              {(audioState.error.includes(\"supported\") || audioState.error.includes(\"network\")) && (\n                <span className=\"text-xs opacity-75\">Try another station or check connection</span>\n              )}\n            </div>\n            <div className=\"flex items-center space-x-2\">\n               <button\n                onClick={nextStation}\n                className=\"px-2 py-1 bg-red-500/30 hover:bg-red-500/50 rounded text-xs transition-colors\"\n               >\n                 Next Station\n               </button>\n              <button\n                onClick={audioActions.clearError}\n                className=\"text-red-300 hover:text-red-100 ml-1 p-1\"\n              >\n                \n              </button>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Settings Panel */}\n      <AnimatePresence>\n        {showSettings && (\n          <motion.div\n            initial={{ opacity: 0, height: 0 }}\n            animate={{ opacity: 1, height: \"auto\" }}\n            exit={{ opacity: 0, height: 0 }}\n            className=\"mt-4 p-3 bg-white/5 rounded-lg border border-white/10\"\n          >\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-white text-sm\">Show Visualizer</span>\n                <button\n                  onClick={() => setShowSettings(false)}\n                  className={`w-8 h-4 rounded-full transition-colors ${\n                    showVisualizer ? \"bg-blue-500\" : \"bg-gray-600\"\n                  }`}\n                >\n                  <div\n                    className={`w-3 h-3 bg-white rounded-full transition-transform ${\n                      showVisualizer ? \"translate-x-4\" : \"translate-x-0.5\"\n                    }`}\n                  />\n                </button>\n              </div>\n\n              <div className=\"text-xs text-gray-400\">\n                Station: {selectedStation.name}\n                <br />\n                Genre: {selectedStation.genre}\n                <br />\n                Location: {selectedStation.location.city},{\" \"}\n                {selectedStation.location.country}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n"],"names":["ModularAudioPlayer","className","showVisualizer","compactMode","autoPlay","selectedStation","playlist","playlistIndex","currentRegion","nextStation","previousStation","showSettings","setShowSettings","audioState","audioActions","volume","currentType","availableTypes","nextType","setType","localTime","setLocalTime","stationLocalTime","setStationLocalTime","loadStation","updateTimes","now","Date","toLocaleTimeString","hour","minute","hour12","lng","location","offsetHours","utc","getTime","getTimezoneOffset","stationTime","interval","setInterval","clearInterval","formatTime","time","minutes","Math","floor","seconds","toString","padStart","div","initial","opacity","y","animate","exit","layout","name","charAt","city","country","genre","button","onClick","whileHover","scale","whileTap","title","isPlaying","pause","play","disabled","isLoading","toggleMute","isMuted","type","min","max","value","onChange","e","setVolume","Number","target","round","x","Array","map","_","i","height","transition","duration","repeat","Infinity","delay","error","includes","clearError"],"mappings":"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"}},
    {"offset": {"line": 3104, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/hooks/useUserData.ts"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useCallback } from \"react\";\nimport type { RadioStation } from \"../types\";\n\nconst STORAGE_KEYS = {\n  FAVORITES: \"radioGlobe_favorites\",\n  RECENT: \"radioGlobe_recent\",\n  PREFERENCES: \"radioGlobe_preferences\",\n};\n\nconst MAX_RECENT = 20;\n\ninterface UserPreferences {\n  autoPlay: boolean;\n  defaultVolume: number;\n  preferredGenres: string[];\n  preferredCountries: string[];\n  sleepTimer: number | null; // minutes\n}\n\nconst DEFAULT_PREFERENCES: UserPreferences = {\n  autoPlay: false,\n  defaultVolume: 70,\n  preferredGenres: [],\n  preferredCountries: [],\n  sleepTimer: null,\n};\n\nexport function useFavorites() {\n  const [favorites, setFavorites] = useState<RadioStation[]>([]);\n  const [isLoaded, setIsLoaded] = useState(false);\n\n  // Load favorites from localStorage\n  useEffect(() => {\n    try {\n      const stored = localStorage.getItem(STORAGE_KEYS.FAVORITES);\n      if (stored) {\n        setFavorites(JSON.parse(stored));\n      }\n    } catch (e) {\n      console.error(\"Failed to load favorites:\", e);\n    }\n    setIsLoaded(true);\n  }, []);\n\n  // Save favorites to localStorage\n  useEffect(() => {\n    if (isLoaded) {\n      localStorage.setItem(STORAGE_KEYS.FAVORITES, JSON.stringify(favorites));\n    }\n  }, [favorites, isLoaded]);\n\n  const addFavorite = useCallback((station: RadioStation) => {\n    setFavorites((prev) => {\n      if (prev.some((s) => s.id === station.id)) return prev;\n      return [station, ...prev];\n    });\n  }, []);\n\n  const removeFavorite = useCallback((stationId: string) => {\n    setFavorites((prev) => prev.filter((s) => s.id !== stationId));\n  }, []);\n\n  const isFavorite = useCallback(\n    (stationId: string) => {\n      return favorites.some((s) => s.id === stationId);\n    },\n    [favorites],\n  );\n\n  const toggleFavorite = useCallback(\n    (station: RadioStation) => {\n      if (isFavorite(station.id)) {\n        removeFavorite(station.id);\n      } else {\n        addFavorite(station);\n      }\n    },\n    [isFavorite, removeFavorite, addFavorite],\n  );\n\n  return {\n    favorites,\n    addFavorite,\n    removeFavorite,\n    isFavorite,\n    toggleFavorite,\n    isLoaded,\n  };\n}\n\nexport function useRecentStations() {\n  const [recent, setRecent] = useState<RadioStation[]>([]);\n  const [isLoaded, setIsLoaded] = useState(false);\n\n  // Load recent from localStorage\n  useEffect(() => {\n    try {\n      const stored = localStorage.getItem(STORAGE_KEYS.RECENT);\n      if (stored) {\n        setRecent(JSON.parse(stored));\n      }\n    } catch (e) {\n      console.error(\"Failed to load recent stations:\", e);\n    }\n    setIsLoaded(true);\n  }, []);\n\n  // Save recent to localStorage\n  useEffect(() => {\n    if (isLoaded) {\n      localStorage.setItem(STORAGE_KEYS.RECENT, JSON.stringify(recent));\n    }\n  }, [recent, isLoaded]);\n\n  const addToRecent = useCallback((station: RadioStation) => {\n    setRecent((prev) => {\n      // Remove if already exists\n      const filtered = prev.filter((s) => s.id !== station.id);\n      // Add to front and limit size\n      return [station, ...filtered].slice(0, MAX_RECENT);\n    });\n  }, []);\n\n  const clearRecent = useCallback(() => {\n    setRecent([]);\n  }, []);\n\n  return {\n    recent,\n    addToRecent,\n    clearRecent,\n    isLoaded,\n  };\n}\n\nexport function usePreferences() {\n  const [preferences, setPreferences] =\n    useState<UserPreferences>(DEFAULT_PREFERENCES);\n  const [isLoaded, setIsLoaded] = useState(false);\n\n  // Load preferences from localStorage\n  useEffect(() => {\n    try {\n      const stored = localStorage.getItem(STORAGE_KEYS.PREFERENCES);\n      if (stored) {\n        setPreferences({ ...DEFAULT_PREFERENCES, ...JSON.parse(stored) });\n      }\n    } catch (e) {\n      console.error(\"Failed to load preferences:\", e);\n    }\n    setIsLoaded(true);\n  }, []);\n\n  // Save preferences to localStorage\n  useEffect(() => {\n    if (isLoaded) {\n      localStorage.setItem(\n        STORAGE_KEYS.PREFERENCES,\n        JSON.stringify(preferences),\n      );\n    }\n  }, [preferences, isLoaded]);\n\n  const updatePreference = useCallback(\n    <K extends keyof UserPreferences>(key: K, value: UserPreferences[K]) => {\n      setPreferences((prev) => ({ ...prev, [key]: value }));\n    },\n    [],\n  );\n\n  const addPreferredGenre = useCallback((genre: string) => {\n    setPreferences((prev) => ({\n      ...prev,\n      preferredGenres: Array.from(new Set([...prev.preferredGenres, genre])),\n    }));\n  }, []);\n\n  const removePreferredGenre = useCallback((genre: string) => {\n    setPreferences((prev) => ({\n      ...prev,\n      preferredGenres: prev.preferredGenres.filter((g) => g !== genre),\n    }));\n  }, []);\n\n  return {\n    preferences,\n    updatePreference,\n    addPreferredGenre,\n    removePreferredGenre,\n    isLoaded,\n  };\n}\n\n// Combined hook for all user data\nexport function useUserData() {\n  const favorites = useFavorites();\n  const recent = useRecentStations();\n  const preferences = usePreferences();\n\n  return {\n    favorites,\n    recent,\n    preferences,\n    isLoaded: favorites.isLoaded && recent.isLoaded && preferences.isLoaded,\n  };\n}\n"],"names":["STORAGE_KEYS","FAVORITES","RECENT","PREFERENCES","MAX_RECENT","DEFAULT_PREFERENCES","autoPlay","defaultVolume","preferredGenres","preferredCountries","sleepTimer","useFavorites","favorites","setFavorites","isLoaded","setIsLoaded","stored","localStorage","getItem","JSON","parse","e","console","error","setItem","stringify","addFavorite","station","prev","some","s","id","removeFavorite","stationId","filter","isFavorite","toggleFavorite","useRecentStations","recent","setRecent","addToRecent","filtered","slice","clearRecent","usePreferences","preferences","setPreferences","updatePreference","key","value","addPreferredGenre","genre","Array","from","Set","removePreferredGenre","g","useUserData"],"mappings":"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"}},
    {"offset": {"line": 3307, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/hooks/useUserLocation.ts"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\n\ninterface UserLocation {\n  latitude: number;\n  longitude: number;\n  country?: string;\n  city?: string;\n  timezone?: string;\n}\n\ninterface LocationState {\n  location: UserLocation | null;\n  isLoading: boolean;\n  error: string | null;\n  permissionDenied: boolean;\n}\n\n// Fallback locations by country code\nconst FALLBACK_LOCATIONS: Record<string, UserLocation> = {\n  US: {\n    latitude: 37.7749,\n    longitude: -122.4194,\n    country: \"United States\",\n    city: \"San Francisco\",\n    timezone: \"America/Los_Angeles\",\n  },\n  GB: {\n    latitude: 51.5074,\n    longitude: -0.1278,\n    country: \"United Kingdom\",\n    city: \"London\",\n    timezone: \"Europe/London\",\n  },\n  DE: {\n    latitude: 52.52,\n    longitude: 13.405,\n    country: \"Germany\",\n    city: \"Berlin\",\n    timezone: \"Europe/Berlin\",\n  },\n  FR: {\n    latitude: 48.8566,\n    longitude: 2.3522,\n    country: \"France\",\n    city: \"Paris\",\n    timezone: \"Europe/Paris\",\n  },\n  JP: {\n    latitude: 35.6762,\n    longitude: 139.6503,\n    country: \"Japan\",\n    city: \"Tokyo\",\n    timezone: \"Asia/Tokyo\",\n  },\n  KE: {\n    latitude: -1.2921,\n    longitude: 36.8219,\n    country: \"Kenya\",\n    city: \"Nairobi\",\n    timezone: \"Africa/Nairobi\",\n  },\n  IN: {\n    latitude: 28.6139,\n    longitude: 77.209,\n    country: \"India\",\n    city: \"New Delhi\",\n    timezone: \"Asia/Kolkata\",\n  },\n  BR: {\n    latitude: -23.5505,\n    longitude: -46.6333,\n    country: \"Brazil\",\n    city: \"So Paulo\",\n    timezone: \"America/Sao_Paulo\",\n  },\n  AU: {\n    latitude: -33.8688,\n    longitude: 151.2093,\n    country: \"Australia\",\n    city: \"Sydney\",\n    timezone: \"Australia/Sydney\",\n  },\n};\n\nexport function useUserLocation() {\n  const [state, setState] = useState<LocationState>({\n    location: null,\n    isLoading: true,\n    error: null,\n    permissionDenied: false,\n  });\n\n  useEffect(() => {\n    // Try to get from localStorage first (cached location)\n    const cached = localStorage.getItem(\"userLocation\");\n    if (cached) {\n      try {\n        const parsed = JSON.parse(cached);\n        // Use cached if less than 24 hours old\n        if (Date.now() - parsed.timestamp < 24 * 60 * 60 * 1000) {\n          setState({\n            location: parsed.location,\n            isLoading: false,\n            error: null,\n            permissionDenied: false,\n          });\n          return;\n        }\n      } catch (e) {\n        localStorage.removeItem(\"userLocation\");\n      }\n    }\n\n    // Try geolocation API\n    if (\"geolocation\" in navigator) {\n      navigator.geolocation.getCurrentPosition(\n        async (position) => {\n          const { latitude, longitude } = position.coords;\n\n          // Try to get location details via reverse geocoding\n          let locationDetails: UserLocation = { latitude, longitude };\n\n          try {\n            // Using a free reverse geocoding service\n            const response = await fetch(\n              `https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json`,\n              { headers: { \"User-Agent\": \"RadioGlobe/1.0\" } },\n            );\n            if (response.ok) {\n              const data = await response.json();\n              locationDetails = {\n                latitude,\n                longitude,\n                country: data.address?.country,\n                city:\n                  data.address?.city ||\n                  data.address?.town ||\n                  data.address?.village,\n                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,\n              };\n            }\n          } catch (e) {\n            // Reverse geocoding failed, use coordinates only\n            locationDetails.timezone =\n              Intl.DateTimeFormat().resolvedOptions().timeZone;\n          }\n\n          // Cache the location\n          localStorage.setItem(\n            \"userLocation\",\n            JSON.stringify({\n              location: locationDetails,\n              timestamp: Date.now(),\n            }),\n          );\n\n          setState({\n            location: locationDetails,\n            isLoading: false,\n            error: null,\n            permissionDenied: false,\n          });\n        },\n        (error) => {\n          console.warn(\"Geolocation error:\", error.message);\n\n          // Use timezone-based fallback\n          const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n          const fallbackLocation = getFallbackFromTimezone(timezone);\n\n          setState({\n            location: fallbackLocation,\n            isLoading: false,\n            error: error.message,\n            permissionDenied: error.code === error.PERMISSION_DENIED,\n          });\n        },\n        {\n          enableHighAccuracy: false,\n          timeout: 10000,\n          maximumAge: 300000, // 5 minutes\n        },\n      );\n    } else {\n      // Geolocation not supported, use timezone fallback\n      const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n      const fallbackLocation = getFallbackFromTimezone(timezone);\n\n      setState({\n        location: fallbackLocation,\n        isLoading: false,\n        error: \"Geolocation not supported\",\n        permissionDenied: false,\n      });\n    }\n  }, []);\n\n  return state;\n}\n\nfunction getFallbackFromTimezone(timezone: string): UserLocation {\n  // Map timezones to countries\n  if (timezone.startsWith(\"America/\")) {\n    if (timezone.includes(\"Sao_Paulo\") || timezone.includes(\"Brasilia\")) {\n      return FALLBACK_LOCATIONS.BR;\n    }\n    return FALLBACK_LOCATIONS.US;\n  }\n  if (timezone.startsWith(\"Europe/London\")) return FALLBACK_LOCATIONS.GB;\n  if (\n    timezone.startsWith(\"Europe/Berlin\") ||\n    timezone.startsWith(\"Europe/Vienna\")\n  )\n    return FALLBACK_LOCATIONS.DE;\n  if (timezone.startsWith(\"Europe/Paris\")) return FALLBACK_LOCATIONS.FR;\n  if (timezone.startsWith(\"Asia/Tokyo\")) return FALLBACK_LOCATIONS.JP;\n  if (timezone.startsWith(\"Asia/Kolkata\")) return FALLBACK_LOCATIONS.IN;\n  if (timezone.startsWith(\"Africa/Nairobi\")) return FALLBACK_LOCATIONS.KE;\n  if (timezone.startsWith(\"Australia/\")) return FALLBACK_LOCATIONS.AU;\n\n  // Default to US\n  return FALLBACK_LOCATIONS.US;\n}\n\n// Calculate distance between two coordinates in km\nexport function calculateDistance(\n  lat1: number,\n  lon1: number,\n  lat2: number,\n  lon2: number,\n): number {\n  const R = 6371; // Earth's radius in km\n  const dLat = toRad(lat2 - lat1);\n  const dLon = toRad(lon2 - lon1);\n  const a =\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(toRad(lat1)) *\n      Math.cos(toRad(lat2)) *\n      Math.sin(dLon / 2) *\n      Math.sin(dLon / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c;\n}\n\nfunction toRad(deg: number): number {\n  return deg * (Math.PI / 180);\n}\n\n// Get time of day category\nexport function getTimeOfDay(): \"morning\" | \"afternoon\" | \"evening\" | \"night\" {\n  const hour = new Date().getHours();\n  if (hour >= 5 && hour < 12) return \"morning\";\n  if (hour >= 12 && hour < 17) return \"afternoon\";\n  if (hour >= 17 && hour < 21) return \"evening\";\n  return \"night\";\n}\n\n// Get recommended genres based on time of day\nexport function getTimeBasedGenres(): string[] {\n  const timeOfDay = getTimeOfDay();\n  switch (timeOfDay) {\n    case \"morning\":\n      return [\"news\", \"talk\", \"classical\", \"jazz\", \"acoustic\"];\n    case \"afternoon\":\n      return [\"pop\", \"rock\", \"indie\", \"electronic\", \"world\"];\n    case \"evening\":\n      return [\"jazz\", \"soul\", \"r&b\", \"chill\", \"lounge\"];\n    case \"night\":\n      return [\"ambient\", \"electronic\", \"classical\", \"lo-fi\", \"sleep\"];\n  }\n}\n"],"names":["FALLBACK_LOCATIONS","US","latitude","longitude","country","city","timezone","GB","DE","FR","JP","KE","IN","BR","AU","useUserLocation","state","setState","location","isLoading","error","permissionDenied","cached","localStorage","getItem","parsed","JSON","parse","Date","now","timestamp","e","removeItem","navigator","geolocation","getCurrentPosition","position","coords","locationDetails","response","fetch","headers","ok","data","json","address","town","village","Intl","DateTimeFormat","resolvedOptions","timeZone","setItem","stringify","console","warn","message","fallbackLocation","getFallbackFromTimezone","code","PERMISSION_DENIED","enableHighAccuracy","timeout","maximumAge","startsWith","includes","calculateDistance","lat1","lon1","lat2","lon2","R","dLat","toRad","dLon","a","Math","sin","cos","c","atan2","sqrt","deg","PI","getTimeOfDay","hour","getHours","getTimeBasedGenres","timeOfDay"],"mappings":"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"}},
    {"offset": {"line": 3561, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/components/StationPanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { motion } from \"framer-motion\";\nimport {\n  MapPin,\n  Clock,\n  Users,\n  ExternalLink,\n  Heart,\n  Share2,\n  X,\n  Wifi,\n  WifiOff,\n  Copy,\n  Check,\n  Radio,\n  Zap,\n  Signal,\n  Globe,\n  Music,\n} from \"lucide-react\";\nimport { RadioStation } from \"../types\";\nimport { useFavorites } from \"../hooks/useUserData\";\nimport { useUserLocation, calculateDistance } from \"../hooks/useUserLocation\";\n\ninterface StationPanelProps {\n  station: RadioStation;\n  onClose?: () => void;\n}\n\nexport function StationPanel({ station, onClose }: StationPanelProps) {\n  const { isFavorite, toggleFavorite } = useFavorites();\n  const { location } = useUserLocation();\n  const [copied, setCopied] = useState(false);\n\n  const isStationFavorite = isFavorite(station.id);\n\n  const currentTime = new Date().toLocaleTimeString(\"en-US\", {\n    timeZone: station.location.timezone || \"UTC\",\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n  });\n\n  // Calculate distance from user\n  const distance =\n    location && station.location.lat && station.location.lng\n      ? calculateDistance(\n          location.latitude,\n          location.longitude,\n          station.location.lat,\n          station.location.lng,\n        )\n      : null;\n\n  const formatDistance = (km: number) => {\n    if (km < 1) return `${Math.round(km * 1000)}m`;\n    if (km < 100) return `${km.toFixed(1)}km`;\n    return `${Math.round(km).toLocaleString()}km`;\n  };\n\n  // Get quality indicator\n  const getQualityIndicator = (bitrate?: number) => {\n    if (!bitrate)\n      return { label: \"Unknown\", color: \"text-gray-400\", icon: WifiOff };\n    if (bitrate >= 256)\n      return { label: \"HD\", color: \"text-green-400\", icon: Wifi };\n    if (bitrate >= 128)\n      return { label: \"Good\", color: \"text-blue-400\", icon: Wifi };\n    return { label: \"Low\", color: \"text-yellow-400\", icon: Wifi };\n  };\n\n  const quality = getQualityIndicator(station.bitrate);\n\n  const handleShare = async () => {\n    const shareData = {\n      title: station.name,\n      text: `Listen to ${station.name} on Radio Globe`,\n      url: `${window.location.origin}?station=${station.id}`,\n    };\n\n    if (navigator.share) {\n      try {\n        await navigator.share(shareData);\n      } catch (e) {\n        // User cancelled or share failed\n        copyToClipboard(shareData.url);\n      }\n    } else {\n      copyToClipboard(shareData.url);\n    }\n  };\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.9, y: 20 }}\n      animate={{ opacity: 1, scale: 1, y: 0 }}\n      exit={{ opacity: 0, scale: 0.9, y: 20 }}\n      transition={{ type: \"spring\", damping: 25, stiffness: 300 }}\n      className=\"relative w-[340px] max-w-sm\"\n    >\n      {/* Animated border gradient */}\n      <div className=\"absolute -inset-[1px] rounded-2xl bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 opacity-50 blur-sm\" />\n      <div className=\"absolute -inset-[1px] rounded-2xl bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 opacity-30 animate-pulse\" />\n      \n      {/* Main panel content */}\n      <div className=\"relative rounded-2xl p-5 bg-gradient-to-b from-gray-900/95 to-gray-950/95 backdrop-blur-xl border border-cyan-500/20 shadow-[0_0_40px_rgba(0,245,255,0.1)]\">\n        {/* Corner accents */}\n        <div className=\"absolute top-0 left-0 w-8 h-8 border-t-2 border-l-2 border-cyan-400/50 rounded-tl-2xl\" />\n        <div className=\"absolute top-0 right-0 w-8 h-8 border-t-2 border-r-2 border-purple-400/50 rounded-tr-2xl\" />\n        <div className=\"absolute bottom-0 left-0 w-8 h-8 border-b-2 border-l-2 border-purple-400/50 rounded-bl-2xl\" />\n        <div className=\"absolute bottom-0 right-0 w-8 h-8 border-b-2 border-r-2 border-cyan-400/50 rounded-br-2xl\" />\n\n        {/* Close Button */}\n        {onClose && (\n          <motion.button\n            onClick={onClose}\n            className=\"absolute top-3 right-3 p-2 rounded-full bg-white/5 hover:bg-white/10 \n                       border border-white/10 hover:border-cyan-500/30 transition-all z-10\"\n            whileHover={{ scale: 1.1, rotate: 90 }}\n            whileTap={{ scale: 0.9 }}\n          >\n            <X className=\"w-4 h-4 text-gray-400\" />\n          </motion.button>\n        )}\n\n        {/* Header */}\n        <div className=\"mb-5 pr-10\">\n          <div className=\"flex items-start gap-4\">\n            {/* Station Icon with animated glow */}\n            <div className=\"relative\">\n              <motion.div \n                className=\"w-14 h-14 rounded-xl bg-gradient-to-br from-cyan-500 to-purple-600 \n                           flex items-center justify-center shadow-lg\"\n                animate={{ \n                  boxShadow: [\n                    \"0 0 20px rgba(0, 245, 255, 0.3)\",\n                    \"0 0 30px rgba(168, 85, 247, 0.4)\",\n                    \"0 0 20px rgba(0, 245, 255, 0.3)\",\n                  ]\n                }}\n                transition={{ duration: 2, repeat: Infinity }}\n              >\n                <Radio className=\"w-7 h-7 text-white\" />\n              </motion.div>\n              {/* Live indicator */}\n              <motion.div \n                className=\"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-gray-900\n                           flex items-center justify-center\"\n                animate={{ scale: [1, 1.2, 1] }}\n                transition={{ duration: 1.5, repeat: Infinity }}\n              >\n                <div className=\"w-2 h-2 bg-white rounded-full\" />\n              </motion.div>\n            </div>\n            \n            <div className=\"flex-1 min-w-0\">\n              <h3 className=\"font-bold text-lg text-white truncate mb-1\">\n                {station.name}\n              </h3>\n              <div className=\"flex items-center gap-1.5 text-gray-400 text-sm\">\n                <MapPin className=\"w-3.5 h-3.5 text-cyan-400 flex-shrink-0\" />\n                <span className=\"truncate\">\n                  {station.location.city}{station.location.city && station.location.country ? \", \" : \"\"}{station.location.country}\n                </span>\n              </div>\n            </div>\n          </div>\n\n          {/* Distance Badge */}\n          {distance !== null && (\n            <motion.div \n              className=\"mt-3 inline-flex items-center gap-1.5 px-3 py-1.5 \n                         bg-gradient-to-r from-cyan-500/10 to-blue-500/10\n                         border border-cyan-500/20 rounded-full text-xs font-mono\"\n              initial={{ opacity: 0, x: -20 }}\n              animate={{ opacity: 1, x: 0 }}\n              transition={{ delay: 0.2 }}\n            >\n              <Signal className=\"w-3.5 h-3.5 text-cyan-400\" />\n              <span className=\"text-cyan-300\">{formatDistance(distance)}</span>\n              <span className=\"text-gray-500\">away</span>\n            </motion.div>\n          )}\n        </div>\n\n        {/* Stats Grid - Holographic style */}\n        <div className=\"grid grid-cols-3 gap-2 mb-5\">\n          {[\n            { icon: Users, value: station.listeners >= 1000 ? `${(station.listeners / 1000).toFixed(0)}k` : station.listeners, label: \"Listeners\", color: \"cyan\" },\n            { icon: Clock, value: currentTime, label: \"Local Time\", color: \"green\" },\n            { icon: quality.icon, value: quality.label, label: station.bitrate ? `${station.bitrate}kbps` : \"Quality\", color: station.bitrate >= 256 ? \"green\" : station.bitrate >= 128 ? \"blue\" : \"yellow\" },\n          ].map((stat, index) => (\n            <motion.div\n              key={stat.label}\n              className=\"relative text-center p-3 rounded-xl \n                         bg-gradient-to-b from-white/5 to-transparent\n                         border border-white/5 hover:border-cyan-500/30\n                         transition-all group\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.1 + index * 0.1 }}\n              whileHover={{ scale: 1.05 }}\n            >\n              <stat.icon className={`w-4 h-4 mx-auto mb-1.5 ${\n                stat.color === \"cyan\" ? \"text-cyan-400\" :\n                stat.color === \"green\" ? \"text-green-400\" :\n                stat.color === \"blue\" ? \"text-blue-400\" :\n                \"text-yellow-400\"\n              }`} />\n              <div className=\"text-sm font-bold text-white font-mono\">{stat.value}</div>\n              <div className=\"text-[10px] text-gray-500 uppercase tracking-wider\">{stat.label}</div>\n              \n              {/* Hover glow */}\n              <div className=\"absolute inset-0 rounded-xl bg-cyan-500/10 opacity-0 group-hover:opacity-100 transition-opacity\" />\n            </motion.div>\n          ))}\n        </div>\n\n        {/* Genre Tags - Neon style */}\n        {station.genre && (\n          <div className=\"flex flex-wrap gap-2 mb-5\">\n            {station.genre\n              .split(\",\")\n              .slice(0, 4)\n              .map((genre, i) => (\n                <motion.span\n                  key={i}\n                  className=\"px-3 py-1 rounded-full text-xs font-medium\n                             bg-gradient-to-r from-purple-500/10 to-pink-500/10\n                             border border-purple-500/20 text-purple-300\n                             hover:border-purple-500/40 transition-colors\"\n                  initial={{ opacity: 0, scale: 0.8 }}\n                  animate={{ opacity: 1, scale: 1 }}\n                  transition={{ delay: 0.3 + i * 0.05 }}\n                >\n                  {genre.trim()}\n                </motion.span>\n              ))}\n          </div>\n        )}\n\n        {/* Language & Details - Terminal style */}\n        {station.language && (\n          <div className=\"mb-5 p-3 rounded-lg bg-black/30 border border-white/5 font-mono text-xs\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-gray-500 uppercase tracking-wider\">Language</span>\n              <span className=\"text-cyan-300 capitalize\">{station.language}</span>\n            </div>\n            {station.source && (\n              <div className=\"flex justify-between items-center mt-2 pt-2 border-t border-white/5\">\n                <span className=\"text-gray-500 uppercase tracking-wider\">Source</span>\n                <span className=\"text-purple-300\">{station.source}</span>\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Actions - Futuristic buttons */}\n        <div className=\"flex gap-2\">\n          <motion.button\n            onClick={() => toggleFavorite(station)}\n            className={`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-xl font-medium transition-all ${\n              isStationFavorite\n                ? \"bg-gradient-to-r from-pink-500/20 to-rose-500/20 text-pink-400 border border-pink-500/30 shadow-[0_0_20px_rgba(236,72,153,0.2)]\"\n                : \"bg-white/5 text-white hover:bg-white/10 border border-white/10 hover:border-cyan-500/30\"\n            }`}\n            whileHover={{ scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n          >\n            <Heart\n              className={`w-4 h-4 ${isStationFavorite ? \"fill-current\" : \"\"}`}\n            />\n            <span className=\"text-sm\">{isStationFavorite ? \"Saved\" : \"Save\"}</span>\n          </motion.button>\n          \n          <motion.button\n            onClick={handleShare}\n            className=\"flex items-center justify-center gap-2 px-4 py-3 \n                       bg-white/5 text-white rounded-xl \n                       border border-white/10 hover:border-cyan-500/30\n                       hover:bg-cyan-500/10 transition-all\"\n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n          >\n            {copied ? (\n              <Check className=\"w-4 h-4 text-green-400\" />\n            ) : (\n              <Share2 className=\"w-4 h-4\" />\n            )}\n          </motion.button>\n          \n          {station.website && (\n            <motion.a\n              href={station.website}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"flex items-center justify-center px-4 py-3 \n                         bg-white/5 text-white rounded-xl \n                         border border-white/10 hover:border-purple-500/30\n                         hover:bg-purple-500/10 transition-all\"\n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.95 }}\n            >\n              <ExternalLink className=\"w-4 h-4\" />\n            </motion.a>\n          )}\n        </div>\n        \n        {/* Bottom accent line */}\n        <motion.div \n          className=\"absolute bottom-0 left-1/2 -translate-x-1/2 w-1/2 h-[2px] \n                     bg-gradient-to-r from-transparent via-cyan-500 to-transparent\"\n          initial={{ scaleX: 0 }}\n          animate={{ scaleX: 1 }}\n          transition={{ delay: 0.5, duration: 0.5 }}\n        />\n      </div>\n    </motion.div>\n  );\n}\n"],"names":["StationPanel","station","onClose","isFavorite","toggleFavorite","location","copied","setCopied","isStationFavorite","id","currentTime","Date","toLocaleTimeString","timeZone","timezone","hour","minute","distance","lat","lng","latitude","longitude","formatDistance","km","Math","round","toFixed","toLocaleString","getQualityIndicator","bitrate","label","color","icon","quality","handleShare","shareData","title","name","text","url","window","origin","navigator","share","e","copyToClipboard","clipboard","writeText","setTimeout","div","initial","opacity","scale","y","animate","exit","transition","type","damping","stiffness","className","button","onClick","whileHover","rotate","whileTap","boxShadow","duration","repeat","Infinity","city","country","x","delay","value","listeners","map","stat","index","genre","split","slice","i","span","trim","language","source","website","a","href","target","rel","scaleX"],"mappings":"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"}},
    {"offset": {"line": 4195, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/services/radioBrowserApiService.ts"],"sourcesContent":["/**\n * Radio Browser API Service\n * \n * Integrates with the free, open-source Radio Browser API (radio-browser.info)\n * This API provides access to 30,000+ radio stations worldwide with:\n * - Real-time station data\n * - Geographic information\n * - Popularity metrics\n * - Stream URLs\n * \n * @see https://api.radio-browser.info/\n */\n\nimport { RadioStation } from \"../types\";\n\n// Radio Browser API servers (they recommend using DNS round-robin)\nconst API_SERVERS = [\n  \"https://de1.api.radio-browser.info\",\n  \"https://nl1.api.radio-browser.info\", \n  \"https://at1.api.radio-browser.info\",\n];\n\n// Use local API proxy for CORS and caching\nconst USE_LOCAL_PROXY = typeof window !== \"undefined\";\nconst LOCAL_PROXY_PATH = \"/api/radio-browser\";\n\ninterface RadioBrowserStation {\n  changeuuid: string;\n  stationuuid: string;\n  serveruuid: string;\n  name: string;\n  url: string;\n  url_resolved: string;\n  homepage: string;\n  favicon: string;\n  tags: string;\n  country: string;\n  countrycode: string;\n  iso_3166_2: string;\n  state: string;\n  language: string;\n  languagecodes: string;\n  votes: number;\n  lastchangetime: string;\n  lastchangetime_iso8601: string;\n  codec: string;\n  bitrate: number;\n  hls: number;\n  lastcheckok: number;\n  lastchecktime: string;\n  lastchecktime_iso8601: string;\n  lastcheckoktime: string;\n  lastcheckoktime_iso8601: string;\n  lastlocalchecktime: string;\n  lastlocalchecktime_iso8601: string;\n  clicktimestamp: string;\n  clicktimestamp_iso8601: string;\n  clickcount: number;\n  clicktrend: number;\n  ssl_error: number;\n  geo_lat: number | null;\n  geo_long: number | null;\n  has_extended_info: boolean;\n}\n\ninterface RadioBrowserCountry {\n  name: string;\n  iso_3166_1: string;\n  stationcount: number;\n}\n\ninterface RadioBrowserTag {\n  name: string;\n  stationcount: number;\n}\n\ninterface RadioBrowserLanguage {\n  name: string;\n  iso_639: string;\n  stationcount: number;\n}\n\ninterface SearchFilters {\n  name?: string;\n  country?: string;\n  countrycode?: string;\n  state?: string;\n  language?: string;\n  tag?: string;\n  tagList?: string[];\n  codec?: string;\n  bitrateMin?: number;\n  bitrateMax?: number;\n  hasGeoInfo?: boolean;\n  isHttps?: boolean;\n  order?: \"name\" | \"url\" | \"homepage\" | \"favicon\" | \"tags\" | \"country\" | \"state\" | \"language\" | \"votes\" | \"codec\" | \"bitrate\" | \"lastcheckok\" | \"lastchecktime\" | \"clicktimestamp\" | \"clickcount\" | \"clicktrend\" | \"changetimestamp\" | \"random\";\n  reverse?: boolean;\n  offset?: number;\n  limit?: number;\n  hidebroken?: boolean;\n}\n\n/**\n * Radio Browser API Service\n * Provides methods to discover and search radio stations from the global database\n */\nexport class RadioBrowserApiService {\n  private currentServerIndex = 0;\n  private readonly requestTimeout = 10000; // 10 seconds\n\n  /**\n   * Get the base URL for API requests\n   */\n  private getBaseUrl(): string {\n    if (USE_LOCAL_PROXY && typeof window !== \"undefined\") {\n      return LOCAL_PROXY_PATH;\n    }\n    return API_SERVERS[this.currentServerIndex];\n  }\n\n  /**\n   * Rotate to next server on failure\n   */\n  private rotateServer(): void {\n    this.currentServerIndex = (this.currentServerIndex + 1) % API_SERVERS.length;\n  }\n\n  /**\n   * Make an API request with automatic server rotation on failure\n   */\n  private async apiRequest<T>(\n    endpoint: string,\n    params: Record<string, string | number | boolean> = {}\n  ): Promise<T> {\n    const maxRetries = API_SERVERS.length;\n    let lastError: Error | null = null;\n\n    for (let attempt = 0; attempt < maxRetries; attempt++) {\n      try {\n        let url: URL;\n\n        if (USE_LOCAL_PROXY) {\n          // Use our Next.js API proxy\n          url = new URL(LOCAL_PROXY_PATH, window.location.origin);\n          url.searchParams.append(\"path\", endpoint);\n        } else {\n          // Direct API call (server-side)\n          const baseUrl = this.getBaseUrl();\n          url = new URL(`${baseUrl}${endpoint}`);\n        }\n        \n        // Add query params\n        Object.entries(params).forEach(([key, value]) => {\n          if (value !== undefined && value !== null) {\n            url.searchParams.append(key, String(value));\n          }\n        });\n\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), this.requestTimeout);\n\n        const response = await fetch(url.toString(), {\n          method: \"GET\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          signal: controller.signal,\n        });\n\n        clearTimeout(timeoutId);\n\n        if (!response.ok) {\n          throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n        }\n\n        return await response.json();\n      } catch (error) {\n        lastError = error as Error;\n        console.warn(`Radio Browser API request failed (attempt ${attempt + 1}):`, error);\n        this.rotateServer();\n      }\n    }\n\n    throw lastError || new Error(\"All API servers failed\");\n  }\n\n  /**\n   * Convert Radio Browser station format to our RadioStation format\n   */\n  private mapStation(station: RadioBrowserStation): RadioStation {\n    // Generate coordinates based on country if not provided\n    let lat = station.geo_lat || 0;\n    let lng = station.geo_long || 0;\n\n    // If no geo info, try to assign approximate coordinates based on country\n    if (!lat && !lng && station.countrycode) {\n      const coords = this.getCountryCoordinates(station.countrycode);\n      lat = coords.lat + (Math.random() - 0.5) * 5;\n      lng = coords.lng + (Math.random() - 0.5) * 5;\n    }\n\n    return {\n      id: station.stationuuid,\n      name: station.name.trim(),\n      url: station.url_resolved || station.url,\n      genre: station.tags?.split(\",\").slice(0, 3).join(\", \") || \"Unknown\",\n      language: station.language || \"Unknown\",\n      listeners: station.clickcount || 0,\n      location: {\n        lat,\n        lng,\n        country: station.country || \"Unknown\",\n        city: station.state || \"\",\n        countryCode: station.countrycode,\n      },\n      logo: station.favicon || undefined,\n      website: station.homepage || undefined,\n      homepage: station.homepage || undefined,\n      bitrate: station.bitrate || undefined,\n      codec: station.codec || undefined,\n      isOnline: station.lastcheckok === 1,\n      votes: station.votes,\n      clickcount: station.clickcount,\n      tags: station.tags?.split(\",\").map(t => t.trim()).filter(Boolean),\n      source: \"radio-browser\",\n    };\n  }\n\n  /**\n   * Get approximate coordinates for a country code\n   */\n  private getCountryCoordinates(countryCode: string): { lat: number; lng: number } {\n    const countryCoords: Record<string, { lat: number; lng: number }> = {\n      US: { lat: 39.8, lng: -98.5 },\n      GB: { lat: 54.0, lng: -2.0 },\n      DE: { lat: 51.2, lng: 10.4 },\n      FR: { lat: 46.2, lng: 2.2 },\n      JP: { lat: 36.2, lng: 138.3 },\n      AU: { lat: -25.3, lng: 133.8 },\n      BR: { lat: -14.2, lng: -51.9 },\n      IN: { lat: 20.6, lng: 79.0 },\n      CN: { lat: 35.9, lng: 104.2 },\n      RU: { lat: 61.5, lng: 105.3 },\n      CA: { lat: 56.1, lng: -106.3 },\n      MX: { lat: 23.6, lng: -102.6 },\n      ES: { lat: 40.5, lng: -3.7 },\n      IT: { lat: 41.9, lng: 12.6 },\n      NL: { lat: 52.1, lng: 5.3 },\n      BE: { lat: 50.5, lng: 4.5 },\n      CH: { lat: 46.8, lng: 8.2 },\n      AT: { lat: 47.5, lng: 14.6 },\n      SE: { lat: 60.1, lng: 18.6 },\n      NO: { lat: 60.5, lng: 8.5 },\n      FI: { lat: 61.9, lng: 25.7 },\n      DK: { lat: 56.3, lng: 9.5 },\n      PL: { lat: 51.9, lng: 19.1 },\n      UA: { lat: 48.4, lng: 31.2 },\n      KR: { lat: 35.9, lng: 127.8 },\n      ZA: { lat: -30.6, lng: 22.9 },\n      AR: { lat: -38.4, lng: -63.6 },\n      CL: { lat: -35.7, lng: -71.5 },\n      CO: { lat: 4.6, lng: -74.3 },\n      // Default fallback\n      DEFAULT: { lat: 0, lng: 0 },\n    };\n\n    return countryCoords[countryCode.toUpperCase()] || countryCoords.DEFAULT;\n  }\n\n  // ===== PUBLIC API METHODS =====\n\n  /**\n   * Search stations by name (fuzzy search)\n   */\n  async searchByName(name: string, limit = 100): Promise<RadioStation[]> {\n    const data = await this.apiRequest<RadioBrowserStation[]>(\"/json/stations/byname/\" + encodeURIComponent(name), {\n      limit,\n      hidebroken: true,\n      order: \"clickcount\",\n      reverse: true,\n    });\n    return data.map(s => this.mapStation(s));\n  }\n\n  /**\n   * Search stations with advanced filters\n   */\n  async searchStations(filters: SearchFilters): Promise<RadioStation[]> {\n    const params: Record<string, string | number | boolean> = {\n      hidebroken: filters.hidebroken ?? true,\n      order: filters.order ?? \"clickcount\",\n      reverse: filters.reverse ?? true,\n      limit: filters.limit ?? 100,\n      offset: filters.offset ?? 0,\n    };\n\n    if (filters.name) params.name = filters.name;\n    if (filters.country) params.country = filters.country;\n    if (filters.countrycode) params.countrycode = filters.countrycode;\n    if (filters.state) params.state = filters.state;\n    if (filters.language) params.language = filters.language;\n    if (filters.tag) params.tag = filters.tag;\n    if (filters.tagList) params.tagList = filters.tagList.join(\",\");\n    if (filters.codec) params.codec = filters.codec;\n    if (filters.bitrateMin) params.bitrateMin = filters.bitrateMin;\n    if (filters.bitrateMax) params.bitrateMax = filters.bitrateMax;\n    if (filters.hasGeoInfo) params.has_geo_info = filters.hasGeoInfo;\n    if (filters.isHttps) params.is_https = filters.isHttps;\n\n    const data = await this.apiRequest<RadioBrowserStation[]>(\"/json/stations/search\", params);\n    return data.map(s => this.mapStation(s));\n  }\n\n  /**\n   * Get top stations by click count (most popular)\n   */\n  async getTopStations(limit = 100): Promise<RadioStation[]> {\n    const data = await this.apiRequest<RadioBrowserStation[]>(\"/json/stations/topclick/\" + limit, {\n      hidebroken: true,\n    });\n    return data.map(s => this.mapStation(s));\n  }\n\n  /**\n   * Get trending stations (highest click trend)\n   */\n  async getTrendingStations(limit = 50): Promise<RadioStation[]> {\n    const data = await this.apiRequest<RadioBrowserStation[]>(\"/json/stations/topvote/\" + limit, {\n      hidebroken: true,\n    });\n    return data.map(s => this.mapStation(s));\n  }\n\n  /**\n   * Get recently changed/added stations\n   */\n  async getRecentStations(limit = 50): Promise<RadioStation[]> {\n    const data = await this.apiRequest<RadioBrowserStation[]>(\"/json/stations/lastchange/\" + limit, {\n      hidebroken: true,\n    });\n    return data.map(s => this.mapStation(s));\n  }\n\n  /**\n   * Get stations by country\n   */\n  async getStationsByCountry(country: string, limit = 100): Promise<RadioStation[]> {\n    const data = await this.apiRequest<RadioBrowserStation[]>(\"/json/stations/bycountry/\" + encodeURIComponent(country), {\n      limit,\n      hidebroken: true,\n      order: \"clickcount\",\n      reverse: true,\n    });\n    return data.map(s => this.mapStation(s));\n  }\n\n  /**\n   * Get stations by country code (ISO 3166-1)\n   */\n  async getStationsByCountryCode(countryCode: string, limit = 100): Promise<RadioStation[]> {\n    const data = await this.apiRequest<RadioBrowserStation[]>(\"/json/stations/bycountrycodeexact/\" + countryCode.toUpperCase(), {\n      limit,\n      hidebroken: true,\n      order: \"clickcount\",\n      reverse: true,\n    });\n    return data.map(s => this.mapStation(s));\n  }\n\n  /**\n   * Get stations by tag/genre\n   */\n  async getStationsByTag(tag: string, limit = 100): Promise<RadioStation[]> {\n    const data = await this.apiRequest<RadioBrowserStation[]>(\"/json/stations/bytag/\" + encodeURIComponent(tag), {\n      limit,\n      hidebroken: true,\n      order: \"clickcount\",\n      reverse: true,\n    });\n    return data.map(s => this.mapStation(s));\n  }\n\n  /**\n   * Get stations by language\n   */\n  async getStationsByLanguage(language: string, limit = 100): Promise<RadioStation[]> {\n    const data = await this.apiRequest<RadioBrowserStation[]>(\"/json/stations/bylanguage/\" + encodeURIComponent(language), {\n      limit,\n      hidebroken: true,\n      order: \"clickcount\",\n      reverse: true,\n    });\n    return data.map(s => this.mapStation(s));\n  }\n\n  /**\n   * Get stations with geo coordinates\n   */\n  async getStationsWithGeoInfo(limit = 500): Promise<RadioStation[]> {\n    const data = await this.apiRequest<RadioBrowserStation[]>(\"/json/stations/search\", {\n      has_geo_info: true,\n      limit,\n      hidebroken: true,\n      order: \"clickcount\",\n      reverse: true,\n    });\n    return data.map(s => this.mapStation(s));\n  }\n\n  /**\n   * Get all available countries\n   */\n  async getCountries(): Promise<RadioBrowserCountry[]> {\n    return this.apiRequest<RadioBrowserCountry[]>(\"/json/countries\", {\n      order: \"stationcount\",\n      reverse: true,\n    });\n  }\n\n  /**\n   * Get all available tags/genres\n   */\n  async getTags(limit = 100): Promise<RadioBrowserTag[]> {\n    return this.apiRequest<RadioBrowserTag[]>(\"/json/tags\", {\n      order: \"stationcount\",\n      reverse: true,\n      limit,\n    });\n  }\n\n  /**\n   * Get all available languages\n   */\n  async getLanguages(): Promise<RadioBrowserLanguage[]> {\n    return this.apiRequest<RadioBrowserLanguage[]>(\"/json/languages\", {\n      order: \"stationcount\",\n      reverse: true,\n    });\n  }\n\n  /**\n   * Report a station click (helps with statistics)\n   */\n  async reportStationClick(stationId: string): Promise<void> {\n    try {\n      await this.apiRequest(`/json/url/${stationId}`);\n    } catch (error) {\n      console.warn(\"Failed to report station click:\", error);\n    }\n  }\n\n  /**\n   * Vote for a station (increases popularity)\n   */\n  async voteForStation(stationId: string): Promise<boolean> {\n    try {\n      const result = await this.apiRequest<{ ok: boolean }>(`/json/vote/${stationId}`);\n      return result.ok;\n    } catch (error) {\n      console.warn(\"Failed to vote for station:\", error);\n      return false;\n    }\n  }\n\n  /**\n   * Get stations near a location\n   */\n  async getStationsNearLocation(\n    lat: number,\n    lng: number,\n    radiusKm = 500,\n    limit = 50\n  ): Promise<RadioStation[]> {\n    // Radio Browser doesn't have direct geo-search, so we search by country\n    // and filter by distance\n    const allStations = await this.getStationsWithGeoInfo(500);\n    \n    const stationsWithDistance = allStations\n      .map(station => ({\n        ...station,\n        distance: this.haversineDistance(lat, lng, station.location.lat, station.location.lng),\n      }))\n      .filter(s => s.distance <= radiusKm)\n      .sort((a, b) => a.distance - b.distance)\n      .slice(0, limit);\n\n    return stationsWithDistance;\n  }\n\n  /**\n   * Calculate distance between two points (Haversine formula)\n   */\n  private haversineDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\n    const R = 6371; // Earth's radius in km\n    const dLat = this.toRad(lat2 - lat1);\n    const dLon = this.toRad(lon2 - lon1);\n    const a =\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n      Math.cos(this.toRad(lat1)) * Math.cos(this.toRad(lat2)) *\n      Math.sin(dLon / 2) * Math.sin(dLon / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    return R * c;\n  }\n\n  private toRad(deg: number): number {\n    return deg * (Math.PI / 180);\n  }\n\n  /**\n   * Discover random stations for exploration\n   */\n  async discoverRandomStations(limit = 20): Promise<RadioStation[]> {\n    const data = await this.apiRequest<RadioBrowserStation[]>(\"/json/stations/search\", {\n      order: \"random\",\n      limit,\n      hidebroken: true,\n      has_geo_info: true,\n    });\n    return data.map(s => this.mapStation(s));\n  }\n\n  /**\n   * Get HD quality stations (high bitrate)\n   */\n  async getHDStations(limit = 50): Promise<RadioStation[]> {\n    const data = await this.apiRequest<RadioBrowserStation[]>(\"/json/stations/search\", {\n      bitrateMin: 256,\n      order: \"clickcount\",\n      reverse: true,\n      limit,\n      hidebroken: true,\n    });\n    return data.map(s => this.mapStation(s));\n  }\n}\n\n// Export singleton instance\nexport const radioBrowserApi = new RadioBrowserApiService();\n"],"names":["API_SERVERS","USE_LOCAL_PROXY","LOCAL_PROXY_PATH","RadioBrowserApiService","currentServerIndex","requestTimeout","getBaseUrl","rotateServer","length","apiRequest","endpoint","params","maxRetries","lastError","attempt","url","baseUrl","URL","Object","entries","forEach","key","value","undefined","searchParams","append","String","controller","AbortController","timeoutId","setTimeout","abort","response","fetch","toString","method","headers","signal","clearTimeout","ok","Error","status","statusText","json","error","console","warn","mapStation","station","lat","geo_lat","lng","geo_long","countrycode","coords","getCountryCoordinates","Math","random","id","stationuuid","name","trim","url_resolved","genre","tags","split","slice","join","language","listeners","clickcount","location","country","city","state","countryCode","logo","favicon","website","homepage","bitrate","codec","isOnline","lastcheckok","votes","map","t","filter","Boolean","source","countryCoords","US","GB","DE","FR","JP","AU","BR","IN","CN","RU","CA","MX","ES","IT","NL","BE","CH","AT","SE","NO","FI","DK","PL","UA","KR","ZA","AR","CL","CO","DEFAULT","toUpperCase","searchByName","limit","data","encodeURIComponent","hidebroken","order","reverse","s","searchStations","filters","offset","tag","tagList","bitrateMin","bitrateMax","hasGeoInfo","has_geo_info","isHttps","is_https","getTopStations","getTrendingStations","getRecentStations","getStationsByCountry","getStationsByCountryCode","getStationsByTag","getStationsByLanguage","getStationsWithGeoInfo","getCountries","getTags","getLanguages","reportStationClick","stationId","voteForStation","result","getStationsNearLocation","radiusKm","allStations","stationsWithDistance","distance","haversineDistance","sort","a","b","lat1","lon1","lat2","lon2","R","dLat","toRad","dLon","sin","cos","c","atan2","sqrt","deg","PI","discoverRandomStations","getHDStations","radioBrowserApi"],"mappings":"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"}},
    {"offset": {"line": 4661, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/components/SearchPanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useCallback, useRef } from \"react\";\nimport {\n  Search,\n  MapPin,\n  Volume2,\n  Heart,\n  Share,\n  Globe,\n  Music,\n  Radio,\n  Sparkles,\n  TrendingUp,\n  Zap,\n  Wifi,\n  Compass,\n  Clock,\n  X,\n} from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { RadioStation } from \"../types\";\nimport { useGlobeStore } from \"../stores/globe-store\";\nimport { radioStationService } from \"../services/radioStationService\";\nimport { radioBrowserApi } from \"../services/radioBrowserApiService\";\n\ninterface SearchPanelProps {\n  className?: string;\n}\n\n// Futuristic filter tabs with icons\nconst FILTER_TABS = [\n  { id: \"all\", label: \"All\", icon: Search, color: \"cyan\" },\n  { id: \"discover\", label: \"Discover\", icon: Sparkles, color: \"purple\" },\n  { id: \"trending\", label: \"Trending\", icon: TrendingUp, color: \"pink\" },\n  { id: \"genre\", label: \"Genre\", icon: Music, color: \"green\" },\n  { id: \"country\", label: \"Country\", icon: Globe, color: \"blue\" },\n  { id: \"city\", label: \"City\", icon: MapPin, color: \"orange\" },\n] as const;\n\ntype FilterType = typeof FILTER_TABS[number][\"id\"];\n\nexport function SearchPanel({ className = \"\" }: SearchPanelProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [searchResults, setSearchResults] = useState<RadioStation[]>([]);\n  const [fullResults, setFullResults] = useState<RadioStation[]>([]);\n  const [resultLimit, setResultLimit] = useState(20);\n  const [totalResults, setTotalResults] = useState(0);\n  const [popularStations, setPopularStations] = useState<RadioStation[]>([]);\n  const [trendingStations, setTrendingStations] = useState<RadioStation[]>([]);\n  const [discoverStations, setDiscoverStations] = useState<RadioStation[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [searchFilter, setSearchFilter] = useState<FilterType>(\"all\");\n  const [availableCountries, setAvailableCountries] = useState<string[]>([]);\n  const [availableCities, setAvailableCities] = useState<string[]>([]);\n  const [suggestedTags, setSuggestedTags] = useState<string[]>([]);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const { selectStation } = useGlobeStore();\n\n  const getDefaultLimit = (filter: FilterType) => {\n    switch (filter) {\n      case \"country\":\n        return 60;\n      case \"city\":\n        return 40;\n      case \"discover\":\n      case \"trending\":\n        return 30;\n      default:\n        return 20;\n    }\n  };\n\n  // Load initial data: popular, trending, and discovery stations\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        // Fetch from local cache\n        const stations = await radioStationService.getPopularStations(8);\n        setPopularStations(stations);\n        \n        const countries = await radioStationService.getAvailableCountries();\n        setAvailableCountries(countries);\n        \n        const cities = await radioStationService.getAvailableCities();\n        setAvailableCities(cities);\n\n        // Fetch from Radio Browser API for enhanced discovery\n        try {\n          const [trending, discover, tags] = await Promise.all([\n            radioBrowserApi.getTrendingStations(10),\n            radioBrowserApi.discoverRandomStations(8),\n            radioBrowserApi.getTags(20),\n          ]);\n          \n          setTrendingStations(trending);\n          setDiscoverStations(discover);\n          setSuggestedTags(tags.map(t => t.name).slice(0, 12));\n        } catch (apiError) {\n          console.warn(\"Radio Browser API unavailable, using local data:\", apiError);\n        }\n        \n        console.log(`Loaded ${countries.length} countries and ${cities.length} cities`);\n      } catch (error) {\n        console.error(\"Failed to load station data:\", error);\n      }\n    };\n    fetchData();\n  }, []);\n\n  // Enhanced smart search with proper filtering logic and faster debounce\n  useEffect(() => {\n    let timer: NodeJS.Timeout;\n\n    // For country/city search, allow shorter search terms\n    const minLength = (searchFilter === \"country\" || searchFilter === \"city\") ? 2 : \n                      (searchFilter === \"discover\" || searchFilter === \"trending\") ? 0 : 3;\n    \n    if (searchTerm.length >= minLength || searchFilter === \"discover\" || searchFilter === \"trending\") {\n      setIsLoading(true);\n\n      // Faster debounce for better UX (150ms)\n      timer = setTimeout(async () => {\n        let results: RadioStation[] = [];\n\n        try {\n          console.log(` Smart search: filter=${searchFilter}, term=\"${searchTerm}\"`);\n          const startTime = performance.now();\n          \n          switch (searchFilter) {\n            case \"all\":\n              // Search across all fields using both local and API\n              results = await radioStationService.searchStations(searchTerm);\n              // Augment with Radio Browser API results if local results are few\n              if (results.length < 20) {\n                try {\n                  const apiResults = await radioBrowserApi.searchByName(searchTerm, 30);\n                  // Merge and dedupe\n                  const existingIds = new Set(results.map(s => s.id));\n                  const newResults = apiResults.filter(s => !existingIds.has(s.id));\n                  results = [...results, ...newResults].slice(0, 100);\n                } catch {}\n              }\n              break;\n              \n            case \"discover\":\n              // Random discovery with optional tag filter\n              if (searchTerm) {\n                results = await radioBrowserApi.getStationsByTag(searchTerm, 50);\n              } else {\n                results = await radioBrowserApi.discoverRandomStations(30);\n              }\n              break;\n              \n            case \"trending\":\n              // Get trending/top voted stations\n              results = await radioBrowserApi.getTrendingStations(50);\n              if (searchTerm) {\n                const term = searchTerm.toLowerCase();\n                results = results.filter(s => \n                  s.name.toLowerCase().includes(term) ||\n                  s.genre?.toLowerCase().includes(term)\n                );\n              }\n              break;\n              \n            case \"genre\":\n              // Search specifically by genre/music type\n              results = await radioStationService.getStationsByGenre(searchTerm);\n              // Augment with Radio Browser API tag search\n              try {\n                const apiResults = await radioBrowserApi.getStationsByTag(searchTerm, 30);\n                const existingIds = new Set(results.map(s => s.id));\n                const newResults = apiResults.filter(s => !existingIds.has(s.id));\n                results = [...results, ...newResults].slice(0, 100);\n              } catch {}\n              break;\n              \n            case \"country\":\n              // Filter stations by country location\n              results = await radioStationService.getStationsByCountry(searchTerm);\n              break;\n              \n            case \"city\":\n              // Filter stations by city location\n              results = await radioStationService.getStationsByCity(searchTerm);\n              break;\n              \n            default:\n              results = await radioStationService.searchStations(searchTerm);\n          }\n\n          const searchTime = (performance.now() - startTime).toFixed(0);\n          console.log(` Found ${results.length} results in ${searchTime}ms`);\n          \n          // Results are already sorted by relevance in the service\n          const defaultLimit = getDefaultLimit(searchFilter);\n          const limit = Math.min(defaultLimit, results.length);\n          setFullResults(results);\n          setTotalResults(results.length);\n          setResultLimit(limit);\n          setSearchResults(results.slice(0, limit));\n        } catch (error) {\n          console.error(\"Search error:\", error);\n          setFullResults([]);\n          setTotalResults(0);\n          setSearchResults([]);\n        } finally {\n          setIsLoading(false);\n        }\n      }, 150);\n    } else {\n      setSearchResults([]);\n      setFullResults([]);\n      setTotalResults(0);\n      setResultLimit(getDefaultLimit(searchFilter));\n      setIsLoading(false);\n    }\n\n    return () => {\n      if (timer) clearTimeout(timer);\n    };\n  }, [searchTerm, searchFilter]);\n\n  const handleStationSelect = (station: RadioStation) => {\n    selectStation(station);\n    // Report click to Radio Browser API for statistics\n    if (station.source === \"radio-browser\") {\n      radioBrowserApi.reportStationClick(station.id).catch(() => {});\n    }\n    setIsOpen(false);\n    setSearchTerm(\"\");\n    setSearchResults([]);\n    setFullResults([]);\n    setTotalResults(0);\n    setResultLimit(getDefaultLimit(searchFilter));\n  };\n\n  const handleLoadMoreResults = () => {\n    if (fullResults.length === 0) return;\n    const nextLimit = Math.min(resultLimit + 20, fullResults.length);\n    if (nextLimit > resultLimit) {\n      setResultLimit(nextLimit);\n      setSearchResults(fullResults.slice(0, nextLimit));\n    }\n  };\n\n  const handleRefreshDiscover = async () => {\n    setIsLoading(true);\n    try {\n      const discover = await radioBrowserApi.discoverRandomStations(20);\n      setDiscoverStations(discover);\n      setSearchResults(discover);\n      setFullResults(discover);\n      setTotalResults(discover.length);\n    } catch (error) {\n      console.error(\"Failed to refresh discover:\", error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const getFilterColor = (filterId: string) => {\n    const colors: Record<string, string> = {\n      cyan: \"from-cyan-400 to-blue-500\",\n      purple: \"from-purple-400 to-pink-500\",\n      pink: \"from-pink-400 to-rose-500\",\n      green: \"from-green-400 to-emerald-500\",\n      blue: \"from-blue-400 to-indigo-500\",\n      orange: \"from-orange-400 to-red-500\",\n    };\n    const filter = FILTER_TABS.find(f => f.id === filterId);\n    return colors[filter?.color || \"cyan\"];\n  };\n\n  return (\n    <div className={`relative z-50 ${className}`}>\n      {/* Click outside to close - placed first so it's below other elements */}\n      {isOpen && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          className=\"fixed inset-0 z-40 bg-black/20\"\n          onClick={() => {\n            setIsOpen(false);\n            setSearchTerm(\"\");\n            setSearchResults([]);\n            setFullResults([]);\n            setTotalResults(0);\n            setResultLimit(getDefaultLimit(searchFilter));\n          }}\n        />\n      )}\n\n      {/* Futuristic Search Input */}\n      <motion.div \n        className=\"relative group z-50\"\n        whileHover={{ scale: 1.02 }}\n        transition={{ type: \"spring\", stiffness: 400 }}\n      >\n        {/* Glow effect behind input */}\n        <div className=\"absolute -inset-0.5 bg-gradient-to-r from-cyan-500/30 via-purple-500/20 to-pink-500/30 rounded-xl blur opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none\" />\n        \n        <div className=\"relative flex items-center\">\n          <div className=\"absolute left-4 top-1/2 -translate-y-1/2 z-10\">\n            <motion.div\n              animate={isLoading ? { rotate: 360 } : { rotate: 0 }}\n              transition={{ duration: 1, repeat: isLoading ? Infinity : 0, ease: \"linear\" }}\n            >\n              <Search className=\"w-5 h-5 text-cyan-400\" />\n            </motion.div>\n          </div>\n          \n          <input\n            ref={inputRef}\n            type=\"text\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            onFocus={() => setIsOpen(true)}\n            placeholder={\n              searchFilter === \"discover\" ? \"Explore tags (jazz, rock, electronic...)\" :\n              searchFilter === \"trending\" ? \"Filter trending stations...\" :\n              searchFilter === \"country\" ? \"Search countries...\" :\n              searchFilter === \"genre\" ? \"Search genres...\" :\n              searchFilter === \"city\" ? \"Search cities...\" :\n              \"Search the radio universe...\"\n            }\n            className=\"w-72 pl-12 pr-4 py-3 rounded-xl text-white placeholder-gray-500 \n                       bg-gray-900\n                       border border-cyan-500/30 \n                       focus:border-cyan-400 focus:ring-2 focus:ring-cyan-500/30\n                       focus:shadow-[0_0_20px_rgba(0,245,255,0.15)]\n                       transition-all duration-300 outline-none\"\n          />\n          \n          {/* Loading indicator */}\n          {isLoading && (\n            <div className=\"absolute right-4 top-1/2 -translate-y-1/2\">\n              <div className=\"w-5 h-5 border-2 border-cyan-400 border-t-transparent rounded-full animate-spin\" />\n            </div>\n          )}\n          \n          {/* Clear button */}\n          {searchTerm && !isLoading && (\n            <button\n              onClick={() => {\n                setSearchTerm(\"\");\n                inputRef.current?.focus();\n              }}\n              className=\"absolute right-4 top-1/2 -translate-y-1/2 p-1 rounded-full hover:bg-white/10 transition-colors\"\n            >\n              <X className=\"w-4 h-4 text-gray-400\" />\n            </button>\n          )}\n        </div>\n      </motion.div>\n\n      {/* Search Results Dropdown */}\n      <AnimatePresence>\n        {isOpen && (\n          <motion.div\n            initial={{ opacity: 0, y: -10, scale: 0.95 }}\n            animate={{ opacity: 1, y: 0, scale: 1 }}\n            exit={{ opacity: 0, y: -10, scale: 0.95 }}\n            transition={{ type: \"spring\", damping: 25, stiffness: 300 }}\n            className=\"absolute top-full left-0 mt-2 w-96 rounded-2xl overflow-hidden z-50 \n                       bg-gray-900/98\n                       border border-cyan-500/20 \n                       shadow-[0_20px_60px_rgba(0,0,0,0.6),0_0_30px_rgba(0,245,255,0.08)]\n                       max-h-[70vh] overflow-y-auto\"\n          >\n            {/* Futuristic Filter Tabs */}\n            <div className=\"p-3 border-b border-white/10 sticky top-0 bg-gray-900 z-10\">\n              <div className=\"flex gap-1.5 flex-wrap\">\n                {FILTER_TABS.map((filter) => {\n                  const Icon = filter.icon;\n                  const isActive = searchFilter === filter.id;\n                  \n                  return (\n                    <motion.button\n                      key={filter.id}\n                      onClick={() => {\n                        setSearchFilter(filter.id);\n                        setSearchTerm(\"\");\n                        setSearchResults([]);\n                        setFullResults([]);\n                        setTotalResults(0);\n                        setResultLimit(getDefaultLimit(filter.id));\n                      }}\n                      className={`relative px-3 py-1.5 text-xs rounded-full transition-all duration-300 flex items-center gap-1.5 ${\n                        isActive\n                          ? \"text-white\"\n                          : \"text-gray-400 hover:text-white bg-white/5 hover:bg-white/10\"\n                      }`}\n                      whileHover={{ scale: 1.05 }}\n                      whileTap={{ scale: 0.95 }}\n                    >\n                      {isActive && (\n                        <motion.div\n                          layoutId=\"activeFilter\"\n                          className={`absolute inset-0 rounded-full bg-gradient-to-r ${getFilterColor(filter.id)}`}\n                          style={{ boxShadow: \"0 0 20px rgba(0,245,255,0.3)\" }}\n                        />\n                      )}\n                      <span className=\"relative z-10 flex items-center gap-1.5\">\n                        <Icon className=\"w-3.5 h-3.5\" />\n                        {filter.label}\n                      </span>\n                    </motion.button>\n                  );\n                })}\n              </div>\n            </div>\n\n            {/* Search Results */}\n            {searchResults.length > 0 && (\n              <div className=\"p-3\">\n                <div className=\"flex items-center justify-between mb-3 px-2\">\n                  <div className=\"flex items-center gap-2 text-xs text-gray-400\">\n                    {searchFilter === \"all\" && <Search className=\"w-3.5 h-3.5 text-cyan-400\" />}\n                    {searchFilter === \"discover\" && <Sparkles className=\"w-3.5 h-3.5 text-purple-400\" />}\n                    {searchFilter === \"trending\" && <TrendingUp className=\"w-3.5 h-3.5 text-pink-400\" />}\n                    {searchFilter === \"country\" && <Globe className=\"w-3.5 h-3.5 text-blue-400\" />}\n                    {searchFilter === \"city\" && <MapPin className=\"w-3.5 h-3.5 text-orange-400\" />}\n                    {searchFilter === \"genre\" && <Music className=\"w-3.5 h-3.5 text-green-400\" />}\n                    <span className=\"font-mono\">\n                      {searchResults.length}\n                      {totalResults > searchResults.length ? ` / ${totalResults}` : \"\"} \n                      <span className=\"text-gray-500 ml-1\">stations</span>\n                    </span>\n                  </div>\n                  \n                  {searchFilter === \"discover\" && (\n                    <motion.button\n                      onClick={handleRefreshDiscover}\n                      className=\"text-xs text-purple-400 hover:text-purple-300 flex items-center gap-1\"\n                      whileHover={{ scale: 1.05 }}\n                      whileTap={{ scale: 0.95 }}\n                    >\n                      <Zap className=\"w-3.5 h-3.5\" />\n                      Refresh\n                    </motion.button>\n                  )}\n                </div>\n                \n                {/* Station Results List */}\n                <div className=\"space-y-2\">\n                  {searchResults.map((station, index) => (\n                    <motion.button\n                      key={station.id}\n                      onClick={() => handleStationSelect(station)}\n                      className=\"w-full p-3 text-left rounded-xl transition-all duration-200 group\n                                 bg-white/[0.02] hover:bg-gradient-to-r hover:from-cyan-500/10 hover:to-purple-500/10\n                                 border border-transparent hover:border-cyan-500/20\n                                 hover:shadow-[0_0_20px_rgba(0,245,255,0.1)]\"\n                      initial={{ opacity: 0, x: -20 }}\n                      animate={{ opacity: 1, x: 0 }}\n                      transition={{ delay: index * 0.03 }}\n                      whileHover={{ x: 4 }}\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        {/* Station Icon with gradient */}\n                        <div className=\"relative\">\n                          <div className={`w-11 h-11 rounded-xl flex items-center justify-center flex-shrink-0\n                                          bg-gradient-to-br ${getFilterColor(searchFilter)} opacity-80\n                                          group-hover:opacity-100 transition-opacity`}>\n                            <Radio className=\"w-5 h-5 text-white\" />\n                          </div>\n                          {/* Online indicator */}\n                          {station.isOnline !== false && (\n                            <div className=\"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 rounded-full border-2 border-gray-900\" />\n                          )}\n                        </div>\n                        \n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"font-medium text-white text-sm truncate group-hover:text-cyan-300 transition-colors\">\n                            {station.name}\n                          </div>\n                          <div className=\"text-xs text-gray-500 flex items-center gap-2 mt-0.5\">\n                            <span className=\"flex items-center gap-1\">\n                              <MapPin className=\"w-3 h-3\" />\n                              {station.location.city ? `${station.location.city}, ` : \"\"}{station.location.country}\n                            </span>\n                            {station.genre && (\n                              <span className=\"px-1.5 py-0.5 rounded-full text-[10px] bg-cyan-500/20 text-cyan-300\">\n                                {station.genre.split(\",\")[0]?.trim()}\n                              </span>\n                            )}\n                          </div>\n                        </div>\n                        \n                        {/* Stats */}\n                        <div className=\"flex flex-col items-end gap-1\">\n                          <div className=\"text-xs font-mono text-gray-400 group-hover:text-cyan-400 transition-colors\">\n                            {station.listeners >= 1000 \n                              ? `${(station.listeners / 1000).toFixed(0)}k` \n                              : station.listeners || \"\"}\n                          </div>\n                          {station.bitrate && (\n                            <div className={`text-[10px] px-1.5 py-0.5 rounded-full ${\n                              station.bitrate >= 256 \n                                ? \"bg-green-500/20 text-green-400\" \n                                : station.bitrate >= 128 \n                                  ? \"bg-blue-500/20 text-blue-400\"\n                                  : \"bg-yellow-500/20 text-yellow-400\"\n                            }`}>\n                              {station.bitrate}kbps\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    </motion.button>\n                  ))}\n                </div>\n                \n                {/* Load More Button */}\n                {totalResults > searchResults.length && (\n                  <motion.button\n                    onClick={handleLoadMoreResults}\n                    className=\"w-full mt-3 py-3 text-sm text-cyan-400 \n                               bg-gradient-to-r from-cyan-500/10 to-purple-500/10 \n                               hover:from-cyan-500/20 hover:to-purple-500/20\n                               border border-cyan-500/20 hover:border-cyan-500/40\n                               rounded-xl transition-all duration-200\n                               flex items-center justify-center gap-2\"\n                    whileHover={{ scale: 1.02 }}\n                    whileTap={{ scale: 0.98 }}\n                  >\n                    <Zap className=\"w-4 h-4\" />\n                    Load more ({totalResults - searchResults.length} remaining)\n                  </motion.button>\n                )}\n              </div>\n            )}\n\n            {/* Discover Mode - Tag Suggestions */}\n            {searchFilter === \"discover\" && searchTerm.length === 0 && suggestedTags.length > 0 && searchResults.length === 0 && (\n              <div className=\"p-4\">\n                <div className=\"flex items-center gap-2 text-xs text-purple-400 mb-3\">\n                  <Sparkles className=\"w-3.5 h-3.5\" />\n                  <span className=\"font-medium\">Explore by Genre</span>\n                </div>\n                <div className=\"flex flex-wrap gap-2\">\n                  {suggestedTags.map((tag) => (\n                    <motion.button\n                      key={tag}\n                      onClick={() => setSearchTerm(tag)}\n                      className=\"px-3 py-1.5 text-xs rounded-full \n                                 bg-gradient-to-r from-purple-500/10 to-pink-500/10\n                                 border border-purple-500/20 hover:border-purple-500/40\n                                 text-purple-300 hover:text-white\n                                 transition-all duration-200\"\n                      whileHover={{ scale: 1.05 }}\n                      whileTap={{ scale: 0.95 }}\n                    >\n                      {tag}\n                    </motion.button>\n                  ))}\n                </div>\n                \n                {discoverStations.length > 0 && (\n                  <div className=\"mt-4 pt-4 border-t border-white/5\">\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <span className=\"text-xs text-gray-400 flex items-center gap-2\">\n                        <Compass className=\"w-3.5 h-3.5 text-purple-400\" />\n                        Random Discoveries\n                      </span>\n                      <motion.button\n                        onClick={handleRefreshDiscover}\n                        className=\"text-xs text-purple-400 hover:text-purple-300\"\n                        whileHover={{ rotate: 180 }}\n                        transition={{ duration: 0.3 }}\n                      >\n                        <Zap className=\"w-3.5 h-3.5\" />\n                      </motion.button>\n                    </div>\n                    <div className=\"space-y-2\">\n                      {discoverStations.slice(0, 5).map((station) => (\n                        <motion.button\n                          key={station.id}\n                          onClick={() => handleStationSelect(station)}\n                          className=\"w-full p-2 text-left rounded-lg bg-white/[0.02] hover:bg-purple-500/10 transition-colors\"\n                          whileHover={{ x: 4 }}\n                        >\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-8 h-8 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center\">\n                              <Radio className=\"w-4 h-4 text-white\" />\n                            </div>\n                            <div className=\"flex-1 min-w-0\">\n                              <div className=\"text-sm text-white truncate\">{station.name}</div>\n                              <div className=\"text-[10px] text-gray-500\">{station.location.country}</div>\n                            </div>\n                          </div>\n                        </motion.button>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* Trending Mode - Show Trending Stations */}\n            {searchFilter === \"trending\" && searchTerm.length === 0 && trendingStations.length > 0 && searchResults.length === 0 && (\n              <div className=\"p-4\">\n                <div className=\"flex items-center gap-2 text-xs text-pink-400 mb-3\">\n                  <TrendingUp className=\"w-3.5 h-3.5\" />\n                  <span className=\"font-medium\">Most Voted Stations</span>\n                </div>\n                <div className=\"space-y-2\">\n                  {trendingStations.map((station, index) => (\n                    <motion.button\n                      key={station.id}\n                      onClick={() => handleStationSelect(station)}\n                      className=\"w-full p-3 text-left rounded-xl bg-white/[0.02] hover:bg-pink-500/10 \n                                 border border-transparent hover:border-pink-500/20 transition-all\"\n                      initial={{ opacity: 0, y: 10 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      transition={{ delay: index * 0.05 }}\n                      whileHover={{ x: 4 }}\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-6 h-6 rounded-full bg-gradient-to-r from-pink-500 to-rose-500 \n                                        flex items-center justify-center text-xs font-bold text-white\">\n                          {index + 1}\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"text-sm text-white truncate\">{station.name}</div>\n                          <div className=\"text-[10px] text-gray-500 flex items-center gap-2\">\n                            <span>{station.location.country}</span>\n                            {station.votes && (\n                              <span className=\"text-pink-400\"> {station.votes}</span>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    </motion.button>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* Country suggestions (when country filter is selected and no search term) */}\n            {searchFilter === \"country\" && searchTerm.length === 0 && availableCountries.length > 0 && searchResults.length === 0 && (\n              <div className=\"p-4\">\n                <div className=\"flex items-center gap-2 text-xs text-blue-400 mb-3\">\n                  <Globe className=\"w-3.5 h-3.5\" />\n                  <span className=\"font-medium\">Select a Country</span>\n                </div>\n                <div className=\"grid grid-cols-2 gap-2 max-h-60 overflow-y-auto\">\n                  {availableCountries.slice(0, 24).map((country) => (\n                    <motion.button\n                      key={country}\n                      onClick={() => setSearchTerm(country)}\n                      className=\"p-2.5 text-left text-sm text-gray-300 rounded-lg\n                                 bg-white/[0.02] hover:bg-blue-500/10\n                                 border border-transparent hover:border-blue-500/20\n                                 transition-all truncate\"\n                      whileHover={{ scale: 1.02 }}\n                    >\n                      {country}\n                    </motion.button>\n                  ))}\n                </div>\n                {availableCountries.length > 24 && (\n                  <div className=\"text-xs text-gray-500 mt-2 px-1\">\n                    +{availableCountries.length - 24} more countries... Start typing to search\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* Popular Stations (default view) */}\n            {searchTerm.length === 0 && searchFilter === \"all\" && popularStations.length > 0 && searchResults.length === 0 && (\n              <div className=\"p-4\">\n                <div className=\"flex items-center gap-2 text-xs text-cyan-400 mb-3\">\n                  <Wifi className=\"w-3.5 h-3.5\" />\n                  <span className=\"font-medium\">Popular Stations</span>\n                </div>\n                <div className=\"space-y-2\">\n                  {popularStations.map((station, index) => (\n                    <motion.button\n                      key={station.id}\n                      onClick={() => handleStationSelect(station)}\n                      className=\"w-full p-3 text-left rounded-xl \n                                 bg-white/[0.02] hover:bg-gradient-to-r hover:from-cyan-500/10 hover:to-blue-500/10\n                                 border border-transparent hover:border-cyan-500/20\n                                 transition-all\"\n                      initial={{ opacity: 0, x: -20 }}\n                      animate={{ opacity: 1, x: 0 }}\n                      transition={{ delay: index * 0.05 }}\n                      whileHover={{ x: 4 }}\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-600 \n                                        flex items-center justify-center\">\n                          <span className=\"text-white text-sm font-bold\">\n                            {station.name.charAt(0)}\n                          </span>\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"text-sm text-white truncate\">{station.name}</div>\n                          <div className=\"text-[10px] text-gray-500\">\n                            {station.location.city}, {station.location.country}\n                          </div>\n                        </div>\n                        <div className=\"text-xs font-mono text-cyan-400\">\n                          {station.listeners >= 1000 \n                            ? `${(station.listeners / 1000).toFixed(0)}k` \n                            : station.listeners}\n                        </div>\n                      </div>\n                    </motion.button>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* No Results */}\n            {((searchFilter === \"all\" && searchTerm.length > 2) || \n              (searchFilter !== \"all\" && searchFilter !== \"discover\" && searchFilter !== \"trending\" && searchTerm.length > 1)) &&\n              searchResults.length === 0 &&\n              !isLoading && (\n                <motion.div \n                  className=\"p-8 text-center\"\n                  initial={{ opacity: 0, scale: 0.9 }}\n                  animate={{ opacity: 1, scale: 1 }}\n                >\n                  <div className=\"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-800/50 flex items-center justify-center\">\n                    <Globe className=\"w-8 h-8 text-gray-600\" />\n                  </div>\n                  <div className=\"text-sm text-gray-400 mb-1\">No stations found</div>\n                  <div className=\"text-xs text-gray-600\">\n                    Try a different search term or explore other filters\n                  </div>\n                  <motion.button\n                    onClick={() => {\n                      setSearchFilter(\"discover\");\n                      setSearchTerm(\"\");\n                    }}\n                    className=\"mt-4 px-4 py-2 text-xs rounded-full \n                               bg-gradient-to-r from-purple-500/20 to-pink-500/20\n                               border border-purple-500/30 text-purple-300\n                               hover:border-purple-500/50 transition-all\"\n                    whileHover={{ scale: 1.05 }}\n                  >\n                    <Sparkles className=\"w-3.5 h-3.5 inline mr-1.5\" />\n                    Discover Random Stations\n                  </motion.button>\n                </motion.div>\n              )}\n\n            {/* Footer with powered by */}\n            <div className=\"p-3 border-t border-white/5 flex items-center justify-between\">\n              <div className=\"text-[10px] text-gray-600 flex items-center gap-1\">\n                <Zap className=\"w-3 h-3\" />\n                Powered by Radio Browser API\n              </div>\n              <button\n                onClick={() => {\n                  setIsOpen(false);\n                  setSearchTerm(\"\");\n                  setSearchResults([]);\n                  setFullResults([]);\n                  setTotalResults(0);\n                  setResultLimit(getDefaultLimit(searchFilter));\n                }}\n                className=\"text-xs text-gray-500 hover:text-cyan-400 transition-colors\"\n              >\n                Close\n              </button>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n"],"names":["FILTER_TABS","id","label","icon","color","SearchPanel","className","isOpen","setIsOpen","searchTerm","setSearchTerm","searchResults","setSearchResults","fullResults","setFullResults","resultLimit","setResultLimit","totalResults","setTotalResults","popularStations","setPopularStations","trendingStations","setTrendingStations","discoverStations","setDiscoverStations","isLoading","setIsLoading","searchFilter","setSearchFilter","availableCountries","setAvailableCountries","availableCities","setAvailableCities","suggestedTags","setSuggestedTags","inputRef","selectStation","getDefaultLimit","filter","fetchData","stations","getPopularStations","countries","getAvailableCountries","cities","getAvailableCities","trending","discover","tags","Promise","all","getTrendingStations","discoverRandomStations","getTags","map","t","name","slice","apiError","console","warn","log","length","error","timer","minLength","setTimeout","results","startTime","performance","now","searchStations","apiResults","searchByName","existingIds","Set","s","newResults","has","getStationsByTag","term","toLowerCase","includes","genre","getStationsByGenre","getStationsByCountry","getStationsByCity","searchTime","toFixed","defaultLimit","limit","Math","min","clearTimeout","handleStationSelect","station","source","reportStationClick","catch","handleLoadMoreResults","nextLimit","handleRefreshDiscover","getFilterColor","filterId","colors","cyan","purple","pink","green","blue","orange","find","f","div","initial","opacity","animate","exit","onClick","whileHover","scale","transition","type","stiffness","rotate","duration","repeat","Infinity","ease","ref","value","onChange","e","target","onFocus","placeholder","current","focus","y","damping","Icon","isActive","button","whileTap","layoutId","style","boxShadow","index","x","delay","isOnline","location","city","country","split","trim","listeners","bitrate","tag","votes","charAt"],"mappings":"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"}},
    {"offset": {"line": 6079, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/components/StationDirectory.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useMemo, useEffect } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport {\n  Globe,\n  Radio,\n  MapPin,\n  Play,\n  Volume2,\n  Heart,\n  Clock,\n  Compass,\n  TrendingUp,\n  History,\n  Sparkles,\n  Filter,\n  ChevronDown,\n} from \"lucide-react\";\nimport { RadioStation } from \"../types\";\nimport { useGlobeStore } from \"../stores/globe-store\";\nimport { useFavorites, useRecentStations } from \"../hooks/useUserData\";\nimport {\n  useUserLocation,\n  calculateDistance,\n  getTimeOfDay,\n  getTimeBasedGenres,\n} from \"../hooks/useUserLocation\";\nimport { radioDiscoveryService } from \"../services/radioDiscoveryService\";\n\ninterface StationDirectoryProps {\n  className?: string;\n}\n\ntype TabType = \"discover\" | \"nearby\" | \"favorites\" | \"recent\";\n\nexport function StationDirectory({ className = \"\" }: StationDirectoryProps) {\n  const [activeTab, setActiveTab] = useState<TabType>(\"discover\");\n  const [selectedGenre, setSelectedGenre] = useState<string>(\"all\");\n  const [stations, setStations] = useState<RadioStation[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [showFilters, setShowFilters] = useState(false);\n\n  const { selectedStation, selectStation } = useGlobeStore();\n  const { favorites, isFavorite, toggleFavorite } = useFavorites();\n  const { recent, addToRecent } = useRecentStations();\n  const { location, isLoading: locationLoading } = useUserLocation();\n\n  // Load stations\n  useEffect(() => {\n    const loadStations = async () => {\n      setIsLoading(true);\n      try {\n        const data = await radioDiscoveryService.getTopStations(100);\n        setStations(data);\n      } catch (error) {\n        console.error(\"Failed to load stations:\", error);\n      }\n      setIsLoading(false);\n    };\n    loadStations();\n  }, []);\n\n  // Get unique genres\n  const genres = useMemo(() => {\n    const allGenres = stations.flatMap(\n      (s) => s.genre?.split(\",\").map((g) => g.trim().toLowerCase()) || [],\n    );\n    return [\"all\", ...Array.from(new Set(allGenres)).slice(0, 10)];\n  }, [stations]);\n\n  // Time-based recommendations\n  const timeOfDay = getTimeOfDay();\n  const recommendedGenres = getTimeBasedGenres();\n\n  // Sort stations by distance if location available\n  const stationsWithDistance = useMemo(() => {\n    if (!location) return stations.map((s) => ({ station: s, distance: null }));\n\n    return stations\n      .map((station) => {\n        const distance =\n          station.location.lat && station.location.lng\n            ? calculateDistance(\n                location.latitude,\n                location.longitude,\n                station.location.lat,\n                station.location.lng,\n              )\n            : null;\n        return { station, distance };\n      })\n      .sort((a, b) => {\n        if (a.distance === null) return 1;\n        if (b.distance === null) return -1;\n        return a.distance - b.distance;\n      });\n  }, [stations, location]);\n\n  // Filter stations by genre\n  const filteredStations = useMemo(() => {\n    if (selectedGenre === \"all\") return stationsWithDistance;\n    return stationsWithDistance.filter(({ station }) =>\n      station.genre?.toLowerCase().includes(selectedGenre),\n    );\n  }, [stationsWithDistance, selectedGenre]);\n\n  // Get display data based on active tab\n  const displayData = useMemo(() => {\n    switch (activeTab) {\n      case \"nearby\":\n        return filteredStations.slice(0, 20);\n      case \"favorites\":\n        return favorites.map((s) => ({ station: s, distance: null }));\n      case \"recent\":\n        return recent.map((s) => ({ station: s, distance: null }));\n      case \"discover\":\n      default:\n        // Time-based smart discovery\n        const timeFiltered = stationsWithDistance.filter(({ station }) =>\n          recommendedGenres.some((genre) =>\n            station.genre?.toLowerCase().includes(genre),\n          ),\n        );\n        // Mix time-relevant with popular\n        return [\n          ...timeFiltered.slice(0, 5),\n          ...stationsWithDistance\n            .filter((s) => !timeFiltered.includes(s))\n            .sort((a, b) => b.station.listeners - a.station.listeners)\n            .slice(0, 15),\n        ];\n    }\n  }, [\n    activeTab,\n    filteredStations,\n    favorites,\n    recent,\n    stationsWithDistance,\n    recommendedGenres,\n  ]);\n\n  const handleStationSelect = (station: RadioStation) => {\n    selectStation(station);\n    addToRecent(station);\n  };\n\n  const formatDistance = (km: number | null) => {\n    if (km === null) return null;\n    if (km < 1) return `${Math.round(km * 1000)}m`;\n    if (km < 100) return `${km.toFixed(0)}km`;\n    return `${Math.round(km).toLocaleString()}km`;\n  };\n\n  const tabs = [\n    { id: \"discover\" as TabType, label: \"Discover\", icon: Sparkles },\n    { id: \"nearby\" as TabType, label: \"Near Me\", icon: Compass },\n    {\n      id: \"favorites\" as TabType,\n      label: \"Favorites\",\n      icon: Heart,\n      count: favorites.length,\n    },\n    {\n      id: \"recent\" as TabType,\n      label: \"Recent\",\n      icon: History,\n      count: recent.length,\n    },\n  ];\n\n  return (\n    <motion.div\n      className={`glass rounded-xl overflow-hidden flex flex-col h-full ${className}`}\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      {/* Header */}\n      <div className=\"p-6 border-b border-white/10 flex-shrink-0\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"relative\">\n              <Globe className=\"w-6 h-6 text-gradient\" />\n              <div className=\"absolute inset-0 animate-pulse-glow rounded-full bg-blue-400/20\" />\n            </div>\n            <div>\n              <h2 className=\"text-xl font-bold text-white tracking-tight\">\n                Stations\n              </h2>\n              <p className=\"text-sm text-gray-400 font-mono\">\n                {displayData.length} available\n              </p>\n            </div>\n          </div>\n\n          {/* Time-based greeting */}\n          <div className=\"flex items-center gap-2 glass px-3 py-2 rounded-lg\">\n            <span className=\"text-sm text-gray-300 font-medium\">\n              {timeOfDay === \"morning\" && \" Good morning\"}\n              {timeOfDay === \"afternoon\" && \" Good afternoon\"}\n              {timeOfDay === \"evening\" && \" Good evening\"}\n              {timeOfDay === \"night\" && \" Night mode\"}\n            </span>\n          </div>\n        </div>\n\n        {/* Enhanced Tabs */}\n        <div className=\"flex gap-2 bg-surface-card/50 p-1.5 rounded-xl\">\n          {tabs.map((tab) => (\n            <motion.button\n              key={tab.id}\n              onClick={() => setActiveTab(tab.id)}\n              className={`flex-1 flex items-center justify-center gap-2 px-3 py-3 text-sm rounded-lg font-medium transition-all ${\n                activeTab === tab.id\n                  ? \"bg-gradient-to-r from-blue-500 to-cyan-400 text-white shadow-lg\"\n                  : \"text-gray-400 hover:text-white hover:bg-white/5\"\n              }`}\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n            >\n              <tab.icon className=\"w-4 h-4\" />\n              <span className=\"hidden sm:inline tracking-wide\">{tab.label}</span>\n              {tab.count !== undefined && tab.count > 0 && (\n                <span\n                  className={`px-2 py-1 text-xs rounded-full font-mono ${\n                    activeTab === tab.id \n                      ? \"bg-white/20 text-white\" \n                      : \"bg-white/10 text-gray-300\"\n                  }`}\n                >\n                  {tab.count}\n                </span>\n              )}\n            </motion.button>\n          ))}\n        </div>\n      </div>\n\n      {/* Filters - For discover and nearby tabs */}\n      {(activeTab === \"discover\" || activeTab === \"nearby\") && (\n        <div className=\"px-4 py-2 border-b border-white/5 flex-shrink-0\">\n          <button\n            onClick={() => setShowFilters(!showFilters)}\n            className=\"flex items-center gap-2 text-xs text-gray-400 hover:text-white transition-colors\"\n          >\n            <Filter className=\"w-3.5 h-3.5\" />\n            <span>Filter by genre</span>\n            <ChevronDown\n              className={`w-3.5 h-3.5 transition-transform ${showFilters ? \"rotate-180\" : \"\"}`}\n            />\n          </button>\n\n          <AnimatePresence>\n            {showFilters && (\n              <motion.div\n                initial={{ height: 0, opacity: 0 }}\n                animate={{ height: \"auto\", opacity: 1 }}\n                exit={{ height: 0, opacity: 0 }}\n                className=\"overflow-hidden\"\n              >\n                <div className=\"flex flex-wrap gap-1.5 pt-2\">\n                  {genres.map((genre) => (\n                    <button\n                      key={genre}\n                      onClick={() => setSelectedGenre(genre)}\n                      className={`px-2 py-1 text-xs rounded-full transition-colors ${\n                        selectedGenre === genre\n                          ? \"bg-blue-500 text-white\"\n                          : \"bg-white/10 text-gray-400 hover:text-white hover:bg-white/20\"\n                      }`}\n                    >\n                      {genre === \"all\" ? \"All\" : genre}\n                    </button>\n                  ))}\n                </div>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n      )}\n\n      {/* Content Heading */}\n      {activeTab === \"discover\" && (\n        <div className=\"px-4 py-2 flex-shrink-0\">\n          <div className=\"flex items-center gap-2 text-xs text-gray-400\">\n            <TrendingUp className=\"w-3.5 h-3.5 text-green-400\" />\n            <span>\n              Recommended for {timeOfDay}:{\" \"}\n              <span className=\"text-gray-300\">\n                {recommendedGenres.slice(0, 3).join(\", \")}\n              </span>\n            </span>\n          </div>\n        </div>\n      )}\n\n      {activeTab === \"nearby\" && location && (\n        <div className=\"px-4 py-2 flex-shrink-0\">\n          <div className=\"flex items-center gap-2 text-xs text-gray-400\">\n            <MapPin className=\"w-3.5 h-3.5 text-blue-400\" />\n            <span>\n              Stations near{\" \"}\n              <span className=\"text-gray-300\">\n                {location.city || \"your location\"}\n              </span>\n            </span>\n          </div>\n        </div>\n      )}\n\n      {/* Station List */}\n      <div className=\"flex-1 overflow-y-auto\">\n        {isLoading ? (\n          <div className=\"flex items-center justify-center h-32\">\n            <div className=\"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin\" />\n          </div>\n        ) : displayData.length === 0 ? (\n          <div className=\"p-8 text-center text-gray-400\">\n            <Radio className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n            <div className=\"text-sm\">\n              {activeTab === \"favorites\" && \"No favorites yet\"}\n              {activeTab === \"recent\" && \"No recently played\"}\n              {activeTab === \"nearby\" && \"No nearby stations found\"}\n              {activeTab === \"discover\" && \"No stations found\"}\n            </div>\n            <div className=\"text-xs mt-1\">\n              {activeTab === \"favorites\" &&\n                \"Tap the heart icon to save stations\"}\n              {activeTab === \"recent\" && \"Play some stations to see them here\"}\n            </div>\n          </div>\n        ) : (\n          <div className=\"divide-y divide-white/5\">\n            {displayData.map(({ station, distance }) => (\n              <StationListItem\n                key={station.id}\n                station={station}\n                distance={formatDistance(distance)}\n                isSelected={selectedStation?.id === station.id}\n                isFavorite={isFavorite(station.id)}\n                onSelect={() => handleStationSelect(station)}\n                onToggleFavorite={() => toggleFavorite(station)}\n              />\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Footer Stats */}\n      <div className=\"p-3 border-t border-white/10 bg-white/5 flex-shrink-0\">\n        <div className=\"flex justify-between text-xs text-gray-500\">\n          <span>{displayData.length} stations</span>\n          <span>{location?.city && ` ${location.city}`}</span>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\ninterface StationListItemProps {\n  station: RadioStation;\n  distance: string | null;\n  isSelected: boolean;\n  isFavorite: boolean;\n  onSelect: () => void;\n  onToggleFavorite: () => void;\n}\n\nfunction StationListItem({\n  station,\n  distance,\n  isSelected,\n  isFavorite,\n  onSelect,\n  onToggleFavorite,\n}: StationListItemProps) {\n  return (\n    <motion.div\n      className={`p-3 cursor-pointer transition-colors ${\n        isSelected ? \"bg-blue-500/20\" : \"hover:bg-white/5\"\n      }`}\n      onClick={onSelect}\n      whileTap={{ scale: 0.98 }}\n    >\n      <div className=\"flex items-center gap-3\">\n        {/* Station Icon */}\n        <div\n          className={`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${\n            isSelected\n              ? \"bg-blue-500\"\n              : \"bg-gradient-to-br from-purple-500/30 to-blue-500/30\"\n          }`}\n        >\n          {isSelected ? (\n            <div className=\"flex items-end gap-0.5 h-4\">\n              <div\n                className=\"w-1 bg-white rounded-full animate-pulse\"\n                style={{ height: \"40%\" }}\n              />\n              <div\n                className=\"w-1 bg-white rounded-full animate-pulse\"\n                style={{ height: \"100%\", animationDelay: \"0.1s\" }}\n              />\n              <div\n                className=\"w-1 bg-white rounded-full animate-pulse\"\n                style={{ height: \"60%\", animationDelay: \"0.2s\" }}\n              />\n            </div>\n          ) : (\n            <span className=\"text-white font-bold text-sm\">\n              {station.name.charAt(0).toUpperCase()}\n            </span>\n          )}\n        </div>\n\n        {/* Station Info */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2\">\n            <h3\n              className={`font-medium text-sm truncate ${\n                isSelected ? \"text-blue-300\" : \"text-white\"\n              }`}\n            >\n              {station.name}\n            </h3>\n          </div>\n\n          <div className=\"flex items-center gap-2 text-xs text-gray-500 mt-0.5\">\n            <span className=\"truncate\">{station.location.country}</span>\n            {station.genre && (\n              <>\n                <span className=\"text-gray-600\"></span>\n                <span className=\"truncate text-gray-400\">\n                  {station.genre.split(\",\")[0]}\n                </span>\n              </>\n            )}\n          </div>\n        </div>\n\n        {/* Distance & Stats */}\n        <div className=\"flex items-center gap-2 flex-shrink-0\">\n          {distance && (\n            <span className=\"text-xs text-blue-400 bg-blue-500/10 px-2 py-0.5 rounded-full\">\n              {distance}\n            </span>\n          )}\n\n          <div className=\"flex items-center gap-1 text-xs text-gray-500\">\n            <Volume2 className=\"w-3 h-3\" />\n            <span>\n              {station.listeners >= 1000\n                ? `${(station.listeners / 1000).toFixed(0)}k`\n                : station.listeners}\n            </span>\n          </div>\n\n          {/* Favorite Button */}\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              onToggleFavorite();\n            }}\n            className={`p-1.5 rounded-full transition-colors ${\n              isFavorite\n                ? \"text-pink-400 bg-pink-500/20\"\n                : \"text-gray-500 hover:text-pink-400 hover:bg-white/5\"\n            }`}\n          >\n            <Heart\n              className={`w-3.5 h-3.5 ${isFavorite ? \"fill-current\" : \"\"}`}\n            />\n          </button>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n"],"names":["StationDirectory","className","activeTab","setActiveTab","selectedGenre","setSelectedGenre","stations","setStations","isLoading","setIsLoading","showFilters","setShowFilters","selectedStation","selectStation","favorites","isFavorite","toggleFavorite","recent","addToRecent","location","locationLoading","loadStations","data","getTopStations","error","console","genres","allGenres","flatMap","s","genre","split","map","g","trim","toLowerCase","Array","from","Set","slice","timeOfDay","recommendedGenres","stationsWithDistance","station","distance","lat","lng","latitude","longitude","sort","a","b","filteredStations","filter","includes","displayData","timeFiltered","some","listeners","handleStationSelect","formatDistance","km","Math","round","toFixed","toLocaleString","tabs","id","label","icon","count","length","div","initial","opacity","y","animate","tab","button","onClick","whileHover","scale","whileTap","undefined","height","exit","join","city","StationListItem","isSelected","onSelect","onToggleFavorite","style","animationDelay","name","charAt","toUpperCase","country","e","stopPropagation"],"mappings":"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"}},
    {"offset": {"line": 6881, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/components/UserPanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { User, Settings, LogOut, Heart, History, Globe } from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\nexport function UserPanel() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [isLoggedIn, setIsLoggedIn] = useState(false); // Mock auth state\n\n  if (!isLoggedIn) {\n    return (\n      <div className=\"flex gap-2\">\n        <button className=\"button-secondary text-sm\">Sign In</button>\n        <button className=\"button-primary text-sm\">Sign Up</button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"relative\">\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"flex items-center gap-3 p-3 glass rounded-lg hover:bg-white/20 transition-colors\"\n      >\n        <div className=\"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center\">\n          <User className=\"w-4 h-4 text-white\" />\n        </div>\n        <div className=\"text-left\">\n          <div className=\"text-sm font-medium text-white\">John Doe</div>\n          <div className=\"text-xs text-gray-400\">Premium</div>\n        </div>\n      </button>\n\n      <AnimatePresence>\n        {isOpen && (\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: -10 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: -10 }}\n            className=\"absolute right-0 top-full mt-2 w-64 glass rounded-xl overflow-hidden z-50\"\n          >\n            <div className=\"p-4 border-b border-white/10\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center\">\n                  <User className=\"w-6 h-6 text-white\" />\n                </div>\n                <div>\n                  <div className=\"font-medium text-white\">John Doe</div>\n                  <div className=\"text-sm text-gray-400\">john@example.com</div>\n                  <div className=\"text-xs text-blue-400\">Premium Member</div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"p-2\">\n              <button className=\"w-full flex items-center gap-3 p-3 hover:bg-white/10 rounded-lg transition-colors\">\n                <Heart className=\"w-4 h-4 text-gray-400\" />\n                <span className=\"text-white\">Favorites</span>\n                <span className=\"ml-auto text-xs text-gray-400\">24</span>\n              </button>\n\n              <button className=\"w-full flex items-center gap-3 p-3 hover:bg-white/10 rounded-lg transition-colors\">\n                <History className=\"w-4 h-4 text-gray-400\" />\n                <span className=\"text-white\">Listening History</span>\n              </button>\n\n              <button className=\"w-full flex items-center gap-3 p-3 hover:bg-white/10 rounded-lg transition-colors\">\n                <Globe className=\"w-4 h-4 text-gray-400\" />\n                <span className=\"text-white\">Discover</span>\n              </button>\n\n              <div className=\"border-t border-white/10 my-2\"></div>\n\n              <button className=\"w-full flex items-center gap-3 p-3 hover:bg-white/10 rounded-lg transition-colors\">\n                <Settings className=\"w-4 h-4 text-gray-400\" />\n                <span className=\"text-white\">Settings</span>\n              </button>\n\n              <button className=\"w-full flex items-center gap-3 p-3 hover:bg-white/10 rounded-lg transition-colors text-red-400\">\n                <LogOut className=\"w-4 h-4\" />\n                <span>Sign Out</span>\n              </button>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Click outside to close */}\n      {isOpen && (\n        <div className=\"fixed inset-0 z-40\" onClick={() => setIsOpen(false)} />\n      )}\n    </div>\n  );\n}\n"],"names":["UserPanel","isOpen","setIsOpen","isLoggedIn","setIsLoggedIn","className","onClick","div","initial","opacity","scale","y","animate","exit"],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAJA;;;;;AAMO,SAASA;IACd,MAAM,CAACC,QAAQC,UAAU,GAAG,IAAA,gOAAQ,EAAC;IACrC,MAAM,CAACC,YAAYC,cAAc,GAAG,IAAA,gOAAQ,EAAC,QAAQ,kBAAkB;IAEvE,IAAI,CAACD,YAAY;QACf,qBACE,6PAAC;YAAIE,WAAU;;8BACb,6PAAC;oBAAOA,WAAU;8BAA2B;;;;;;8BAC7C,6PAAC;oBAAOA,WAAU;8BAAyB;;;;;;;;;;;;IAGjD;IAEA,qBACE,6PAAC;QAAIA,WAAU;;0BACb,6PAAC;gBACCC,SAAS,IAAMJ,UAAU,CAACD;gBAC1BI,WAAU;;kCAEV,6PAAC;wBAAIA,WAAU;kCACb,cAAA,6PAAC,0MAAI;4BAACA,WAAU;;;;;;;;;;;kCAElB,6PAAC;wBAAIA,WAAU;;0CACb,6PAAC;gCAAIA,WAAU;0CAAiC;;;;;;0CAChD,6PAAC;gCAAIA,WAAU;0CAAwB;;;;;;;;;;;;;;;;;;0BAI3C,6PAAC,4MAAe;0BACbJ,wBACC,6PAAC,oLAAM,CAACM,GAAG;oBACTC,SAAS;wBAAEC,SAAS;wBAAGC,OAAO;wBAAMC,GAAG,CAAC;oBAAG;oBAC3CC,SAAS;wBAAEH,SAAS;wBAAGC,OAAO;wBAAGC,GAAG;oBAAE;oBACtCE,MAAM;wBAAEJ,SAAS;wBAAGC,OAAO;wBAAMC,GAAG,CAAC;oBAAG;oBACxCN,WAAU;;sCAEV,6PAAC;4BAAIA,WAAU;sCACb,cAAA,6PAAC;gCAAIA,WAAU;;kDACb,6PAAC;wCAAIA,WAAU;kDACb,cAAA,6PAAC,0MAAI;4CAACA,WAAU;;;;;;;;;;;kDAElB,6PAAC;;0DACC,6PAAC;gDAAIA,WAAU;0DAAyB;;;;;;0DACxC,6PAAC;gDAAIA,WAAU;0DAAwB;;;;;;0DACvC,6PAAC;gDAAIA,WAAU;0DAAwB;;;;;;;;;;;;;;;;;;;;;;;sCAK7C,6PAAC;4BAAIA,WAAU;;8CACb,6PAAC;oCAAOA,WAAU;;sDAChB,6PAAC,6MAAK;4CAACA,WAAU;;;;;;sDACjB,6PAAC;4CAAKA,WAAU;sDAAa;;;;;;sDAC7B,6PAAC;4CAAKA,WAAU;sDAAgC;;;;;;;;;;;;8CAGlD,6PAAC;oCAAOA,WAAU;;sDAChB,6PAAC,mNAAO;4CAACA,WAAU;;;;;;sDACnB,6PAAC;4CAAKA,WAAU;sDAAa;;;;;;;;;;;;8CAG/B,6PAAC;oCAAOA,WAAU;;sDAChB,6PAAC,6MAAK;4CAACA,WAAU;;;;;;sDACjB,6PAAC;4CAAKA,WAAU;sDAAa;;;;;;;;;;;;8CAG/B,6PAAC;oCAAIA,WAAU;;;;;;8CAEf,6PAAC;oCAAOA,WAAU;;sDAChB,6PAAC,sNAAQ;4CAACA,WAAU;;;;;;sDACpB,6PAAC;4CAAKA,WAAU;sDAAa;;;;;;;;;;;;8CAG/B,6PAAC;oCAAOA,WAAU;;sDAChB,6PAAC,oNAAM;4CAACA,WAAU;;;;;;sDAClB,6PAAC;sDAAK;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAQfJ,wBACC,6PAAC;gBAAII,WAAU;gBAAqBC,SAAS,IAAMJ,UAAU;;;;;;;;;;;;AAIrE"}},
    {"offset": {"line": 7236, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/events/GlobeEventBus.ts"],"sourcesContent":["/**\n * Event types for the Globe Observer system\n */\nexport enum GlobeEventType {\n  STATION_SELECTED = 'station_selected',\n  STATION_HOVERED = 'station_hovered',\n  STATIONS_LOADED = 'stations_loaded',\n  ZOOM_CHANGED = 'zoom_changed',\n  LOCATION_CHANGED = 'location_changed',\n  AUDIO_STATE_CHANGED = 'audio_state_changed',\n  ERROR_OCCURRED = 'error_occurred'\n}\n\n/**\n * Base event interface\n */\nexport interface GlobeEvent {\n  type: GlobeEventType;\n  timestamp: number;\n  data?: any;\n}\n\n/**\n * Specific event interfaces\n */\nexport interface StationSelectedEvent extends GlobeEvent {\n  type: GlobeEventType.STATION_SELECTED;\n  data: {\n    stationId: string;\n    station: any;\n  };\n}\n\nexport interface StationsLoadedEvent extends GlobeEvent {\n  type: GlobeEventType.STATIONS_LOADED;\n  data: {\n    count: number;\n    region?: string;\n    zoomLevel: number;\n  };\n}\n\nexport interface ZoomChangedEvent extends GlobeEvent {\n  type: GlobeEventType.ZOOM_CHANGED;\n  data: {\n    oldZoom: number;\n    newZoom: number;\n    cameraDistance: number;\n  };\n}\n\nexport interface ErrorOccurredEvent extends GlobeEvent {\n  type: GlobeEventType.ERROR_OCCURRED;\n  data: {\n    message: string;\n    source: string;\n    error?: Error;\n  };\n}\n\n/**\n * Observer interface for subscribing to globe events\n */\nexport interface IGlobeObserver {\n  onEvent(event: GlobeEvent): void;\n  getObserverId(): string;\n}\n\n/**\n * Observable interface for publishing globe events\n */\nexport interface IGlobeObservable {\n  subscribe(observer: IGlobeObserver, eventTypes?: GlobeEventType[]): void;\n  unsubscribe(observerId: string): void;\n  notify(event: GlobeEvent): void;\n}\n\n/**\n * Implementation of Observable pattern for Globe events\n * Provides decoupled communication between components\n */\nexport class GlobeEventBus implements IGlobeObservable {\n  private observers = new Map<string, {\n    observer: IGlobeObserver;\n    eventTypes: Set<GlobeEventType>;\n  }>();\n  \n  private eventHistory: GlobeEvent[] = [];\n  private readonly maxHistorySize = 100;\n\n  /**\n   * Subscribe an observer to specific event types\n   */\n  subscribe(observer: IGlobeObserver, eventTypes?: GlobeEventType[]): void {\n    const observerId = observer.getObserverId();\n    const subscribedTypes = new Set(eventTypes || Object.values(GlobeEventType));\n    \n    this.observers.set(observerId, {\n      observer,\n      eventTypes: subscribedTypes\n    });\n\n    console.log(`Observer ${observerId} subscribed to events:`, Array.from(subscribedTypes));\n  }\n\n  /**\n   * Unsubscribe an observer\n   */\n  unsubscribe(observerId: string): void {\n    if (this.observers.delete(observerId)) {\n      console.log(`Observer ${observerId} unsubscribed`);\n    }\n  }\n\n  /**\n   * Notify all subscribed observers of an event\n   */\n  notify(event: GlobeEvent): void {\n    // Add to event history\n    this.addToHistory(event);\n\n    // Notify relevant observers\n    Array.from(this.observers.entries()).forEach(([observerId, { observer, eventTypes }]) => {\n      if (eventTypes.has(event.type)) {\n        try {\n          observer.onEvent(event);\n        } catch (error) {\n          console.error(`Error in observer ${observerId}:`, error);\n          \n          // Emit error event\n          this.notify({\n            type: GlobeEventType.ERROR_OCCURRED,\n            timestamp: Date.now(),\n            data: {\n              message: `Observer ${observerId} error`,\n              source: 'GlobeEventBus',\n              error: error instanceof Error ? error : new Error(String(error))\n            }\n          });\n        }\n      }\n    });\n  }\n\n  /**\n   * Get list of active observers\n   */\n  getObservers(): string[] {\n    return Array.from(this.observers.keys());\n  }\n\n  /**\n   * Get event history\n   */\n  getEventHistory(eventType?: GlobeEventType): GlobeEvent[] {\n    if (eventType) {\n      return this.eventHistory.filter(event => event.type === eventType);\n    }\n    return [...this.eventHistory];\n  }\n\n  /**\n   * Clear event history\n   */\n  clearHistory(): void {\n    this.eventHistory = [];\n  }\n\n  /**\n   * Get statistics about event bus usage\n   */\n  getStats(): {\n    observerCount: number;\n    eventHistorySize: number;\n    eventTypeCounts: Record<string, number>;\n  } {\n    const eventTypeCounts: Record<string, number> = {};\n    \n    this.eventHistory.forEach(event => {\n      eventTypeCounts[event.type] = (eventTypeCounts[event.type] || 0) + 1;\n    });\n\n    return {\n      observerCount: this.observers.size,\n      eventHistorySize: this.eventHistory.length,\n      eventTypeCounts\n    };\n  }\n\n  private addToHistory(event: GlobeEvent): void {\n    this.eventHistory.push(event);\n    \n    // Maintain max history size\n    if (this.eventHistory.length > this.maxHistorySize) {\n      this.eventHistory.shift();\n    }\n  }\n}\n\n/**\n * Singleton event bus instance\n */\nexport const globeEventBus = new GlobeEventBus();\n\n/**\n * Base class for components that need to observe globe events\n */\nexport abstract class GlobeObserver implements IGlobeObserver {\n  protected eventBus: GlobeEventBus;\n  private observerId: string;\n\n  constructor(observerId: string, eventBus: GlobeEventBus = globeEventBus) {\n    this.observerId = observerId;\n    this.eventBus = eventBus;\n  }\n\n  getObserverId(): string {\n    return this.observerId;\n  }\n\n  abstract onEvent(event: GlobeEvent): void;\n\n  protected subscribe(eventTypes?: GlobeEventType[]): void {\n    this.eventBus.subscribe(this, eventTypes);\n  }\n\n  protected unsubscribe(): void {\n    this.eventBus.unsubscribe(this.observerId);\n  }\n\n  protected emit(event: Omit<GlobeEvent, 'timestamp'>): void {\n    this.eventBus.notify({\n      ...event,\n      timestamp: Date.now()\n    });\n  }\n}\n\n/**\n * Utility functions for creating common events\n */\nexport const createGlobeEvent = {\n  stationSelected: (stationId: string, station: any): StationSelectedEvent => ({\n    type: GlobeEventType.STATION_SELECTED,\n    timestamp: Date.now(),\n    data: { stationId, station }\n  }),\n\n  stationsLoaded: (count: number, region?: string, zoomLevel = 1): StationsLoadedEvent => ({\n    type: GlobeEventType.STATIONS_LOADED,\n    timestamp: Date.now(),\n    data: { count, region, zoomLevel }\n  }),\n\n  zoomChanged: (oldZoom: number, newZoom: number, cameraDistance: number): ZoomChangedEvent => ({\n    type: GlobeEventType.ZOOM_CHANGED,\n    timestamp: Date.now(),\n    data: { oldZoom, newZoom, cameraDistance }\n  }),\n\n  error: (message: string, source: string, error?: Error): ErrorOccurredEvent => ({\n    type: GlobeEventType.ERROR_OCCURRED,\n    timestamp: Date.now(),\n    data: { message, source, error }\n  })\n};"],"names":["GlobeEventType","GlobeEventBus","observers","Map","eventHistory","maxHistorySize","subscribe","observer","eventTypes","observerId","getObserverId","subscribedTypes","Set","Object","values","set","console","log","Array","from","unsubscribe","delete","notify","event","addToHistory","entries","forEach","has","type","onEvent","error","timestamp","Date","now","data","message","source","Error","String","getObservers","keys","getEventHistory","eventType","filter","clearHistory","getStats","eventTypeCounts","observerCount","size","eventHistorySize","length","push","shift","globeEventBus","GlobeObserver","eventBus","emit","createGlobeEvent","stationSelected","stationId","station","stationsLoaded","count","region","zoomLevel","zoomChanged","oldZoom","newZoom","cameraDistance"],"mappings":"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"}},
    {"offset": {"line": 7414, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/commands/GlobeCommands.ts"],"sourcesContent":["/**\n * Command pattern implementation for Globe actions\n * Provides undo/redo functionality and action queuing\n */\n\nexport interface ICommand {\n  execute(): Promise<void> | void;\n  undo(): Promise<void> | void;\n  canUndo(): boolean;\n  getDescription(): string;\n}\n\n/**\n * Abstract base command with common functionality\n */\nexport abstract class BaseCommand implements ICommand {\n  protected timestamp: number;\n  protected executed = false;\n\n  constructor() {\n    this.timestamp = Date.now();\n  }\n\n  abstract execute(): Promise<void> | void;\n  abstract undo(): Promise<void> | void;\n  abstract getDescription(): string;\n\n  canUndo(): boolean {\n    return this.executed;\n  }\n\n  protected markExecuted(): void {\n    this.executed = true;\n  }\n\n  protected markUndo(): void {\n    this.executed = false;\n  }\n\n  getTimestamp(): number {\n    return this.timestamp;\n  }\n}\n\n/**\n * Station selection command\n */\nexport class SelectStationCommand extends BaseCommand {\n  constructor(\n    private stationId: string,\n    private station: any,\n    private onExecute: (stationId: string, station: any) => void,\n    private onUndo: () => void,\n    private previousSelection?: { stationId: string; station: any }\n  ) {\n    super();\n  }\n\n  execute(): void {\n    this.onExecute(this.stationId, this.station);\n    this.markExecuted();\n  }\n\n  undo(): void {\n    if (this.previousSelection) {\n      this.onExecute(this.previousSelection.stationId, this.previousSelection.station);\n    } else {\n      this.onUndo();\n    }\n    this.markUndo();\n  }\n\n  getDescription(): string {\n    return `Select station: ${this.station?.name || this.stationId}`;\n  }\n}\n\n/**\n * Camera position command\n */\nexport class SetCameraPositionCommand extends BaseCommand {\n  constructor(\n    private newPosition: [number, number, number],\n    private setCameraPosition: (position: [number, number, number]) => void,\n    private previousPosition: [number, number, number]\n  ) {\n    super();\n  }\n\n  execute(): void {\n    this.setCameraPosition(this.newPosition);\n    this.markExecuted();\n  }\n\n  undo(): void {\n    this.setCameraPosition(this.previousPosition);\n    this.markUndo();\n  }\n\n  getDescription(): string {\n    return `Move camera to ${this.newPosition.join(', ')}`;\n  }\n}\n\n/**\n * Load stations command\n */\nexport class LoadStationsCommand extends BaseCommand {\n  constructor(\n    private region: string,\n    private onLoad: (region: string) => Promise<void>,\n    private onUnload: () => void\n  ) {\n    super();\n  }\n\n  async execute(): Promise<void> {\n    await this.onLoad(this.region);\n    this.markExecuted();\n  }\n\n  undo(): void {\n    this.onUnload();\n    this.markUndo();\n  }\n\n  getDescription(): string {\n    return `Load stations for region: ${this.region}`;\n  }\n}\n\n/**\n * Filter stations command\n */\nexport class FilterStationsCommand extends BaseCommand {\n  constructor(\n    private filterCriteria: any,\n    private onFilter: (criteria: any) => void,\n    private onClearFilter: () => void\n  ) {\n    super();\n  }\n\n  execute(): void {\n    this.onFilter(this.filterCriteria);\n    this.markExecuted();\n  }\n\n  undo(): void {\n    this.onClearFilter();\n    this.markUndo();\n  }\n\n  getDescription(): string {\n    return `Apply filter: ${JSON.stringify(this.filterCriteria)}`;\n  }\n}\n\n/**\n * Batch command for executing multiple commands together\n */\nexport class BatchCommand extends BaseCommand {\n  constructor(\n    private commands: ICommand[],\n    private description: string\n  ) {\n    super();\n  }\n\n  async execute(): Promise<void> {\n    for (const command of this.commands) {\n      await command.execute();\n    }\n    this.markExecuted();\n  }\n\n  async undo(): Promise<void> {\n    // Undo in reverse order\n    for (let i = this.commands.length - 1; i >= 0; i--) {\n      const command = this.commands[i];\n      if (command.canUndo()) {\n        await command.undo();\n      }\n    }\n    this.markUndo();\n  }\n\n  canUndo(): boolean {\n    return this.executed && this.commands.some(cmd => cmd.canUndo());\n  }\n\n  getDescription(): string {\n    return this.description;\n  }\n}\n\n/**\n * Command invoker with undo/redo history\n */\nexport class CommandInvoker {\n  private history: ICommand[] = [];\n  private currentPosition = -1;\n  private readonly maxHistorySize: number;\n\n  constructor(maxHistorySize = 50) {\n    this.maxHistorySize = maxHistorySize;\n  }\n\n  /**\n   * Execute a command and add it to history\n   */\n  async execute(command: ICommand): Promise<void> {\n    try {\n      await command.execute();\n      \n      // Remove any commands after current position (when doing new action after undo)\n      this.history = this.history.slice(0, this.currentPosition + 1);\n      \n      // Add new command\n      this.history.push(command);\n      this.currentPosition++;\n      \n      // Maintain max history size\n      if (this.history.length > this.maxHistorySize) {\n        this.history.shift();\n        this.currentPosition--;\n      }\n      \n      console.log(`Executed command: ${command.getDescription()}`);\n    } catch (error) {\n      console.error(`Failed to execute command: ${command.getDescription()}`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Undo the last command\n   */\n  async undo(): Promise<boolean> {\n    if (!this.canUndo()) {\n      return false;\n    }\n\n    const command = this.history[this.currentPosition];\n    try {\n      await command.undo();\n      this.currentPosition--;\n      console.log(`Undid command: ${command.getDescription()}`);\n      return true;\n    } catch (error) {\n      console.error(`Failed to undo command: ${command.getDescription()}`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Redo the next command\n   */\n  async redo(): Promise<boolean> {\n    if (!this.canRedo()) {\n      return false;\n    }\n\n    this.currentPosition++;\n    const command = this.history[this.currentPosition];\n    try {\n      await command.execute();\n      console.log(`Redid command: ${command.getDescription()}`);\n      return true;\n    } catch (error) {\n      console.error(`Failed to redo command: ${command.getDescription()}`, error);\n      this.currentPosition--;\n      return false;\n    }\n  }\n\n  /**\n   * Check if undo is possible\n   */\n  canUndo(): boolean {\n    return this.currentPosition >= 0 && \n           this.history[this.currentPosition]?.canUndo();\n  }\n\n  /**\n   * Check if redo is possible\n   */\n  canRedo(): boolean {\n    return this.currentPosition < this.history.length - 1;\n  }\n\n  /**\n   * Get command history\n   */\n  getHistory(): Array<{ description: string; canUndo: boolean; timestamp: number }> {\n    return this.history.map((cmd, index) => ({\n      description: cmd.getDescription(),\n      canUndo: cmd.canUndo(),\n      timestamp: (cmd as BaseCommand).getTimestamp?.() || 0,\n      isCurrent: index === this.currentPosition\n    }));\n  }\n\n  /**\n   * Clear command history\n   */\n  clearHistory(): void {\n    this.history = [];\n    this.currentPosition = -1;\n  }\n\n  /**\n   * Get current command\n   */\n  getCurrentCommand(): ICommand | undefined {\n    return this.history[this.currentPosition];\n  }\n\n  /**\n   * Get statistics\n   */\n  getStats(): { \n    totalCommands: number; \n    currentPosition: number; \n    canUndo: boolean; \n    canRedo: boolean; \n  } {\n    return {\n      totalCommands: this.history.length,\n      currentPosition: this.currentPosition,\n      canUndo: this.canUndo(),\n      canRedo: this.canRedo()\n    };\n  }\n}\n\n/**\n * Singleton command invoker\n */\nexport const globeCommandInvoker = new CommandInvoker();\n\n/**\n * Command factory for creating common commands\n */\nexport const createCommand = {\n  selectStation: (\n    stationId: string, \n    station: any, \n    onExecute: (stationId: string, station: any) => void,\n    onUndo: () => void,\n    previousSelection?: { stationId: string; station: any }\n  ) => new SelectStationCommand(stationId, station, onExecute, onUndo, previousSelection),\n\n  setCameraPosition: (\n    newPosition: [number, number, number],\n    setCameraPosition: (position: [number, number, number]) => void,\n    previousPosition: [number, number, number]\n  ) => new SetCameraPositionCommand(newPosition, setCameraPosition, previousPosition),\n\n  loadStations: (\n    region: string,\n    onLoad: (region: string) => Promise<void>,\n    onUnload: () => void\n  ) => new LoadStationsCommand(region, onLoad, onUnload),\n\n  filterStations: (\n    filterCriteria: any,\n    onFilter: (criteria: any) => void,\n    onClearFilter: () => void\n  ) => new FilterStationsCommand(filterCriteria, onFilter, onClearFilter),\n\n  batch: (commands: ICommand[], description: string) => \n    new BatchCommand(commands, description)\n};"],"names":["BaseCommand","timestamp","executed","Date","now","canUndo","markExecuted","markUndo","getTimestamp","SelectStationCommand","stationId","station","onExecute","onUndo","previousSelection","execute","undo","getDescription","name","SetCameraPositionCommand","newPosition","setCameraPosition","previousPosition","join","LoadStationsCommand","region","onLoad","onUnload","FilterStationsCommand","filterCriteria","onFilter","onClearFilter","JSON","stringify","BatchCommand","commands","description","command","i","length","some","cmd","CommandInvoker","history","currentPosition","maxHistorySize","slice","push","shift","console","log","error","redo","canRedo","getHistory","map","index","isCurrent","clearHistory","getCurrentCommand","getStats","totalCommands","globeCommandInvoker","createCommand","selectStation","loadStations","filterStations","batch"],"mappings":"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"}},
    {"offset": {"line": 7684, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/usecases/StationUseCases.ts"],"sourcesContent":["import { IStationLoadingUseCase, IStationSelectionUseCase } from \"../domain/usecases\";\nimport { MarkerData } from \"../strategies/MarkerStrategy\";\nimport { StationRepository } from \"../repositories/StationRepository\";\nimport { GlobeEventBus, createGlobeEvent, GlobeEventType } from \"../events/GlobeEventBus\";\nimport { CommandInvoker, createCommand } from \"../commands/GlobeCommands\";\nimport { latLngToPosition } from \"../utils/coordinates\";\n\n\n/**\n * Station Loading Use Case\n * Handles progressive loading and clustering of radio stations\n */\nexport class StationLoadingUseCase implements IStationLoadingUseCase {\n  constructor(\n    private stationRepository: StationRepository,\n    private eventBus: GlobeEventBus\n  ) {}\n\n  async loadStationsForView(zoomLevel: number): Promise<MarkerData[]> {\n    try {\n      this.eventBus.notify(createGlobeEvent.zoomChanged(0, zoomLevel, zoomLevel * 2));\n\n      // Load comprehensive global station data with country distribution\n      const stations = await this.stationRepository.getGlobalStationsWithDistribution();\n      console.log(`Loaded ${stations.length} stations from global distribution`);\n\n      // If no stations or stations without coordinates, add enhanced test data\n      if (stations.length === 0 || stations.every(s => !s.location?.lat && !s.location?.lng)) {\n        console.log('Adding enhanced fallback test stations with real coordinates');\n        const enhancedTestStations = this.getEnhancedTestStations();\n        return this.clusterStationsByCountryAndCity(enhancedTestStations, zoomLevel);\n      }\n\n      // Group stations by country and city for intelligent clustering\n      const clusteredMarkers = this.clusterStationsByCountryAndCity(stations, zoomLevel);\n      \n      const totalStations = clusteredMarkers.reduce((sum, marker) => sum + marker.stations.length, 0);\n      console.log(`Created ${clusteredMarkers.length} marker clusters with ${totalStations} total stations`);\n      \n      this.eventBus.notify(createGlobeEvent.stationsLoaded(\n        totalStations,\n        'global',\n        zoomLevel\n      ));\n\n      return clusteredMarkers;\n    } catch (error) {\n      console.error('Error in loadStationsForView:', error);\n      \n      // Enhanced fallback with comprehensive test data\n      const testStations = this.getEnhancedTestStations();\n      const clusteredMarkers = this.clusterStationsByCountryAndCity(testStations, zoomLevel);\n      \n      const totalStations = clusteredMarkers.reduce((sum, marker) => sum + marker.stations.length, 0);\n      \n      this.eventBus.notify(createGlobeEvent.stationsLoaded(\n        totalStations,\n        'global',\n        zoomLevel\n      ));\n      \n      this.eventBus.notify(createGlobeEvent.error(\n        'Failed to load stations, using fallback',\n        'StationLoadingUseCase',\n        error instanceof Error ? error : new Error(String(error))\n      ));\n      return clusteredMarkers;\n    }\n  }\n\n  /**\n   * Enhanced clustering by country first, then by city for better organization\n   */\n  private clusterStationsByCountryAndCity(stations: any[], zoomLevel: number): MarkerData[] {\n    const markers: MarkerData[] = [];\n    \n    // Group by country first, then by city/region within country\n    const stationsByCountry = new Map<string, any[]>();\n    stations.forEach(station => {\n      const country = station.location?.country || station.country || 'Unknown';\n      if (!stationsByCountry.has(country)) {\n        stationsByCountry.set(country, []);\n      }\n      stationsByCountry.get(country)!.push(station);\n    });\n\n    // Process each country based on zoom level with more conservative clustering\n    stationsByCountry.forEach((countryStations, country) => {\n      if (zoomLevel <= 2) {\n        // Country-level clustering for far zoom - always cluster\n        const countryCenter = this.getCountryCenter(country);\n        if (countryCenter && countryStations.length > 0) {\n          markers.push({\n            id: `country-${country}`,\n            type: 'cluster',\n            position: countryCenter,\n            stations: countryStations,\n            metadata: {\n              name: `${country} (${countryStations.length} stations)`,\n              country: country,\n              stationCount: countryStations.length,\n              density: this.getDensityLevel(countryStations.length),\n              type: 'country' as const\n            }\n          });\n        }\n      } else if (zoomLevel <= 4) {\n        // City-level clustering for medium zoom - be more conservative\n        if (countryStations.length <= 3) {\n          // If very few stations, still cluster at country level\n          const countryCenter = this.getCountryCenter(country);\n          if (countryCenter) {\n            markers.push({\n              id: `country-${country}`,\n              type: 'cluster',\n              position: countryCenter,\n              stations: countryStations,\n              metadata: {\n                name: `${country} (${countryStations.length} stations)`,\n                country: country,\n                stationCount: countryStations.length,\n                density: this.getDensityLevel(countryStations.length),\n                type: 'country' as const\n              }\n            });\n          }\n        } else {\n          // City-level clustering for countries with many stations\n          // Group by major cities and towns within the country\n          const cityClusters = this.clusterStationsByCity(countryStations, country, zoomLevel);\n          markers.push(...cityClusters);\n        }\n      } else {\n        // Individual stations for close zoom - but limit to prevent overcrowding\n        const maxIndividualStations = 15; // Limit individual stations per country\n        const stationsToShow = countryStations.slice(0, maxIndividualStations);\n        \n        if (countryStations.length > maxIndividualStations) {\n          // If too many stations, show a few individuals plus a cluster for the rest\n          stationsToShow.forEach(station => {\n            if (station.location?.lat && station.location?.lng) {\n              markers.push({\n                id: `station-${station.id}`,\n                type: 'single',\n                position: [station.location.lng, station.location.lat, 0],\n                stations: [station],\n                metadata: {\n                  name: station.name,\n                  country: station.location.country,\n                  city: station.location.city,\n                  stationCount: 1,\n                  density: 'low' as const,\n                  type: 'cluster' as const\n                }\n              });\n            }\n          });\n          \n          // Add a cluster for remaining stations\n          const remaining = countryStations.slice(maxIndividualStations);\n          const countryCenter = this.getCountryCenter(country);\n          if (countryCenter && remaining.length > 0) {\n            markers.push({\n              id: `country-overflow-${country}`,\n              type: 'cluster',\n              position: countryCenter,\n              stations: remaining,\n              metadata: {\n                name: `${country} (+${remaining.length} more)`,\n                country: country,\n                stationCount: remaining.length,\n                density: this.getDensityLevel(remaining.length),\n                type: 'country' as const\n              }\n            });\n          }\n        } else {\n          // Show all individual stations if manageable count\n          stationsToShow.forEach(station => {\n            if (station.location?.lat && station.location?.lng) {\n              markers.push({\n                id: `station-${station.id}`,\n                type: 'single',\n                position: [station.location.lng, station.location.lat, 0],\n                stations: [station],\n                metadata: {\n                  name: station.name,\n                  country: station.location.country,\n                  city: station.location.city,\n                  stationCount: 1,\n                  density: 'low' as const,\n                  type: 'cluster' as const\n                }\n              });\n            }\n          });\n        }\n      }\n    });\n\n    return markers;\n  }\n\n  /**\n   * Get approximate center coordinates for major countries\n   */\n  private getCountryCenter(country: string): [number, number, number] | null {\n    const countryCenters: Record<string, [number, number, number]> = {\n      'US': [-98.5, 39.8, 0], 'United States': [-98.5, 39.8, 0],\n      'GB': [-3.4, 55.4, 0], 'United Kingdom': [-3.4, 55.4, 0],\n      'DE': [10.5, 51.2, 0], 'Germany': [10.5, 51.2, 0],\n      'FR': [2.2, 46.2, 0], 'France': [2.2, 46.2, 0],\n      'ES': [-3.7, 40.5, 0], 'Spain': [-3.7, 40.5, 0],\n      'IT': [12.6, 41.9, 0], 'Italy': [12.6, 41.9, 0],\n      'NL': [5.3, 52.1, 0], 'Netherlands': [5.3, 52.1, 0],\n      'SE': [18.6, 60.1, 0], 'Sweden': [18.6, 60.1, 0],\n      'NO': [10.7, 59.9, 0], 'Norway': [10.7, 59.9, 0],\n      'DK': [9.5, 56.3, 0], 'Denmark': [9.5, 56.3, 0],\n      'JP': [138.3, 36.2, 0], 'Japan': [138.3, 36.2, 0],\n      'KR': [127.8, 35.9, 0], 'South Korea': [127.8, 35.9, 0],\n      'CN': [104.2, 35.9, 0], 'China': [104.2, 35.9, 0],\n      'IN': [78.9, 20.6, 0], 'India': [78.9, 20.6, 0],\n      'AU': [133.8, -25.3, 0], 'Australia': [133.8, -25.3, 0],\n      'NZ': [174.9, -40.9, 0], 'New Zealand': [174.9, -40.9, 0],\n      'BR': [-51.9, -14.2, 0], 'Brazil': [-51.9, -14.2, 0],\n      'MX': [-102.6, 23.6, 0], 'Mexico': [-102.6, 23.6, 0],\n      'CA': [-106.3, 56.1, 0], 'Canada': [-106.3, 56.1, 0],\n      'RU': [105.3, 61.5, 0], 'Russia': [105.3, 61.5, 0],\n      'ZA': [22.9, -30.6, 0], 'South Africa': [22.9, -30.6, 0],\n      'AR': [-63.6, -38.4, 0], 'Argentina': [-63.6, -38.4, 0],\n      'CL': [-71.5, -35.7, 0], 'Chile': [-71.5, -35.7, 0],\n      'EG': [30.8, 26.8, 0], 'Egypt': [30.8, 26.8, 0],\n      'NG': [8.7, 9.1, 0], 'Nigeria': [8.7, 9.1, 0],\n      'TR': [35.2, 39.0, 0], 'Turkey': [35.2, 39.0, 0],\n    };\n\n    return countryCenters[country] || null;\n  }\n\n  /**\n   * Calculate density level based on station count\n   */\n  private getDensityLevel(stationCount: number): 'low' | 'medium' | 'high' | 'very-high' {\n    if (stationCount > 20) return 'very-high';\n    if (stationCount > 10) return 'high';\n    if (stationCount > 5) return 'medium';\n    return 'low';\n  }\n\n  /**\n   * Get coordinates for major cities worldwide\n   */\n  private getCityCoordinates(cityName: string, country: string): { lat: number; lng: number } | null {\n    const cityCoords: Record<string, Record<string, { lat: number; lng: number }>> = {\n      'Zambia': {\n        'Lusaka': { lat: -15.3875, lng: 28.3228 },\n        'Ndola': { lat: -12.9687, lng: 28.6366 },\n        'Kitwe': { lat: -12.8024, lng: 28.2132 },\n        'Kabwe': { lat: -14.4469, lng: 28.4464 },\n        'Chingola': { lat: -12.5289, lng: 27.8811 },\n        'Mufulira': { lat: -12.5443, lng: 28.2405 },\n        'Livingstone': { lat: -17.8419, lng: 25.8544 }\n      },\n      'Nigeria': {\n        'Lagos': { lat: 6.5244, lng: 3.3792 },\n        'Abuja': { lat: 9.0765, lng: 7.3986 },\n        'Kano': { lat: 12.0022, lng: 8.5920 },\n        'Ibadan': { lat: 7.3775, lng: 3.9470 },\n        'Port Harcourt': { lat: 4.8156, lng: 7.0498 }\n      },\n      'Kenya': {\n        'Nairobi': { lat: -1.2921, lng: 36.8219 },\n        'Mombasa': { lat: -4.0435, lng: 39.6682 },\n        'Kisumu': { lat: -0.0917, lng: 34.7680 },\n        'Eldoret': { lat: 0.5143, lng: 35.2698 }\n      },\n      'South Africa': {\n        'Johannesburg': { lat: -26.2041, lng: 28.0473 },\n        'Cape Town': { lat: -33.9249, lng: 18.4241 },\n        'Durban': { lat: -29.8587, lng: 31.0218 },\n        'Pretoria': { lat: -25.7479, lng: 28.2293 }\n      },\n      'United States': {\n        'New York': { lat: 40.7128, lng: -74.0060 },\n        'Los Angeles': { lat: 34.0522, lng: -118.2437 },\n        'Chicago': { lat: 41.8781, lng: -87.6298 },\n        'Houston': { lat: 29.7604, lng: -95.3698 }\n      },\n      'United Kingdom': {\n        'London': { lat: 51.5074, lng: -0.1278 },\n        'Manchester': { lat: 53.4808, lng: -2.2426 },\n        'Birmingham': { lat: 52.4862, lng: -1.8904 },\n        'Liverpool': { lat: 53.4084, lng: -2.9916 }\n      }\n    };\n\n    return cityCoords[country]?.[cityName] || null;\n  }\n\n  /**\n   * Get approximate country boundaries for coordinate generation\n   */\n  private getCountryBounds(country: string): { minLat: number; maxLat: number; minLng: number; maxLng: number } | null {\n    const countryBounds: Record<string, { minLat: number; maxLat: number; minLng: number; maxLng: number }> = {\n      'Zambia': { minLat: -18.0, maxLat: -8.2, minLng: 21.9, maxLng: 33.7 },\n      'Nigeria': { minLat: 4.3, maxLat: 13.9, minLng: 2.7, maxLng: 14.7 },\n      'Kenya': { minLat: -4.7, maxLat: 5.5, minLng: 33.9, maxLng: 41.9 },\n      'South Africa': { minLat: -34.8, maxLat: -22.1, minLng: 16.3, maxLng: 32.9 },\n      'United States': { minLat: 25.0, maxLat: 49.0, minLng: -125.0, maxLng: -66.0 },\n      'United Kingdom': { minLat: 49.9, maxLat: 58.7, minLng: -8.6, maxLng: 1.8 },\n      'Germany': { minLat: 47.3, maxLat: 55.1, minLng: 5.9, maxLng: 15.0 },\n      'France': { minLat: 41.3, maxLat: 51.1, minLng: -5.1, maxLng: 9.6 },\n      'Brazil': { minLat: -33.7, maxLat: 5.3, minLng: -73.9, maxLng: -28.8 },\n      'Australia': { minLat: -43.6, maxLat: -10.7, minLng: 113.3, maxLng: 153.6 }\n    };\n\n    return countryBounds[country] || null;\n  }\n\n  /**\n   * Enhanced test stations with global coverage\n   */\n  private getEnhancedTestStations(): any[] {\n    return [\n      // North America\n      { id: 'test-us-1', name: 'KQED FM', url: 'http://kqed.org/stream', country: 'US', city: 'San Francisco', genre: 'News', location: { lat: 37.7749, lng: -122.4194 } },\n      { id: 'test-us-2', name: 'WNYC FM', url: 'http://wnyc.org/stream', country: 'US', city: 'New York', genre: 'News', location: { lat: 40.7589, lng: -73.9851 } },\n      { id: 'test-us-3', name: 'WXPN', url: 'http://wxpn.org/stream', country: 'US', city: 'Philadelphia', genre: 'Music', location: { lat: 39.9526, lng: -75.1652 } },\n      { id: 'test-ca-1', name: 'CBC Radio One', url: 'http://cbc.ca/stream', country: 'CA', city: 'Toronto', genre: 'News', location: { lat: 43.6532, lng: -79.3832 } },\n      { id: 'test-ca-2', name: 'Radio-Canada', url: 'http://radio-canada.ca/stream', country: 'CA', city: 'Montreal', genre: 'News', location: { lat: 45.5017, lng: -73.5673 } },\n      \n      // Europe\n      { id: 'test-gb-1', name: 'BBC Radio 1', url: 'http://bbc.co.uk/stream', country: 'GB', city: 'London', genre: 'Music', location: { lat: 51.5074, lng: -0.1278 } },\n      { id: 'test-gb-2', name: 'BBC Radio 4', url: 'http://bbc.co.uk/radio4', country: 'GB', city: 'London', genre: 'News', location: { lat: 51.5074, lng: -0.1278 } },\n      { id: 'test-de-1', name: 'Deutschlandfunk', url: 'http://dradio.de/stream', country: 'DE', city: 'Berlin', genre: 'News', location: { lat: 52.5200, lng: 13.4050 } },\n      { id: 'test-de-2', name: 'Bayern 3', url: 'http://br.de/stream', country: 'DE', city: 'Munich', genre: 'Music', location: { lat: 48.1351, lng: 11.5820 } },\n      { id: 'test-fr-1', name: 'France Inter', url: 'http://radiofrance.fr/stream', country: 'FR', city: 'Paris', genre: 'News', location: { lat: 48.8566, lng: 2.3522 } },\n      { id: 'test-es-1', name: 'RNE Radio 1', url: 'http://rtve.es/stream', country: 'ES', city: 'Madrid', genre: 'News', location: { lat: 40.4168, lng: -3.7038 } },\n      { id: 'test-it-1', name: 'RAI Radio 1', url: 'http://rai.it/stream', country: 'IT', city: 'Rome', genre: 'News', location: { lat: 41.9028, lng: 12.4964 } },\n      { id: 'test-nl-1', name: 'NPO Radio 1', url: 'http://npo.nl/stream', country: 'NL', city: 'Amsterdam', genre: 'News', location: { lat: 52.3676, lng: 4.9041 } },\n      { id: 'test-se-1', name: 'SVT P1', url: 'http://svt.se/stream', country: 'SE', city: 'Stockholm', genre: 'News', location: { lat: 59.3293, lng: 18.0686 } },\n      { id: 'test-no-1', name: 'NRK P1', url: 'http://nrk.no/stream', country: 'NO', city: 'Oslo', genre: 'News', location: { lat: 59.9139, lng: 10.7522 } },\n      \n      // Asia-Pacific\n      { id: 'test-jp-1', name: 'NHK Radio', url: 'http://nhk.or.jp/stream', country: 'JP', city: 'Tokyo', genre: 'News', location: { lat: 35.6762, lng: 139.6503 } },\n      { id: 'test-jp-2', name: 'J-Wave', url: 'http://j-wave.co.jp/stream', country: 'JP', city: 'Tokyo', genre: 'Music', location: { lat: 35.6762, lng: 139.6503 } },\n      { id: 'test-kr-1', name: 'KBS Radio', url: 'http://kbs.co.kr/stream', country: 'KR', city: 'Seoul', genre: 'News', location: { lat: 37.5665, lng: 126.9780 } },\n      { id: 'test-au-1', name: 'ABC Radio', url: 'http://abc.net.au/stream', country: 'AU', city: 'Sydney', genre: 'News', location: { lat: -33.8688, lng: 151.2093 } },\n      { id: 'test-au-2', name: 'Triple J', url: 'http://triplej.net.au/stream', country: 'AU', city: 'Sydney', genre: 'Music', location: { lat: -33.8688, lng: 151.2093 } },\n      { id: 'test-nz-1', name: 'RNZ National', url: 'http://rnz.co.nz/stream', country: 'NZ', city: 'Wellington', genre: 'News', location: { lat: -41.2865, lng: 174.7762 } },\n      { id: 'test-in-1', name: 'All India Radio', url: 'http://allindiaradio.gov.in/stream', country: 'IN', city: 'New Delhi', genre: 'News', location: { lat: 28.7041, lng: 77.1025 } },\n      { id: 'test-in-2', name: 'Radio City', url: 'http://radiocity.in/stream', country: 'IN', city: 'Mumbai', genre: 'Music', location: { lat: 19.0760, lng: 72.8777 } },\n      \n      // Latin America\n      { id: 'test-br-1', name: 'CBN Radio', url: 'http://cbn.globoradio.globo.com/stream', country: 'BR', city: 'So Paulo', genre: 'News', location: { lat: -23.5558, lng: -46.6396 } },\n      { id: 'test-br-2', name: 'Rdio Nacional', url: 'http://radios.ebc.com.br/stream', country: 'BR', city: 'Rio de Janeiro', genre: 'Music', location: { lat: -22.9068, lng: -43.1729 } },\n      { id: 'test-mx-1', name: 'Radio Universidad', url: 'http://radio.unam.mx/stream', country: 'MX', city: 'Mexico City', genre: 'Culture', location: { lat: 19.4326, lng: -99.1332 } },\n      { id: 'test-ar-1', name: 'Radio Nacional', url: 'http://radionacional.com.ar/stream', country: 'AR', city: 'Buenos Aires', genre: 'News', location: { lat: -34.6118, lng: -58.3960 } },\n      { id: 'test-cl-1', name: 'Radio Cooperativa', url: 'http://cooperativa.cl/stream', country: 'CL', city: 'Santiago', genre: 'News', location: { lat: -33.4489, lng: -70.6693 } },\n      \n      // Africa & Middle East\n      { id: 'test-za-1', name: 'SAfm', url: 'http://sabc.co.za/stream', country: 'ZA', city: 'Johannesburg', genre: 'News', location: { lat: -26.2041, lng: 28.0473 } },\n      { id: 'test-eg-1', name: 'Radio Cairo', url: 'http://ertu.org/stream', country: 'EG', city: 'Cairo', genre: 'News', location: { lat: 30.0444, lng: 31.2357 } },\n      { id: 'test-ng-1', name: 'Radio Nigeria', url: 'http://frcn.gov.ng/stream', country: 'NG', city: 'Lagos', genre: 'News', location: { lat: 6.5244, lng: 3.3792 } },\n      { id: 'test-il-1', name: 'Kol Israel', url: 'http://kan.org.il/stream', country: 'IL', city: 'Tel Aviv', genre: 'News', location: { lat: 32.0853, lng: 34.7818 } },\n      \n      // Russia & Eastern Europe\n      { id: 'test-ru-1', name: 'Radio Russia', url: 'http://radiorus.ru/stream', country: 'RU', city: 'Moscow', genre: 'News', location: { lat: 55.7558, lng: 37.6173 } },\n      { id: 'test-ru-2', name: 'Echo Moscow', url: 'http://echo.msk.ru/stream', country: 'RU', city: 'Moscow', genre: 'Talk', location: { lat: 55.7558, lng: 37.6173 } },\n      { id: 'test-tr-1', name: 'TRT Radyo 1', url: 'http://trt.net.tr/stream', country: 'TR', city: 'Istanbul', genre: 'News', location: { lat: 41.0082, lng: 28.9784 } },\n    ];\n  }\n\n  private clusterStationsByCity(stations: any[], country: string, zoomLevel: number): MarkerData[] {\n    const cityGroups = new Map<string, any[]>();\n    \n    console.log(`Clustering ${stations.length} stations for ${country}`);\n    \n    // Group stations by city, creating major urban centers as cluster points\n    stations.forEach((station, index) => {\n      const city = station.location?.city || 'Unknown City';\n      const cityKey = `${city}-${country}`;\n      \n      if (!cityGroups.has(cityKey)) {\n        cityGroups.set(cityKey, []);\n      }\n      cityGroups.get(cityKey)!.push(station);\n      \n      // Log first few stations to debug location data\n      if (index < 3) {\n        console.log(`Station ${index} in ${country}:`, {\n          name: station.name,\n          city,\n          lat: station.location?.lat,\n          lng: station.location?.lng\n        });\n      }\n    });\n\n    console.log(`Created ${cityGroups.size} city clusters for ${country}`);\n\n    // Convert city groups to marker data representing urban centers\n    return Array.from(cityGroups.entries()).map(([cityKey, groupStations]) => {\n      const representative = groupStations[0];\n      const cityName = cityKey.split('-')[0];\n      let lat = representative.location?.lat || 0;\n      let lng = representative.location?.lng || 0;\n      \n      // If no coordinates, use enhanced city coordinate lookup\n      if (lat === 0 && lng === 0) {\n        const cityCoords = this.getCityCoordinates(cityName, country);\n        if (cityCoords) {\n          lat = cityCoords.lat;\n          lng = cityCoords.lng;\n        } else {\n          // Fallback: generate realistic coordinates within country bounds\n          const countryBounds = this.getCountryBounds(country);\n          if (countryBounds) {\n            const hash = this.hashString(cityKey);\n            lat = countryBounds.minLat + ((hash % 100) / 100) * (countryBounds.maxLat - countryBounds.minLat);\n            lng = countryBounds.minLng + (((hash * 7) % 100) / 100) * (countryBounds.maxLng - countryBounds.minLng);\n          }\n        }\n      }\n      \n      const position = latLngToPosition(lat, lng, 2.02) as [number, number, number];\n      \n      return {\n        id: cityKey,\n        position,\n        stations: groupStations,\n        type: 'city' as const,\n        metadata: {\n          name: `${cityName} (${groupStations.length} stations)`,\n          city: cityName,\n          country: country,\n          stationCount: groupStations.length,\n          density: this.getDensityLevel(groupStations.length),\n          type: 'city' as const\n        }\n      };\n    }).filter(marker => \n      // Filter out markers with invalid coordinates\n      marker.position[0] !== 0 || marker.position[1] !== 0\n    );\n  }\n\n  private hashString(str: string): number {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n      const char = str.charCodeAt(i);\n      hash = ((hash << 5) - hash) + char;\n      hash = hash & hash; // Convert to 32-bit integer\n    }\n    return Math.abs(hash);\n  }\n}\n\n/**\n * Station Selection Use Case  \n * Handles station selection with command pattern and events\n */\nexport class StationSelectionUseCase implements IStationSelectionUseCase {\n  private currentSelection: { stationId: string; station: any } | null = null;\n\n  constructor(\n    private eventBus: GlobeEventBus,\n    private commandInvoker: CommandInvoker\n  ) {}\n\n  async selectStation(stationId: string, station: any): Promise<void> {\n    const previousSelection = this.currentSelection;\n    \n    // Create selection command\n    const command = createCommand.selectStation(\n      stationId,\n      station,\n      (id, st) => this.executeSelection(id, st),\n      () => this.clearSelection(),\n      previousSelection || undefined\n    );\n\n    // Execute through command invoker for undo/redo support\n    await this.commandInvoker.execute(command);\n  }\n\n  async clearSelection(): Promise<void> {\n    if (!this.currentSelection) return;\n\n    const previousSelection = this.currentSelection;\n    this.currentSelection = null;\n\n    // Emit selection cleared event\n    this.eventBus.notify({\n      type: GlobeEventType.STATION_SELECTED,\n      timestamp: Date.now(),\n      data: { stationId: null, station: null, previousSelection }\n    });\n  }\n\n  getCurrentSelection(): { stationId: string; station: any } | null {\n    return this.currentSelection;\n  }\n\n  async hoverStation(stationId: string | null): Promise<void> {\n    this.eventBus.notify({\n      type: GlobeEventType.STATION_HOVERED,\n      timestamp: Date.now(),\n      data: { stationId }\n    });\n  }\n\n  private executeSelection(stationId: string, station: any): void {\n    this.currentSelection = { stationId, station };\n\n    // Emit selection event\n    this.eventBus.notify(createGlobeEvent.stationSelected(stationId, station));\n  }\n}"],"names":["StationLoadingUseCase","stationRepository","eventBus","loadStationsForView","zoomLevel","notify","zoomChanged","stations","getGlobalStationsWithDistribution","console","log","length","every","s","location","lat","lng","enhancedTestStations","getEnhancedTestStations","clusterStationsByCountryAndCity","clusteredMarkers","totalStations","reduce","sum","marker","stationsLoaded","error","testStations","Error","String","markers","stationsByCountry","Map","forEach","station","country","has","set","get","push","countryStations","countryCenter","getCountryCenter","id","type","position","metadata","name","stationCount","density","getDensityLevel","cityClusters","clusterStationsByCity","maxIndividualStations","stationsToShow","slice","city","remaining","countryCenters","getCityCoordinates","cityName","cityCoords","getCountryBounds","countryBounds","minLat","maxLat","minLng","maxLng","url","genre","cityGroups","index","cityKey","size","Array","from","entries","map","groupStations","representative","split","hash","hashString","filter","str","i","char","charCodeAt","Math","abs","StationSelectionUseCase","currentSelection","commandInvoker","selectStation","stationId","previousSelection","command","st","executeSelection","clearSelection","undefined","execute","STATION_SELECTED","timestamp","Date","now","data","getCurrentSelection","hoverStation","STATION_HOVERED","stationSelected"],"mappings":"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"}},
    {"offset": {"line": 8903, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/strategies/MarkerStrategy.ts"],"sourcesContent":["import * as THREE from \"three\";\nimport { RadioStation } from \"../types\";\n\nexport interface MarkerData {\n  id: string;\n  position: [number, number, number];\n  stations: RadioStation[];\n  type: 'single' | 'cluster' | 'city' | 'country';\n  metadata: {\n    city?: string;\n    country?: string;\n    density?: 'low' | 'medium' | 'high' | 'very-high';\n    zoomLevel?: number;\n    name?: string;\n    stationCount?: number;\n    type?: 'country' | 'city' | 'cluster';\n  };\n}\n\nexport interface MarkerStyle {\n  size: number;\n  color: string;\n  opacity: number;\n  hasLabel: boolean;\n  labelText?: string;\n  pulseEffect?: boolean;\n  glowEffect?: boolean;\n}\n\nexport abstract class BaseMarkerStrategy {\n  abstract calculateStyle(data: MarkerData, cameraDistance: number): MarkerStyle;\n  abstract shouldShow(data: MarkerData, zoomLevel: number): boolean;\n  abstract handleInteraction(data: MarkerData, interactionType: 'click' | 'hover'): void;\n}\n\nexport class SingleStationMarkerStrategy extends BaseMarkerStrategy {\n  calculateStyle(data: MarkerData, cameraDistance: number): MarkerStyle {\n    // Much smaller markers when zoomed in\n    const baseSize = Math.max(0.015, Math.min(0.05, 0.1 / cameraDistance));\n    \n    return {\n      size: baseSize,\n      color: \"#5f72ff\",\n      opacity: 0.9,\n      // Only show labels when extremely close\n      hasLabel: cameraDistance < 2.0,\n      labelText: data.stations[0]?.name,\n      pulseEffect: false,\n      glowEffect: false\n    };\n  }\n\n  shouldShow(data: MarkerData, zoomLevel: number): boolean {\n    return zoomLevel > 3.5; // Show individual stations at closer zoom\n  }\n\n  handleInteraction(data: MarkerData, interactionType: 'click' | 'hover'): void {\n    if (interactionType === 'click' && data.stations[0]) {\n      // Dispatch station selection event\n      window.dispatchEvent(new CustomEvent('stationSelected', { \n        detail: data.stations[0] \n      }));\n    }\n  }\n}\n\nexport class ClusterMarkerStrategy extends BaseMarkerStrategy {\n  calculateStyle(data: MarkerData, cameraDistance: number): MarkerStyle {\n    const stationCount = data.stations.length;\n    // Even more conservative base size\n    const baseSize = Math.max(0.025, Math.min(0.1, 0.18 / cameraDistance));\n    // Further reduce size multiplier to prevent huge markers\n    const sizeMultiplier = Math.log(stationCount + 1) * 0.08;\n    \n    const densityColors = {\n      'low': \"#5f72ff\",\n      'medium': \"#ffde59\", \n      'high': \"#ffa502\",\n      'very-high': \"#ff4757\"\n    };\n\n    // Special styling for country-level clusters\n    const isCountryCluster = data.metadata.type === 'country';\n    const color = isCountryCluster ? this.getCountryColor(data.metadata.country || 'Unknown') : densityColors[data.metadata.density || 'low'];\n\n    return {\n      size: baseSize + sizeMultiplier,\n      color: color,\n      opacity: isCountryCluster ? 0.8 : 0.9,\n      // More restrictive label showing - show country names for country clusters\n      hasLabel: cameraDistance < (isCountryCluster ? 4.0 : 2.5) && stationCount <= (isCountryCluster ? 200 : 5),\n      labelText: isCountryCluster ? data.metadata.name : (data.metadata.city || `${stationCount}`),\n      pulseEffect: false,\n      glowEffect: true\n    };\n  }\n\n  private getCountryColor(country: string): string {\n    // Assign distinctive colors to major countries\n    const countryColors: Record<string, string> = {\n      'US': '#ff6b6b', 'United States': '#ff6b6b',\n      'GB': '#4ecdc4', 'United Kingdom': '#4ecdc4',\n      'DE': '#45b7d1', 'Germany': '#45b7d1',\n      'FR': '#96ceb4', 'France': '#96ceb4',\n      'JP': '#ffeaa7', 'Japan': '#ffeaa7',\n      'AU': '#fd79a8', 'Australia': '#fd79a8',\n      'BR': '#00b894', 'Brazil': '#00b894',\n      'CA': '#e17055', 'Canada': '#e17055',\n      'IN': '#a29bfe', 'India': '#a29bfe',\n      'RU': '#636e72', 'Russia': '#636e72',\n      'CN': '#fd63a3', 'China': '#fd63a3',\n      'KR': '#fdcb6e', 'South Korea': '#fdcb6e',\n      'ES': '#e84393', 'Spain': '#e84393',\n      'IT': '#00cec9', 'Italy': '#00cec9',\n    };\n    \n    return countryColors[country] || '#74b9ff'; // Default blue\n  }\n\n  shouldShow(data: MarkerData, zoomLevel: number): boolean {\n    return zoomLevel >= 1 && zoomLevel <= 4; // Stop showing clusters before single stations appear\n  }\n\n  handleInteraction(data: MarkerData, interactionType: 'click' | 'hover'): void {\n    if (interactionType === 'click') {\n      if (data.stations.length === 1) {\n        // Handle single station case - dispatch selection event directly\n        window.dispatchEvent(new CustomEvent('stationSelected', { \n          detail: data.stations[0] \n        }));\n      } else {\n        // Show cluster expansion or select most popular\n        const popularStation = data.stations.reduce((prev, current) => \n          (current.listeners > prev.listeners) ? current : prev\n        );\n        window.dispatchEvent(new CustomEvent('stationSelected', { \n          detail: popularStation \n        }));\n      }\n    }\n  }\n}\n\nexport class MarkerFactory {\n  private strategies = new Map<string, BaseMarkerStrategy>();\n\n  constructor() {\n    this.strategies.set('single', new SingleStationMarkerStrategy());\n    this.strategies.set('cluster', new ClusterMarkerStrategy());\n  }\n\n  createMarker(data: MarkerData, cameraDistance: number): {\n    style: MarkerStyle;\n    strategy: BaseMarkerStrategy;\n  } {\n    const strategy = this.strategies.get(data.type) || this.strategies.get('single')!;\n    \n    return {\n      style: strategy.calculateStyle(data, cameraDistance),\n      strategy\n    };\n  }\n\n  shouldShowMarker(data: MarkerData, zoomLevel: number): boolean {\n    const strategy = this.strategies.get(data.type) || this.strategies.get('single')!;\n    return strategy.shouldShow(data, zoomLevel);\n  }\n}"],"names":["BaseMarkerStrategy","SingleStationMarkerStrategy","calculateStyle","data","cameraDistance","baseSize","Math","max","min","size","color","opacity","hasLabel","labelText","stations","name","pulseEffect","glowEffect","shouldShow","zoomLevel","handleInteraction","interactionType","window","dispatchEvent","CustomEvent","detail","ClusterMarkerStrategy","stationCount","length","sizeMultiplier","log","densityColors","isCountryCluster","metadata","type","getCountryColor","country","density","city","countryColors","popularStation","reduce","prev","current","listeners","MarkerFactory","strategies","Map","set","createMarker","strategy","get","style","shouldShowMarker"],"mappings":";;;;;;;;;;AA6BO,MAAeA;AAItB;AAEO,MAAMC,oCAAoCD;IAC/CE,eAAeC,IAAgB,EAAEC,cAAsB,EAAe;QACpE,sCAAsC;QACtC,MAAMC,WAAWC,KAAKC,GAAG,CAAC,OAAOD,KAAKE,GAAG,CAAC,MAAM,MAAMJ;QAEtD,OAAO;YACLK,MAAMJ;YACNK,OAAO;YACPC,SAAS;YACT,wCAAwC;YACxCC,UAAUR,iBAAiB;YAC3BS,WAAWV,KAAKW,QAAQ,CAAC,EAAE,EAAEC;YAC7BC,aAAa;YACbC,YAAY;QACd;IACF;IAEAC,WAAWf,IAAgB,EAAEgB,SAAiB,EAAW;QACvD,OAAOA,YAAY,KAAK,0CAA0C;IACpE;IAEAC,kBAAkBjB,IAAgB,EAAEkB,eAAkC,EAAQ;QAC5E,IAAIA,oBAAoB,WAAWlB,KAAKW,QAAQ,CAAC,EAAE,EAAE;YACnD,mCAAmC;YACnCQ,OAAOC,aAAa,CAAC,IAAIC,YAAY,mBAAmB;gBACtDC,QAAQtB,KAAKW,QAAQ,CAAC,EAAE;YAC1B;QACF;IACF;AACF;AAEO,MAAMY,8BAA8B1B;IACzCE,eAAeC,IAAgB,EAAEC,cAAsB,EAAe;QACpE,MAAMuB,eAAexB,KAAKW,QAAQ,CAACc,MAAM;QACzC,mCAAmC;QACnC,MAAMvB,WAAWC,KAAKC,GAAG,CAAC,OAAOD,KAAKE,GAAG,CAAC,KAAK,OAAOJ;QACtD,yDAAyD;QACzD,MAAMyB,iBAAiBvB,KAAKwB,GAAG,CAACH,eAAe,KAAK;QAEpD,MAAMI,gBAAgB;YACpB,OAAO;YACP,UAAU;YACV,QAAQ;YACR,aAAa;QACf;QAEA,6CAA6C;QAC7C,MAAMC,mBAAmB7B,KAAK8B,QAAQ,CAACC,IAAI,KAAK;QAChD,MAAMxB,QAAQsB,mBAAmB,IAAI,CAACG,eAAe,CAAChC,KAAK8B,QAAQ,CAACG,OAAO,IAAI,aAAaL,aAAa,CAAC5B,KAAK8B,QAAQ,CAACI,OAAO,IAAI,MAAM;QAEzI,OAAO;YACL5B,MAAMJ,WAAWwB;YACjBnB,OAAOA;YACPC,SAASqB,mBAAmB,MAAM;YAClC,2EAA2E;YAC3EpB,UAAUR,iBAAiB,CAAC4B,mBAAmB,MAAM,GAAG,KAAKL,gBAAgB,CAACK,mBAAmB,MAAM,CAAC;YACxGnB,WAAWmB,mBAAmB7B,KAAK8B,QAAQ,CAAClB,IAAI,GAAIZ,KAAK8B,QAAQ,CAACK,IAAI,IAAI,GAAGX,cAAc;YAC3FX,aAAa;YACbC,YAAY;QACd;IACF;IAEQkB,gBAAgBC,OAAe,EAAU;QAC/C,+CAA+C;QAC/C,MAAMG,gBAAwC;YAC5C,MAAM;YAAW,iBAAiB;YAClC,MAAM;YAAW,kBAAkB;YACnC,MAAM;YAAW,WAAW;YAC5B,MAAM;YAAW,UAAU;YAC3B,MAAM;YAAW,SAAS;YAC1B,MAAM;YAAW,aAAa;YAC9B,MAAM;YAAW,UAAU;YAC3B,MAAM;YAAW,UAAU;YAC3B,MAAM;YAAW,SAAS;YAC1B,MAAM;YAAW,UAAU;YAC3B,MAAM;YAAW,SAAS;YAC1B,MAAM;YAAW,eAAe;YAChC,MAAM;YAAW,SAAS;YAC1B,MAAM;YAAW,SAAS;QAC5B;QAEA,OAAOA,aAAa,CAACH,QAAQ,IAAI,WAAW,eAAe;IAC7D;IAEAlB,WAAWf,IAAgB,EAAEgB,SAAiB,EAAW;QACvD,OAAOA,aAAa,KAAKA,aAAa,GAAG,sDAAsD;IACjG;IAEAC,kBAAkBjB,IAAgB,EAAEkB,eAAkC,EAAQ;QAC5E,IAAIA,oBAAoB,SAAS;YAC/B,IAAIlB,KAAKW,QAAQ,CAACc,MAAM,KAAK,GAAG;gBAC9B,iEAAiE;gBACjEN,OAAOC,aAAa,CAAC,IAAIC,YAAY,mBAAmB;oBACtDC,QAAQtB,KAAKW,QAAQ,CAAC,EAAE;gBAC1B;YACF,OAAO;gBACL,gDAAgD;gBAChD,MAAM0B,iBAAiBrC,KAAKW,QAAQ,CAAC2B,MAAM,CAAC,CAACC,MAAMC,UACjD,AAACA,QAAQC,SAAS,GAAGF,KAAKE,SAAS,GAAID,UAAUD;gBAEnDpB,OAAOC,aAAa,CAAC,IAAIC,YAAY,mBAAmB;oBACtDC,QAAQe;gBACV;YACF;QACF;IACF;AACF;AAEO,MAAMK;IACHC,aAAa,IAAIC,MAAkC;IAE3DF,aAAc;QACZ,IAAI,CAACC,UAAU,CAACE,GAAG,CAAC,UAAU,IAAI/C;QAClC,IAAI,CAAC6C,UAAU,CAACE,GAAG,CAAC,WAAW,IAAItB;IACrC;IAEAuB,aAAa9C,IAAgB,EAAEC,cAAsB,EAGnD;QACA,MAAM8C,WAAW,IAAI,CAACJ,UAAU,CAACK,GAAG,CAAChD,KAAK+B,IAAI,KAAK,IAAI,CAACY,UAAU,CAACK,GAAG,CAAC;QAEvE,OAAO;YACLC,OAAOF,SAAShD,cAAc,CAACC,MAAMC;YACrC8C;QACF;IACF;IAEAG,iBAAiBlD,IAAgB,EAAEgB,SAAiB,EAAW;QAC7D,MAAM+B,WAAW,IAAI,CAACJ,UAAU,CAACK,GAAG,CAAChD,KAAK+B,IAAI,KAAK,IAAI,CAACY,UAAU,CAACK,GAAG,CAAC;QACvE,OAAOD,SAAShC,UAAU,CAACf,MAAMgB;IACnC;AACF"}},
    {"offset": {"line": 9045, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/repositories/StationRepository.ts"],"sourcesContent":["import { IStationRepository } from \"../domain/interfaces\";\nimport { RadioStation } from \"../types\";\nimport { radioDiscoveryService } from \"../services/radioDiscoveryService\";\n\n/**\n * Concrete implementation of station repository using radioDiscoveryService\n * Follows Repository pattern to abstract data access\n */\nexport class StationRepository implements IStationRepository {\n  private cache = new Map<string, RadioStation[]>();\n  private readonly cacheTimeout = 5 * 60 * 1000; // 5 minutes\n  private cacheTimestamps = new Map<string, number>();\n\n  async getStationsByRegion(region: string): Promise<RadioStation[]> {\n    const cacheKey = `region:${region}`;\n    \n    if (this.isValidCache(cacheKey)) {\n      return this.cache.get(cacheKey) || [];\n    }\n\n    try {\n      // For better distribution, get diverse global stations\n      const stations = await radioDiscoveryService.getGlobalStationsWithDistribution();\n      this.updateCache(cacheKey, stations);\n      return stations;\n    } catch (error) {\n      console.error(`Failed to fetch stations for region ${region}:`, error);\n      return this.cache.get(cacheKey) || [];\n    }\n  }\n\n  async getGlobalStationsWithDistribution(): Promise<RadioStation[]> {\n    const cacheKey = 'global_distribution';\n    \n    if (this.isValidCache(cacheKey)) {\n      return this.cache.get(cacheKey) || [];\n    }\n\n    try {\n      // Use the new getAllStations method with IndexedDB caching\n      const stations = await radioDiscoveryService.getAllStations();\n      this.updateCache(cacheKey, stations);\n      console.log(`StationRepository: Loaded ${stations.length} stations`);\n      return stations;\n    } catch (error) {\n      console.error('Failed to fetch all stations:', error);\n      // Try cache first before falling back\n      const cached = this.cache.get(cacheKey);\n      if (cached) return cached;\n      \n      // Last resort fallback\n      const fallback = await radioDiscoveryService.getTopStations(5000);\n      this.updateCache(cacheKey, fallback);\n      return fallback;\n    }\n  }\n\n  async getStationsByCountry(country: string): Promise<RadioStation[]> {\n    const cacheKey = `country:${country}`;\n    \n    if (this.isValidCache(cacheKey)) {\n      return this.cache.get(cacheKey) || [];\n    }\n\n    try {\n      const stations = await radioDiscoveryService.getStationsByCountry(country);\n      this.updateCache(cacheKey, stations);\n      return stations;\n    } catch (error) {\n      console.error(`Failed to fetch stations for country ${country}:`, error);\n      return this.cache.get(cacheKey) || [];\n    }\n  }\n\n  async getStationsByGenre(genre: string): Promise<RadioStation[]> {\n    const cacheKey = `genre:${genre}`;\n    \n    if (this.isValidCache(cacheKey)) {\n      return this.cache.get(cacheKey) || [];\n    }\n\n    try {\n      const stations = await radioDiscoveryService.getStationsByTag(genre);\n      this.updateCache(cacheKey, stations);\n      return stations;\n    } catch (error) {\n      console.error(`Failed to fetch stations for genre ${genre}:`, error);\n      return this.cache.get(cacheKey) || [];\n    }\n  }\n\n  async searchStations(query: string): Promise<RadioStation[]> {\n    const cacheKey = `search:${query.toLowerCase()}`;\n    \n    if (this.isValidCache(cacheKey)) {\n      return this.cache.get(cacheKey) || [];\n    }\n\n    try {\n      const stations = await radioDiscoveryService.searchOnlineStations(query);\n      this.updateCache(cacheKey, stations);\n      return stations;\n    } catch (error) {\n      console.error(`Failed to search stations for query ${query}:`, error);\n      return this.cache.get(cacheKey) || [];\n    }\n  }\n\n  async getProgressiveStations(limit: number, offset: number): Promise<RadioStation[]> {\n    const cacheKey = `progressive:${limit}:${offset}`;\n    \n    if (this.isValidCache(cacheKey)) {\n      return this.cache.get(cacheKey) || [];\n    }\n\n    try {\n      // Use zoomLevel calculation based on limit for progressive loading\n      const zoomLevel = Math.max(1, Math.floor(limit / 100));\n      const stations = await radioDiscoveryService.getProgressiveStations(zoomLevel);\n      \n      // Apply offset and limit manually since the service doesn't support it directly\n      const paginatedStations = stations.slice(offset, offset + limit);\n      \n      this.updateCache(cacheKey, paginatedStations);\n      return paginatedStations;\n    } catch (error) {\n      console.error(`Failed to fetch progressive stations:`, error);\n      return this.cache.get(cacheKey) || [];\n    }\n  }\n\n  async getPopularStations(limit: number = 50): Promise<RadioStation[]> {\n    const cacheKey = `popular:${limit}`;\n    \n    if (this.isValidCache(cacheKey)) {\n      return this.cache.get(cacheKey) || [];\n    }\n\n    try {\n      const stations = await radioDiscoveryService.getTopStations(limit);\n      this.updateCache(cacheKey, stations);\n      return stations;\n    } catch (error) {\n      console.error(`Failed to fetch popular stations:`, error);\n      return this.cache.get(cacheKey) || [];\n    }\n  }\n\n  /**\n   * Clear cache for specific key or all cache\n   */\n  clearCache(key?: string): void {\n    if (key) {\n      this.cache.delete(key);\n      this.cacheTimestamps.delete(key);\n    } else {\n      this.cache.clear();\n      this.cacheTimestamps.clear();\n    }\n  }\n\n  /**\n   * Get cache statistics for monitoring\n   */\n  getCacheStats(): { size: number; keys: string[] } {\n    return {\n      size: this.cache.size,\n      keys: Array.from(this.cache.keys())\n    };\n  }\n\n  private isValidCache(key: string): boolean {\n    const timestamp = this.cacheTimestamps.get(key);\n    if (!timestamp) return false;\n    \n    const now = Date.now();\n    return (now - timestamp) < this.cacheTimeout;\n  }\n\n  private updateCache(key: string, data: RadioStation[]): void {\n    this.cache.set(key, data);\n    this.cacheTimestamps.set(key, Date.now());\n  }\n}\n\n// Export singleton instance\nexport const stationRepository = new StationRepository();"],"names":["StationRepository","cache","Map","cacheTimeout","cacheTimestamps","getStationsByRegion","region","cacheKey","isValidCache","get","stations","getGlobalStationsWithDistribution","updateCache","error","console","getAllStations","log","length","cached","fallback","getTopStations","getStationsByCountry","country","getStationsByGenre","genre","getStationsByTag","searchStations","query","toLowerCase","searchOnlineStations","getProgressiveStations","limit","offset","zoomLevel","Math","max","floor","paginatedStations","slice","getPopularStations","clearCache","key","delete","clear","getCacheStats","size","keys","Array","from","timestamp","now","Date","data","set","stationRepository"],"mappings":"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"}},
    {"offset": {"line": 9203, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/infrastructure/ServiceContainer.ts"],"sourcesContent":["import { IStationLoadingUseCase, IStationSelectionUseCase } from \"../domain/usecases\";\nimport { StationLoadingUseCase, StationSelectionUseCase } from \"../usecases/StationUseCases\";\nimport { MarkerFactory } from \"../strategies/MarkerStrategy\";\nimport { StationRepository } from \"../repositories/StationRepository\";\nimport { GlobeEventBus } from \"../events/GlobeEventBus\";\nimport { CommandInvoker } from \"../commands/GlobeCommands\";\n\n/**\n * Dependency Injection Container\n * Manages service instances and their dependencies using Singleton pattern\n * Implements Inversion of Control (IoC) principle\n */\nclass ServiceContainer {\n  private static instance: ServiceContainer;\n  private services = new Map<string, any>();\n  private singletons = new Map<string, any>();\n\n  private constructor() {\n    this.registerServices();\n  }\n\n  static getInstance(): ServiceContainer {\n    if (!ServiceContainer.instance) {\n      ServiceContainer.instance = new ServiceContainer();\n    }\n    return ServiceContainer.instance;\n  }\n\n  private registerServices(): void {\n    // Register Repositories (Singleton)\n    this.registerSingleton(\"StationRepository\", () => new StationRepository());\n    \n    // Register Event Bus (Singleton)\n    this.registerSingleton(\"GlobeEventBus\", () => new GlobeEventBus());\n    \n    // Register Command Invoker (Singleton)\n    this.registerSingleton(\"CommandInvoker\", () => new CommandInvoker());\n    \n    // Register Use Cases (Factory - new instance each time)\n    this.register(\"StationLoadingUseCase\", () => \n      new StationLoadingUseCase(\n        this.resolveSingleton(\"StationRepository\"),\n        this.resolveSingleton(\"GlobeEventBus\")\n      )\n    );\n    \n    this.register(\"StationSelectionUseCase\", () => \n      new StationSelectionUseCase(\n        this.resolveSingleton(\"GlobeEventBus\"),\n        this.resolveSingleton(\"CommandInvoker\")\n      )\n    );\n    \n    // Register Factories (Factory - new instance each time)\n    this.register(\"MarkerFactory\", () => new MarkerFactory());\n  }\n\n  /**\n   * Register a factory function for transient services (new instance each time)\n   */\n  register<T>(key: string, factory: () => T): void {\n    this.services.set(key, factory);\n  }\n\n  /**\n   * Register a factory function for singleton services (same instance always)\n   */\n  registerSingleton<T>(key: string, factory: () => T): void {\n    this.services.set(key, factory);\n  }\n\n  /**\n   * Resolve a transient service (new instance each time)\n   */\n  resolve<T>(key: string): T {\n    const factory = this.services.get(key);\n    if (!factory) {\n      throw new Error(`Service ${key} not registered`);\n    }\n    return factory();\n  }\n\n  /**\n   * Resolve a singleton service (cached instance)\n   */\n  resolveSingleton<T>(key: string): T {\n    // Check if already instantiated\n    if (this.singletons.has(key)) {\n      return this.singletons.get(key);\n    }\n\n    // Create and cache instance\n    const factory = this.services.get(key);\n    if (!factory) {\n      throw new Error(`Service ${key} not registered`);\n    }\n    \n    const instance = factory();\n    this.singletons.set(key, instance);\n    return instance;\n  }\n\n  /**\n   * Clear all singleton instances (useful for testing)\n   */\n  clearSingletons(): void {\n    this.singletons.clear();\n  }\n\n  /**\n   * Get service registry information\n   */\n  getServiceInfo(): { \n    registeredServices: string[]; \n    activeSingletons: string[];\n    totalServices: number;\n  } {\n    return {\n      registeredServices: Array.from(this.services.keys()),\n      activeSingletons: Array.from(this.singletons.keys()),\n      totalServices: this.services.size\n    };\n  }\n\n  // Legacy methods for backward compatibility\n  get<T>(key: string): T {\n    if (this.services.has(key)) {\n      return this.resolve(key);\n    }\n    throw new Error(`Service ${key} not found`);\n  }\n\n  // Convenience methods for common services\n  getStationLoadingUseCase(): IStationLoadingUseCase {\n    return this.resolve(\"StationLoadingUseCase\");\n  }\n\n  getStationSelectionUseCase(): IStationSelectionUseCase {\n    return this.resolve(\"StationSelectionUseCase\");\n  }\n\n  getMarkerFactory(): MarkerFactory {\n    return this.resolve(\"MarkerFactory\");\n  }\n\n  getStationRepository(): StationRepository {\n    return this.resolveSingleton(\"StationRepository\");\n  }\n\n  getGlobeEventBus(): GlobeEventBus {\n    return this.resolveSingleton(\"GlobeEventBus\");\n  }\n\n  getCommandInvoker(): CommandInvoker {\n    return this.resolveSingleton(\"CommandInvoker\");\n  }\n}\n\n// Export factory functions for clean dependency injection\nexport const createStationLoadingUseCase = (): IStationLoadingUseCase => \n  ServiceContainer.getInstance().getStationLoadingUseCase();\n\nexport const createStationSelectionUseCase = (): IStationSelectionUseCase =>\n  ServiceContainer.getInstance().getStationSelectionUseCase();\n\nexport const createMarkerFactory = (): MarkerFactory =>\n  ServiceContainer.getInstance().getMarkerFactory();\n\nexport const createStationRepository = (): StationRepository =>\n  ServiceContainer.getInstance().getStationRepository();\n\nexport const createGlobeEventBus = (): GlobeEventBus => {\n  const eventBus = ServiceContainer.getInstance().getGlobeEventBus();\n  console.log('ServiceContainer: Creating/returning GlobeEventBus instance:', eventBus);\n  return eventBus;\n}\n\nexport const createCommandInvoker = (): CommandInvoker =>\n  ServiceContainer.getInstance().getCommandInvoker();"],"names":["ServiceContainer","instance","services","Map","singletons","registerServices","getInstance","registerSingleton","register","resolveSingleton","key","factory","set","resolve","get","Error","has","clearSingletons","clear","getServiceInfo","registeredServices","Array","from","keys","activeSingletons","totalServices","size","getStationLoadingUseCase","getStationSelectionUseCase","getMarkerFactory","getStationRepository","getGlobeEventBus","getCommandInvoker","createStationLoadingUseCase","createStationSelectionUseCase","createMarkerFactory","createStationRepository","createGlobeEventBus","eventBus","console","log","createCommandInvoker"],"mappings":"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"}},
    {"offset": {"line": 9347, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/hooks/useStationCount.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { GlobeEventType, createGlobeEvent } from '../events/GlobeEventBus';\nimport { createGlobeEventBus } from '../infrastructure/ServiceContainer';\n\n/**\n * Hook to listen to station loading events from the new architecture\n */\nexport function useStationCount() {\n  const [stationCount, setStationCount] = useState(0);\n  \n  useEffect(() => {\n    const eventBus = createGlobeEventBus();\n    \n    // Create observer manually since we're in a React hook\n    const observerId = 'useStationCount-hook';\n    \n    const observer = {\n      getObserverId: () => observerId,\n      onEvent: (event: any) => {\n        if (event.type === GlobeEventType.STATIONS_LOADED) {\n          const count = event.data?.count || 0;\n          setStationCount(count);\n        }\n      }\n    };\n    \n    // Subscribe to station loading events\n    eventBus.subscribe(observer, [GlobeEventType.STATIONS_LOADED]);\n    \n    return () => {\n      eventBus.unsubscribe(observerId);\n    };\n  }, []);\n  \n  return stationCount;\n}"],"names":["useStationCount","stationCount","setStationCount","eventBus","observerId","observer","getObserverId","onEvent","event","type","STATIONS_LOADED","count","data","subscribe","unsubscribe"],"mappings":";;;;AAAA;AACA;AACA;;;;AAKO,SAASA;IACd,MAAM,CAACC,cAAcC,gBAAgB,GAAG,IAAA,gOAAQ,EAAC;IAEjD,IAAA,iOAAS,EAAC;QACR,MAAMC,WAAW,IAAA,+KAAmB;QAEpC,uDAAuD;QACvD,MAAMC,aAAa;QAEnB,MAAMC,WAAW;YACfC,eAAe,IAAMF;YACrBG,SAAS,CAACC;gBACR,IAAIA,MAAMC,IAAI,KAAK,+JAAc,CAACC,eAAe,EAAE;oBACjD,MAAMC,QAAQH,MAAMI,IAAI,EAAED,SAAS;oBACnCT,gBAAgBS;gBAClB;YACF;QACF;QAEA,sCAAsC;QACtCR,SAASU,SAAS,CAACR,UAAU;YAAC,+JAAc,CAACK,eAAe;SAAC;QAE7D,OAAO;YACLP,SAASW,WAAW,CAACV;QACvB;IACF,GAAG,EAAE;IAEL,OAAOH;AACT"}},
    {"offset": {"line": 9386, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { CesiumGlobe } from \"../components/CesiumGlobe\";\nimport { ModularAudioPlayer } from \"../components/ModularAudioPlayer\";\nimport { StationPanel } from \"../components/StationPanel\";\nimport { SearchPanel } from \"../components/SearchPanel\";\nimport { StationDirectory } from \"../components/StationDirectory\";\nimport { UserPanel } from \"../components/UserPanel\";\nimport { useGlobeStore } from \"../stores/globe-store\";\nimport { useStationCount } from \"../hooks/useStationCount\";\n// import { globalRadioStations } from '../data/globalRadioStations'\nimport { radioDiscoveryService } from \"../services/radioDiscoveryService\";\nimport { motion } from \"framer-motion\";\nimport { Radio, Menu, X, List } from \"lucide-react\";\n\nexport default function Home() {\n  const { selectedStation, addMarker, selectStation } = useGlobeStore();\n  const stationCount = useStationCount(); // Use new architecture station count\n  const [isMobile, setIsMobile] = useState(false);\n  const [showDirectory, setShowDirectory] = useState(false);\n  const [showMobileMenu, setShowMobileMenu] = useState(false);\n\n  // Listen for station selection from 3D globe\n  useEffect(() => {\n    const handleStationSelected = (event: CustomEvent) => {\n      const station = event.detail;\n      if (station) {\n        console.log('Station selected from globe:', station);\n        selectStation(station);\n      }\n    };\n\n    window.addEventListener('stationSelected', handleStationSelected as EventListener);\n    return () => window.removeEventListener('stationSelected', handleStationSelected as EventListener);\n  }, [selectStation]);\n\n  // Detect mobile device and screen size\n  useEffect(() => {\n    const checkIfMobile = () => {\n      setIsMobile(window.innerWidth < 768 || \"ontouchstart\" in window);\n    };\n\n    checkIfMobile();\n    window.addEventListener(\"resize\", checkIfMobile);\n    return () => window.removeEventListener(\"resize\", checkIfMobile);\n  }, []);\n\n  return (\n    <main className=\"relative h-screen w-screen overflow-hidden bg-black\">\n      {/* 3D Globe with Three.js */}\n      <div className=\"absolute inset-0\">\n        <Globe />\n      </div>\n\n      {/* Top Bar */}\n      <motion.div\n        className=\"absolute top-0 left-0 right-0 z-40 p-6\"\n        initial={{ y: -100 }}\n        animate={{ y: 0 }}\n        transition={{ delay: 0.5 }}\n      >\n        <div className=\"flex items-center justify-between\">\n          {/* Logo */}\n          <motion.div\n            className=\"flex items-center gap-3 glass rounded-2xl px-6 py-3\"\n            whileHover={{ scale: 1.02 }}\n            transition={{ type: \"spring\", stiffness: 300 }}\n          >\n            <div className=\"relative\">\n              <Radio className=\"w-8 h-8 text-gradient\" />\n              <div className=\"absolute inset-0 animate-pulse-glow rounded-full bg-blue-400/20\" />\n            </div>\n            <div>\n              <h1 className=\"text-2xl font-bold text-gradient tracking-tight\">\n                Radio Globe\n              </h1>\n              <p className=\"text-sm text-gray-400 font-mono\">\n                Discover global radio stations\n              </p>\n            </div>\n          </motion.div>\n\n          {/* Desktop Navigation */}\n          {!isMobile && (\n            <div className=\"flex items-center gap-4\">\n              <SearchPanel />\n              <motion.button\n                onClick={() => setShowDirectory(!showDirectory)}\n                className={`glass px-6 py-3 rounded-xl flex items-center gap-3 transition-all font-medium ${\n                  showDirectory\n                    ? \"bg-gradient-to-r from-blue-500/30 to-cyan-500/30 text-cyan-300 border-cyan-400/30\"\n                    : \"text-white hover:bg-white/10 border-white/10\"\n                }`}\n                whileHover={{ scale: 1.02 }}\n                whileTap={{ scale: 0.98 }}\n              >\n                <List className=\"w-5 h-5\" />\n                <span className=\"text-sm tracking-wide\">Directory</span>\n                <div className=\"text-xs font-mono opacity-60\">\n                  {stationCount}\n                </div>\n              </motion.button>\n            </div>\n          )}\n\n          {/* Mobile Menu Button */}\n          {isMobile && (\n            <motion.button\n              onClick={() => setShowMobileMenu(!showMobileMenu)}\n              className=\"glass p-3 rounded-lg text-white\"\n              whileHover={{ scale: 1.05 }}\n            >\n              {showMobileMenu ? (\n                <X className=\"w-5 h-5\" />\n              ) : (\n                <Menu className=\"w-5 h-5\" />\n              )}\n            </motion.button>\n          )}\n        </div>\n      </motion.div>\n\n      {/* Station Directory Panel */}\n      {showDirectory && !isMobile && (\n        <motion.div\n          className=\"absolute top-20 left-4 z-50 w-96\"\n          initial={{ x: -400, opacity: 0 }}\n          animate={{ x: 0, opacity: 1 }}\n          exit={{ x: -400, opacity: 0 }}\n        >\n          <StationDirectory />\n        </motion.div>\n      )}\n\n      {/* Station Info Panel */}\n      {selectedStation && (\n        <motion.div\n          className={`absolute ${isMobile ? \"bottom-20 left-3 right-3\" : \"top-20 left-4\"} z-50`}\n          initial={{\n            x: isMobile ? 0 : -400,\n            y: isMobile ? 100 : 0,\n            opacity: 0,\n          }}\n          animate={{ x: 0, y: 0, opacity: 1 }}\n          exit={{ x: isMobile ? 0 : -400, y: isMobile ? 100 : 0, opacity: 0 }}\n        >\n          <StationPanel station={selectedStation} />\n        </motion.div>\n      )}\n\n      {/* Bottom Controls */}\n      <motion.div\n        className=\"absolute bottom-0 left-0 right-0 z-40\"\n        initial={{ y: 100 }}\n        animate={{ y: 0 }}\n        transition={{ delay: 0.7 }}\n      >\n        <div className=\"p-4\">\n          <div className=\"flex items-center justify-between\">\n            {/* User Panel - Desktop */}\n            {!isMobile && <UserPanel />}\n\n            {/* Audio Player */}\n            <div className=\"flex-1 max-w-2xl mx-4\">\n              <ModularAudioPlayer\n                showVisualizer={!isMobile}\n                compactMode={isMobile}\n                autoPlay={false}\n              />\n            </div>\n\n            {/* Mobile Controls */}\n            {isMobile && (\n              <div className=\"flex items-center gap-2\">\n                <motion.button\n                  onClick={() => setShowDirectory(!showDirectory)}\n                  className={`glass p-3 rounded-lg transition-colors ${\n                    showDirectory\n                      ? \"bg-blue-500/20 text-blue-300\"\n                      : \"text-white\"\n                  }`}\n                  whileHover={{ scale: 1.05 }}\n                >\n                  <List className=\"w-5 h-5\" />\n                </motion.button>\n              </div>\n            )}\n\n            {/* Desktop Stats */}\n            {!isMobile && (\n              <motion.div \n                className=\"glass px-6 py-4 rounded-2xl flex-shrink-0 border border-white/10\"\n                whileHover={{ scale: 1.02 }}\n                transition={{ type: \"spring\", stiffness: 300 }}\n              >\n                <div className=\"text-center\">\n                  <div className=\"text-xs text-gray-400 font-mono uppercase tracking-wide\">\n                    Global Stations\n                  </div>\n                  <div className=\"text-3xl font-bold text-gradient mt-1\">\n                    {stationCount}\n                  </div>\n                </div>\n              </motion.div>\n            )}\n          </div>\n        </div>\n      </motion.div>\n\n      {/* Mobile Menu Overlay */}\n      {showMobileMenu && isMobile && (\n        <motion.div\n          className=\"absolute inset-0 z-50\"\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n        >\n          <div\n            className=\"absolute inset-0 bg-black/80\"\n            onClick={() => setShowMobileMenu(false)}\n          />\n          <motion.div\n            className=\"absolute top-0 right-0 h-full w-80 glass p-6\"\n            initial={{ x: 320 }}\n            animate={{ x: 0 }}\n            exit={{ x: 320 }}\n          >\n            <div className=\"space-y-6\">\n              <div className=\"flex items-center justify-between\">\n                <h2 className=\"text-xl font-bold text-white\">Menu</h2>\n                <button\n                  onClick={() => setShowMobileMenu(false)}\n                  className=\"p-2 hover:bg-white/10 rounded-lg transition-colors\"\n                >\n                  <X className=\"w-5 h-5 text-white\" />\n                </button>\n              </div>\n\n              <div className=\"space-y-4\">\n                <SearchPanel />\n\n                <motion.button\n                  onClick={() => {\n                    setShowDirectory(!showDirectory);\n                    setShowMobileMenu(false);\n                  }}\n                  className=\"w-full glass p-4 rounded-lg flex items-center gap-3 text-left\"\n                  whileHover={{ scale: 1.02 }}\n                >\n                  <List className=\"w-5 h-5 text-blue-400\" />\n                  <div>\n                    <div className=\"font-medium text-white\">\n                      Station Directory\n                    </div>\n                    <div className=\"text-xs text-gray-400\">\n                      Browse all stations\n                    </div>\n                  </div>\n                </motion.button>\n\n                <UserPanel />\n              </div>\n            </div>\n          </motion.div>\n        </motion.div>\n      )}\n\n      {/* Mobile Directory Overlay */}\n      {showDirectory && isMobile && (\n        <motion.div\n          className=\"absolute inset-0 z-50\"\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n        >\n          <div\n            className=\"absolute inset-0 bg-black/80\"\n            onClick={() => setShowDirectory(false)}\n          />\n          <motion.div\n            className=\"absolute top-20 bottom-20 left-4 right-4 rounded-xl overflow-hidden\"\n            initial={{ scale: 0.8, opacity: 0 }}\n            animate={{ scale: 1, opacity: 1 }}\n            exit={{ scale: 0.8, opacity: 0 }}\n          >\n            <StationDirectory />\n          </motion.div>\n        </motion.div>\n      )}\n\n      {/* Loading Screen */}\n      <motion.div\n        className=\"absolute inset-0 z-50 bg-black flex items-center justify-center\"\n        initial={{ opacity: 1 }}\n        animate={{ opacity: 0 }}\n        transition={{ delay: 1, duration: 0.5 }}\n        style={{ pointerEvents: \"none\" }}\n      >\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-white text-lg\">Loading Radio Globe...</p>\n          <p className=\"text-gray-400 text-sm\">\n            Connecting to global stations...\n          </p>\n        </div>\n      </motion.div>\n    </main>\n  );\n}\n"],"names":["Home","selectedStation","addMarker","selectStation","stationCount","isMobile","setIsMobile","showDirectory","setShowDirectory","showMobileMenu","setShowMobileMenu","handleStationSelected","event","station","detail","console","log","window","addEventListener","removeEventListener","checkIfMobile","innerWidth","className","Globe","div","initial","y","animate","transition","delay","whileHover","scale","type","stiffness","button","onClick","whileTap","x","opacity","exit","showVisualizer","compactMode","autoPlay","duration","style","pointerEvents"],"mappings":"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"}}]
}