{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/node_modules/%40cesium/engine/Source/DataSources/KmlDataSource.js"],"sourcesContent":["import ArcType from \"../Core/ArcType.js\";\nimport AssociativeArray from \"../Core/AssociativeArray.js\";\nimport BoundingRectangle from \"../Core/BoundingRectangle.js\";\nimport buildModuleUrl from \"../Core/buildModuleUrl.js\";\nimport Cartesian2 from \"../Core/Cartesian2.js\";\nimport Cartesian3 from \"../Core/Cartesian3.js\";\nimport Cartographic from \"../Core/Cartographic.js\";\nimport ClockRange from \"../Core/ClockRange.js\";\nimport ClockStep from \"../Core/ClockStep.js\";\nimport clone from \"../Core/clone.js\";\nimport Color from \"../Core/Color.js\";\nimport createGuid from \"../Core/createGuid.js\";\nimport Credit from \"../Core/Credit.js\";\nimport Frozen from \"../Core/Frozen.js\";\nimport defer from \"../Core/defer.js\";\nimport defined from \"../Core/defined.js\";\nimport DeveloperError from \"../Core/DeveloperError.js\";\nimport Ellipsoid from \"../Core/Ellipsoid.js\";\nimport Event from \"../Core/Event.js\";\nimport getExtensionFromUri from \"../Core/getExtensionFromUri.js\";\nimport getFilenameFromUri from \"../Core/getFilenameFromUri.js\";\nimport getTimestamp from \"../Core/getTimestamp.js\";\nimport HeadingPitchRange from \"../Core/HeadingPitchRange.js\";\nimport HeadingPitchRoll from \"../Core/HeadingPitchRoll.js\";\nimport Iso8601 from \"../Core/Iso8601.js\";\nimport JulianDate from \"../Core/JulianDate.js\";\nimport CesiumMath from \"../Core/Math.js\";\nimport NearFarScalar from \"../Core/NearFarScalar.js\";\nimport objectToQuery from \"../Core/objectToQuery.js\";\nimport oneTimeWarning from \"../Core/oneTimeWarning.js\";\nimport PinBuilder from \"../Core/PinBuilder.js\";\nimport PolygonHierarchy from \"../Core/PolygonHierarchy.js\";\nimport queryToObject from \"../Core/queryToObject.js\";\nimport Rectangle from \"../Core/Rectangle.js\";\nimport Resource from \"../Core/Resource.js\";\nimport RuntimeError from \"../Core/RuntimeError.js\";\nimport TimeInterval from \"../Core/TimeInterval.js\";\nimport TimeIntervalCollection from \"../Core/TimeIntervalCollection.js\";\nimport HeightReference from \"../Scene/HeightReference.js\";\nimport HorizontalOrigin from \"../Scene/HorizontalOrigin.js\";\nimport LabelStyle from \"../Scene/LabelStyle.js\";\nimport SceneMode from \"../Scene/SceneMode.js\";\nimport Autolinker from \"autolinker\";\nimport Uri from \"urijs\";\nimport {\n  configure,\n  BlobReader,\n  Data64URIWriter,\n  TextWriter,\n  ZipReader,\n} from \"@zip.js/zip.js/lib/zip-core.js\";\nimport getElement from \"./getElement.js\";\nimport BillboardGraphics from \"./BillboardGraphics.js\";\nimport CompositePositionProperty from \"./CompositePositionProperty.js\";\nimport DataSource from \"./DataSource.js\";\nimport DataSourceClock from \"./DataSourceClock.js\";\nimport Entity from \"./Entity.js\";\nimport EntityCluster from \"./EntityCluster.js\";\nimport EntityCollection from \"./EntityCollection.js\";\nimport KmlCamera from \"./KmlCamera.js\";\nimport KmlLookAt from \"./KmlLookAt.js\";\nimport KmlTour from \"./KmlTour.js\";\nimport KmlTourFlyTo from \"./KmlTourFlyTo.js\";\nimport KmlTourWait from \"./KmlTourWait.js\";\nimport LabelGraphics from \"./LabelGraphics.js\";\nimport PathGraphics from \"./PathGraphics.js\";\nimport PolygonGraphics from \"./PolygonGraphics.js\";\nimport PolylineGraphics from \"./PolylineGraphics.js\";\nimport PositionPropertyArray from \"./PositionPropertyArray.js\";\nimport RectangleGraphics from \"./RectangleGraphics.js\";\nimport ReferenceProperty from \"./ReferenceProperty.js\";\nimport SampledPositionProperty from \"./SampledPositionProperty.js\";\nimport ScaledPositionProperty from \"./ScaledPositionProperty.js\";\nimport TimeIntervalCollectionProperty from \"./TimeIntervalCollectionProperty.js\";\nimport WallGraphics from \"./WallGraphics.js\";\n\n//This is by no means an exhaustive list of MIME types.\n//The purpose of this list is to be able to accurately identify content embedded\n//in KMZ files. Eventually, we can make this configurable by the end user so they can add\n//there own content types if they have KMZ files that require it.\nconst MimeTypes = {\n  avi: \"video/x-msvideo\",\n  bmp: \"image/bmp\",\n  bz2: \"application/x-bzip2\",\n  chm: \"application/vnd.ms-htmlhelp\",\n  css: \"text/css\",\n  csv: \"text/csv\",\n  doc: \"application/msword\",\n  dvi: \"application/x-dvi\",\n  eps: \"application/postscript\",\n  flv: \"video/x-flv\",\n  gif: \"image/gif\",\n  gz: \"application/x-gzip\",\n  htm: \"text/html\",\n  html: \"text/html\",\n  ico: \"image/vnd.microsoft.icon\",\n  jnlp: \"application/x-java-jnlp-file\",\n  jpeg: \"image/jpeg\",\n  jpg: \"image/jpeg\",\n  m3u: \"audio/x-mpegurl\",\n  m4v: \"video/mp4\",\n  mathml: \"application/mathml+xml\",\n  mid: \"audio/midi\",\n  midi: \"audio/midi\",\n  mov: \"video/quicktime\",\n  mp3: \"audio/mpeg\",\n  mp4: \"video/mp4\",\n  mp4v: \"video/mp4\",\n  mpeg: \"video/mpeg\",\n  mpg: \"video/mpeg\",\n  odp: \"application/vnd.oasis.opendocument.presentation\",\n  ods: \"application/vnd.oasis.opendocument.spreadsheet\",\n  odt: \"application/vnd.oasis.opendocument.text\",\n  ogg: \"application/ogg\",\n  pdf: \"application/pdf\",\n  png: \"image/png\",\n  pps: \"application/vnd.ms-powerpoint\",\n  ppt: \"application/vnd.ms-powerpoint\",\n  ps: \"application/postscript\",\n  qt: \"video/quicktime\",\n  rdf: \"application/rdf+xml\",\n  rss: \"application/rss+xml\",\n  rtf: \"application/rtf\",\n  svg: \"image/svg+xml\",\n  swf: \"application/x-shockwave-flash\",\n  text: \"text/plain\",\n  tif: \"image/tiff\",\n  tiff: \"image/tiff\",\n  txt: \"text/plain\",\n  wav: \"audio/x-wav\",\n  wma: \"audio/x-ms-wma\",\n  wmv: \"video/x-ms-wmv\",\n  xml: \"application/xml\",\n  zip: \"application/zip\",\n\n  detectFromFilename: function (filename) {\n    let ext = filename.toLowerCase();\n    ext = getExtensionFromUri(ext);\n    return MimeTypes[ext];\n  },\n};\n\nlet parser;\nif (typeof DOMParser !== \"undefined\") {\n  parser = new DOMParser();\n}\n\nconst autolinker = new Autolinker({\n  stripPrefix: false,\n  email: false,\n  replaceFn: function (match) {\n    //Prevent matching of non-explicit urls.\n    //i.e. foo.id won't match but http://foo.id will\n    return match.urlMatchType === \"scheme\" || match.urlMatchType === \"www\";\n  },\n});\n\nconst BILLBOARD_SIZE = 32;\n\nconst BILLBOARD_NEAR_DISTANCE = 2414016;\nconst BILLBOARD_NEAR_RATIO = 1.0;\nconst BILLBOARD_FAR_DISTANCE = 1.6093e7;\nconst BILLBOARD_FAR_RATIO = 0.1;\n\nconst kmlNamespaces = [\n  null,\n  undefined,\n  \"http://www.opengis.net/kml/2.2\",\n  \"http://earth.google.com/kml/2.2\",\n  \"http://earth.google.com/kml/2.1\",\n  \"http://earth.google.com/kml/2.0\",\n];\nconst gxNamespaces = [\"http://www.google.com/kml/ext/2.2\"];\nconst atomNamespaces = [\"http://www.w3.org/2005/Atom\"];\nconst namespaces = {\n  kml: kmlNamespaces,\n  gx: gxNamespaces,\n  atom: atomNamespaces,\n  kmlgx: kmlNamespaces.concat(gxNamespaces),\n};\n\n// Ensure Specs/Data/KML/unsupported.kml is kept up to date with these supported types\nconst featureTypes = {\n  Document: processDocument,\n  Folder: processFolder,\n  Placemark: processPlacemark,\n  NetworkLink: processNetworkLink,\n  GroundOverlay: processGroundOverlay,\n  PhotoOverlay: processUnsupportedFeature,\n  ScreenOverlay: processScreenOverlay,\n  Tour: processTour,\n};\n\nfunction DeferredLoading(dataSource) {\n  this._dataSource = dataSource;\n  this._deferred = defer();\n  this._stack = [];\n  this._promises = [];\n  this._timeoutSet = false;\n  this._used = false;\n\n  this._started = 0;\n  this._timeThreshold = 1000; // Initial load is 1 second\n}\n\nObject.defineProperties(DeferredLoading.prototype, {\n  dataSource: {\n    get: function () {\n      return this._dataSource;\n    },\n  },\n});\n\nDeferredLoading.prototype.addNodes = function (nodes, processingData) {\n  this._stack.push({\n    nodes: nodes,\n    index: 0,\n    processingData: processingData,\n  });\n  this._used = true;\n};\n\nDeferredLoading.prototype.addPromise = function (promise) {\n  this._promises.push(promise);\n};\n\nDeferredLoading.prototype.wait = function () {\n  // Case where we had a non-document/folder as the root\n  const deferred = this._deferred;\n  if (!this._used) {\n    deferred.resolve();\n  }\n\n  return Promise.all([deferred.promise, Promise.all(this._promises)]);\n};\n\nDeferredLoading.prototype.process = function () {\n  const isFirstCall = this._stack.length === 1;\n  if (isFirstCall) {\n    this._started = KmlDataSource._getTimestamp();\n  }\n\n  return this._process(isFirstCall);\n};\n\nDeferredLoading.prototype._giveUpTime = function () {\n  if (this._timeoutSet) {\n    // Timeout was already set so just return\n    return;\n  }\n\n  this._timeoutSet = true;\n  this._timeThreshold = 50; // After the first load lower threshold to 0.5 seconds\n  const that = this;\n  setTimeout(function () {\n    that._timeoutSet = false;\n    that._started = KmlDataSource._getTimestamp();\n    that._process(true);\n  }, 0);\n};\n\nDeferredLoading.prototype._nextNode = function () {\n  const stack = this._stack;\n  const top = stack[stack.length - 1];\n  const index = top.index;\n  const nodes = top.nodes;\n  if (index === nodes.length) {\n    return;\n  }\n  ++top.index;\n\n  return nodes[index];\n};\n\nDeferredLoading.prototype._pop = function () {\n  const stack = this._stack;\n  stack.pop();\n\n  // Return false if we are done\n  if (stack.length === 0) {\n    this._deferred.resolve();\n    return false;\n  }\n\n  return true;\n};\n\nDeferredLoading.prototype._process = function (isFirstCall) {\n  const dataSource = this.dataSource;\n  const processingData = this._stack[this._stack.length - 1].processingData;\n\n  let child = this._nextNode();\n  while (defined(child)) {\n    const featureProcessor = featureTypes[child.localName];\n    if (\n      defined(featureProcessor) &&\n      (namespaces.kml.indexOf(child.namespaceURI) !== -1 ||\n        namespaces.gx.indexOf(child.namespaceURI) !== -1)\n    ) {\n      featureProcessor(dataSource, child, processingData, this);\n\n      // Give up time and continue loading later\n      if (\n        this._timeoutSet ||\n        KmlDataSource._getTimestamp() > this._started + this._timeThreshold\n      ) {\n        this._giveUpTime();\n        return;\n      }\n    }\n\n    child = this._nextNode();\n  }\n\n  // If we are a recursive call from a subfolder, just return so the parent folder can continue processing\n  // If we aren't then make another call to processNodes because there is stuff still left in the queue\n  if (this._pop() && isFirstCall) {\n    this._process(true);\n  }\n};\n\nfunction isZipFile(blob) {\n  const magicBlob = blob.slice(0, Math.min(4, blob.size));\n  const deferred = defer();\n  const reader = new FileReader();\n  reader.addEventListener(\"load\", function () {\n    deferred.resolve(\n      new DataView(reader.result).getUint32(0, false) === 0x504b0304,\n    );\n  });\n  reader.addEventListener(\"error\", function () {\n    deferred.reject(reader.error);\n  });\n  reader.readAsArrayBuffer(magicBlob);\n  return deferred.promise;\n}\n\nfunction readBlobAsText(blob) {\n  const deferred = defer();\n  const reader = new FileReader();\n  reader.addEventListener(\"load\", function () {\n    deferred.resolve(reader.result);\n  });\n  reader.addEventListener(\"error\", function () {\n    deferred.reject(reader.error);\n  });\n  reader.readAsText(blob);\n  return deferred.promise;\n}\n\nfunction insertNamespaces(text) {\n  const namespaceMap = {\n    xsi: \"http://www.w3.org/2001/XMLSchema-instance\",\n  };\n  let firstPart, lastPart, reg, declaration;\n\n  for (const key in namespaceMap) {\n    if (namespaceMap.hasOwnProperty(key)) {\n      reg = RegExp(`[< ]${key}:`);\n      declaration = `xmlns:${key}=`;\n      if (reg.test(text) && text.indexOf(declaration) === -1) {\n        if (!defined(firstPart)) {\n          firstPart = text.substr(0, text.indexOf(\"<kml\") + 4);\n          lastPart = text.substr(firstPart.length);\n        }\n        firstPart += ` ${declaration}\"${namespaceMap[key]}\"`;\n      }\n    }\n  }\n\n  if (defined(firstPart)) {\n    text = firstPart + lastPart;\n  }\n\n  return text;\n}\n\nfunction removeDuplicateNamespaces(text) {\n  let index = text.indexOf(\"xmlns:\");\n  const endDeclaration = text.indexOf(\">\", index);\n  let namespace, startIndex, endIndex;\n\n  while (index !== -1 && index < endDeclaration) {\n    namespace = text.slice(index, text.indexOf('\"', index));\n    startIndex = index;\n    index = text.indexOf(namespace, index + 1);\n    if (index !== -1) {\n      endIndex = text.indexOf('\"', text.indexOf('\"', index) + 1);\n      text = text.slice(0, index - 1) + text.slice(endIndex + 1, text.length);\n      index = text.indexOf(\"xmlns:\", startIndex - 1);\n    } else {\n      index = text.indexOf(\"xmlns:\", startIndex + 1);\n    }\n  }\n\n  return text;\n}\n\nasync function loadXmlFromZip(entry, uriResolver) {\n  let text = await entry.getData(new TextWriter());\n  text = insertNamespaces(text);\n  text = removeDuplicateNamespaces(text);\n  uriResolver.kml = parser.parseFromString(text, \"application/xml\");\n}\n\nasync function loadDataUriFromZip(entry, uriResolver) {\n  const mimeType =\n    MimeTypes.detectFromFilename(entry.filename) ?? \"application/octet-stream\";\n  const dataUri = await entry.getData(new Data64URIWriter(mimeType));\n  uriResolver[entry.filename] = dataUri;\n}\n\nfunction embedDataUris(div, elementType, attributeName, uriResolver) {\n  const keys = uriResolver.keys;\n  const baseUri = new Uri(\".\");\n  const elements = div.querySelectorAll(elementType);\n  for (let i = 0; i < elements.length; i++) {\n    const element = elements[i];\n    const value = element.getAttribute(attributeName);\n    if (defined(value)) {\n      const relativeUri = new Uri(value);\n      const uri = relativeUri.absoluteTo(baseUri).toString();\n      const index = keys.indexOf(uri);\n      if (index !== -1) {\n        const key = keys[index];\n        element.setAttribute(attributeName, uriResolver[key]);\n        if (elementType === \"a\" && element.getAttribute(\"download\") === null) {\n          element.setAttribute(\"download\", key);\n        }\n      }\n    }\n  }\n}\n\nfunction applyBasePath(div, elementType, attributeName, sourceResource) {\n  const elements = div.querySelectorAll(elementType);\n  for (let i = 0; i < elements.length; i++) {\n    const element = elements[i];\n    const value = element.getAttribute(attributeName);\n    const resource = resolveHref(value, sourceResource);\n    if (defined(resource)) {\n      element.setAttribute(attributeName, resource.url);\n    }\n  }\n}\n\n// an optional context is passed to allow for some malformed kmls (those with multiple geometries with same ids) to still parse\n// correctly, as they do in Google Earth.\nfunction createEntity(node, entityCollection, context) {\n  let id = queryStringAttribute(node, \"id\");\n  id = defined(id) && id.length !== 0 ? id : createGuid();\n  if (defined(context)) {\n    id = context + id;\n  }\n\n  // If we have a duplicate ID just generate one.\n  // This isn't valid KML but Google Earth handles this case.\n  let entity = entityCollection.getById(id);\n  if (defined(entity)) {\n    id = createGuid();\n    if (defined(context)) {\n      id = context + id;\n    }\n  }\n\n  entity = entityCollection.add(new Entity({ id: id }));\n  if (!defined(entity.kml)) {\n    entity.addProperty(\"kml\");\n    entity.kml = new KmlFeatureData();\n  }\n  return entity;\n}\n\nfunction isExtrudable(altitudeMode, gxAltitudeMode) {\n  return (\n    altitudeMode === \"absolute\" ||\n    altitudeMode === \"relativeToGround\" ||\n    gxAltitudeMode === \"relativeToSeaFloor\"\n  );\n}\n\nfunction readCoordinate(value, ellipsoid) {\n  //Google Earth treats empty or missing coordinates as 0.\n  if (!defined(value)) {\n    return Cartesian3.fromDegrees(0, 0, 0, ellipsoid);\n  }\n\n  const digits = value.match(/[^\\s,\\n]+/g);\n  if (!defined(digits)) {\n    return Cartesian3.fromDegrees(0, 0, 0, ellipsoid);\n  }\n\n  let longitude = parseFloat(digits[0]);\n  let latitude = parseFloat(digits[1]);\n  let height = parseFloat(digits[2]);\n\n  longitude = isNaN(longitude) ? 0.0 : longitude;\n  latitude = isNaN(latitude) ? 0.0 : latitude;\n  height = isNaN(height) ? 0.0 : height;\n\n  return Cartesian3.fromDegrees(longitude, latitude, height, ellipsoid);\n}\n\nfunction readCoordinates(element, ellipsoid) {\n  if (!defined(element)) {\n    return undefined;\n  }\n\n  const tuples = element.textContent.match(/[^\\s\\n]+/g);\n  if (!defined(tuples)) {\n    return undefined;\n  }\n\n  const length = tuples.length;\n  const result = new Array(length);\n  let resultIndex = 0;\n  for (let i = 0; i < length; i++) {\n    result[resultIndex++] = readCoordinate(tuples[i], ellipsoid);\n  }\n  return result;\n}\n\nfunction queryNumericAttribute(node, attributeName) {\n  if (!defined(node)) {\n    return undefined;\n  }\n\n  const value = node.getAttribute(attributeName);\n  if (value !== null) {\n    const result = parseFloat(value);\n    return !isNaN(result) ? result : undefined;\n  }\n  return undefined;\n}\n\nfunction queryStringAttribute(node, attributeName) {\n  if (!defined(node)) {\n    return undefined;\n  }\n  const value = node.getAttribute(attributeName);\n  return value !== null ? value : undefined;\n}\n\nfunction queryFirstNode(node, tagName, namespace) {\n  if (!defined(node)) {\n    return undefined;\n  }\n  const childNodes = node.childNodes;\n  const length = childNodes.length;\n  for (let q = 0; q < length; q++) {\n    const child = childNodes[q];\n    if (\n      child.localName === tagName &&\n      namespace.indexOf(child.namespaceURI) !== -1\n    ) {\n      return child;\n    }\n  }\n  return undefined;\n}\n\nfunction queryNodes(node, tagName, namespace) {\n  if (!defined(node)) {\n    return undefined;\n  }\n  const result = [];\n  const childNodes = node.getElementsByTagNameNS(\"*\", tagName);\n  const length = childNodes.length;\n  for (let q = 0; q < length; q++) {\n    const child = childNodes[q];\n    if (\n      child.localName === tagName &&\n      namespace.indexOf(child.namespaceURI) !== -1\n    ) {\n      result.push(child);\n    }\n  }\n  return result;\n}\n\nfunction queryChildNodes(node, tagName, namespace) {\n  if (!defined(node)) {\n    return [];\n  }\n  const result = [];\n  const childNodes = node.childNodes;\n  const length = childNodes.length;\n  for (let q = 0; q < length; q++) {\n    const child = childNodes[q];\n    if (\n      child.localName === tagName &&\n      namespace.indexOf(child.namespaceURI) !== -1\n    ) {\n      result.push(child);\n    }\n  }\n  return result;\n}\n\nfunction queryNumericValue(node, tagName, namespace) {\n  const resultNode = queryFirstNode(node, tagName, namespace);\n  if (defined(resultNode)) {\n    const result = parseFloat(resultNode.textContent);\n    return !isNaN(result) ? result : undefined;\n  }\n  return undefined;\n}\n\nfunction queryStringValue(node, tagName, namespace) {\n  const result = queryFirstNode(node, tagName, namespace);\n  if (defined(result)) {\n    return result.textContent.trim();\n  }\n  return undefined;\n}\n\nfunction queryBooleanValue(node, tagName, namespace) {\n  const result = queryFirstNode(node, tagName, namespace);\n  if (defined(result)) {\n    const value = result.textContent.trim();\n    return value === \"1\" || /^true$/i.test(value);\n  }\n  return undefined;\n}\n\nfunction resolveHref(href, sourceResource, uriResolver) {\n  if (!defined(href)) {\n    return undefined;\n  }\n\n  let resource;\n  if (defined(uriResolver)) {\n    // To resolve issues with KML sources defined in Windows style paths.\n    href = href.replace(/\\\\/g, \"/\");\n    let blob = uriResolver[href];\n    if (defined(blob)) {\n      resource = new Resource({\n        url: blob,\n      });\n    } else {\n      // Needed for multiple levels of KML files in a KMZ\n      const baseUri = new Uri(sourceResource.getUrlComponent());\n      const uri = new Uri(href);\n      blob = uriResolver[uri.absoluteTo(baseUri)];\n      if (defined(blob)) {\n        resource = new Resource({\n          url: blob,\n        });\n      }\n    }\n  }\n\n  if (!defined(resource)) {\n    resource = sourceResource.getDerivedResource({\n      url: href,\n    });\n  }\n\n  return resource;\n}\n\nconst colorOptions = {\n  maximumRed: undefined,\n  red: undefined,\n  maximumGreen: undefined,\n  green: undefined,\n  maximumBlue: undefined,\n  blue: undefined,\n};\n\nfunction parseColorString(value, isRandom) {\n  if (!defined(value) || /^\\s*$/gm.test(value)) {\n    return undefined;\n  }\n\n  if (value[0] === \"#\") {\n    value = value.substring(1);\n  }\n\n  const alpha = parseInt(value.substring(0, 2), 16) / 255.0;\n  const blue = parseInt(value.substring(2, 4), 16) / 255.0;\n  const green = parseInt(value.substring(4, 6), 16) / 255.0;\n  const red = parseInt(value.substring(6, 8), 16) / 255.0;\n\n  if (!isRandom) {\n    return new Color(red, green, blue, alpha);\n  }\n\n  if (red > 0) {\n    colorOptions.maximumRed = red;\n    colorOptions.red = undefined;\n  } else {\n    colorOptions.maximumRed = undefined;\n    colorOptions.red = 0;\n  }\n  if (green > 0) {\n    colorOptions.maximumGreen = green;\n    colorOptions.green = undefined;\n  } else {\n    colorOptions.maximumGreen = undefined;\n    colorOptions.green = 0;\n  }\n  if (blue > 0) {\n    colorOptions.maximumBlue = blue;\n    colorOptions.blue = undefined;\n  } else {\n    colorOptions.maximumBlue = undefined;\n    colorOptions.blue = 0;\n  }\n  colorOptions.alpha = alpha;\n  return Color.fromRandom(colorOptions);\n}\n\nfunction queryColorValue(node, tagName, namespace) {\n  const value = queryStringValue(node, tagName, namespace);\n  if (!defined(value)) {\n    return undefined;\n  }\n  return parseColorString(\n    value,\n    queryStringValue(node, \"colorMode\", namespace) === \"random\",\n  );\n}\n\nfunction processTimeStamp(featureNode) {\n  const node = queryFirstNode(featureNode, \"TimeStamp\", namespaces.kmlgx);\n  const whenString = queryStringValue(node, \"when\", namespaces.kmlgx);\n\n  if (!defined(node) || !defined(whenString) || whenString.length === 0) {\n    return undefined;\n  }\n\n  //According to the KML spec, a TimeStamp represents a \"single moment in time\"\n  //However, since Cesium animates much differently than Google Earth, that doesn't\n  //Make much sense here.  Instead, we use the TimeStamp as the moment the feature\n  //comes into existence.  This works much better and gives a similar feel to\n  //GE's experience.\n  const when = JulianDate.fromIso8601(whenString);\n  const result = new TimeIntervalCollection();\n  result.addInterval(\n    new TimeInterval({\n      start: when,\n      stop: Iso8601.MAXIMUM_VALUE,\n    }),\n  );\n  return result;\n}\n\nfunction processTimeSpan(featureNode) {\n  const node = queryFirstNode(featureNode, \"TimeSpan\", namespaces.kmlgx);\n  if (!defined(node)) {\n    return undefined;\n  }\n  let result;\n\n  const beginNode = queryFirstNode(node, \"begin\", namespaces.kmlgx);\n  let beginDate = defined(beginNode)\n    ? JulianDate.fromIso8601(beginNode.textContent)\n    : undefined;\n\n  const endNode = queryFirstNode(node, \"end\", namespaces.kmlgx);\n  let endDate = defined(endNode)\n    ? JulianDate.fromIso8601(endNode.textContent)\n    : undefined;\n\n  if (defined(beginDate) && defined(endDate)) {\n    if (JulianDate.lessThan(endDate, beginDate)) {\n      const tmp = beginDate;\n      beginDate = endDate;\n      endDate = tmp;\n    }\n    result = new TimeIntervalCollection();\n    result.addInterval(\n      new TimeInterval({\n        start: beginDate,\n        stop: endDate,\n      }),\n    );\n  } else if (defined(beginDate)) {\n    result = new TimeIntervalCollection();\n    result.addInterval(\n      new TimeInterval({\n        start: beginDate,\n        stop: Iso8601.MAXIMUM_VALUE,\n      }),\n    );\n  } else if (defined(endDate)) {\n    result = new TimeIntervalCollection();\n    result.addInterval(\n      new TimeInterval({\n        start: Iso8601.MINIMUM_VALUE,\n        stop: endDate,\n      }),\n    );\n  }\n\n  return result;\n}\n\nfunction createDefaultBillboard() {\n  const billboard = new BillboardGraphics();\n  billboard.width = BILLBOARD_SIZE;\n  billboard.height = BILLBOARD_SIZE;\n  billboard.scaleByDistance = new NearFarScalar(\n    BILLBOARD_NEAR_DISTANCE,\n    BILLBOARD_NEAR_RATIO,\n    BILLBOARD_FAR_DISTANCE,\n    BILLBOARD_FAR_RATIO,\n  );\n  billboard.pixelOffsetScaleByDistance = new NearFarScalar(\n    BILLBOARD_NEAR_DISTANCE,\n    BILLBOARD_NEAR_RATIO,\n    BILLBOARD_FAR_DISTANCE,\n    BILLBOARD_FAR_RATIO,\n  );\n  return billboard;\n}\n\nfunction createDefaultPolygon() {\n  const polygon = new PolygonGraphics();\n  polygon.outline = true;\n  polygon.outlineColor = Color.WHITE;\n  return polygon;\n}\n\nfunction createDefaultLabel() {\n  const label = new LabelGraphics();\n  label.translucencyByDistance = new NearFarScalar(3000000, 1.0, 5000000, 0.0);\n  label.pixelOffset = new Cartesian2(17, 0);\n  label.horizontalOrigin = HorizontalOrigin.LEFT;\n  label.font = \"16px sans-serif\";\n  label.style = LabelStyle.FILL_AND_OUTLINE;\n  return label;\n}\n\nfunction getIconHref(\n  iconNode,\n  dataSource,\n  sourceResource,\n  uriResolver,\n  canRefresh,\n) {\n  let href = queryStringValue(iconNode, \"href\", namespaces.kml);\n  if (!defined(href) || href.length === 0) {\n    return undefined;\n  }\n\n  if (href.indexOf(\"root://icons/palette-\") === 0) {\n    const palette = href.charAt(21);\n\n    // Get the icon number\n    let x = queryNumericValue(iconNode, \"x\", namespaces.gx) ?? 0;\n    let y = queryNumericValue(iconNode, \"y\", namespaces.gx) ?? 0;\n    x = Math.min(x / 32, 7);\n    y = 7 - Math.min(y / 32, 7);\n    const iconNum = 8 * y + x;\n\n    href = `https://maps.google.com/mapfiles/kml/pal${palette}/icon${iconNum}.png`;\n  }\n\n  const hrefResource = resolveHref(href, sourceResource, uriResolver);\n\n  if (canRefresh) {\n    const refreshMode = queryStringValue(\n      iconNode,\n      \"refreshMode\",\n      namespaces.kml,\n    );\n    const viewRefreshMode = queryStringValue(\n      iconNode,\n      \"viewRefreshMode\",\n      namespaces.kml,\n    );\n    if (refreshMode === \"onInterval\" || refreshMode === \"onExpire\") {\n      oneTimeWarning(\n        `kml-refreshMode-${refreshMode}`,\n        `KML - Unsupported Icon refreshMode: ${refreshMode}`,\n      );\n    } else if (viewRefreshMode === \"onStop\" || viewRefreshMode === \"onRegion\") {\n      oneTimeWarning(\n        `kml-refreshMode-${viewRefreshMode}`,\n        `KML - Unsupported Icon viewRefreshMode: ${viewRefreshMode}`,\n      );\n    }\n\n    const viewBoundScale =\n      queryStringValue(iconNode, \"viewBoundScale\", namespaces.kml) ?? 1.0;\n    const defaultViewFormat =\n      viewRefreshMode === \"onStop\"\n        ? \"BBOX=[bboxWest],[bboxSouth],[bboxEast],[bboxNorth]\"\n        : \"\";\n    const viewFormat =\n      queryStringValue(iconNode, \"viewFormat\", namespaces.kml) ??\n      defaultViewFormat;\n    const httpQuery = queryStringValue(iconNode, \"httpQuery\", namespaces.kml);\n    if (defined(viewFormat)) {\n      hrefResource.setQueryParameters(queryToObject(cleanupString(viewFormat)));\n    }\n    if (defined(httpQuery)) {\n      hrefResource.setQueryParameters(queryToObject(cleanupString(httpQuery)));\n    }\n\n    const ellipsoid = dataSource._ellipsoid;\n    processNetworkLinkQueryString(\n      hrefResource,\n      dataSource.camera,\n      dataSource.canvas,\n      viewBoundScale,\n      dataSource._lastCameraView.bbox,\n      ellipsoid,\n    );\n\n    return hrefResource;\n  }\n\n  return hrefResource;\n}\n\nfunction processBillboardIcon(\n  dataSource,\n  node,\n  targetEntity,\n  sourceResource,\n  uriResolver,\n) {\n  let scale = queryNumericValue(node, \"scale\", namespaces.kml);\n  const heading = queryNumericValue(node, \"heading\", namespaces.kml);\n  const color = queryColorValue(node, \"color\", namespaces.kml);\n\n  const iconNode = queryFirstNode(node, \"Icon\", namespaces.kml);\n  let icon = getIconHref(\n    iconNode,\n    dataSource,\n    sourceResource,\n    uriResolver,\n    false,\n  );\n\n  // If icon tags are present but blank, we do not want to show an icon\n  if (defined(iconNode) && !defined(icon)) {\n    icon = false;\n  }\n\n  const x = queryNumericValue(iconNode, \"x\", namespaces.gx);\n  const y = queryNumericValue(iconNode, \"y\", namespaces.gx);\n  const w = queryNumericValue(iconNode, \"w\", namespaces.gx);\n  const h = queryNumericValue(iconNode, \"h\", namespaces.gx);\n\n  const hotSpotNode = queryFirstNode(node, \"hotSpot\", namespaces.kml);\n  const hotSpotX = queryNumericAttribute(hotSpotNode, \"x\");\n  const hotSpotY = queryNumericAttribute(hotSpotNode, \"y\");\n  const hotSpotXUnit = queryStringAttribute(hotSpotNode, \"xunits\");\n  const hotSpotYUnit = queryStringAttribute(hotSpotNode, \"yunits\");\n\n  let billboard = targetEntity.billboard;\n  if (!defined(billboard)) {\n    billboard = createDefaultBillboard();\n    targetEntity.billboard = billboard;\n  }\n\n  billboard.image = icon;\n  billboard.scale = scale;\n  billboard.color = color;\n\n  if (defined(x) || defined(y) || defined(w) || defined(h)) {\n    billboard.imageSubRegion = new BoundingRectangle(x, y, w, h);\n  }\n\n  //GE treats a heading of zero as no heading\n  //You can still point north using a 360 degree angle (or any multiple of 360)\n  if (defined(heading) && heading !== 0) {\n    billboard.rotation = CesiumMath.toRadians(-heading);\n    billboard.alignedAxis = Cartesian3.UNIT_Z;\n  }\n\n  //Hotpot is the KML equivalent of pixel offset\n  //The hotspot origin is the lower left, but we leave\n  //our billboard origin at the center and simply\n  //modify the pixel offset to take this into account\n  scale = scale ?? 1.0;\n\n  let xOffset;\n  let yOffset;\n  if (defined(hotSpotX)) {\n    if (hotSpotXUnit === \"pixels\") {\n      xOffset = -hotSpotX * scale;\n    } else if (hotSpotXUnit === \"insetPixels\") {\n      xOffset = (hotSpotX - BILLBOARD_SIZE) * scale;\n    } else if (hotSpotXUnit === \"fraction\") {\n      xOffset = -hotSpotX * BILLBOARD_SIZE * scale;\n    }\n    xOffset += BILLBOARD_SIZE * 0.5 * scale;\n  }\n\n  if (defined(hotSpotY)) {\n    if (hotSpotYUnit === \"pixels\") {\n      yOffset = hotSpotY * scale;\n    } else if (hotSpotYUnit === \"insetPixels\") {\n      yOffset = (-hotSpotY + BILLBOARD_SIZE) * scale;\n    } else if (hotSpotYUnit === \"fraction\") {\n      yOffset = hotSpotY * BILLBOARD_SIZE * scale;\n    }\n\n    yOffset -= BILLBOARD_SIZE * 0.5 * scale;\n  }\n\n  if (defined(xOffset) || defined(yOffset)) {\n    billboard.pixelOffset = new Cartesian2(xOffset, yOffset);\n  }\n}\n\nfunction applyStyle(\n  dataSource,\n  styleNode,\n  targetEntity,\n  sourceResource,\n  uriResolver,\n) {\n  for (let i = 0, len = styleNode.childNodes.length; i < len; i++) {\n    const node = styleNode.childNodes.item(i);\n    if (node.localName === \"IconStyle\") {\n      processBillboardIcon(\n        dataSource,\n        node,\n        targetEntity,\n        sourceResource,\n        uriResolver,\n      );\n    } else if (node.localName === \"LabelStyle\") {\n      let label = targetEntity.label;\n      if (!defined(label)) {\n        label = createDefaultLabel();\n        targetEntity.label = label;\n      }\n      label.scale =\n        queryNumericValue(node, \"scale\", namespaces.kml) ?? label.scale;\n      label.fillColor =\n        queryColorValue(node, \"color\", namespaces.kml) ?? label.fillColor;\n      label.text = targetEntity.name;\n    } else if (node.localName === \"LineStyle\") {\n      let polyline = targetEntity.polyline;\n      if (!defined(polyline)) {\n        polyline = new PolylineGraphics();\n        targetEntity.polyline = polyline;\n      }\n      polyline.width = queryNumericValue(node, \"width\", namespaces.kml);\n      polyline.material = queryColorValue(node, \"color\", namespaces.kml);\n      if (defined(queryColorValue(node, \"outerColor\", namespaces.gx))) {\n        oneTimeWarning(\n          \"kml-gx:outerColor\",\n          \"KML - gx:outerColor is not supported in a LineStyle\",\n        );\n      }\n      if (defined(queryNumericValue(node, \"outerWidth\", namespaces.gx))) {\n        oneTimeWarning(\n          \"kml-gx:outerWidth\",\n          \"KML - gx:outerWidth is not supported in a LineStyle\",\n        );\n      }\n      if (defined(queryNumericValue(node, \"physicalWidth\", namespaces.gx))) {\n        oneTimeWarning(\n          \"kml-gx:physicalWidth\",\n          \"KML - gx:physicalWidth is not supported in a LineStyle\",\n        );\n      }\n      if (defined(queryBooleanValue(node, \"labelVisibility\", namespaces.gx))) {\n        oneTimeWarning(\n          \"kml-gx:labelVisibility\",\n          \"KML - gx:labelVisibility is not supported in a LineStyle\",\n        );\n      }\n    } else if (node.localName === \"PolyStyle\") {\n      let polygon = targetEntity.polygon;\n      if (!defined(polygon)) {\n        polygon = createDefaultPolygon();\n        targetEntity.polygon = polygon;\n      }\n      polygon.material =\n        queryColorValue(node, \"color\", namespaces.kml) ?? polygon.material;\n      polygon.fill =\n        queryBooleanValue(node, \"fill\", namespaces.kml) ?? polygon.fill;\n      polygon.outline =\n        queryBooleanValue(node, \"outline\", namespaces.kml) ?? polygon.outline;\n    } else if (node.localName === \"BalloonStyle\") {\n      const bgColor =\n        parseColorString(queryStringValue(node, \"bgColor\", namespaces.kml)) ??\n        Color.WHITE;\n      const textColor =\n        parseColorString(queryStringValue(node, \"textColor\", namespaces.kml)) ??\n        Color.BLACK;\n      const text = queryStringValue(node, \"text\", namespaces.kml);\n\n      //This is purely an internal property used in style processing,\n      //it never ends up on the final entity.\n      targetEntity.addProperty(\"balloonStyle\");\n      targetEntity.balloonStyle = {\n        bgColor: bgColor,\n        textColor: textColor,\n        text: text,\n      };\n    } else if (node.localName === \"ListStyle\") {\n      const listItemType = queryStringValue(\n        node,\n        \"listItemType\",\n        namespaces.kml,\n      );\n      if (listItemType === \"radioFolder\" || listItemType === \"checkOffOnly\") {\n        oneTimeWarning(\n          `kml-listStyle-${listItemType}`,\n          `KML - Unsupported ListStyle with listItemType: ${listItemType}`,\n        );\n      }\n    }\n  }\n}\n\n//Processes and merges any inline styles for the provided node into the provided entity.\nfunction computeFinalStyle(\n  dataSource,\n  placeMark,\n  styleCollection,\n  sourceResource,\n  uriResolver,\n) {\n  const result = new Entity();\n  let styleEntity;\n\n  //Google earth seems to always use the last inline Style/StyleMap only\n  let styleIndex = -1;\n  const childNodes = placeMark.childNodes;\n  const length = childNodes.length;\n  for (let q = 0; q < length; q++) {\n    const child = childNodes[q];\n    if (child.localName === \"Style\" || child.localName === \"StyleMap\") {\n      styleIndex = q;\n    }\n  }\n\n  if (styleIndex !== -1) {\n    const inlineStyleNode = childNodes[styleIndex];\n    if (inlineStyleNode.localName === \"Style\") {\n      applyStyle(\n        dataSource,\n        inlineStyleNode,\n        result,\n        sourceResource,\n        uriResolver,\n      );\n    } else {\n      // StyleMap\n      const pairs = queryChildNodes(inlineStyleNode, \"Pair\", namespaces.kml);\n      for (let p = 0; p < pairs.length; p++) {\n        const pair = pairs[p];\n        const key = queryStringValue(pair, \"key\", namespaces.kml);\n        if (key === \"normal\") {\n          const styleUrl = queryStringValue(pair, \"styleUrl\", namespaces.kml);\n          if (defined(styleUrl)) {\n            styleEntity = styleCollection.getById(styleUrl);\n            if (!defined(styleEntity)) {\n              styleEntity = styleCollection.getById(`#${styleUrl}`);\n            }\n            if (defined(styleEntity)) {\n              result.merge(styleEntity);\n            }\n          } else {\n            const node = queryFirstNode(pair, \"Style\", namespaces.kml);\n            applyStyle(dataSource, node, result, sourceResource, uriResolver);\n          }\n        } else {\n          oneTimeWarning(\n            `kml-styleMap-${key}`,\n            `KML - Unsupported StyleMap key: ${key}`,\n          );\n        }\n      }\n    }\n  }\n\n  //Google earth seems to always use the first external style only.\n  const externalStyle = queryStringValue(placeMark, \"styleUrl\", namespaces.kml);\n  if (defined(externalStyle)) {\n    let id = externalStyle;\n    if (externalStyle[0] !== \"#\" && externalStyle.indexOf(\"#\") !== -1) {\n      const tokens = externalStyle.split(\"#\");\n      const uri = tokens[0];\n      const resource = sourceResource.getDerivedResource({\n        url: uri,\n      });\n\n      id = `${resource.getUrlComponent()}#${tokens[1]}`;\n    }\n\n    styleEntity = styleCollection.getById(id);\n    if (!defined(styleEntity)) {\n      styleEntity = styleCollection.getById(`#${id}`);\n    }\n    if (defined(styleEntity)) {\n      result.merge(styleEntity);\n    }\n  }\n\n  return result;\n}\n\n//Asynchronously processes an external style file.\nfunction processExternalStyles(dataSource, resource, styleCollection) {\n  return resource.fetchXML().then(function (styleKml) {\n    return processStyles(dataSource, styleKml, styleCollection, resource, true);\n  });\n}\n\n//Processes all shared and external styles and stores\n//their id into the provided styleCollection.\n//Returns an array of promises that will resolve when\n//each style is loaded.\nfunction processStyles(\n  dataSource,\n  kml,\n  styleCollection,\n  sourceResource,\n  isExternal,\n  uriResolver,\n) {\n  let i;\n  let id;\n  let styleEntity;\n\n  let node;\n  const styleNodes = queryNodes(kml, \"Style\", namespaces.kml);\n  if (defined(styleNodes)) {\n    const styleNodesLength = styleNodes.length;\n    for (i = 0; i < styleNodesLength; i++) {\n      node = styleNodes[i];\n      id = queryStringAttribute(node, \"id\");\n      if (defined(id)) {\n        id = `#${id}`;\n        if (isExternal && defined(sourceResource)) {\n          id = sourceResource.getUrlComponent() + id;\n        }\n        if (!defined(styleCollection.getById(id))) {\n          styleEntity = new Entity({\n            id: id,\n          });\n          styleCollection.add(styleEntity);\n          applyStyle(\n            dataSource,\n            node,\n            styleEntity,\n            sourceResource,\n            uriResolver,\n          );\n        }\n      }\n    }\n  }\n\n  const styleMaps = queryNodes(kml, \"StyleMap\", namespaces.kml);\n  if (defined(styleMaps)) {\n    const styleMapsLength = styleMaps.length;\n    for (i = 0; i < styleMapsLength; i++) {\n      const styleMap = styleMaps[i];\n      id = queryStringAttribute(styleMap, \"id\");\n      if (defined(id)) {\n        const pairs = queryChildNodes(styleMap, \"Pair\", namespaces.kml);\n        for (let p = 0; p < pairs.length; p++) {\n          const pair = pairs[p];\n          const key = queryStringValue(pair, \"key\", namespaces.kml);\n          if (key === \"normal\") {\n            id = `#${id}`;\n            if (isExternal && defined(sourceResource)) {\n              id = sourceResource.getUrlComponent() + id;\n            }\n            if (!defined(styleCollection.getById(id))) {\n              styleEntity = styleCollection.getOrCreateEntity(id);\n\n              let styleUrl = queryStringValue(pair, \"styleUrl\", namespaces.kml);\n              if (defined(styleUrl)) {\n                if (styleUrl[0] !== \"#\") {\n                  styleUrl = `#${styleUrl}`;\n                }\n\n                if (isExternal && defined(sourceResource)) {\n                  styleUrl = sourceResource.getUrlComponent() + styleUrl;\n                }\n                const base = styleCollection.getById(styleUrl);\n\n                if (defined(base)) {\n                  styleEntity.merge(base);\n                }\n              } else {\n                node = queryFirstNode(pair, \"Style\", namespaces.kml);\n                applyStyle(\n                  dataSource,\n                  node,\n                  styleEntity,\n                  sourceResource,\n                  uriResolver,\n                );\n              }\n            }\n          } else {\n            oneTimeWarning(\n              `kml-styleMap-${key}`,\n              `KML - Unsupported StyleMap key: ${key}`,\n            );\n          }\n        }\n      }\n    }\n  }\n\n  const promises = [];\n  const styleUrlNodes = kml.getElementsByTagName(\"styleUrl\");\n  const styleUrlNodesLength = styleUrlNodes.length;\n  for (i = 0; i < styleUrlNodesLength; i++) {\n    const styleReference = styleUrlNodes[i].textContent;\n    if (styleReference[0] !== \"#\") {\n      //According to the spec, all local styles should start with a #\n      //and everything else is an external style that has a # seperating\n      //the URL of the document and the style.  However, Google Earth\n      //also accepts styleUrls without a # as meaning a local style.\n      const tokens = styleReference.split(\"#\");\n      if (tokens.length === 2) {\n        const uri = tokens[0];\n        const resource = sourceResource.getDerivedResource({\n          url: uri,\n        });\n\n        promises.push(\n          processExternalStyles(dataSource, resource, styleCollection),\n        );\n      }\n    }\n  }\n\n  return promises;\n}\n\nfunction createDropLine(entityCollection, entity, styleEntity) {\n  const entityPosition = new ReferenceProperty(entityCollection, entity.id, [\n    \"position\",\n  ]);\n  const surfacePosition = new ScaledPositionProperty(entity.position);\n  entity.polyline = defined(styleEntity.polyline)\n    ? styleEntity.polyline.clone()\n    : new PolylineGraphics();\n  entity.polyline.positions = new PositionPropertyArray([\n    entityPosition,\n    surfacePosition,\n  ]);\n}\n\nfunction heightReferenceFromAltitudeMode(altitudeMode, gxAltitudeMode) {\n  if (\n    (!defined(altitudeMode) && !defined(gxAltitudeMode)) ||\n    altitudeMode === \"clampToGround\"\n  ) {\n    return HeightReference.CLAMP_TO_GROUND;\n  }\n\n  if (altitudeMode === \"relativeToGround\") {\n    return HeightReference.RELATIVE_TO_GROUND;\n  }\n\n  if (altitudeMode === \"absolute\") {\n    return HeightReference.NONE;\n  }\n\n  if (gxAltitudeMode === \"clampToSeaFloor\") {\n    oneTimeWarning(\n      \"kml-gx:altitudeMode-clampToSeaFloor\",\n      \"KML - <gx:altitudeMode>:clampToSeaFloor is currently not supported, using <kml:altitudeMode>:clampToGround.\",\n    );\n    return HeightReference.CLAMP_TO_GROUND;\n  }\n\n  if (gxAltitudeMode === \"relativeToSeaFloor\") {\n    oneTimeWarning(\n      \"kml-gx:altitudeMode-relativeToSeaFloor\",\n      \"KML - <gx:altitudeMode>:relativeToSeaFloor is currently not supported, using <kml:altitudeMode>:relativeToGround.\",\n    );\n    return HeightReference.RELATIVE_TO_GROUND;\n  }\n\n  if (defined(altitudeMode)) {\n    oneTimeWarning(\n      \"kml-altitudeMode-unknown\",\n      `KML - Unknown <kml:altitudeMode>:${altitudeMode}, using <kml:altitudeMode>:CLAMP_TO_GROUND.`,\n    );\n  } else {\n    oneTimeWarning(\n      \"kml-gx:altitudeMode-unknown\",\n      `KML - Unknown <gx:altitudeMode>:${gxAltitudeMode}, using <kml:altitudeMode>:CLAMP_TO_GROUND.`,\n    );\n  }\n\n  // Clamp to ground is the default\n  return HeightReference.CLAMP_TO_GROUND;\n}\n\nfunction createPositionPropertyFromAltitudeMode(\n  property,\n  altitudeMode,\n  gxAltitudeMode,\n) {\n  if (\n    gxAltitudeMode === \"relativeToSeaFloor\" ||\n    altitudeMode === \"absolute\" ||\n    altitudeMode === \"relativeToGround\"\n  ) {\n    //Just return the ellipsoid referenced property until we support MSL\n    return property;\n  }\n\n  if (\n    (defined(altitudeMode) && altitudeMode !== \"clampToGround\") || //\n    (defined(gxAltitudeMode) && gxAltitudeMode !== \"clampToSeaFloor\")\n  ) {\n    oneTimeWarning(\n      \"kml-altitudeMode-unknown\",\n      `KML - Unknown altitudeMode: ${altitudeMode ?? gxAltitudeMode}`,\n    );\n  }\n\n  // Clamp to ground is the default\n  return new ScaledPositionProperty(property);\n}\n\nfunction createPositionPropertyArrayFromAltitudeMode(\n  properties,\n  altitudeMode,\n  gxAltitudeMode,\n  ellipsoid,\n) {\n  if (!defined(properties)) {\n    return undefined;\n  }\n\n  if (\n    gxAltitudeMode === \"relativeToSeaFloor\" ||\n    altitudeMode === \"absolute\" ||\n    altitudeMode === \"relativeToGround\"\n  ) {\n    //Just return the ellipsoid referenced property until we support MSL\n    return properties;\n  }\n\n  if (\n    (defined(altitudeMode) && altitudeMode !== \"clampToGround\") || //\n    (defined(gxAltitudeMode) && gxAltitudeMode !== \"clampToSeaFloor\")\n  ) {\n    oneTimeWarning(\n      \"kml-altitudeMode-unknown\",\n      `KML - Unknown altitudeMode: ${altitudeMode ?? gxAltitudeMode}`,\n    );\n  }\n\n  // Clamp to ground is the default\n  const propertiesLength = properties.length;\n  for (let i = 0; i < propertiesLength; i++) {\n    const property = properties[i];\n    ellipsoid.scaleToGeodeticSurface(property, property);\n  }\n  return properties;\n}\n\nfunction processPositionGraphics(\n  dataSource,\n  entity,\n  styleEntity,\n  heightReference,\n) {\n  let label = entity.label;\n  if (!defined(label)) {\n    label = defined(styleEntity.label)\n      ? styleEntity.label.clone()\n      : createDefaultLabel();\n    entity.label = label;\n  }\n  label.text = entity.name;\n\n  let billboard = entity.billboard;\n  if (!defined(billboard)) {\n    billboard = defined(styleEntity.billboard)\n      ? styleEntity.billboard.clone()\n      : createDefaultBillboard();\n    entity.billboard = billboard;\n  }\n\n  if (!defined(billboard.image)) {\n    billboard.image = dataSource._pinBuilder.fromColor(Color.YELLOW, 64);\n\n    // If there were empty <Icon> tags in the KML, then billboard.image was set to false above\n    // However, in this case, the false value would have been converted to a property afterwards\n    // Thus, we check if billboard.image is defined with value of false\n  } else if (!billboard.image.getValue()) {\n    billboard.image = undefined;\n  }\n\n  let scale = 1.0;\n  if (defined(billboard.scale)) {\n    scale = billboard.scale.getValue();\n    if (scale !== 0) {\n      label.pixelOffset = new Cartesian2(scale * 16 + 1, 0);\n    } else {\n      //Minor tweaks to better match Google Earth.\n      label.pixelOffset = undefined;\n      label.horizontalOrigin = undefined;\n    }\n  }\n\n  if (defined(heightReference) && dataSource._clampToGround) {\n    billboard.heightReference = heightReference;\n    label.heightReference = heightReference;\n  }\n}\n\nfunction processPathGraphics(entity, styleEntity) {\n  let path = entity.path;\n  if (!defined(path)) {\n    path = new PathGraphics();\n    path.leadTime = 0;\n    entity.path = path;\n  }\n\n  const polyline = styleEntity.polyline;\n  if (defined(polyline)) {\n    path.material = polyline.material;\n    path.width = polyline.width;\n  }\n}\n\nfunction processPoint(\n  dataSource,\n  entityCollection,\n  geometryNode,\n  entity,\n  styleEntity,\n) {\n  const coordinatesString = queryStringValue(\n    geometryNode,\n    \"coordinates\",\n    namespaces.kml,\n  );\n  const altitudeMode = queryStringValue(\n    geometryNode,\n    \"altitudeMode\",\n    namespaces.kml,\n  );\n  const gxAltitudeMode = queryStringValue(\n    geometryNode,\n    \"altitudeMode\",\n    namespaces.gx,\n  );\n  const extrude = queryBooleanValue(geometryNode, \"extrude\", namespaces.kml);\n  const ellipsoid = dataSource._ellipsoid;\n  const position = readCoordinate(coordinatesString, ellipsoid);\n\n  entity.position = position;\n  processPositionGraphics(\n    dataSource,\n    entity,\n    styleEntity,\n    heightReferenceFromAltitudeMode(altitudeMode, gxAltitudeMode),\n  );\n\n  if (extrude && isExtrudable(altitudeMode, gxAltitudeMode)) {\n    createDropLine(entityCollection, entity, styleEntity);\n  }\n\n  return true;\n}\n\nfunction processLineStringOrLinearRing(\n  dataSource,\n  entityCollection,\n  geometryNode,\n  entity,\n  styleEntity,\n) {\n  const coordinatesNode = queryFirstNode(\n    geometryNode,\n    \"coordinates\",\n    namespaces.kml,\n  );\n  const altitudeMode = queryStringValue(\n    geometryNode,\n    \"altitudeMode\",\n    namespaces.kml,\n  );\n  const gxAltitudeMode = queryStringValue(\n    geometryNode,\n    \"altitudeMode\",\n    namespaces.gx,\n  );\n  const extrude = queryBooleanValue(geometryNode, \"extrude\", namespaces.kml);\n  const tessellate = queryBooleanValue(\n    geometryNode,\n    \"tessellate\",\n    namespaces.kml,\n  );\n  const canExtrude = isExtrudable(altitudeMode, gxAltitudeMode);\n  const zIndex = queryNumericValue(geometryNode, \"drawOrder\", namespaces.gx);\n\n  const ellipsoid = dataSource._ellipsoid;\n  const coordinates = readCoordinates(coordinatesNode, ellipsoid);\n  let polyline = styleEntity.polyline;\n  if (canExtrude && extrude) {\n    const wall = new WallGraphics();\n    entity.wall = wall;\n    wall.positions = coordinates;\n    const polygon = styleEntity.polygon;\n\n    if (defined(polygon)) {\n      wall.fill = polygon.fill;\n      wall.material = polygon.material;\n    }\n\n    //Always outline walls so they show up in 2D.\n    wall.outline = true;\n    if (defined(polyline)) {\n      wall.outlineColor = defined(polyline.material)\n        ? polyline.material.color\n        : Color.WHITE;\n      wall.outlineWidth = polyline.width;\n    } else if (defined(polygon)) {\n      wall.outlineColor = defined(polygon.material)\n        ? polygon.material.color\n        : Color.WHITE;\n    }\n  } else if (dataSource._clampToGround && !canExtrude && tessellate) {\n    const polylineGraphics = new PolylineGraphics();\n    polylineGraphics.clampToGround = true;\n    entity.polyline = polylineGraphics;\n    polylineGraphics.positions = coordinates;\n    if (defined(polyline)) {\n      polylineGraphics.material = defined(polyline.material)\n        ? polyline.material.color.getValue(Iso8601.MINIMUM_VALUE)\n        : Color.WHITE;\n      polylineGraphics.width = polyline.width ?? 1.0;\n    } else {\n      polylineGraphics.material = Color.WHITE;\n      polylineGraphics.width = 1.0;\n    }\n    polylineGraphics.zIndex = zIndex;\n  } else {\n    if (defined(zIndex)) {\n      oneTimeWarning(\n        \"kml-gx:drawOrder\",\n        \"KML - gx:drawOrder is not supported in LineStrings when clampToGround is false\",\n      );\n    }\n    if (dataSource._clampToGround && !tessellate) {\n      oneTimeWarning(\n        \"kml-line-tesselate\",\n        \"Ignoring clampToGround for KML lines without the tessellate flag.\",\n      );\n    }\n\n    polyline = defined(polyline) ? polyline.clone() : new PolylineGraphics();\n    entity.polyline = polyline;\n    polyline.positions = createPositionPropertyArrayFromAltitudeMode(\n      coordinates,\n      altitudeMode,\n      gxAltitudeMode,\n      ellipsoid,\n    );\n    if (!tessellate || canExtrude) {\n      polyline.arcType = ArcType.NONE;\n    }\n  }\n\n  return true;\n}\n\nfunction processPolygon(\n  dataSource,\n  entityCollection,\n  geometryNode,\n  entity,\n  styleEntity,\n) {\n  const outerBoundaryIsNode = queryFirstNode(\n    geometryNode,\n    \"outerBoundaryIs\",\n    namespaces.kml,\n  );\n  let linearRingNode = queryFirstNode(\n    outerBoundaryIsNode,\n    \"LinearRing\",\n    namespaces.kml,\n  );\n  let coordinatesNode = queryFirstNode(\n    linearRingNode,\n    \"coordinates\",\n    namespaces.kml,\n  );\n  const ellipsoid = dataSource._ellipsoid;\n  let coordinates = readCoordinates(coordinatesNode, ellipsoid);\n  const extrude = queryBooleanValue(geometryNode, \"extrude\", namespaces.kml);\n  const altitudeMode = queryStringValue(\n    geometryNode,\n    \"altitudeMode\",\n    namespaces.kml,\n  );\n  const gxAltitudeMode = queryStringValue(\n    geometryNode,\n    \"altitudeMode\",\n    namespaces.gx,\n  );\n  const canExtrude = isExtrudable(altitudeMode, gxAltitudeMode);\n\n  const polygon = defined(styleEntity.polygon)\n    ? styleEntity.polygon.clone()\n    : createDefaultPolygon();\n\n  const polyline = styleEntity.polyline;\n  if (defined(polyline)) {\n    polygon.outlineColor = defined(polyline.material)\n      ? polyline.material.color\n      : Color.WHITE;\n    polygon.outlineWidth = polyline.width;\n  }\n  entity.polygon = polygon;\n\n  if (canExtrude) {\n    polygon.perPositionHeight = true;\n    polygon.extrudedHeight = extrude ? 0 : undefined;\n  } else if (!dataSource._clampToGround) {\n    polygon.height = 0;\n  }\n\n  if (defined(coordinates)) {\n    const hierarchy = new PolygonHierarchy(coordinates);\n    const innerBoundaryIsNodes = queryChildNodes(\n      geometryNode,\n      \"innerBoundaryIs\",\n      namespaces.kml,\n    );\n    for (let j = 0; j < innerBoundaryIsNodes.length; j++) {\n      linearRingNode = queryChildNodes(\n        innerBoundaryIsNodes[j],\n        \"LinearRing\",\n        namespaces.kml,\n      );\n      for (let k = 0; k < linearRingNode.length; k++) {\n        coordinatesNode = queryFirstNode(\n          linearRingNode[k],\n          \"coordinates\",\n          namespaces.kml,\n        );\n        coordinates = readCoordinates(coordinatesNode, ellipsoid);\n        if (defined(coordinates)) {\n          hierarchy.holes.push(new PolygonHierarchy(coordinates));\n        }\n      }\n    }\n    polygon.hierarchy = hierarchy;\n  }\n\n  return true;\n}\n\nfunction processTrack(\n  dataSource,\n  entityCollection,\n  geometryNode,\n  entity,\n  styleEntity,\n) {\n  const altitudeMode = queryStringValue(\n    geometryNode,\n    \"altitudeMode\",\n    namespaces.kml,\n  );\n  const gxAltitudeMode = queryStringValue(\n    geometryNode,\n    \"altitudeMode\",\n    namespaces.gx,\n  );\n  const coordNodes = queryChildNodes(geometryNode, \"coord\", namespaces.gx);\n  const angleNodes = queryChildNodes(geometryNode, \"angles\", namespaces.gx);\n  const timeNodes = queryChildNodes(geometryNode, \"when\", namespaces.kml);\n  const extrude = queryBooleanValue(geometryNode, \"extrude\", namespaces.kml);\n  const canExtrude = isExtrudable(altitudeMode, gxAltitudeMode);\n  const ellipsoid = dataSource._ellipsoid;\n\n  if (angleNodes.length > 0) {\n    oneTimeWarning(\n      \"kml-gx:angles\",\n      \"KML - gx:angles are not supported in gx:Tracks\",\n    );\n  }\n\n  const length = Math.min(coordNodes.length, timeNodes.length);\n  const coordinates = [];\n  const times = [];\n  for (let i = 0; i < length; i++) {\n    const position = readCoordinate(coordNodes[i].textContent, ellipsoid);\n    coordinates.push(position);\n    times.push(JulianDate.fromIso8601(timeNodes[i].textContent));\n  }\n  const property = new SampledPositionProperty();\n  property.addSamples(times, coordinates);\n  entity.position = property;\n  processPositionGraphics(\n    dataSource,\n    entity,\n    styleEntity,\n    heightReferenceFromAltitudeMode(altitudeMode, gxAltitudeMode),\n  );\n  processPathGraphics(entity, styleEntity);\n\n  entity.availability = new TimeIntervalCollection();\n\n  if (timeNodes.length > 0) {\n    entity.availability.addInterval(\n      new TimeInterval({\n        start: times[0],\n        stop: times[times.length - 1],\n      }),\n    );\n  }\n\n  if (canExtrude && extrude) {\n    createDropLine(entityCollection, entity, styleEntity);\n  }\n\n  return true;\n}\n\nfunction addToMultiTrack(\n  times,\n  positions,\n  composite,\n  availability,\n  dropShowProperty,\n  extrude,\n  altitudeMode,\n  gxAltitudeMode,\n  includeEndPoints,\n) {\n  const start = times[0];\n  const stop = times[times.length - 1];\n\n  const data = new SampledPositionProperty();\n  data.addSamples(times, positions);\n\n  composite.intervals.addInterval(\n    new TimeInterval({\n      start: start,\n      stop: stop,\n      isStartIncluded: includeEndPoints,\n      isStopIncluded: includeEndPoints,\n      data: createPositionPropertyFromAltitudeMode(\n        data,\n        altitudeMode,\n        gxAltitudeMode,\n      ),\n    }),\n  );\n  availability.addInterval(\n    new TimeInterval({\n      start: start,\n      stop: stop,\n      isStartIncluded: includeEndPoints,\n      isStopIncluded: includeEndPoints,\n    }),\n  );\n  dropShowProperty.intervals.addInterval(\n    new TimeInterval({\n      start: start,\n      stop: stop,\n      isStartIncluded: includeEndPoints,\n      isStopIncluded: includeEndPoints,\n      data: extrude,\n    }),\n  );\n}\n\nfunction processMultiTrack(\n  dataSource,\n  entityCollection,\n  geometryNode,\n  entity,\n  styleEntity,\n) {\n  // Multitrack options do not work in GE as detailed in the spec,\n  // rather than altitudeMode being at the MultiTrack level,\n  // GE just defers all settings to the underlying track.\n\n  const interpolate = queryBooleanValue(\n    geometryNode,\n    \"interpolate\",\n    namespaces.gx,\n  );\n  const trackNodes = queryChildNodes(geometryNode, \"Track\", namespaces.gx);\n\n  let times;\n  let lastStop;\n  let lastStopPosition;\n  let needDropLine = false;\n  const dropShowProperty = new TimeIntervalCollectionProperty();\n  const availability = new TimeIntervalCollection();\n  const composite = new CompositePositionProperty();\n  const ellipsoid = dataSource._ellipsoid;\n  for (let i = 0, len = trackNodes.length; i < len; i++) {\n    const trackNode = trackNodes[i];\n    const timeNodes = queryChildNodes(trackNode, \"when\", namespaces.kml);\n    const coordNodes = queryChildNodes(trackNode, \"coord\", namespaces.gx);\n    const altitudeMode = queryStringValue(\n      trackNode,\n      \"altitudeMode\",\n      namespaces.kml,\n    );\n    const gxAltitudeMode = queryStringValue(\n      trackNode,\n      \"altitudeMode\",\n      namespaces.gx,\n    );\n    const canExtrude = isExtrudable(altitudeMode, gxAltitudeMode);\n    const extrude = queryBooleanValue(trackNode, \"extrude\", namespaces.kml);\n\n    const length = Math.min(coordNodes.length, timeNodes.length);\n\n    const positions = [];\n    times = [];\n    for (let x = 0; x < length; x++) {\n      const position = readCoordinate(coordNodes[x].textContent, ellipsoid);\n      positions.push(position);\n      times.push(JulianDate.fromIso8601(timeNodes[x].textContent));\n    }\n\n    if (interpolate) {\n      //If we are interpolating, then we need to fill in the end of\n      //the last track and the beginning of this one with a sampled\n      //property.  From testing in Google Earth, this property\n      //is never extruded and always absolute.\n      if (defined(lastStop)) {\n        addToMultiTrack(\n          [lastStop, times[0]],\n          [lastStopPosition, positions[0]],\n          composite,\n          availability,\n          dropShowProperty,\n          false,\n          \"absolute\",\n          undefined,\n          false,\n        );\n      }\n      lastStop = times[length - 1];\n      lastStopPosition = positions[positions.length - 1];\n    }\n\n    addToMultiTrack(\n      times,\n      positions,\n      composite,\n      availability,\n      dropShowProperty,\n      canExtrude && extrude,\n      altitudeMode,\n      gxAltitudeMode,\n      true,\n    );\n    needDropLine = needDropLine || (canExtrude && extrude);\n  }\n\n  entity.availability = availability;\n  entity.position = composite;\n  processPositionGraphics(dataSource, entity, styleEntity);\n  processPathGraphics(entity, styleEntity);\n  if (needDropLine) {\n    createDropLine(entityCollection, entity, styleEntity);\n    entity.polyline.show = dropShowProperty;\n  }\n\n  return true;\n}\n\nconst geometryTypes = {\n  Point: processPoint,\n  LineString: processLineStringOrLinearRing,\n  LinearRing: processLineStringOrLinearRing,\n  Polygon: processPolygon,\n  Track: processTrack,\n  MultiTrack: processMultiTrack,\n  MultiGeometry: processMultiGeometry,\n  Model: processUnsupportedGeometry,\n};\n\nfunction processMultiGeometry(\n  dataSource,\n  entityCollection,\n  geometryNode,\n  entity,\n  styleEntity,\n  context,\n) {\n  const childNodes = geometryNode.childNodes;\n  let hasGeometry = false;\n  for (let i = 0, len = childNodes.length; i < len; i++) {\n    const childNode = childNodes.item(i);\n    const geometryProcessor = geometryTypes[childNode.localName];\n    if (defined(geometryProcessor)) {\n      const childEntity = createEntity(childNode, entityCollection, context);\n      childEntity.parent = entity;\n      childEntity.name = entity.name;\n      childEntity.availability = entity.availability;\n      childEntity.description = entity.description;\n      childEntity.kml = entity.kml;\n      if (\n        geometryProcessor(\n          dataSource,\n          entityCollection,\n          childNode,\n          childEntity,\n          styleEntity,\n        )\n      ) {\n        hasGeometry = true;\n      }\n    }\n  }\n\n  return hasGeometry;\n}\n\nfunction processUnsupportedGeometry(\n  dataSource,\n  entityCollection,\n  geometryNode,\n  entity,\n  styleEntity,\n) {\n  oneTimeWarning(\n    \"kml-unsupportedGeometry\",\n    `KML - Unsupported geometry: ${geometryNode.localName}`,\n  );\n  return false;\n}\n\nfunction processExtendedData(node, entity) {\n  const extendedDataNode = queryFirstNode(node, \"ExtendedData\", namespaces.kml);\n\n  if (!defined(extendedDataNode)) {\n    return undefined;\n  }\n\n  if (defined(queryFirstNode(extendedDataNode, \"SchemaData\", namespaces.kml))) {\n    oneTimeWarning(\"kml-schemaData\", \"KML - SchemaData is unsupported\");\n  }\n  if (defined(queryStringAttribute(extendedDataNode, \"xmlns:prefix\"))) {\n    oneTimeWarning(\n      \"kml-extendedData\",\n      \"KML - ExtendedData with xmlns:prefix is unsupported\",\n    );\n  }\n\n  const result = {};\n  const dataNodes = queryChildNodes(extendedDataNode, \"Data\", namespaces.kml);\n  if (defined(dataNodes)) {\n    const length = dataNodes.length;\n    for (let i = 0; i < length; i++) {\n      const dataNode = dataNodes[i];\n      const name = queryStringAttribute(dataNode, \"name\");\n      if (defined(name)) {\n        result[name] = {\n          displayName: queryStringValue(\n            dataNode,\n            \"displayName\",\n            namespaces.kml,\n          ),\n          value: queryStringValue(dataNode, \"value\", namespaces.kml),\n        };\n      }\n    }\n  }\n  entity.kml.extendedData = result;\n}\n\nlet scratchDiv;\nif (typeof document !== \"undefined\") {\n  scratchDiv = document.createElement(\"div\");\n}\n\nfunction processDescription(\n  node,\n  entity,\n  styleEntity,\n  uriResolver,\n  sourceResource,\n) {\n  let i;\n  let key;\n  let keys;\n\n  const kmlData = entity.kml;\n  const extendedData = kmlData.extendedData;\n  const description = queryStringValue(node, \"description\", namespaces.kml);\n\n  const balloonStyle = entity.balloonStyle ?? styleEntity.balloonStyle;\n\n  let background = Color.WHITE;\n  let foreground = Color.BLACK;\n  let text = description;\n\n  if (defined(balloonStyle)) {\n    background = balloonStyle.bgColor ?? Color.WHITE;\n    foreground = balloonStyle.textColor ?? Color.BLACK;\n    text = balloonStyle.text ?? description;\n  }\n\n  let value;\n  if (defined(text)) {\n    text = text.replace(\"$[name]\", entity.name ?? \"\");\n    text = text.replace(\"$[description]\", description ?? \"\");\n    text = text.replace(\"$[address]\", kmlData.address ?? \"\");\n    text = text.replace(\"$[Snippet]\", kmlData.snippet ?? \"\");\n    text = text.replace(\"$[id]\", entity.id);\n\n    //While not explicitly defined by the OGC spec, in Google Earth\n    //The appearance of geDirections adds the directions to/from links\n    //We simply replace this string with nothing.\n    text = text.replace(\"$[geDirections]\", \"\");\n\n    if (defined(extendedData)) {\n      const matches = text.match(/\\$\\[.+?\\]/g);\n      if (matches !== null) {\n        for (i = 0; i < matches.length; i++) {\n          const token = matches[i];\n          let propertyName = token.substr(2, token.length - 3);\n          const isDisplayName = /\\/displayName$/.test(propertyName);\n          propertyName = propertyName.replace(/\\/displayName$/, \"\");\n\n          value = extendedData[propertyName];\n          if (defined(value)) {\n            value = isDisplayName ? value.displayName : value.value;\n          }\n          if (defined(value)) {\n            text = text.replace(token, value ?? \"\");\n          }\n        }\n      }\n    }\n  } else if (defined(extendedData)) {\n    //If no description exists, build a table out of the extended data\n    keys = Object.keys(extendedData);\n    if (keys.length > 0) {\n      text =\n        '<table class=\"cesium-infoBox-defaultTable cesium-infoBox-defaultTable-lighter\"><tbody>';\n      for (i = 0; i < keys.length; i++) {\n        key = keys[i];\n        value = extendedData[key];\n        text += `<tr><th>${value.displayName ?? key}</th><td>${value.value ?? \"\"}</td></tr>`;\n      }\n      text += \"</tbody></table>\";\n    }\n  }\n\n  if (!defined(text)) {\n    //No description\n    return;\n  }\n\n  //Turns non-explicit links into clickable links.\n  text = autolinker.link(text);\n\n  //Use a temporary div to manipulate the links\n  //so that they open in a new window.\n  scratchDiv.innerHTML = text;\n  const links = scratchDiv.querySelectorAll(\"a\");\n  for (i = 0; i < links.length; i++) {\n    links[i].setAttribute(\"target\", \"_blank\");\n  }\n\n  //Rewrite any KMZ embedded urls\n  if (defined(uriResolver) && uriResolver.keys.length > 1) {\n    embedDataUris(scratchDiv, \"a\", \"href\", uriResolver);\n    embedDataUris(scratchDiv, \"link\", \"href\", uriResolver);\n    embedDataUris(scratchDiv, \"area\", \"href\", uriResolver);\n    embedDataUris(scratchDiv, \"img\", \"src\", uriResolver);\n    embedDataUris(scratchDiv, \"iframe\", \"src\", uriResolver);\n    embedDataUris(scratchDiv, \"video\", \"src\", uriResolver);\n    embedDataUris(scratchDiv, \"audio\", \"src\", uriResolver);\n    embedDataUris(scratchDiv, \"source\", \"src\", uriResolver);\n    embedDataUris(scratchDiv, \"track\", \"src\", uriResolver);\n    embedDataUris(scratchDiv, \"input\", \"src\", uriResolver);\n    embedDataUris(scratchDiv, \"embed\", \"src\", uriResolver);\n    embedDataUris(scratchDiv, \"script\", \"src\", uriResolver);\n    embedDataUris(scratchDiv, \"video\", \"poster\", uriResolver);\n  }\n\n  //Make relative urls absolute using the sourceResource\n  applyBasePath(scratchDiv, \"a\", \"href\", sourceResource);\n  applyBasePath(scratchDiv, \"link\", \"href\", sourceResource);\n  applyBasePath(scratchDiv, \"area\", \"href\", sourceResource);\n  applyBasePath(scratchDiv, \"img\", \"src\", sourceResource);\n  applyBasePath(scratchDiv, \"iframe\", \"src\", sourceResource);\n  applyBasePath(scratchDiv, \"video\", \"src\", sourceResource);\n  applyBasePath(scratchDiv, \"audio\", \"src\", sourceResource);\n  applyBasePath(scratchDiv, \"source\", \"src\", sourceResource);\n  applyBasePath(scratchDiv, \"track\", \"src\", sourceResource);\n  applyBasePath(scratchDiv, \"input\", \"src\", sourceResource);\n  applyBasePath(scratchDiv, \"embed\", \"src\", sourceResource);\n  applyBasePath(scratchDiv, \"script\", \"src\", sourceResource);\n  applyBasePath(scratchDiv, \"video\", \"poster\", sourceResource);\n\n  let tmp = '<div class=\"cesium-infoBox-description-lighter\" style=\"';\n  tmp += \"overflow:auto;\";\n  tmp += \"word-wrap:break-word;\";\n  tmp += `background-color:${background.toCssColorString()};`;\n  tmp += `color:${foreground.toCssColorString()};`;\n  tmp += '\">';\n  tmp += `${scratchDiv.innerHTML}</div>`;\n  scratchDiv.innerHTML = \"\";\n\n  //Set the final HTML as the description.\n  entity.description = tmp;\n}\n\nfunction processFeature(dataSource, featureNode, processingData) {\n  const entityCollection = processingData.entityCollection;\n  const parent = processingData.parentEntity;\n  const sourceResource = processingData.sourceResource;\n  const uriResolver = processingData.uriResolver;\n\n  const entity = createEntity(\n    featureNode,\n    entityCollection,\n    processingData.context,\n  );\n  const kmlData = entity.kml;\n  const styleEntity = computeFinalStyle(\n    dataSource,\n    featureNode,\n    processingData.styleCollection,\n    sourceResource,\n    uriResolver,\n  );\n\n  const name = queryStringValue(featureNode, \"name\", namespaces.kml);\n  entity.name = name;\n  entity.parent = parent;\n\n  let availability = processTimeSpan(featureNode);\n  if (!defined(availability)) {\n    availability = processTimeStamp(featureNode);\n  }\n  entity.availability = availability;\n\n  mergeAvailabilityWithParent(entity);\n\n  // Per KML spec \"A Feature is visible only if it and all its ancestors are visible.\"\n  function ancestryIsVisible(parentEntity) {\n    if (!parentEntity) {\n      return true;\n    }\n    return parentEntity.show && ancestryIsVisible(parentEntity.parent);\n  }\n\n  const visibility = queryBooleanValue(\n    featureNode,\n    \"visibility\",\n    namespaces.kml,\n  );\n  entity.show = ancestryIsVisible(parent) && (visibility ?? true);\n  //const open = queryBooleanValue(featureNode, 'open', namespaces.kml);\n\n  const authorNode = queryFirstNode(featureNode, \"author\", namespaces.atom);\n  const author = kmlData.author;\n  author.name = queryStringValue(authorNode, \"name\", namespaces.atom);\n  author.uri = queryStringValue(authorNode, \"uri\", namespaces.atom);\n  author.email = queryStringValue(authorNode, \"email\", namespaces.atom);\n\n  const linkNode = queryFirstNode(featureNode, \"link\", namespaces.atom);\n  const link = kmlData.link;\n  link.href = queryStringAttribute(linkNode, \"href\");\n  link.hreflang = queryStringAttribute(linkNode, \"hreflang\");\n  link.rel = queryStringAttribute(linkNode, \"rel\");\n  link.type = queryStringAttribute(linkNode, \"type\");\n  link.title = queryStringAttribute(linkNode, \"title\");\n  link.length = queryStringAttribute(linkNode, \"length\");\n\n  kmlData.address = queryStringValue(featureNode, \"address\", namespaces.kml);\n  kmlData.phoneNumber = queryStringValue(\n    featureNode,\n    \"phoneNumber\",\n    namespaces.kml,\n  );\n  kmlData.snippet = queryStringValue(featureNode, \"Snippet\", namespaces.kml);\n\n  processExtendedData(featureNode, entity);\n  processDescription(\n    featureNode,\n    entity,\n    styleEntity,\n    uriResolver,\n    sourceResource,\n  );\n\n  const ellipsoid = dataSource._ellipsoid;\n  processLookAt(featureNode, entity, ellipsoid);\n  processCamera(featureNode, entity, ellipsoid);\n\n  if (defined(queryFirstNode(featureNode, \"Region\", namespaces.kml))) {\n    oneTimeWarning(\"kml-region\", \"KML - Placemark Regions are unsupported\");\n  }\n\n  return {\n    entity: entity,\n    styleEntity: styleEntity,\n  };\n}\n\nfunction processDocument(dataSource, node, processingData, deferredLoading) {\n  deferredLoading.addNodes(node.childNodes, processingData);\n  deferredLoading.process();\n}\n\nfunction processFolder(dataSource, node, processingData, deferredLoading) {\n  const r = processFeature(dataSource, node, processingData);\n  const newProcessingData = clone(processingData);\n  newProcessingData.parentEntity = r.entity;\n  processDocument(dataSource, node, newProcessingData, deferredLoading);\n}\n\nfunction processPlacemark(\n  dataSource,\n  placemark,\n  processingData,\n  deferredLoading,\n) {\n  const r = processFeature(dataSource, placemark, processingData);\n  const entity = r.entity;\n  const styleEntity = r.styleEntity;\n\n  let hasGeometry = false;\n  const childNodes = placemark.childNodes;\n  for (let i = 0, len = childNodes.length; i < len && !hasGeometry; i++) {\n    const childNode = childNodes.item(i);\n    const geometryProcessor = geometryTypes[childNode.localName];\n    if (defined(geometryProcessor)) {\n      // pass the placemark entity id as a context for case of defining multiple child entities together to handle case\n      // where some malformed kmls reuse the same id across placemarks, which works in GE, but is not technically to spec.\n      geometryProcessor(\n        dataSource,\n        processingData.entityCollection,\n        childNode,\n        entity,\n        styleEntity,\n        entity.id,\n      );\n      hasGeometry = true;\n    }\n  }\n\n  if (!hasGeometry) {\n    entity.merge(styleEntity);\n    processPositionGraphics(dataSource, entity, styleEntity);\n  }\n}\n\nconst playlistNodeProcessors = {\n  FlyTo: processTourFlyTo,\n  Wait: processTourWait,\n  SoundCue: processTourUnsupportedNode,\n  AnimatedUpdate: processTourUnsupportedNode,\n  TourControl: processTourUnsupportedNode,\n};\n\nfunction processTour(dataSource, node, processingData, deferredLoading) {\n  const name = queryStringValue(node, \"name\", namespaces.kml);\n  const id = queryStringAttribute(node, \"id\");\n  const tour = new KmlTour(name, id);\n\n  const playlistNode = queryFirstNode(node, \"Playlist\", namespaces.gx);\n  if (playlistNode) {\n    const ellipsoid = dataSource._ellipsoid;\n    const childNodes = playlistNode.childNodes;\n    for (let i = 0; i < childNodes.length; i++) {\n      const entryNode = childNodes[i];\n      if (entryNode.localName) {\n        const playlistNodeProcessor =\n          playlistNodeProcessors[entryNode.localName];\n        if (playlistNodeProcessor) {\n          playlistNodeProcessor(tour, entryNode, ellipsoid);\n        } else {\n          console.log(\n            `Unknown KML Tour playlist entry type ${entryNode.localName}`,\n          );\n        }\n      }\n    }\n  }\n\n  dataSource._kmlTours.push(tour);\n}\n\nfunction processTourUnsupportedNode(tour, entryNode) {\n  oneTimeWarning(`KML Tour unsupported node ${entryNode.localName}`);\n}\n\nfunction processTourWait(tour, entryNode) {\n  const duration = queryNumericValue(entryNode, \"duration\", namespaces.gx);\n  tour.addPlaylistEntry(new KmlTourWait(duration));\n}\n\nfunction processTourFlyTo(tour, entryNode, ellipsoid) {\n  const duration = queryNumericValue(entryNode, \"duration\", namespaces.gx);\n  const flyToMode = queryStringValue(entryNode, \"flyToMode\", namespaces.gx);\n\n  const t = { kml: {} };\n\n  processLookAt(entryNode, t, ellipsoid);\n  processCamera(entryNode, t, ellipsoid);\n\n  const view = t.kml.lookAt || t.kml.camera;\n\n  const flyto = new KmlTourFlyTo(duration, flyToMode, view);\n  tour.addPlaylistEntry(flyto);\n}\n\nfunction processCamera(featureNode, entity, ellipsoid) {\n  const camera = queryFirstNode(featureNode, \"Camera\", namespaces.kml);\n  if (defined(camera)) {\n    const lon = queryNumericValue(camera, \"longitude\", namespaces.kml) ?? 0.0;\n    const lat = queryNumericValue(camera, \"latitude\", namespaces.kml) ?? 0.0;\n    const altitude =\n      queryNumericValue(camera, \"altitude\", namespaces.kml) ?? 0.0;\n\n    const heading = queryNumericValue(camera, \"heading\", namespaces.kml) ?? 0.0;\n    const tilt = queryNumericValue(camera, \"tilt\", namespaces.kml) ?? 0.0;\n    const roll = queryNumericValue(camera, \"roll\", namespaces.kml) ?? 0.0;\n\n    const position = Cartesian3.fromDegrees(lon, lat, altitude, ellipsoid);\n    const hpr = HeadingPitchRoll.fromDegrees(heading, tilt - 90.0, roll);\n\n    entity.kml.camera = new KmlCamera(position, hpr);\n  }\n}\n\nfunction processLookAt(featureNode, entity, ellipsoid) {\n  const lookAt = queryFirstNode(featureNode, \"LookAt\", namespaces.kml);\n  if (defined(lookAt)) {\n    const lon = queryNumericValue(lookAt, \"longitude\", namespaces.kml) ?? 0.0;\n    const lat = queryNumericValue(lookAt, \"latitude\", namespaces.kml) ?? 0.0;\n    const altitude =\n      queryNumericValue(lookAt, \"altitude\", namespaces.kml) ?? 0.0;\n    let heading = queryNumericValue(lookAt, \"heading\", namespaces.kml);\n    let tilt = queryNumericValue(lookAt, \"tilt\", namespaces.kml);\n    const range = queryNumericValue(lookAt, \"range\", namespaces.kml) ?? 0.0;\n\n    tilt = CesiumMath.toRadians(tilt ?? 0.0);\n    heading = CesiumMath.toRadians(heading ?? 0.0);\n\n    const hpr = new HeadingPitchRange(\n      heading,\n      tilt - CesiumMath.PI_OVER_TWO,\n      range,\n    );\n    const viewPoint = Cartesian3.fromDegrees(lon, lat, altitude, ellipsoid);\n\n    entity.kml.lookAt = new KmlLookAt(viewPoint, hpr);\n  }\n}\n\nfunction processScreenOverlay(\n  dataSource,\n  screenOverlayNode,\n  processingData,\n  deferredLoading,\n) {\n  const screenOverlay = processingData.screenOverlayContainer;\n  if (!defined(screenOverlay)) {\n    return undefined;\n  }\n\n  const sourceResource = processingData.sourceResource;\n  const uriResolver = processingData.uriResolver;\n\n  const iconNode = queryFirstNode(screenOverlayNode, \"Icon\", namespaces.kml);\n  const icon = getIconHref(\n    iconNode,\n    dataSource,\n    sourceResource,\n    uriResolver,\n    false,\n  );\n\n  if (!defined(icon)) {\n    return undefined;\n  }\n\n  const img = document.createElement(\"img\");\n  dataSource._screenOverlays.push(img);\n\n  img.src = icon.url;\n  img.onload = function () {\n    const styles = [\"position: absolute\"];\n\n    const screenXY = queryFirstNode(\n      screenOverlayNode,\n      \"screenXY\",\n      namespaces.kml,\n    );\n    const overlayXY = queryFirstNode(\n      screenOverlayNode,\n      \"overlayXY\",\n      namespaces.kml,\n    );\n    const size = queryFirstNode(screenOverlayNode, \"size\", namespaces.kml);\n\n    let x, y;\n    let xUnit, yUnit;\n    let xStyle, yStyle;\n\n    if (defined(size)) {\n      x = queryNumericAttribute(size, \"x\");\n      y = queryNumericAttribute(size, \"y\");\n      xUnit = queryStringAttribute(size, \"xunits\");\n      yUnit = queryStringAttribute(size, \"yunits\");\n\n      if (defined(x) && x !== -1 && x !== 0) {\n        if (xUnit === \"fraction\") {\n          xStyle = `width: ${Math.floor(x * 100)}%`;\n        } else if (xUnit === \"pixels\") {\n          xStyle = `width: ${x}px`;\n        }\n\n        styles.push(xStyle);\n      }\n\n      if (defined(y) && y !== -1 && y !== 0) {\n        if (yUnit === \"fraction\") {\n          yStyle = `height: ${Math.floor(y * 100)}%`;\n        } else if (yUnit === \"pixels\") {\n          yStyle = `height: ${y}px`;\n        }\n\n        styles.push(yStyle);\n      }\n    }\n\n    // set the interim style so the width/height properties get calculated\n    img.style = styles.join(\";\");\n\n    let xOrigin = 0;\n    let yOrigin = img.height;\n\n    if (defined(overlayXY)) {\n      x = queryNumericAttribute(overlayXY, \"x\");\n      y = queryNumericAttribute(overlayXY, \"y\");\n      xUnit = queryStringAttribute(overlayXY, \"xunits\");\n      yUnit = queryStringAttribute(overlayXY, \"yunits\");\n\n      if (defined(x)) {\n        if (xUnit === \"fraction\") {\n          xOrigin = x * img.width;\n        } else if (xUnit === \"pixels\") {\n          xOrigin = x;\n        } else if (xUnit === \"insetPixels\") {\n          xOrigin = x;\n        }\n      }\n\n      if (defined(y)) {\n        if (yUnit === \"fraction\") {\n          yOrigin = y * img.height;\n        } else if (yUnit === \"pixels\") {\n          yOrigin = y;\n        } else if (yUnit === \"insetPixels\") {\n          yOrigin = y;\n        }\n      }\n    }\n\n    if (defined(screenXY)) {\n      x = queryNumericAttribute(screenXY, \"x\");\n      y = queryNumericAttribute(screenXY, \"y\");\n      xUnit = queryStringAttribute(screenXY, \"xunits\");\n      yUnit = queryStringAttribute(screenXY, \"yunits\");\n\n      if (defined(x)) {\n        if (xUnit === \"fraction\") {\n          xStyle = `${\"left: \" + \"calc(\"}${Math.floor(\n            x * 100,\n          )}% - ${xOrigin}px)`;\n        } else if (xUnit === \"pixels\") {\n          xStyle = `left: ${x - xOrigin}px`;\n        } else if (xUnit === \"insetPixels\") {\n          xStyle = `right: ${x - xOrigin}px`;\n        }\n\n        styles.push(xStyle);\n      }\n\n      if (defined(y)) {\n        if (yUnit === \"fraction\") {\n          yStyle = `${\"bottom: \" + \"calc(\"}${Math.floor(\n            y * 100,\n          )}% - ${yOrigin}px)`;\n        } else if (yUnit === \"pixels\") {\n          yStyle = `bottom: ${y - yOrigin}px`;\n        } else if (yUnit === \"insetPixels\") {\n          yStyle = `top: ${y - yOrigin}px`;\n        }\n\n        styles.push(yStyle);\n      }\n    }\n\n    img.style = styles.join(\";\");\n  };\n\n  screenOverlay.appendChild(img);\n}\n\nfunction processGroundOverlay(\n  dataSource,\n  groundOverlay,\n  processingData,\n  deferredLoading,\n) {\n  const r = processFeature(dataSource, groundOverlay, processingData);\n  const entity = r.entity;\n\n  let geometry;\n  let isLatLonQuad = false;\n\n  const ellipsoid = dataSource._ellipsoid;\n  const positions = readCoordinates(\n    queryFirstNode(groundOverlay, \"LatLonQuad\", namespaces.gx),\n    ellipsoid,\n  );\n  const zIndex = queryNumericValue(groundOverlay, \"drawOrder\", namespaces.kml);\n  if (defined(positions)) {\n    geometry = createDefaultPolygon();\n    geometry.hierarchy = new PolygonHierarchy(positions);\n    geometry.zIndex = zIndex;\n    entity.polygon = geometry;\n    isLatLonQuad = true;\n  } else {\n    geometry = new RectangleGraphics();\n    geometry.zIndex = zIndex;\n    entity.rectangle = geometry;\n\n    const latLonBox = queryFirstNode(\n      groundOverlay,\n      \"LatLonBox\",\n      namespaces.kml,\n    );\n    if (defined(latLonBox)) {\n      let west = queryNumericValue(latLonBox, \"west\", namespaces.kml);\n      let south = queryNumericValue(latLonBox, \"south\", namespaces.kml);\n      let east = queryNumericValue(latLonBox, \"east\", namespaces.kml);\n      let north = queryNumericValue(latLonBox, \"north\", namespaces.kml);\n\n      if (defined(west)) {\n        west = CesiumMath.negativePiToPi(CesiumMath.toRadians(west));\n      }\n      if (defined(south)) {\n        south = CesiumMath.clampToLatitudeRange(CesiumMath.toRadians(south));\n      }\n      if (defined(east)) {\n        east = CesiumMath.negativePiToPi(CesiumMath.toRadians(east));\n      }\n      if (defined(north)) {\n        north = CesiumMath.clampToLatitudeRange(CesiumMath.toRadians(north));\n      }\n      geometry.coordinates = new Rectangle(west, south, east, north);\n\n      const rotation = queryNumericValue(latLonBox, \"rotation\", namespaces.kml);\n      if (defined(rotation)) {\n        const rotationRadians = CesiumMath.toRadians(rotation);\n        geometry.rotation = rotationRadians;\n        geometry.stRotation = rotationRadians;\n      }\n    }\n  }\n\n  const iconNode = queryFirstNode(groundOverlay, \"Icon\", namespaces.kml);\n  const href = getIconHref(\n    iconNode,\n    dataSource,\n    processingData.sourceResource,\n    processingData.uriResolver,\n    true,\n  );\n  if (defined(href)) {\n    if (isLatLonQuad) {\n      oneTimeWarning(\n        \"kml-gx:LatLonQuad\",\n        \"KML - gx:LatLonQuad Icon does not support texture projection.\",\n      );\n    }\n    const x = queryNumericValue(iconNode, \"x\", namespaces.gx);\n    const y = queryNumericValue(iconNode, \"y\", namespaces.gx);\n    const w = queryNumericValue(iconNode, \"w\", namespaces.gx);\n    const h = queryNumericValue(iconNode, \"h\", namespaces.gx);\n\n    if (defined(x) || defined(y) || defined(w) || defined(h)) {\n      oneTimeWarning(\n        \"kml-groundOverlay-xywh\",\n        \"KML - gx:x, gx:y, gx:w, gx:h aren't supported for GroundOverlays\",\n      );\n    }\n\n    geometry.material = href;\n    geometry.material.color = queryColorValue(\n      groundOverlay,\n      \"color\",\n      namespaces.kml,\n    );\n    geometry.material.transparent = true;\n  } else {\n    geometry.material = queryColorValue(groundOverlay, \"color\", namespaces.kml);\n  }\n\n  let altitudeMode = queryStringValue(\n    groundOverlay,\n    \"altitudeMode\",\n    namespaces.kml,\n  );\n\n  if (defined(altitudeMode)) {\n    if (altitudeMode === \"absolute\") {\n      //Use height above ellipsoid until we support MSL.\n      geometry.height = queryNumericValue(\n        groundOverlay,\n        \"altitude\",\n        namespaces.kml,\n      );\n      geometry.zIndex = undefined;\n    } else if (altitudeMode !== \"clampToGround\") {\n      oneTimeWarning(\n        \"kml-altitudeMode-unknown\",\n        `KML - Unknown altitudeMode: ${altitudeMode}`,\n      );\n    }\n    // else just use the default of 0 until we support 'clampToGround'\n  } else {\n    altitudeMode = queryStringValue(\n      groundOverlay,\n      \"altitudeMode\",\n      namespaces.gx,\n    );\n    if (altitudeMode === \"relativeToSeaFloor\") {\n      oneTimeWarning(\n        \"kml-altitudeMode-relativeToSeaFloor\",\n        \"KML - altitudeMode relativeToSeaFloor is currently not supported, treating as absolute.\",\n      );\n      geometry.height = queryNumericValue(\n        groundOverlay,\n        \"altitude\",\n        namespaces.kml,\n      );\n      geometry.zIndex = undefined;\n    } else if (altitudeMode === \"clampToSeaFloor\") {\n      oneTimeWarning(\n        \"kml-altitudeMode-clampToSeaFloor\",\n        \"KML - altitudeMode clampToSeaFloor is currently not supported, treating as clampToGround.\",\n      );\n    } else if (defined(altitudeMode)) {\n      oneTimeWarning(\n        \"kml-altitudeMode-unknown\",\n        `KML - Unknown altitudeMode: ${altitudeMode}`,\n      );\n    }\n  }\n}\n\nfunction processUnsupportedFeature(\n  dataSource,\n  node,\n  processingData,\n  deferredLoading,\n) {\n  dataSource._unsupportedNode.raiseEvent(\n    dataSource,\n    processingData.parentEntity,\n    node,\n    processingData.entityCollection,\n    processingData.styleCollection,\n    processingData.sourceResource,\n    processingData.uriResolver,\n  );\n  oneTimeWarning(\n    `kml-unsupportedFeature-${node.nodeName}`,\n    `KML - Unsupported feature: ${node.nodeName}`,\n  );\n}\n\nconst RefreshMode = {\n  INTERVAL: 0,\n  EXPIRE: 1,\n  STOP: 2,\n};\n\nfunction cleanupString(s) {\n  if (!defined(s) || s.length === 0) {\n    return \"\";\n  }\n\n  const sFirst = s[0];\n  if (sFirst === \"&\" || sFirst === \"?\") {\n    s = s.substring(1);\n  }\n\n  return s;\n}\n\nconst zeroRectangle = new Rectangle();\nconst scratchCartographic = new Cartographic();\nconst scratchCartesian2 = new Cartesian2();\nconst scratchCartesian3 = new Cartesian3();\n\nfunction processNetworkLinkQueryString(\n  resource,\n  camera,\n  canvas,\n  viewBoundScale,\n  bbox,\n  ellipsoid,\n) {\n  function fixLatitude(value) {\n    if (value < -CesiumMath.PI_OVER_TWO) {\n      return -CesiumMath.PI_OVER_TWO;\n    } else if (value > CesiumMath.PI_OVER_TWO) {\n      return CesiumMath.PI_OVER_TWO;\n    }\n    return value;\n  }\n\n  function fixLongitude(value) {\n    if (value > CesiumMath.PI) {\n      return value - CesiumMath.TWO_PI;\n    } else if (value < -CesiumMath.PI) {\n      return value + CesiumMath.TWO_PI;\n    }\n\n    return value;\n  }\n\n  let queryString = objectToQuery(resource.queryParameters);\n\n  // objectToQuery escapes [ and ], so fix that\n  queryString = queryString.replace(/%5B/g, \"[\").replace(/%5D/g, \"]\");\n\n  if (defined(camera) && camera._mode !== SceneMode.MORPHING) {\n    let centerCartesian;\n    let centerCartographic;\n\n    bbox = bbox ?? zeroRectangle;\n    if (defined(canvas)) {\n      scratchCartesian2.x = canvas.clientWidth * 0.5;\n      scratchCartesian2.y = canvas.clientHeight * 0.5;\n      centerCartesian = camera.pickEllipsoid(\n        scratchCartesian2,\n        ellipsoid,\n        scratchCartesian3,\n      );\n    }\n\n    if (defined(centerCartesian)) {\n      centerCartographic = ellipsoid.cartesianToCartographic(\n        centerCartesian,\n        scratchCartographic,\n      );\n    } else {\n      centerCartographic = Rectangle.center(bbox, scratchCartographic);\n      centerCartesian = ellipsoid.cartographicToCartesian(centerCartographic);\n    }\n\n    if (\n      defined(viewBoundScale) &&\n      !CesiumMath.equalsEpsilon(viewBoundScale, 1.0, CesiumMath.EPSILON9)\n    ) {\n      const newHalfWidth = bbox.width * viewBoundScale * 0.5;\n      const newHalfHeight = bbox.height * viewBoundScale * 0.5;\n      bbox = new Rectangle(\n        fixLongitude(centerCartographic.longitude - newHalfWidth),\n        fixLatitude(centerCartographic.latitude - newHalfHeight),\n        fixLongitude(centerCartographic.longitude + newHalfWidth),\n        fixLatitude(centerCartographic.latitude + newHalfHeight),\n      );\n    }\n\n    queryString = queryString.replace(\n      \"[bboxWest]\",\n      CesiumMath.toDegrees(bbox.west).toString(),\n    );\n    queryString = queryString.replace(\n      \"[bboxSouth]\",\n      CesiumMath.toDegrees(bbox.south).toString(),\n    );\n    queryString = queryString.replace(\n      \"[bboxEast]\",\n      CesiumMath.toDegrees(bbox.east).toString(),\n    );\n    queryString = queryString.replace(\n      \"[bboxNorth]\",\n      CesiumMath.toDegrees(bbox.north).toString(),\n    );\n\n    const lon = CesiumMath.toDegrees(centerCartographic.longitude).toString();\n    const lat = CesiumMath.toDegrees(centerCartographic.latitude).toString();\n    queryString = queryString.replace(\"[lookatLon]\", lon);\n    queryString = queryString.replace(\"[lookatLat]\", lat);\n    queryString = queryString.replace(\n      \"[lookatTilt]\",\n      CesiumMath.toDegrees(camera.pitch).toString(),\n    );\n    queryString = queryString.replace(\n      \"[lookatHeading]\",\n      CesiumMath.toDegrees(camera.heading).toString(),\n    );\n    queryString = queryString.replace(\n      \"[lookatRange]\",\n      Cartesian3.distance(camera.positionWC, centerCartesian),\n    );\n    queryString = queryString.replace(\"[lookatTerrainLon]\", lon);\n    queryString = queryString.replace(\"[lookatTerrainLat]\", lat);\n    queryString = queryString.replace(\n      \"[lookatTerrainAlt]\",\n      centerCartographic.height.toString(),\n    );\n\n    ellipsoid.cartesianToCartographic(camera.positionWC, scratchCartographic);\n    queryString = queryString.replace(\n      \"[cameraLon]\",\n      CesiumMath.toDegrees(scratchCartographic.longitude).toString(),\n    );\n    queryString = queryString.replace(\n      \"[cameraLat]\",\n      CesiumMath.toDegrees(scratchCartographic.latitude).toString(),\n    );\n    queryString = queryString.replace(\n      \"[cameraAlt]\",\n      CesiumMath.toDegrees(scratchCartographic.height).toString(),\n    );\n\n    const frustum = camera.frustum;\n    const aspectRatio = frustum.aspectRatio;\n    let horizFov = \"\";\n    let vertFov = \"\";\n    if (defined(aspectRatio)) {\n      const fov = CesiumMath.toDegrees(frustum.fov);\n      if (aspectRatio > 1.0) {\n        horizFov = fov;\n        vertFov = fov / aspectRatio;\n      } else {\n        vertFov = fov;\n        horizFov = fov * aspectRatio;\n      }\n    }\n    queryString = queryString.replace(\"[horizFov]\", horizFov.toString());\n    queryString = queryString.replace(\"[vertFov]\", vertFov.toString());\n  } else {\n    queryString = queryString.replace(\"[bboxWest]\", \"-180\");\n    queryString = queryString.replace(\"[bboxSouth]\", \"-90\");\n    queryString = queryString.replace(\"[bboxEast]\", \"180\");\n    queryString = queryString.replace(\"[bboxNorth]\", \"90\");\n\n    queryString = queryString.replace(\"[lookatLon]\", \"\");\n    queryString = queryString.replace(\"[lookatLat]\", \"\");\n    queryString = queryString.replace(\"[lookatRange]\", \"\");\n    queryString = queryString.replace(\"[lookatTilt]\", \"\");\n    queryString = queryString.replace(\"[lookatHeading]\", \"\");\n    queryString = queryString.replace(\"[lookatTerrainLon]\", \"\");\n    queryString = queryString.replace(\"[lookatTerrainLat]\", \"\");\n    queryString = queryString.replace(\"[lookatTerrainAlt]\", \"\");\n\n    queryString = queryString.replace(\"[cameraLon]\", \"\");\n    queryString = queryString.replace(\"[cameraLat]\", \"\");\n    queryString = queryString.replace(\"[cameraAlt]\", \"\");\n    queryString = queryString.replace(\"[horizFov]\", \"\");\n    queryString = queryString.replace(\"[vertFov]\", \"\");\n  }\n\n  if (defined(canvas)) {\n    queryString = queryString.replace(\"[horizPixels]\", canvas.clientWidth);\n    queryString = queryString.replace(\"[vertPixels]\", canvas.clientHeight);\n  } else {\n    queryString = queryString.replace(\"[horizPixels]\", \"\");\n    queryString = queryString.replace(\"[vertPixels]\", \"\");\n  }\n\n  queryString = queryString.replace(\"[terrainEnabled]\", \"1\");\n  queryString = queryString.replace(\"[clientVersion]\", \"1\");\n  queryString = queryString.replace(\"[kmlVersion]\", \"2.2\");\n  queryString = queryString.replace(\"[clientName]\", \"Cesium\");\n  queryString = queryString.replace(\"[language]\", \"English\");\n\n  resource.setQueryParameters(queryToObject(queryString));\n}\n\nfunction processNetworkLink(dataSource, node, processingData, deferredLoading) {\n  const r = processFeature(dataSource, node, processingData);\n  const networkEntity = r.entity;\n\n  const sourceResource = processingData.sourceResource;\n  const uriResolver = processingData.uriResolver;\n\n  let link = queryFirstNode(node, \"Link\", namespaces.kml);\n\n  if (!defined(link)) {\n    link = queryFirstNode(node, \"Url\", namespaces.kml);\n  }\n  if (defined(link)) {\n    let href = queryStringValue(link, \"href\", namespaces.kml);\n    let viewRefreshMode;\n    let viewBoundScale;\n    if (defined(href)) {\n      let newSourceUri = href;\n      href = resolveHref(href, sourceResource, processingData.uriResolver);\n\n      // We need to pass in the original path if resolveHref returns a data uri because the network link\n      //  references a document in a KMZ archive\n      if (/^data:/.test(href.getUrlComponent())) {\n        // So if sourceUri isn't the kmz file, then its another kml in the archive, so resolve it\n        if (!/\\.kmz/i.test(sourceResource.getUrlComponent())) {\n          newSourceUri = sourceResource.getDerivedResource({\n            url: newSourceUri,\n          });\n        }\n      } else {\n        newSourceUri = href.clone(); // Not a data uri so use the fully qualified uri\n        viewRefreshMode = queryStringValue(\n          link,\n          \"viewRefreshMode\",\n          namespaces.kml,\n        );\n        if (viewRefreshMode === \"onRegion\") {\n          oneTimeWarning(\n            \"kml-refrehMode-onRegion\",\n            \"KML - Unsupported viewRefreshMode: onRegion\",\n          );\n          return;\n        }\n        viewBoundScale =\n          queryStringValue(link, \"viewBoundScale\", namespaces.kml) ?? 1.0;\n        const defaultViewFormat =\n          viewRefreshMode === \"onStop\"\n            ? \"BBOX=[bboxWest],[bboxSouth],[bboxEast],[bboxNorth]\"\n            : \"\";\n        const viewFormat =\n          queryStringValue(link, \"viewFormat\", namespaces.kml) ??\n          defaultViewFormat;\n        const httpQuery = queryStringValue(link, \"httpQuery\", namespaces.kml);\n        if (defined(viewFormat)) {\n          href.setQueryParameters(queryToObject(cleanupString(viewFormat)));\n        }\n        if (defined(httpQuery)) {\n          href.setQueryParameters(queryToObject(cleanupString(httpQuery)));\n        }\n\n        const ellipsoid = dataSource._ellipsoid;\n        processNetworkLinkQueryString(\n          href,\n          dataSource.camera,\n          dataSource.canvas,\n          viewBoundScale,\n          dataSource._lastCameraView.bbox,\n          ellipsoid,\n        );\n      }\n\n      const options = {\n        sourceUri: newSourceUri,\n        uriResolver: uriResolver,\n        context: networkEntity.id,\n        screenOverlayContainer: processingData.screenOverlayContainer,\n      };\n      const networkLinkCollection = new EntityCollection();\n      const promise = load(dataSource, networkLinkCollection, href, options)\n        .then(function (rootElement) {\n          const entities = dataSource._entityCollection;\n          const newEntities = networkLinkCollection.values;\n          entities.suspendEvents();\n          for (let i = 0; i < newEntities.length; i++) {\n            const newEntity = newEntities[i];\n            if (!defined(newEntity.parent)) {\n              newEntity.parent = networkEntity;\n              mergeAvailabilityWithParent(newEntity);\n            }\n\n            entities.add(newEntity);\n          }\n          entities.resumeEvents();\n\n          // Add network links to a list if we need they will need to be updated\n          const refreshMode = queryStringValue(\n            link,\n            \"refreshMode\",\n            namespaces.kml,\n          );\n          let refreshInterval =\n            queryNumericValue(link, \"refreshInterval\", namespaces.kml) ?? 0;\n          if (\n            (refreshMode === \"onInterval\" && refreshInterval > 0) ||\n            refreshMode === \"onExpire\" ||\n            viewRefreshMode === \"onStop\"\n          ) {\n            const networkLinkControl = queryFirstNode(\n              rootElement,\n              \"NetworkLinkControl\",\n              namespaces.kml,\n            );\n            const hasNetworkLinkControl = defined(networkLinkControl);\n\n            const now = JulianDate.now();\n            const networkLinkInfo = {\n              id: createGuid(),\n              href: href,\n              cookie: {},\n              lastUpdated: now,\n              updating: false,\n              entity: networkEntity,\n              viewBoundScale: viewBoundScale,\n              needsUpdate: false,\n              cameraUpdateTime: now,\n            };\n\n            let minRefreshPeriod = 0;\n            if (hasNetworkLinkControl) {\n              networkLinkInfo.cookie = queryToObject(\n                queryStringValue(\n                  networkLinkControl,\n                  \"cookie\",\n                  namespaces.kml,\n                ) ?? \"\",\n              );\n              minRefreshPeriod =\n                queryNumericValue(\n                  networkLinkControl,\n                  \"minRefreshPeriod\",\n                  namespaces.kml,\n                ) ?? 0;\n            }\n\n            if (refreshMode === \"onInterval\") {\n              if (hasNetworkLinkControl) {\n                refreshInterval = Math.max(minRefreshPeriod, refreshInterval);\n              }\n              networkLinkInfo.refreshMode = RefreshMode.INTERVAL;\n              networkLinkInfo.time = refreshInterval;\n            } else if (refreshMode === \"onExpire\") {\n              let expires;\n              if (hasNetworkLinkControl) {\n                expires = queryStringValue(\n                  networkLinkControl,\n                  \"expires\",\n                  namespaces.kml,\n                );\n              }\n              if (defined(expires)) {\n                try {\n                  const date = JulianDate.fromIso8601(expires);\n                  const diff = JulianDate.secondsDifference(date, now);\n                  if (diff > 0 && diff < minRefreshPeriod) {\n                    JulianDate.addSeconds(now, minRefreshPeriod, date);\n                  }\n                  networkLinkInfo.refreshMode = RefreshMode.EXPIRE;\n                  networkLinkInfo.time = date;\n                } catch (e) {\n                  oneTimeWarning(\n                    \"kml-refreshMode-onInterval-onExpire\",\n                    \"KML - NetworkLinkControl expires is not a valid date\",\n                  );\n                }\n              } else {\n                oneTimeWarning(\n                  \"kml-refreshMode-onExpire\",\n                  \"KML - refreshMode of onExpire requires the NetworkLinkControl to have an expires element\",\n                );\n              }\n            } else if (defined(dataSource.camera)) {\n              // Only allow onStop refreshes if we have a camera\n              networkLinkInfo.refreshMode = RefreshMode.STOP;\n              networkLinkInfo.time =\n                queryNumericValue(link, \"viewRefreshTime\", namespaces.kml) ?? 0;\n            } else {\n              oneTimeWarning(\n                \"kml-refrehMode-onStop-noCamera\",\n                \"A NetworkLink with viewRefreshMode=onStop requires the `camera` property to be defined.\",\n              );\n            }\n\n            if (defined(networkLinkInfo.refreshMode)) {\n              dataSource._networkLinks.set(networkLinkInfo.id, networkLinkInfo);\n            }\n          }\n        })\n        .catch(function (error) {\n          oneTimeWarning(`An error occured during loading ${href.url}`);\n          dataSource._error.raiseEvent(dataSource, error);\n        });\n\n      deferredLoading.addPromise(promise);\n    }\n  }\n}\n\nfunction processFeatureNode(dataSource, node, processingData, deferredLoading) {\n  const featureProcessor = featureTypes[node.localName];\n  if (defined(featureProcessor)) {\n    return featureProcessor(dataSource, node, processingData, deferredLoading);\n  }\n\n  return processUnsupportedFeature(\n    dataSource,\n    node,\n    processingData,\n    deferredLoading,\n  );\n}\n\nfunction loadKml(\n  dataSource,\n  entityCollection,\n  kml,\n  sourceResource,\n  uriResolver,\n  screenOverlayContainer,\n  context,\n) {\n  entityCollection.removeAll();\n\n  const documentElement = kml.documentElement;\n  const document =\n    documentElement.localName === \"Document\"\n      ? documentElement\n      : queryFirstNode(documentElement, \"Document\", namespaces.kml);\n  let name = queryStringValue(document, \"name\", namespaces.kml);\n  if (!defined(name)) {\n    name = getFilenameFromUri(sourceResource.getUrlComponent());\n  }\n\n  // Only set the name from the root document\n  if (!defined(dataSource._name)) {\n    dataSource._name = name;\n  }\n\n  const deferredLoading = new KmlDataSource._DeferredLoading(dataSource);\n  const styleCollection = new EntityCollection(dataSource);\n  return Promise.all(\n    processStyles(\n      dataSource,\n      kml,\n      styleCollection,\n      sourceResource,\n      false,\n      uriResolver,\n    ),\n  ).then(function () {\n    let element = kml.documentElement;\n    if (element.localName === \"kml\") {\n      const childNodes = element.childNodes;\n      for (let i = 0; i < childNodes.length; i++) {\n        const tmp = childNodes[i];\n        if (defined(featureTypes[tmp.localName])) {\n          element = tmp;\n          break;\n        }\n      }\n    }\n\n    const processingData = {\n      parentEntity: undefined,\n      entityCollection: entityCollection,\n      styleCollection: styleCollection,\n      sourceResource: sourceResource,\n      uriResolver: uriResolver,\n      context: context,\n      screenOverlayContainer: screenOverlayContainer,\n    };\n\n    entityCollection.suspendEvents();\n    processFeatureNode(dataSource, element, processingData, deferredLoading);\n    entityCollection.resumeEvents();\n\n    return deferredLoading.wait().then(function () {\n      return kml.documentElement;\n    });\n  });\n}\n\nasync function loadKmz(\n  dataSource,\n  entityCollection,\n  blob,\n  sourceResource,\n  screenOverlayContainer,\n) {\n  const zWorkerUri = buildModuleUrl(\"ThirdParty/Workers/zip-web-worker.js\");\n  const zWasmUri = buildModuleUrl(\"ThirdParty/zip-module.wasm\");\n  configure({\n    workerURI: zWorkerUri,\n    wasmURI: zWasmUri,\n  });\n\n  const reader = new ZipReader(new BlobReader(blob));\n  const entries = await reader.getEntries();\n\n  const promises = [];\n  const uriResolver = {};\n  let docEntry;\n  for (let i = 0; i < entries.length; i++) {\n    const entry = entries[i];\n    if (!entry.directory) {\n      if (/\\.kml$/i.test(entry.filename)) {\n        // We use the first KML document we come across\n        //  https://developers.google.com/kml/documentation/kmzarchives\n        // Unless we come across a .kml file at the root of the archive because GE does this\n        if (!defined(docEntry) || !/\\//i.test(entry.filename)) {\n          if (defined(docEntry)) {\n            // We found one at the root so load the initial kml as a data uri\n            promises.push(loadDataUriFromZip(docEntry, uriResolver));\n          }\n          docEntry = entry;\n        } else {\n          // Wasn't the first kml and wasn't at the root\n          promises.push(loadDataUriFromZip(entry, uriResolver));\n        }\n      } else {\n        promises.push(loadDataUriFromZip(entry, uriResolver));\n      }\n    }\n  }\n\n  // Now load the root KML document\n  if (defined(docEntry)) {\n    promises.push(loadXmlFromZip(docEntry, uriResolver));\n  }\n  await Promise.all(promises);\n  reader.close();\n  if (!defined(uriResolver.kml)) {\n    throw new RuntimeError(\"KMZ file does not contain a KML document.\");\n  }\n  uriResolver.keys = Object.keys(uriResolver);\n\n  return loadKml(\n    dataSource,\n    entityCollection,\n    uriResolver.kml,\n    sourceResource,\n    uriResolver,\n    screenOverlayContainer,\n  );\n}\n\nfunction load(dataSource, entityCollection, data, options) {\n  options = options ?? Frozen.EMPTY_OBJECT;\n  let sourceUri = options.sourceUri;\n  const uriResolver = options.uriResolver;\n  const context = options.context;\n  let screenOverlayContainer = options.screenOverlayContainer;\n\n  let promise = data;\n  if (typeof data === \"string\" || data instanceof Resource) {\n    data = Resource.createIfNeeded(data);\n    promise = data.fetchBlob();\n    sourceUri = sourceUri ?? data.clone();\n\n    // Add resource credits to our list of credits to display\n    const resourceCredits = dataSource._resourceCredits;\n    const credits = data.credits;\n    if (defined(credits)) {\n      const length = credits.length;\n      for (let i = 0; i < length; i++) {\n        resourceCredits.push(credits[i]);\n      }\n    }\n  } else {\n    sourceUri = sourceUri ?? Resource.DEFAULT.clone();\n  }\n\n  sourceUri = Resource.createIfNeeded(sourceUri);\n\n  if (defined(screenOverlayContainer)) {\n    screenOverlayContainer = getElement(screenOverlayContainer);\n  }\n\n  return Promise.resolve(promise)\n    .then(function (dataToLoad) {\n      if (dataToLoad instanceof Blob) {\n        return isZipFile(dataToLoad).then(function (isZip) {\n          if (isZip) {\n            return loadKmz(\n              dataSource,\n              entityCollection,\n              dataToLoad,\n              sourceUri,\n              screenOverlayContainer,\n            );\n          }\n          return readBlobAsText(dataToLoad).then(function (text) {\n            //There's no official way to validate if a parse was successful.\n            //The following check detects the error on various browsers.\n\n            //Insert missing namespaces\n            text = insertNamespaces(text);\n\n            //Remove Duplicate Namespaces\n            text = removeDuplicateNamespaces(text);\n\n            //IE raises an exception\n            let kml;\n            let error;\n            try {\n              kml = parser.parseFromString(text, \"application/xml\");\n            } catch (e) {\n              error = e.toString();\n            }\n\n            //The parse succeeds on Chrome and Firefox, but the error\n            //handling is different in each.\n            if (\n              defined(error) ||\n              kml.body ||\n              kml.documentElement.tagName === \"parsererror\"\n            ) {\n              //Firefox has error information as the firstChild nodeValue.\n              let msg = defined(error)\n                ? error\n                : kml.documentElement.firstChild.nodeValue;\n\n              //Chrome has it in the body text.\n              if (!msg) {\n                msg = kml.body.innerText;\n              }\n\n              //Return the error\n              throw new RuntimeError(msg);\n            }\n            return loadKml(\n              dataSource,\n              entityCollection,\n              kml,\n              sourceUri,\n              uriResolver,\n              screenOverlayContainer,\n              context,\n            );\n          });\n        });\n      }\n      return loadKml(\n        dataSource,\n        entityCollection,\n        dataToLoad,\n        sourceUri,\n        uriResolver,\n        screenOverlayContainer,\n        context,\n      );\n    })\n    .catch(function (error) {\n      dataSource._error.raiseEvent(dataSource, error);\n      console.log(error);\n      return Promise.reject(error);\n    });\n}\n\n// NOTE: LoadOptions properties are repeated in ConstructorOptions because some\n// tooling does not support \"base types\" for @typedef.  Remove if/when\n// https://github.com/microsoft/TypeScript/issues/20077 and/or\n// https://github.com/jsdoc/jsdoc/issues/1199 actually get resolved\n/**\n * @typedef {object} KmlDataSource.LoadOptions\n *\n * Initialization options for the `load` method.\n *\n * @property {string} [sourceUri] Overrides the url to use for resolving relative links and other KML network features.\n * @property {boolean} [clampToGround=false] true if we want the geometry features (Polygons, LineStrings and LinearRings) clamped to the ground.\n * @property {Ellipsoid} [ellipsoid=Ellipsoid.default] The global ellipsoid used for geographical calculations.\n * @property {Element|string} [screenOverlayContainer] A container for ScreenOverlay images.\n */\n\n/**\n * @typedef {object} KmlDataSource.ConstructorOptions\n *\n * Options for constructing a new KmlDataSource, or calling the static `load` method.\n *\n * @property {Camera} [camera] The camera that is used for viewRefreshModes and sending camera properties to network links.\n * @property {HTMLCanvasElement} [canvas] The canvas that is used for sending viewer properties to network links.\n * @property {Credit|string} [credit] A credit for the data source, which is displayed on the canvas.\n *\n * @property {string} [sourceUri] Overrides the url to use for resolving relative links and other KML network features.\n * @property {boolean} [clampToGround=false] true if we want the geometry features (Polygons, LineStrings and LinearRings) clamped to the ground.\n * @property {Ellipsoid} [ellipsoid=Ellipsoid.default] The global ellipsoid used for geographical calculations.\n * @property {Element|string} [screenOverlayContainer] A container for ScreenOverlay images.\n\n*/\n\n/**\n * A {@link DataSource} which processes Keyhole Markup Language 2.2 (KML).\n * <p>\n * KML support in Cesium is incomplete, but a large amount of the standard,\n * as well as Google's <code>gx</code> extension namespace, is supported. See Github issue\n * {@link https://github.com/CesiumGS/cesium/issues/873|#873} for a\n * detailed list of what is and isn't supported. Cesium will also write information to the\n * console when it encounters most unsupported features.\n * </p>\n * <p>\n * Non visual feature data, such as <code>atom:author</code> and <code>ExtendedData</code>\n * is exposed via an instance of {@link KmlFeatureData}, which is added to each {@link Entity}\n * under the <code>kml</code> property.\n * </p>\n *\n * @alias KmlDataSource\n * @constructor\n *\n * @param {KmlDataSource.ConstructorOptions} [options] Object describing initialization options\n *\n * @see {@link http://www.opengeospatial.org/standards/kml/|Open Geospatial Consortium KML Standard}\n * @see {@link https://developers.google.com/kml/|Google KML Documentation}\n *\n * @demo {@link https://sandcastle.cesium.com/index.html?src=KML.html|Cesium Sandcastle KML Demo}\n *\n * @example\n * const viewer = new Cesium.Viewer('cesiumContainer');\n * viewer.dataSources.add(Cesium.KmlDataSource.load('../../SampleData/facilities.kmz',\n *      {\n *           camera: viewer.scene.camera,\n *           canvas: viewer.scene.canvas\n *      })\n * );\n */\nfunction KmlDataSource(options) {\n  options = options ?? Frozen.EMPTY_OBJECT;\n  const camera = options.camera;\n  const canvas = options.canvas;\n\n  this._changed = new Event();\n  this._error = new Event();\n  this._loading = new Event();\n  this._refresh = new Event();\n  this._unsupportedNode = new Event();\n\n  this._clock = undefined;\n  this._entityCollection = new EntityCollection(this);\n  this._name = undefined;\n  this._isLoading = false;\n  this._pinBuilder = new PinBuilder();\n  this._networkLinks = new AssociativeArray();\n  this._entityCluster = new EntityCluster();\n\n  /**\n   * The current size of this Canvas will be used to populate the Link parameters\n   * for client height and width.\n   *\n   * @type {HTMLCanvasElement | undefined}\n   */\n  this.canvas = canvas;\n\n  /**\n   * The position and orientation of this {@link Camera} will be used to\n   * populate various camera parameters when making network requests.\n   * Camera movement will determine when to trigger NetworkLink refresh if\n   * <code>viewRefreshMode</code> is <code>onStop</code>.\n   *\n   * @type {Camera | undefined}\n   */\n  this.camera = camera;\n\n  this._lastCameraView = {\n    position: defined(camera) ? Cartesian3.clone(camera.positionWC) : undefined,\n    direction: defined(camera)\n      ? Cartesian3.clone(camera.directionWC)\n      : undefined,\n    up: defined(camera) ? Cartesian3.clone(camera.upWC) : undefined,\n    bbox: defined(camera)\n      ? camera.computeViewRectangle()\n      : Rectangle.clone(Rectangle.MAX_VALUE),\n  };\n\n  this._ellipsoid = options.ellipsoid ?? Ellipsoid.default;\n\n  // User specified credit\n  let credit = options.credit;\n  if (typeof credit === \"string\") {\n    credit = new Credit(credit);\n  }\n  this._credit = credit;\n\n  // Create a list of Credit's from the resource that the user can't remove\n  this._resourceCredits = [];\n\n  this._kmlTours = [];\n\n  this._screenOverlays = [];\n}\n\n/**\n * Creates a Promise to a new instance loaded with the provided KML data.\n *\n * @param {Resource|string|Document|Blob} data A url, parsed KML document, or Blob containing binary KMZ data or a parsed KML document.\n * @param {KmlDataSource.ConstructorOptions} [options] An object specifying configuration options\n *\n * @returns {Promise<KmlDataSource>} A promise that will resolve to a new KmlDataSource instance once the KML is loaded.\n */\nKmlDataSource.load = function (data, options) {\n  options = options ?? Frozen.EMPTY_OBJECT;\n  const dataSource = new KmlDataSource(options);\n  return dataSource.load(data, options);\n};\n\nObject.defineProperties(KmlDataSource.prototype, {\n  /**\n   * Gets or sets a human-readable name for this instance.\n   * This will be automatically be set to the KML document name on load.\n   * @memberof KmlDataSource.prototype\n   * @type {string}\n   */\n  name: {\n    get: function () {\n      return this._name;\n    },\n    set: function (value) {\n      if (this._name !== value) {\n        this._name = value;\n        this._changed.raiseEvent(this);\n      }\n    },\n  },\n  /**\n   * Gets the clock settings defined by the loaded KML. This represents the total\n   * availability interval for all time-dynamic data. If the KML does not contain\n   * time-dynamic data, this value is undefined.\n   * @memberof KmlDataSource.prototype\n   * @type {DataSourceClock}\n   */\n  clock: {\n    get: function () {\n      return this._clock;\n    },\n  },\n  /**\n   * Gets the collection of {@link Entity} instances.\n   * @memberof KmlDataSource.prototype\n   * @type {EntityCollection}\n   */\n  entities: {\n    get: function () {\n      return this._entityCollection;\n    },\n  },\n  /**\n   * Gets a value indicating if the data source is currently loading data.\n   * @memberof KmlDataSource.prototype\n   * @type {boolean}\n   */\n  isLoading: {\n    get: function () {\n      return this._isLoading;\n    },\n  },\n  /**\n   * Gets an event that will be raised when the underlying data changes.\n   * @memberof KmlDataSource.prototype\n   * @type {Event}\n   */\n  changedEvent: {\n    get: function () {\n      return this._changed;\n    },\n  },\n  /**\n   * Gets an event that will be raised if an error is encountered during processing.\n   * @memberof KmlDataSource.prototype\n   * @type {Event}\n   */\n  errorEvent: {\n    get: function () {\n      return this._error;\n    },\n  },\n  /**\n   * Gets an event that will be raised when the data source either starts or stops loading.\n   * @memberof KmlDataSource.prototype\n   * @type {Event}\n   */\n  loadingEvent: {\n    get: function () {\n      return this._loading;\n    },\n  },\n  /**\n   * Gets an event that will be raised when the data source refreshes a network link.\n   * @memberof KmlDataSource.prototype\n   * @type {Event}\n   */\n  refreshEvent: {\n    get: function () {\n      return this._refresh;\n    },\n  },\n  /**\n   * Gets an event that will be raised when the data source finds an unsupported node type.\n   * @memberof KmlDataSource.prototype\n   * @type {Event}\n   */\n  unsupportedNodeEvent: {\n    get: function () {\n      return this._unsupportedNode;\n    },\n  },\n  /**\n   * Gets whether or not this data source should be displayed.\n   * @memberof KmlDataSource.prototype\n   * @type {boolean}\n   */\n  show: {\n    get: function () {\n      return this._entityCollection.show;\n    },\n    set: function (value) {\n      this._entityCollection.show = value;\n    },\n  },\n\n  /**\n   * Gets or sets the clustering options for this data source. This object can be shared between multiple data sources.\n   *\n   * @memberof KmlDataSource.prototype\n   * @type {EntityCluster}\n   */\n  clustering: {\n    get: function () {\n      return this._entityCluster;\n    },\n    set: function (value) {\n      //>>includeStart('debug', pragmas.debug);\n      if (!defined(value)) {\n        throw new DeveloperError(\"value must be defined.\");\n      }\n      //>>includeEnd('debug');\n      this._entityCluster = value;\n    },\n  },\n  /**\n   * Gets the credit that will be displayed for the data source\n   * @memberof KmlDataSource.prototype\n   * @type {Credit}\n   */\n  credit: {\n    get: function () {\n      return this._credit;\n    },\n  },\n  /**\n   * Gets the KML Tours that are used to guide the camera to specified destinations on given time intervals.\n   * @memberof KmlDataSource.prototype\n   * @type {KmlTour[]}\n   */\n  kmlTours: {\n    get: function () {\n      return this._kmlTours;\n    },\n  },\n});\n\n/**\n * Asynchronously loads the provided KML data, replacing any existing data.\n *\n * @param {Resource|string|Document|Blob} data A url, parsed KML document, or Blob containing binary KMZ data or a parsed KML document.\n * @param {KmlDataSource.LoadOptions} [options] An object specifying configuration options\n *\n * @returns {Promise<KmlDataSource>} A promise that will resolve to this instances once the KML is loaded.\n */\nKmlDataSource.prototype.load = function (data, options) {\n  //>>includeStart('debug', pragmas.debug);\n  if (!defined(data)) {\n    throw new DeveloperError(\"data is required.\");\n  }\n  //>>includeEnd('debug');\n\n  options = options ?? Frozen.EMPTY_OBJECT;\n  DataSource.setLoading(this, true);\n\n  const oldName = this._name;\n  this._name = undefined;\n  this._clampToGround = options.clampToGround ?? false;\n\n  const that = this;\n  return load(this, this._entityCollection, data, options)\n    .then(function () {\n      let clock;\n\n      const availability = that._entityCollection.computeAvailability();\n\n      let start = availability.start;\n      let stop = availability.stop;\n      const isMinStart = JulianDate.equals(start, Iso8601.MINIMUM_VALUE);\n      const isMaxStop = JulianDate.equals(stop, Iso8601.MAXIMUM_VALUE);\n      if (!isMinStart || !isMaxStop) {\n        let date;\n\n        //If start is min time just start at midnight this morning, local time\n        if (isMinStart) {\n          date = new Date();\n          date.setHours(0, 0, 0, 0);\n          start = JulianDate.fromDate(date);\n        }\n\n        //If stop is max value just stop at midnight tonight, local time\n        if (isMaxStop) {\n          date = new Date();\n          date.setHours(24, 0, 0, 0);\n          stop = JulianDate.fromDate(date);\n        }\n\n        clock = new DataSourceClock();\n        clock.startTime = start;\n        clock.stopTime = stop;\n        clock.currentTime = JulianDate.clone(start);\n        clock.clockRange = ClockRange.LOOP_STOP;\n        clock.clockStep = ClockStep.SYSTEM_CLOCK_MULTIPLIER;\n        clock.multiplier = Math.round(\n          Math.min(\n            Math.max(JulianDate.secondsDifference(stop, start) / 60, 1),\n            3.15569e7,\n          ),\n        );\n      }\n\n      let changed = false;\n      if (clock !== that._clock) {\n        that._clock = clock;\n        changed = true;\n      }\n\n      if (oldName !== that._name) {\n        changed = true;\n      }\n\n      if (changed) {\n        that._changed.raiseEvent(that);\n      }\n\n      DataSource.setLoading(that, false);\n\n      return that;\n    })\n    .catch(function (error) {\n      DataSource.setLoading(that, false);\n      that._error.raiseEvent(that, error);\n      console.log(error);\n      return Promise.reject(error);\n    });\n};\n\n/**\n * Cleans up any non-entity elements created by the data source. Currently this only affects ScreenOverlay elements.\n */\nKmlDataSource.prototype.destroy = function () {\n  while (this._screenOverlays.length > 0) {\n    const elem = this._screenOverlays.pop();\n    elem.remove();\n  }\n};\n\nfunction mergeAvailabilityWithParent(child) {\n  const parent = child.parent;\n  if (defined(parent)) {\n    const parentAvailability = parent.availability;\n    if (defined(parentAvailability)) {\n      const childAvailability = child.availability;\n      if (defined(childAvailability)) {\n        childAvailability.intersect(parentAvailability);\n      } else {\n        child.availability = parentAvailability;\n      }\n    }\n  }\n}\n\nfunction getNetworkLinkUpdateCallback(\n  dataSource,\n  networkLink,\n  newEntityCollection,\n  networkLinks,\n  processedHref,\n) {\n  return function (rootElement) {\n    if (!networkLinks.contains(networkLink.id)) {\n      // Got into the odd case where a parent network link was updated while a child\n      //  network link update was in flight, so just throw it away.\n      return;\n    }\n    let remove = false;\n    const networkLinkControl = queryFirstNode(\n      rootElement,\n      \"NetworkLinkControl\",\n      namespaces.kml,\n    );\n    const hasNetworkLinkControl = defined(networkLinkControl);\n\n    let minRefreshPeriod = 0;\n    if (hasNetworkLinkControl) {\n      if (\n        defined(queryFirstNode(networkLinkControl, \"Update\", namespaces.kml))\n      ) {\n        oneTimeWarning(\n          \"kml-networkLinkControl-update\",\n          \"KML - NetworkLinkControl updates aren't supported.\",\n        );\n        networkLink.updating = false;\n        networkLinks.remove(networkLink.id);\n        return;\n      }\n      networkLink.cookie = queryToObject(\n        queryStringValue(networkLinkControl, \"cookie\", namespaces.kml) ?? \"\",\n      );\n      minRefreshPeriod =\n        queryNumericValue(\n          networkLinkControl,\n          \"minRefreshPeriod\",\n          namespaces.kml,\n        ) ?? 0;\n    }\n\n    const now = JulianDate.now();\n    const refreshMode = networkLink.refreshMode;\n    if (refreshMode === RefreshMode.INTERVAL) {\n      if (defined(networkLinkControl)) {\n        networkLink.time = Math.max(minRefreshPeriod, networkLink.time);\n      }\n    } else if (refreshMode === RefreshMode.EXPIRE) {\n      let expires;\n      if (defined(networkLinkControl)) {\n        expires = queryStringValue(\n          networkLinkControl,\n          \"expires\",\n          namespaces.kml,\n        );\n      }\n      if (defined(expires)) {\n        try {\n          const date = JulianDate.fromIso8601(expires);\n          const diff = JulianDate.secondsDifference(date, now);\n          if (diff > 0 && diff < minRefreshPeriod) {\n            JulianDate.addSeconds(now, minRefreshPeriod, date);\n          }\n          networkLink.time = date;\n        } catch (e) {\n          oneTimeWarning(\n            \"kml-networkLinkControl-expires\",\n            \"KML - NetworkLinkControl expires is not a valid date\",\n          );\n          remove = true;\n        }\n      } else {\n        oneTimeWarning(\n          \"kml-refreshMode-onExpire\",\n          \"KML - refreshMode of onExpire requires the NetworkLinkControl to have an expires element\",\n        );\n        remove = true;\n      }\n    }\n\n    const networkLinkEntity = networkLink.entity;\n    const entityCollection = dataSource._entityCollection;\n    const newEntities = newEntityCollection.values;\n\n    function removeChildren(entity) {\n      entityCollection.remove(entity);\n      const children = entity._children;\n      const count = children.length;\n      for (let i = 0; i < count; ++i) {\n        removeChildren(children[i]);\n      }\n    }\n\n    // Remove old entities\n    entityCollection.suspendEvents();\n    const entitiesCopy = entityCollection.values.slice();\n    let i;\n    for (i = 0; i < entitiesCopy.length; ++i) {\n      const entityToRemove = entitiesCopy[i];\n      if (entityToRemove.parent === networkLinkEntity) {\n        entityToRemove.parent = undefined;\n        removeChildren(entityToRemove);\n      }\n    }\n    entityCollection.resumeEvents();\n\n    // Add new entities\n    entityCollection.suspendEvents();\n    for (i = 0; i < newEntities.length; i++) {\n      const newEntity = newEntities[i];\n      if (!defined(newEntity.parent)) {\n        newEntity.parent = networkLinkEntity;\n        mergeAvailabilityWithParent(newEntity);\n      }\n      entityCollection.add(newEntity);\n    }\n    entityCollection.resumeEvents();\n\n    // No refresh information remove it, otherwise update lastUpdate time\n    if (remove) {\n      networkLinks.remove(networkLink.id);\n    } else {\n      networkLink.lastUpdated = now;\n    }\n\n    const availability = entityCollection.computeAvailability();\n\n    const start = availability.start;\n    const stop = availability.stop;\n    const isMinStart = JulianDate.equals(start, Iso8601.MINIMUM_VALUE);\n    const isMaxStop = JulianDate.equals(stop, Iso8601.MAXIMUM_VALUE);\n    if (!isMinStart || !isMaxStop) {\n      const clock = dataSource._clock;\n\n      if (clock.startTime !== start || clock.stopTime !== stop) {\n        clock.startTime = start;\n        clock.stopTime = stop;\n        dataSource._changed.raiseEvent(dataSource);\n      }\n    }\n\n    networkLink.updating = false;\n    networkLink.needsUpdate = false;\n    dataSource._refresh.raiseEvent(\n      dataSource,\n      processedHref.getUrlComponent(true),\n    );\n  };\n}\n\nconst entitiesToIgnore = new AssociativeArray();\n\n/**\n * Updates any NetworkLink that require updating.\n *\n * @param {JulianDate} time The simulation time.\n * @returns {boolean} True if this data source is ready to be displayed at the provided time, false otherwise.\n */\nKmlDataSource.prototype.update = function (time) {\n  const networkLinks = this._networkLinks;\n  if (networkLinks.length === 0) {\n    return true;\n  }\n\n  const now = JulianDate.now();\n  const that = this;\n\n  entitiesToIgnore.removeAll();\n\n  function recurseIgnoreEntities(entity) {\n    const children = entity._children;\n    const count = children.length;\n    for (let i = 0; i < count; ++i) {\n      const child = children[i];\n      entitiesToIgnore.set(child.id, child);\n      recurseIgnoreEntities(child);\n    }\n  }\n\n  let cameraViewUpdate = false;\n  const lastCameraView = this._lastCameraView;\n  const camera = this.camera;\n  if (\n    defined(camera) &&\n    !(\n      camera.positionWC.equalsEpsilon(\n        lastCameraView.position,\n        CesiumMath.EPSILON7,\n      ) &&\n      camera.directionWC.equalsEpsilon(\n        lastCameraView.direction,\n        CesiumMath.EPSILON7,\n      ) &&\n      camera.upWC.equalsEpsilon(lastCameraView.up, CesiumMath.EPSILON7)\n    )\n  ) {\n    // Camera has changed so update the last view\n    lastCameraView.position = Cartesian3.clone(camera.positionWC);\n    lastCameraView.direction = Cartesian3.clone(camera.directionWC);\n    lastCameraView.up = Cartesian3.clone(camera.upWC);\n    lastCameraView.bbox = camera.computeViewRectangle();\n    cameraViewUpdate = true;\n  }\n\n  const newNetworkLinks = new AssociativeArray();\n  let changed = false;\n  networkLinks.values.forEach(function (networkLink) {\n    const entity = networkLink.entity;\n    if (entitiesToIgnore.contains(entity.id)) {\n      return;\n    }\n\n    if (!networkLink.updating) {\n      let doUpdate = false;\n      if (networkLink.refreshMode === RefreshMode.INTERVAL) {\n        if (\n          JulianDate.secondsDifference(now, networkLink.lastUpdated) >\n          networkLink.time\n        ) {\n          doUpdate = true;\n        }\n      } else if (networkLink.refreshMode === RefreshMode.EXPIRE) {\n        if (JulianDate.greaterThan(now, networkLink.time)) {\n          doUpdate = true;\n        }\n      } else if (networkLink.refreshMode === RefreshMode.STOP) {\n        if (cameraViewUpdate) {\n          networkLink.needsUpdate = true;\n          networkLink.cameraUpdateTime = now;\n        }\n\n        if (\n          networkLink.needsUpdate &&\n          JulianDate.secondsDifference(now, networkLink.cameraUpdateTime) >=\n            networkLink.time\n        ) {\n          doUpdate = true;\n        }\n      }\n\n      if (doUpdate) {\n        recurseIgnoreEntities(entity);\n        networkLink.updating = true;\n        const newEntityCollection = new EntityCollection();\n        const href = networkLink.href.clone();\n\n        href.setQueryParameters(networkLink.cookie);\n        const ellipsoid = that._ellipsoid ?? Ellipsoid.default;\n        processNetworkLinkQueryString(\n          href,\n          that.camera,\n          that.canvas,\n          networkLink.viewBoundScale,\n          lastCameraView.bbox,\n          ellipsoid,\n        );\n\n        load(that, newEntityCollection, href, {\n          context: entity.id,\n        })\n          .then(\n            getNetworkLinkUpdateCallback(\n              that,\n              networkLink,\n              newEntityCollection,\n              newNetworkLinks,\n              href,\n            ),\n          )\n          .catch(function (error) {\n            const msg = `NetworkLink ${networkLink.href} refresh failed: ${error}`;\n            console.log(msg);\n            that._error.raiseEvent(that, msg);\n          });\n        changed = true;\n      }\n    }\n    newNetworkLinks.set(networkLink.id, networkLink);\n  });\n\n  if (changed) {\n    this._networkLinks = newNetworkLinks;\n    this._changed.raiseEvent(this);\n  }\n\n  return true;\n};\n\n/**\n * Contains KML Feature data loaded into the <code>Entity.kml</code> property by {@link KmlDataSource}.\n * @alias KmlFeatureData\n * @constructor\n */\nfunction KmlFeatureData() {\n  /**\n   * @typedef KmlFeatureData.Author\n   * @type {object}\n   * @property {string} name Gets the name.\n   * @property {string} uri Gets the URI.\n   * @property {number} age Gets the email.\n   */\n\n  /**\n   * Gets the atom syndication format author field.\n   * @type {KmlFeatureData.Author}\n   */\n  this.author = {\n    name: undefined,\n    uri: undefined,\n    email: undefined,\n  };\n\n  /**\n   * @typedef KmlFeatureData.Link\n   * @type {object}\n   * @property {string} href Gets the href.\n   * @property {string} hreflang Gets the language of the linked resource.\n   * @property {string} rel Gets the link relation.\n   * @property {string} type Gets the link type.\n   * @property {string} title Gets the link title.\n   * @property {string} length Gets the link length.\n   */\n\n  /**\n   * Gets the link.\n   * @type {KmlFeatureData.Link}\n   */\n  this.link = {\n    href: undefined,\n    hreflang: undefined,\n    rel: undefined,\n    type: undefined,\n    title: undefined,\n    length: undefined,\n  };\n\n  /**\n   * Gets the unstructured address field.\n   * @type {string}\n   */\n  this.address = undefined;\n  /**\n   * Gets the phone number.\n   * @type {string}\n   */\n  this.phoneNumber = undefined;\n  /**\n   * Gets the snippet.\n   * @type {string}\n   */\n  this.snippet = undefined;\n  /**\n   * Gets the extended data, parsed into a JSON object.\n   * Currently only the <code>Data</code> property is supported.\n   * <code>SchemaData</code> and custom data are ignored.\n   * @type {string}\n   */\n  this.extendedData = undefined;\n}\n\n// For testing\nKmlDataSource._DeferredLoading = DeferredLoading;\nKmlDataSource._getTimestamp = getTimestamp;\n\nexport default KmlDataSource;\n"],"names":["MimeTypes","avi","bmp","bz2","chm","css","csv","doc","dvi","eps","flv","gif","gz","htm","html","ico","jnlp","jpeg","jpg","m3u","m4v","mathml","mid","midi","mov","mp3","mp4","mp4v","mpeg","mpg","odp","ods","odt","ogg","pdf","png","pps","ppt","ps","qt","rdf","rss","rtf","svg","swf","text","tif","tiff","txt","wav","wma","wmv","xml","zip","detectFromFilename","filename","ext","toLowerCase","parser","DOMParser","autolinker","stripPrefix","email","replaceFn","match","urlMatchType","BILLBOARD_SIZE","BILLBOARD_NEAR_DISTANCE","BILLBOARD_NEAR_RATIO","BILLBOARD_FAR_DISTANCE","BILLBOARD_FAR_RATIO","kmlNamespaces","undefined","gxNamespaces","atomNamespaces","namespaces","kml","gx","atom","kmlgx","concat","featureTypes","Document","processDocument","Folder","processFolder","Placemark","processPlacemark","NetworkLink","processNetworkLink","GroundOverlay","processGroundOverlay","PhotoOverlay","processUnsupportedFeature","ScreenOverlay","processScreenOverlay","Tour","processTour","DeferredLoading","dataSource","_dataSource","_deferred","_stack","_promises","_timeoutSet","_used","_started","_timeThreshold","Object","defineProperties","prototype","get","addNodes","nodes","processingData","push","index","addPromise","promise","wait","deferred","resolve","Promise","all","process","isFirstCall","length","KmlDataSource","_getTimestamp","_process","_giveUpTime","that","setTimeout","_nextNode","stack","top","_pop","pop","child","featureProcessor","localName","indexOf","namespaceURI","isZipFile","blob","magicBlob","slice","Math","min","size","reader","FileReader","addEventListener","DataView","result","getUint32","reject","error","readAsArrayBuffer","readBlobAsText","readAsText","insertNamespaces","namespaceMap","xsi","firstPart","lastPart","reg","declaration","key","hasOwnProperty","RegExp","test","substr","removeDuplicateNamespaces","endDeclaration","namespace","startIndex","endIndex","loadXmlFromZip","entry","uriResolver","getData","parseFromString","loadDataUriFromZip","mimeType","dataUri","embedDataUris","div","elementType","attributeName","keys","baseUri","elements","querySelectorAll","i","element","value","getAttribute","relativeUri","uri","absoluteTo","toString","setAttribute","applyBasePath","sourceResource","resource","resolveHref","url","createEntity","node","entityCollection","context","id","queryStringAttribute","entity","getById","add","addProperty","KmlFeatureData","isExtrudable","altitudeMode","gxAltitudeMode","readCoordinate","ellipsoid","fromDegrees","digits","longitude","parseFloat","latitude","height","isNaN","readCoordinates","tuples","textContent","Array","resultIndex","queryNumericAttribute","queryFirstNode","tagName","childNodes","q","queryNodes","getElementsByTagNameNS","queryChildNodes","queryNumericValue","resultNode","queryStringValue","trim","queryBooleanValue","href","replace","getUrlComponent","getDerivedResource","colorOptions","maximumRed","red","maximumGreen","green","maximumBlue","blue","parseColorString","isRandom","substring","alpha","parseInt","fromRandom","queryColorValue","processTimeStamp","featureNode","whenString","when","fromIso8601","addInterval","start","stop","MAXIMUM_VALUE","processTimeSpan","beginNode","beginDate","endNode","endDate","lessThan","tmp","MINIMUM_VALUE","createDefaultBillboard","billboard","width","scaleByDistance","pixelOffsetScaleByDistance","createDefaultPolygon","polygon","outline","outlineColor","WHITE","createDefaultLabel","label","translucencyByDistance","pixelOffset","horizontalOrigin","LEFT","font","style","FILL_AND_OUTLINE","getIconHref","iconNode","canRefresh","palette","charAt","x","y","iconNum","hrefResource","refreshMode","viewRefreshMode","viewBoundScale","defaultViewFormat","viewFormat","httpQuery","setQueryParameters","cleanupString","_ellipsoid","processNetworkLinkQueryString","camera","canvas","_lastCameraView","bbox","processBillboardIcon","targetEntity","scale","heading","color","icon","w","h","hotSpotNode","hotSpotX","hotSpotY","hotSpotXUnit","hotSpotYUnit","image","imageSubRegion","rotation","toRadians","alignedAxis","UNIT_Z","xOffset","yOffset","applyStyle","styleNode","len","item","fillColor","name","polyline","material","fill","bgColor","textColor","BLACK","balloonStyle","listItemType","computeFinalStyle","placeMark","styleCollection","styleEntity","styleIndex","inlineStyleNode","pairs","p","pair","styleUrl","merge","externalStyle","tokens","split","processExternalStyles","fetchXML","then","styleKml","processStyles","isExternal","styleNodes","styleNodesLength","styleMaps","styleMapsLength","styleMap","getOrCreateEntity","base","promises","styleUrlNodes","getElementsByTagName","styleUrlNodesLength","styleReference","createDropLine","entityPosition","surfacePosition","position","clone","positions","heightReferenceFromAltitudeMode","CLAMP_TO_GROUND","RELATIVE_TO_GROUND","NONE","createPositionPropertyFromAltitudeMode","property","createPositionPropertyArrayFromAltitudeMode","properties","propertiesLength","scaleToGeodeticSurface","processPositionGraphics","heightReference","_pinBuilder","fromColor","YELLOW","getValue","_clampToGround","processPathGraphics","path","leadTime","processPoint","geometryNode","coordinatesString","extrude","processLineStringOrLinearRing","coordinatesNode","tessellate","canExtrude","zIndex","coordinates","wall","outlineWidth","polylineGraphics","clampToGround","arcType","processPolygon","outerBoundaryIsNode","linearRingNode","perPositionHeight","extrudedHeight","hierarchy","innerBoundaryIsNodes","j","k","holes","processTrack","coordNodes","angleNodes","timeNodes","times","addSamples","availability","addToMultiTrack","composite","dropShowProperty","includeEndPoints","data","intervals","isStartIncluded","isStopIncluded","processMultiTrack","interpolate","trackNodes","lastStop","lastStopPosition","needDropLine","trackNode","show","geometryTypes","Point","LineString","LinearRing","Polygon","Track","MultiTrack","MultiGeometry","processMultiGeometry","Model","processUnsupportedGeometry","hasGeometry","childNode","geometryProcessor","childEntity","parent","description","processExtendedData","extendedDataNode","dataNodes","dataNode","displayName","extendedData","scratchDiv","document","createElement","processDescription","kmlData","background","foreground","address","snippet","matches","token","propertyName","isDisplayName","link","innerHTML","links","toCssColorString","processFeature","parentEntity","mergeAvailabilityWithParent","ancestryIsVisible","visibility","authorNode","author","linkNode","hreflang","rel","type","title","phoneNumber","processLookAt","processCamera","deferredLoading","r","newProcessingData","placemark","playlistNodeProcessors","FlyTo","processTourFlyTo","Wait","processTourWait","SoundCue","processTourUnsupportedNode","AnimatedUpdate","TourControl","tour","playlistNode","entryNode","playlistNodeProcessor","console","log","_kmlTours","duration","addPlaylistEntry","flyToMode","t","view","lookAt","flyto","lon","lat","altitude","tilt","roll","hpr","range","PI_OVER_TWO","viewPoint","screenOverlayNode","screenOverlay","screenOverlayContainer","img","_screenOverlays","src","onload","styles","screenXY","overlayXY","xUnit","yUnit","xStyle","yStyle","floor","join","xOrigin","yOrigin","appendChild","groundOverlay","geometry","isLatLonQuad","rectangle","latLonBox","west","south","east","north","negativePiToPi","clampToLatitudeRange","rotationRadians","stRotation","transparent","_unsupportedNode","raiseEvent","nodeName","RefreshMode","INTERVAL","EXPIRE","STOP","s","sFirst","zeroRectangle","scratchCartographic","scratchCartesian2","scratchCartesian3","fixLatitude","fixLongitude","PI","TWO_PI","queryString","queryParameters","_mode","MORPHING","centerCartesian","centerCartographic","clientWidth","clientHeight","pickEllipsoid","cartesianToCartographic","center","cartographicToCartesian","equalsEpsilon","EPSILON9","newHalfWidth","newHalfHeight","toDegrees","pitch","distance","positionWC","frustum","aspectRatio","horizFov","vertFov","fov","networkEntity","newSourceUri","options","sourceUri","networkLinkCollection","load","rootElement","entities","_entityCollection","newEntities","values","suspendEvents","newEntity","resumeEvents","refreshInterval","networkLinkControl","hasNetworkLinkControl","now","networkLinkInfo","cookie","lastUpdated","updating","needsUpdate","cameraUpdateTime","minRefreshPeriod","max","time","expires","date","diff","secondsDifference","addSeconds","e","_networkLinks","set","catch","_error","processFeatureNode","loadKml","removeAll","documentElement","document1","_name","_DeferredLoading","loadKmz","zWorkerUri","zWasmUri","workerURI","wasmURI","entries","getEntries","docEntry","directory","close","EMPTY_OBJECT","createIfNeeded","fetchBlob","resourceCredits","_resourceCredits","credits","DEFAULT","dataToLoad","Blob","isZip","body","msg","firstChild","nodeValue","innerText","_changed","_loading","_refresh","_clock","_isLoading","_entityCluster","direction","directionWC","up","upWC","computeViewRectangle","MAX_VALUE","default","credit","_credit","clock","isLoading","changedEvent","errorEvent","loadingEvent","refreshEvent","unsupportedNodeEvent","clustering","kmlTours","setLoading","oldName","computeAvailability","isMinStart","equals","isMaxStop","Date","setHours","fromDate","startTime","stopTime","currentTime","clockRange","LOOP_STOP","clockStep","SYSTEM_CLOCK_MULTIPLIER","multiplier","round","changed","destroy","elem","remove","parentAvailability","childAvailability","intersect","getNetworkLinkUpdateCallback","networkLink","newEntityCollection","networkLinks","processedHref","contains","networkLinkEntity","removeChildren","children","_children","count","entitiesCopy","entityToRemove","entitiesToIgnore","update","recurseIgnoreEntities","cameraViewUpdate","lastCameraView","EPSILON7","newNetworkLinks","forEach","doUpdate","greaterThan"],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,uDAAuD;AACvD,gFAAgF;AAChF,yFAAyF;AACzF,iEAAiE;AACjE,MAAMA,YAAY;IAChBC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,IAAI;IACJC,KAAK;IACLC,MAAM;IACNC,KAAK;IACLC,MAAM;IACNC,MAAM;IACNC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,QAAQ;IACRC,KAAK;IACLC,MAAM;IACNC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,MAAM;IACNC,MAAM;IACNC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,IAAI;IACJC,IAAI;IACJC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,MAAM;IACNC,KAAK;IACLC,MAAM;IACNC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IACLC,KAAK;IAELC,oBAAoB,SAAUC,QAAQ;QACpC,IAAIC,MAAMD,SAASE,WAAW;QAC9BD,MAAM,IAAA,yLAAmB,EAACA;QAC1B,OAAOxD,SAAS,CAACwD,IAAI;IACvB;A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","ignoreList":[0]}}]
}