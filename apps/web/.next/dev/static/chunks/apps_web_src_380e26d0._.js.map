{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/utils/cesiumUtils.ts"],"sourcesContent":["import { Cartesian3, Math as CesiumMath, Cartographic } from \"cesium\";\nimport { RadioStation } from \"../types\";\n\n/**\n * Utility functions for working with Cesium coordinates and radio stations\n */\n\nexport interface CesiumCoordinate {\n  longitude: number;\n  latitude: number;\n  height?: number;\n}\n\nexport interface StationEntity {\n  id: string;\n  station: RadioStation;\n  position: Cartesian3;\n  coordinate: CesiumCoordinate;\n}\n\n/**\n * Convert latitude/longitude to Cesium Cartesian3 position\n */\nexport function latLngToCartesian3(\n  lat: number,\n  lng: number,\n  height: number = 0,\n): Cartesian3 {\n  return Cartesian3.fromDegrees(lng, lat, height);\n}\n\n/**\n * Convert radio station to Cesium entity data\n */\nexport function radioStationToEntity(station: RadioStation): StationEntity {\n  const coordinate: CesiumCoordinate = {\n    longitude: station.location.lng,\n    latitude: station.location.lat,\n    height: 10000, // 10km above surface for visibility\n  };\n\n  return {\n    id: station.id,\n    station,\n    position: latLngToCartesian3(\n      coordinate.latitude,\n      coordinate.longitude,\n      coordinate.height,\n    ),\n    coordinate,\n  };\n}\n\n/**\n * Calculate distance between two coordinates in kilometers\n */\nexport function calculateDistance(\n  coord1: CesiumCoordinate,\n  coord2: CesiumCoordinate,\n): number {\n  const R = 6371; // Earth's radius in km\n  const dLat = CesiumMath.toRadians(coord2.latitude - coord1.latitude);\n  const dLon = CesiumMath.toRadians(coord2.longitude - coord1.longitude);\n\n  const a =\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(CesiumMath.toRadians(coord1.latitude)) *\n      Math.cos(CesiumMath.toRadians(coord2.latitude)) *\n      Math.sin(dLon / 2) *\n      Math.sin(dLon / 2);\n\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c;\n}\n\n/**\n * Get optimal camera position for viewing a station\n */\nexport function getStationCameraPosition(station: RadioStation): Cartesian3 {\n  const distance = 2000000; // 2000km from surface\n  return latLngToCartesian3(\n    station.location.lat,\n    station.location.lng,\n    distance,\n  );\n}\n\n/**\n * Create camera destination for smooth animation to station\n */\ninterface CameraDestination {\n  destination: Cartesian3;\n  orientation: {\n    heading: number;\n    pitch: number;\n    roll: number;\n  };\n  duration: number;\n}\n\nfunction estimateAltitudeFromBoundingBox(bbox: {\n  minLat: number;\n  minLng: number;\n  maxLat: number;\n  maxLng: number;\n}): number {\n  const latSpan = Math.max(Math.abs(bbox.maxLat - bbox.minLat), 0.5);\n  const lngSpan = Math.max(Math.abs(bbox.maxLng - bbox.minLng), 0.5);\n  const dominantSpan = Math.max(latSpan, lngSpan);\n  const meters = dominantSpan * 111_000;\n  const altitude = meters * 3;\n  return Math.min(2_500_000, Math.max(220_000, altitude));\n}\n\nfunction estimateDurationFromAltitude(altitude: number): number {\n  const normalized = altitude / 1_000_000;\n  return Math.min(3.5, Math.max(1.25, normalized + 0.75));\n}\n\nexport function createCameraDestination(station: RadioStation): CameraDestination {\n  const wof = station.location.wof;\n  const targetLat = wof?.centroid?.lat ?? station.location.lat;\n  const targetLng = wof?.centroid?.lng ?? station.location.lng;\n\n  const altitude = wof?.bbox ? estimateAltitudeFromBoundingBox(wof.bbox) : 1_500_000;\n  const duration = estimateDurationFromAltitude(altitude);\n\n  return {\n    destination: Cartesian3.fromDegrees(targetLng, targetLat, altitude),\n    orientation: {\n      heading: CesiumMath.toRadians(0),\n      pitch: CesiumMath.toRadians(-40),\n      roll: 0,\n    },\n    duration,\n  };\n}\n\n/**\n * Filter stations by visibility based on camera position\n */\nexport function filterStationsByDistance(\n  stations: RadioStation[],\n  cameraPosition: Cartesian3,\n  maxDistance: number = 5000, // km\n): RadioStation[] {\n  const cameraCartographic = Cartographic.fromCartesian(cameraPosition);\n  const cameraCoord: CesiumCoordinate = {\n    longitude: CesiumMath.toDegrees(cameraCartographic.longitude),\n    latitude: CesiumMath.toDegrees(cameraCartographic.latitude),\n  };\n\n  return stations.filter((station) => {\n    const stationCoord: CesiumCoordinate = {\n      longitude: station.location.lng,\n      latitude: station.location.lat,\n    };\n    return calculateDistance(cameraCoord, stationCoord) <= maxDistance;\n  });\n}\n\n/**\n * Get color for station based on status and cluster information\n */\nexport function getStationColor(\n  station: RadioStation,\n  isSelected: boolean = false,\n  isHovered: boolean = false,\n) {\n  if (isSelected) return { red: 1.0, green: 0.0, blue: 0.0, alpha: 1.0 }; // Red\n  if (isHovered) return { red: 1.0, green: 1.0, blue: 0.0, alpha: 1.0 }; // Yellow\n\n  // Special handling for clusters - brighter colors\n  const isCluster = station.isCluster || (station.stationCount && station.stationCount > 1);\n  const alphaMultiplier = isCluster ? 1.0 : 0.8; // Clusters are more opaque\n\n  // Color by region/country with extensive coverage\n  const country = station.location.country || \"default\";\n  switch (country) {\n    // North America\n    case \"US\":\n    case \"USA\":\n      return { red: 0.0, green: 0.5, blue: 1.0, alpha: alphaMultiplier }; // Blue\n    case \"CA\":\n    case \"Canada\":\n      return { red: 1.0, green: 0.0, blue: 0.0, alpha: alphaMultiplier }; // Red\n    case \"MX\":\n    case \"Mexico\":\n      return { red: 0.0, green: 1.0, blue: 0.0, alpha: alphaMultiplier }; // Green\n\n    // Europe\n    case \"UK\":\n    case \"GB\":\n    case \"United Kingdom\":\n      return { red: 1.0, green: 0.0, blue: 0.5, alpha: alphaMultiplier }; // Pink\n    case \"DE\":\n    case \"Germany\":\n      return { red: 1.0, green: 1.0, blue: 0.0, alpha: alphaMultiplier }; // Yellow\n    case \"FR\":\n    case \"France\":\n      return { red: 0.5, green: 0.0, blue: 1.0, alpha: alphaMultiplier }; // Purple\n    case \"IT\":\n    case \"Italy\":\n      return { red: 0.0, green: 1.0, blue: 0.5, alpha: alphaMultiplier }; // Light Green\n    case \"ES\":\n    case \"Spain\":\n      return { red: 1.0, green: 0.5, blue: 0.0, alpha: alphaMultiplier }; // Orange\n    case \"NL\":\n    case \"Netherlands\":\n      return { red: 1.0, green: 0.5, blue: 0.5, alpha: alphaMultiplier }; // Light Pink\n    case \"SE\":\n    case \"Sweden\":\n      return { red: 0.0, green: 0.7, blue: 1.0, alpha: alphaMultiplier }; // Light Blue\n    case \"NO\":\n    case \"Norway\":\n      return { red: 0.0, green: 0.3, blue: 0.7, alpha: alphaMultiplier }; // Dark Blue\n    case \"DK\":\n    case \"Denmark\":\n      return { red: 0.8, green: 0.0, blue: 0.3, alpha: alphaMultiplier }; // Dark Pink\n    case \"FI\":\n    case \"Finland\":\n      return { red: 0.0, green: 0.8, blue: 0.8, alpha: alphaMultiplier }; // Cyan\n    case \"CH\":\n    case \"Switzerland\":\n      return { red: 0.7, green: 0.7, blue: 0.7, alpha: alphaMultiplier }; // Light Gray\n    case \"AT\":\n    case \"Austria\":\n      return { red: 0.5, green: 0.5, blue: 0.0, alpha: alphaMultiplier }; // Olive\n    case \"BE\":\n    case \"Belgium\":\n      return { red: 0.3, green: 0.0, blue: 0.0, alpha: alphaMultiplier }; // Dark Red\n    case \"PL\":\n    case \"Poland\":\n      return { red: 0.8, green: 0.8, blue: 0.0, alpha: alphaMultiplier }; // Bright Yellow\n    case \"RU\":\n    case \"Russia\":\n      return { red: 0.0, green: 0.0, blue: 0.8, alpha: alphaMultiplier }; // Dark Blue\n\n    // Asia Pacific\n    case \"JP\":\n    case \"Japan\":\n      return { red: 1.0, green: 0.0, blue: 1.0, alpha: alphaMultiplier }; // Magenta\n    case \"CN\":\n    case \"China\":\n      return { red: 1.0, green: 0.8, blue: 0.0, alpha: alphaMultiplier }; // Gold\n    case \"KR\":\n    case \"Korea\":\n    case \"South Korea\":\n      return { red: 0.5, green: 1.0, blue: 0.5, alpha: alphaMultiplier }; // Light Green\n    case \"IN\":\n    case \"India\":\n      return { red: 1.0, green: 0.5, blue: 0.2, alpha: alphaMultiplier }; // Saffron\n    case \"AU\":\n    case \"Australia\":\n      return { red: 0.0, green: 0.6, blue: 0.0, alpha: alphaMultiplier }; // Forest Green\n    case \"NZ\":\n    case \"New Zealand\":\n      return { red: 0.0, green: 0.4, blue: 0.0, alpha: alphaMultiplier }; // Dark Green\n    case \"TH\":\n    case \"Thailand\":\n      return { red: 0.8, green: 0.4, blue: 0.8, alpha: alphaMultiplier }; // Light Purple\n    case \"SG\":\n    case \"Singapore\":\n      return { red: 0.0, green: 0.8, blue: 0.6, alpha: alphaMultiplier }; // Teal\n    case \"MY\":\n    case \"Malaysia\":\n      return { red: 0.6, green: 0.8, blue: 0.0, alpha: alphaMultiplier }; // Lime\n    case \"ID\":\n    case \"Indonesia\":\n      return { red: 0.8, green: 0.0, blue: 0.8, alpha: alphaMultiplier }; // Purple\n    case \"PH\":\n    case \"Philippines\":\n      return { red: 0.0, green: 0.0, blue: 1.0, alpha: alphaMultiplier }; // Blue\n\n    // South America\n    case \"BR\":\n    case \"Brazil\":\n      return { red: 0.0, green: 0.8, blue: 0.2, alpha: alphaMultiplier }; // Brazilian Green\n    case \"AR\":\n    case \"Argentina\":\n      return { red: 0.5, green: 0.8, blue: 1.0, alpha: alphaMultiplier }; // Sky Blue\n    case \"CL\":\n    case \"Chile\":\n      return { red: 0.8, green: 0.0, blue: 0.0, alpha: alphaMultiplier }; // Red\n    case \"PE\":\n    case \"Peru\":\n      return { red: 0.8, green: 0.2, blue: 0.0, alpha: alphaMultiplier }; // Dark Orange\n    case \"CO\":\n    case \"Colombia\":\n      return { red: 1.0, green: 1.0, blue: 0.0, alpha: alphaMultiplier }; // Yellow\n\n    // Africa\n    case \"ZA\":\n    case \"South Africa\":\n      return { red: 0.0, green: 0.5, blue: 0.0, alpha: alphaMultiplier }; // Green\n    case \"NG\":\n    case \"Nigeria\":\n      return { red: 0.0, green: 0.7, blue: 0.0, alpha: alphaMultiplier }; // Green\n    case \"KE\":\n    case \"Kenya\":\n      return { red: 0.8, green: 0.0, blue: 0.0, alpha: alphaMultiplier }; // Red\n    case \"EG\":\n    case \"Egypt\":\n      return { red: 0.8, green: 0.6, blue: 0.0, alpha: alphaMultiplier }; // Gold\n    case \"MA\":\n    case \"Morocco\":\n      return { red: 0.8, green: 0.0, blue: 0.0, alpha: alphaMultiplier }; // Red\n\n    // Middle East\n    case \"AE\":\n    case \"UAE\":\n      return { red: 0.0, green: 0.6, blue: 0.8, alpha: alphaMultiplier }; // Turquoise\n    case \"SA\":\n    case \"Saudi Arabia\":\n      return { red: 0.0, green: 0.5, blue: 0.0, alpha: alphaMultiplier }; // Green\n    case \"IL\":\n    case \"Israel\":\n      return { red: 0.0, green: 0.0, blue: 0.8, alpha: alphaMultiplier }; // Blue\n    case \"TR\":\n    case \"Turkey\":\n      return { red: 0.8, green: 0.0, blue: 0.0, alpha: alphaMultiplier }; // Red\n    case \"IR\":\n    case \"Iran\":\n      return { red: 0.0, green: 0.8, blue: 0.0, alpha: alphaMultiplier }; // Green\n\n    // Default for unspecified countries\n    default:\n      return { red: 0.7, green: 0.7, blue: 0.7, alpha: alphaMultiplier }; // Light Gray\n  }\n}\n\n/**\n * Create billboard scale based on station importance and cluster size\n */\nexport function getStationScale(station: RadioStation): number {\n  // Handle clusters with dynamic scaling based on station count\n  if (station.isCluster && station.stationCount) {\n    if (station.stationCount > 20) return 2.5; // Very large clusters\n    if (station.stationCount > 10) return 2.0; // Large clusters\n    if (station.stationCount > 5) return 1.7; // Medium clusters\n    if (station.stationCount > 1) return 1.4; // Small clusters\n  }\n\n  // Scale based on language or listener count (for individual stations)\n  if (station.language === \"en\") return 1.2;\n  if (station.tags?.includes(\"popular\")) return 1.1;\n  if (station.listeners && station.listeners > 10000) return 1.3;\n  \n  return 1.0;\n}\n"],"names":["latLngToCartesian3","lat","lng","height","fromDegrees","radioStationToEntity","station","coordinate","longitude","location","latitude","id","position","calculateDistance","coord1","coord2","R","dLat","toRadians","dLon","a","Math","sin","cos","c","atan2","sqrt","getStationCameraPosition","distance","estimateAltitudeFromBoundingBox","bbox","latSpan","max","abs","maxLat","minLat","lngSpan","maxLng","minLng","dominantSpan","meters","altitude","min","estimateDurationFromAltitude","normalized","createCameraDestination","wof","targetLat","centroid","targetLng","duration","destination","orientation","heading","pitch","roll","filterStationsByDistance","stations","cameraPosition","maxDistance","cameraCartographic","fromCartesian","cameraCoord","toDegrees","filter","stationCoord","getStationColor","isSelected","isHovered","red","green","blue","alpha","isCluster","stationCount","alphaMultiplier","country","getStationScale","language","tags","includes","listeners"],"mappings":"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"}},
    {"offset": {"line": 506, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/utils/cesiumEntityManager.ts"],"sourcesContent":["import {\n  Viewer,\n  Entity,\n  Color,\n  ConstantProperty,\n  BillboardGraphics,\n  LabelGraphics,\n  HeightReference,\n  NearFarScalar,\n  DistanceDisplayCondition,\n  Cartesian2,\n  VerticalOrigin,\n  LabelStyle,\n} from \"cesium\";\nimport {\n  radioStationToEntity,\n  getStationColor,\n  getStationScale,\n} from \"../utils/cesiumUtils\";\nimport type { RadioStation } from \"../types\";\n\n// Generate a futuristic glowing dot texture\nfunction createGlowingDotCanvas(color: string, size: number, glow: boolean): HTMLCanvasElement {\n  const canvas = document.createElement('canvas');\n  canvas.width = size;\n  canvas.height = size;\n  const context = canvas.getContext('2d');\n  if (!context) return canvas;\n\n  const center = size / 2;\n  const radius = size / 4;\n\n  // Clear\n  context.clearRect(0, 0, size, size);\n\n  // Outer glow\n  if (glow) {\n    const gradient = context.createRadialGradient(center, center, radius, center, center, size / 2);\n    gradient.addColorStop(0, color);\n    gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\n    context.fillStyle = gradient;\n    context.beginPath();\n    context.arc(center, center, size / 2, 0, Math.PI * 2);\n    context.fill();\n  }\n\n  // Inner core\n  context.beginPath();\n  context.arc(center, center, radius, 0, Math.PI * 2);\n  context.fillStyle = '#ffffff';\n  context.fill();\n  \n  // Colored rim\n  context.beginPath();\n  context.arc(center, center, radius, 0, Math.PI * 2);\n  context.lineWidth = 2;\n  context.strokeStyle = color;\n  context.stroke();\n\n  return canvas;\n}\n\nconst STATION_CANVAS = createGlowingDotCanvas('rgba(50, 255, 100, 0.8)', 64, true); // Neon Green\nconst CLUSTER_CANVAS = createGlowingDotCanvas('rgba(50, 200, 255, 0.8)', 96, true); // Neon Blue\nconst CITY_CANVAS = createGlowingDotCanvas('rgba(255, 100, 200, 0.8)', 80, true); // Neon Pink\n\n/**\n * Manages Cesium entities for radio stations\n */\nexport class CesiumEntityManager {\n  private entities = new Map<string, Entity>();\n  private viewer: Viewer;\n\n  constructor(viewer: Viewer) {\n    this.viewer = viewer;\n  }\n\n  /**\n   * Create a radio station entity with cluster support\n   */\n  createStationEntity(station: RadioStation): Entity {\n    const stationEntity = radioStationToEntity(station);\n\n    // Choose visual based on type\n    const isCluster = station.isCluster || (station as any).type === 'cluster';\n    const isCity = (station as any).type === 'city';\n    \n    let canvas = STATION_CANVAS;\n    let labelColor = Color.WHITE;\n    let scale = isCity ? 0.8 : 0.6;\n    let distanceFade = 3.0e6;\n\n    if (isCity) {\n      canvas = CITY_CANVAS;\n      labelColor = Color.fromCssColorString('#ff64c8');\n      scale = 0.8;\n      distanceFade = 8.0e6;\n    } else if (isCluster) {\n      canvas = CLUSTER_CANVAS;\n      labelColor = Color.fromCssColorString('#32c8ff');\n      scale = 1.0;\n      distanceFade = 15.0e6;\n    }\n\n    const entity = this.viewer.entities.add({\n      id: station.id,\n      position: stationEntity.position,\n\n      billboard: new BillboardGraphics({\n        image: new ConstantProperty(canvas),\n        show: new ConstantProperty(true),\n        scale: new ConstantProperty(scale),\n        color: new ConstantProperty(Color.WHITE),\n        scaleByDistance: new ConstantProperty(\n          new NearFarScalar(1.0e5, 1.5, 2.0e7, 0.2)\n        ),\n        translucencyByDistance: new ConstantProperty(\n          new NearFarScalar(1.0e5, 1.0, 3.0e7, 0.1)\n        ),\n        distanceDisplayCondition: new ConstantProperty(\n          new DistanceDisplayCondition(0.0, distanceFade),\n        ),\n        heightReference: new ConstantProperty(\n          HeightReference.RELATIVE_TO_GROUND,\n        ),\n        disableDepthTestDistance: new ConstantProperty(\n          Number.POSITIVE_INFINITY,\n        ),\n      }),\n      \n      // Floating label for futuristic feel\n      point: undefined, // Disable point, use billboard\n\n      label: new LabelGraphics({\n        text: new ConstantProperty(station.name),\n        font: new ConstantProperty(\"14px 'Saira', sans-serif\"), // Futuristic font\n        style: new ConstantProperty(LabelStyle.FILL),\n        verticalOrigin: new ConstantProperty(VerticalOrigin.BOTTOM),\n        pixelOffset: new ConstantProperty(new Cartesian2(0, -20)),\n        show: new ConstantProperty(false), // Show on hover\n        distanceDisplayCondition: new ConstantProperty(\n          new DistanceDisplayCondition(0.0, distanceFade * 0.5), // Hide labels sooner than dots\n        ),\n        fillColor: new ConstantProperty(labelColor),\n        outlineWidth: new ConstantProperty(0),\n        scaleByDistance: new ConstantProperty(\n          new NearFarScalar(1.0e5, 1.2, 1.0e7, 0.5)\n        )\n      }),\n    });\n\n    // Store station data on the entity\n    (entity as any).station = station;\n    this.entities.set(station.id, entity);\n    \n    // Request render since we're using requestRenderMode\n    this.viewer.scene.requestRender();\n\n    return entity;\n  }\n\n  /**\n   * Update entity appearance based on selection/hover state\n   */\n  updateEntityAppearance(\n    stationId: string,\n    isSelected: boolean,\n    isHovered: boolean,\n  ): void {\n    const entity = this.entities.get(stationId);\n    if (!entity) return;\n\n    const station = (entity as any).station as RadioStation;\n    \n    // Logic to make active selection glow or pulse could go here\n    if (entity.billboard) {\n      const baseScale = (station as any).type === 'city' ? 0.8 : ((station as any).isCluster ? 1.0 : 0.6);\n      const targetScale = isSelected ? baseScale * 1.5 : (isHovered ? baseScale * 1.3 : baseScale);\n      \n      entity.billboard.scale = new ConstantProperty(targetScale);\n      \n      // Update label visibility\n      if (entity.label) {\n        entity.label.show = new ConstantProperty(isHovered || isSelected);\n      }\n    }\n    \n    // Request render for appearance updates\n    this.viewer.scene.requestRender();\n  }\n\n  /**\n   * Get entity by station ID\n   */\n  getEntity(stationId: string): Entity | undefined {\n    return this.entities.get(stationId);\n  }\n\n  /**\n   * Get all entities\n   */\n  getAllEntities(): Map<string, Entity> {\n    return this.entities;\n  }\n\n  /**\n   * Clear all entities\n   */\n  clearAll(): void {\n    this.viewer.entities.removeAll();\n    this.entities.clear();\n    this.viewer.scene.requestRender();\n  }\n\n  /**\n   * Remove specific entity\n   */\n  removeEntity(stationId: string): void {\n    const entity = this.entities.get(stationId);\n    if (entity) {\n      this.viewer.entities.remove(entity);\n      this.entities.delete(stationId);\n      this.viewer.scene.requestRender();\n    }\n  }\n}\n"],"names":["createGlowingDotCanvas","color","size","glow","canvas","document","createElement","width","height","context","getContext","center","radius","clearRect","gradient","createRadialGradient","addColorStop","fillStyle","beginPath","arc","Math","PI","fill","lineWidth","strokeStyle","stroke","STATION_CANVAS","CLUSTER_CANVAS","CITY_CANVAS","CesiumEntityManager","entities","Map","viewer","createStationEntity","station","stationEntity","isCluster","type","isCity","labelColor","WHITE","scale","distanceFade","fromCssColorString","entity","add","id","position","billboard","image","show","scaleByDistance","translucencyByDistance","distanceDisplayCondition","heightReference","RELATIVE_TO_GROUND","disableDepthTestDistance","Number","POSITIVE_INFINITY","point","undefined","label","text","name","font","style","FILL","verticalOrigin","BOTTOM","pixelOffset","fillColor","outlineWidth","set","scene","requestRender","updateEntityAppearance","stationId","isSelected","isHovered","get","baseScale","targetScale","getEntity","getAllEntities","clearAll","removeAll","clear","removeEntity","remove","delete"],"mappings":"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"}},
    {"offset": {"line": 678, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/utils/cesiumViewerConfig.ts"],"sourcesContent":["import {\n  Viewer,\n  ScreenSpaceEventType,\n  ScreenSpaceEventHandler,\n  Math as CesiumMath,\n  Cartesian3,\n  ShadowMode,\n  Color,\n  TileMapServiceImageryProvider,\n  EllipsoidTerrainProvider,\n  SceneMode,\n  defined,\n  buildModuleUrl,\n  ImageryLayer,\n  createWorldImageryAsync,\n  IonWorldImageryStyle,\n  ArcGisMapServerImageryProvider,\n} from \"cesium\";\n\n/**\n * Configuration options for Cesium viewer\n */\nexport interface CesiumViewerConfig {\n  animation?: boolean;\n  baseLayerPicker?: boolean;\n  fullscreenButton?: boolean;\n  geocoder?: boolean;\n  homeButton?: boolean;\n  infoBox?: boolean;\n  sceneModePicker?: boolean;\n  selectionIndicator?: boolean;\n  timeline?: boolean;\n  navigationHelpButton?: boolean;\n  navigationInstructionsInitiallyVisible?: boolean;\n  vrButton?: boolean;\n  scene3DOnly?: boolean;\n  shadows?: boolean;\n  terrainShadows?: ShadowMode;\n}\n\n/**\n * Default Cesium viewer configuration - production ready\n */\nexport const DEFAULT_CESIUM_CONFIG: CesiumViewerConfig = {\n  animation: false,\n  baseLayerPicker: false,\n  fullscreenButton: false,\n  geocoder: false,\n  homeButton: false,\n  infoBox: false,\n  sceneModePicker: false,\n  selectionIndicator: false,\n  timeline: false,\n  navigationHelpButton: false,\n  navigationInstructionsInitiallyVisible: false,\n  vrButton: false,\n  scene3DOnly: true,\n  shadows: false,\n  terrainShadows: ShadowMode.DISABLED,\n};\n\n/**\n * Creates a production-ready Cesium viewer with stable rendering\n * Uses bundled NaturalEarthII imagery (no external dependencies = no flicker)\n */\nexport async function createCesiumViewer(\n  container: HTMLElement,\n  config: CesiumViewerConfig = DEFAULT_CESIUM_CONFIG,\n): Promise<Viewer> {\n  // Create hidden credit container\n  const creditContainer = document.createElement(\"div\");\n  creditContainer.style.display = \"none\";\n  document.body.appendChild(creditContainer);\n\n  let imageryProvider;\n  try {\n    // Try to use Cesium World Imagery (Bing Maps Aerial) for realism\n    imageryProvider = await createWorldImageryAsync({\n      style: IonWorldImageryStyle.AERIAL\n    });\n  } catch (error) {\n    console.warn(\"Failed to load Cesium World Imagery, falling back to ArcGIS:\", error);\n    // Fallback to ArcGIS World Imagery (High Res Satellite)\n    imageryProvider = await ArcGisMapServerImageryProvider.fromUrl(\n      \"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer\"\n    );\n  }\n\n  const viewer = new Viewer(container, {\n    ...config,\n    baseLayerPicker: false,\n    terrainProvider: new EllipsoidTerrainProvider(),\n    baseLayer: new ImageryLayer(imageryProvider),\n    \n    // Rendering settings for stability\n    // Disable requestRenderMode to prevent flickering on some devices\n    requestRenderMode: false,\n    targetFrameRate: 60,\n    useBrowserRecommendedResolution: true,\n    \n    // Scene configuration\n    scene3DOnly: true,\n    sceneMode: SceneMode.SCENE3D,\n    orderIndependentTranslucency: false,\n    \n    // Credits\n    creditContainer: creditContainer,\n    \n    // WebGL context options for stable rendering\n    contextOptions: {\n      webgl: {\n        alpha: false,\n        antialias: false,\n        preserveDrawingBuffer: false,\n        powerPreference: \"high-performance\",\n        failIfMajorPerformanceCaveat: false,\n      },\n    },\n  });\n\n  const scene = viewer.scene;\n  \n  // Disable ALL visual effects that can cause flickering\n  scene.globe.enableLighting = false;\n  scene.globe.showGroundAtmosphere = false;\n  scene.globe.showWaterEffect = false;\n  scene.globe.backFaceCulling = true;\n  scene.globe.depthTestAgainstTerrain = false;\n  \n  // Solid background - no transparency\n  scene.globe.baseColor = Color.BLACK;\n  scene.backgroundColor = Color.BLACK;\n  \n  // Disable all sky elements\n  if (scene.skyBox) scene.skyBox.show = false;\n  if (scene.sun) scene.sun.show = false;\n  if (scene.moon) scene.moon.show = false;\n  if (scene.skyAtmosphere) scene.skyAtmosphere.show = false;\n  \n  // Disable atmospheric effects\n  scene.fog.enabled = false;\n  scene.highDynamicRange = false;\n  scene.logarithmicDepthBuffer = false;\n  \n  // Disable ALL post-processing\n  const stages = scene.postProcessStages;\n  if (stages) {\n    stages.fxaa.enabled = false;\n    stages.ambientOcclusion.enabled = false;\n    stages.bloom.enabled = false;\n  }\n  \n  // Disable ground primitives that can flicker\n  scene.groundPrimitives.show = true;\n  \n  // Initial camera\n  viewer.camera.setView({\n    destination: Cartesian3.fromDegrees(0, 20, 20000000),\n    orientation: {\n      heading: 0,\n      pitch: CesiumMath.toRadians(-90),\n      roll: 0,\n    },\n  });\n\n  console.log(\"Cesium viewer created with stable local imagery\");\n  return viewer;\n}\n\n/**\n * Creates event handlers for Cesium viewer interactions\n */\nexport function createEventHandlers(\n  viewer: Viewer,\n  onStationClick: (stationId: string | null) => void,\n  onStationHover: (stationId: string | null) => void,\n): ScreenSpaceEventHandler {\n  const handler = new ScreenSpaceEventHandler(viewer.scene.canvas);\n\n  handler.setInputAction((click: any) => {\n    const pickedObject = viewer.scene.pick(click.position);\n    if (defined(pickedObject) && defined(pickedObject.id) && (pickedObject.id as any).station) {\n      onStationClick((pickedObject.id as any).station.id);\n    } else {\n      onStationClick(null);\n    }\n  }, ScreenSpaceEventType.LEFT_CLICK);\n\n  handler.setInputAction((movement: any) => {\n    const pickedObject = viewer.scene.pick(movement.endPosition);\n    if (defined(pickedObject) && defined(pickedObject.id) && (pickedObject.id as any).station) {\n      onStationHover((pickedObject.id as any).station.id);\n      viewer.canvas.style.cursor = \"pointer\";\n    } else {\n      onStationHover(null);\n      viewer.canvas.style.cursor = \"default\";\n    }\n  }, ScreenSpaceEventType.MOUSE_MOVE);\n\n  return handler;\n}\n"],"names":["DEFAULT_CESIUM_CONFIG","animation","baseLayerPicker","fullscreenButton","geocoder","homeButton","infoBox","sceneModePicker","selectionIndicator","timeline","navigationHelpButton","navigationInstructionsInitiallyVisible","vrButton","scene3DOnly","shadows","terrainShadows","DISABLED","createCesiumViewer","container","config","creditContainer","document","createElement","style","display","body","appendChild","imageryProvider","AERIAL","error","console","warn","fromUrl","viewer","terrainProvider","baseLayer","requestRenderMode","targetFrameRate","useBrowserRecommendedResolution","sceneMode","SCENE3D","orderIndependentTranslucency","contextOptions","webgl","alpha","antialias","preserveDrawingBuffer","powerPreference","failIfMajorPerformanceCaveat","scene","globe","enableLighting","showGroundAtmosphere","showWaterEffect","backFaceCulling","depthTestAgainstTerrain","baseColor","BLACK","backgroundColor","skyBox","show","sun","moon","skyAtmosphere","fog","enabled","highDynamicRange","logarithmicDepthBuffer","stages","postProcessStages","fxaa","ambientOcclusion","bloom","groundPrimitives","camera","setView","destination","fromDegrees","orientation","heading","pitch","toRadians","roll","log","createEventHandlers","onStationClick","onStationHover","handler","canvas","setInputAction","click","pickedObject","pick","position","id","station","LEFT_CLICK","movement","endPosition","cursor","MOUSE_MOVE"],"mappings":"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"}},
    {"offset": {"line": 830, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/utils/cesiumRegionOverlay.ts"],"sourcesContent":["import {\n  Color,\n  ColorMaterialProperty,\n  ConstantProperty,\n  GeoJsonDataSource,\n  Viewer,\n} from \"cesium\";\nimport type { Feature, Geometry } from \"geojson\";\nimport booleanPointInPolygon from \"@turf/boolean-point-in-polygon\";\nimport { point } from \"@turf/helpers\";\nimport type { RadioStation } from \"../types\";\nimport {\n  loadNaturalEarthCountries,\n  loadNaturalEarthRegions,\n  type NaturalEarthCollection,\n  type NaturalEarthFeature,\n  type NaturalEarthFeatureProperties,\n} from \"../services/location/naturalEarthService\";\n\ninterface OverlayCacheEntry {\n  source: GeoJsonDataSource;\n}\n\ninterface OverlayDescriptor {\n  key: string;\n  type: \"country\" | \"region\";\n  isoA2?: string;\n  isoA3?: string;\n  iso3166?: string;\n  centroid: { lat: number; lng: number };\n}\n\nconst DEFAULT_FILL = Color.fromCssColorString(\"#2563eb\").withAlpha(0.15);\nconst DEFAULT_STROKE = Color.fromCssColorString(\"#2563eb\").withAlpha(0.8);\nconst SECONDARY_FILL = Color.fromCssColorString(\"#facc15\").withAlpha(0.2);\nconst SECONDARY_STROKE = Color.fromCssColorString(\"#fde047\").withAlpha(0.9);\n\nexport class CesiumRegionOverlayManager {\n  private viewer: Viewer;\n  private cache = new Map<string, OverlayCacheEntry>();\n  private activeKeys: string[] = [];\n  private countryCollectionPromise: Promise<NaturalEarthCollection> | null = null;\n  private regionCollectionPromise: Promise<NaturalEarthCollection> | null = null;\n\n  constructor(viewer: Viewer) {\n    this.viewer = viewer;\n  }\n\n  async highlightStation(station: RadioStation | null): Promise<void> {\n    this.hideActiveSources();\n\n    if (!station?.location.wof) {\n      return;\n    }\n\n    const detail = station.location.wof;\n    const centroid = detail.centroid ?? { lat: station.location.lat, lng: station.location.lng };\n\n    const highlightQueue: Array<{ descriptor: OverlayDescriptor; fill: Color; stroke: Color }> = [];\n\n    if (detail.countryIsoA3 || detail.countryIsoA2) {\n      highlightQueue.push({\n        descriptor: {\n          key: `country:${detail.countryIsoA3 ?? detail.countryIsoA2 ?? detail.countryId}`,\n          type: \"country\",\n          isoA2: detail.countryIsoA2,\n          isoA3: detail.countryIsoA3,\n          centroid,\n        },\n        fill: DEFAULT_FILL,\n        stroke: DEFAULT_STROKE,\n      });\n    }\n\n    if (detail.regionIso3166 || detail.regionId) {\n      highlightQueue.push({\n        descriptor: {\n          key: `region:${detail.regionIso3166 ?? detail.regionId}`,\n          type: \"region\",\n          isoA2: detail.countryIsoA2,\n          iso3166: detail.regionIso3166,\n          centroid,\n        },\n        fill: SECONDARY_FILL,\n        stroke: SECONDARY_STROKE,\n      });\n    }\n\n    for (const item of highlightQueue) {\n      const source = await this.ensureSource(item.descriptor, item.fill, item.stroke);\n      if (!source) continue;\n      source.show = true;\n      this.activeKeys.push(item.descriptor.key);\n    }\n  }\n\n  dispose(): void {\n    this.cache.forEach((entry) => {\n      this.viewer.dataSources.remove(entry.source, true);\n    });\n    this.cache.clear();\n    this.activeKeys = [];\n  }\n\n  private hideActiveSources(): void {\n    for (const key of this.activeKeys) {\n      const entry = this.cache.get(key);\n      if (entry) {\n        entry.source.show = false;\n      }\n    }\n    this.activeKeys = [];\n  }\n\n  private async ensureSource(descriptor: OverlayDescriptor, fill: Color, stroke: Color): Promise<GeoJsonDataSource | null> {\n    const cached = this.cache.get(descriptor.key);\n    if (cached) {\n      this.applyMaterial(cached.source, fill, stroke);\n      return cached.source;\n    }\n\n    const feature = await this.findFeature(descriptor);\n    if (!feature) return null;\n\n    const collection = {\n      type: \"FeatureCollection\" as const,\n      features: [feature],\n    };\n\n    const source = await GeoJsonDataSource.load(collection, {\n      stroke,\n      strokeWidth: 2,\n      fill,\n      clampToGround: true,\n    });\n\n    this.viewer.dataSources.add(source);\n    this.cache.set(descriptor.key, { source });\n    return source;\n  }\n\n  private async findFeature(descriptor: OverlayDescriptor): Promise<NaturalEarthFeature | null> {\n    if (descriptor.type === \"country\") {\n      const collection = await this.ensureCountries();\n      const { isoA2, isoA3, centroid } = descriptor;\n      const matchByIso = collection.features.find((feature) => {\n          const props = feature.properties;\n          if (isoA3 && props.isoA3?.toUpperCase() === isoA3.toUpperCase()) return true;\n          if (isoA2 && props.isoA2?.toUpperCase() === isoA2.toUpperCase()) return true;\n          return props.name.toLowerCase() === descriptor.key.replace(\"country:\", \"\").toLowerCase();\n        });\n      if (matchByIso && this.isNaturalEarthFeature(matchByIso)) {\n        return matchByIso;\n      }\n\n      const matchByPoint = collection.features.find((feature) => {\n        if (!this.isNaturalEarthFeature(feature)) {\n          return false;\n        }\n        return this.isFeatureContainingPoint(feature, centroid.lat, centroid.lng);\n      });\n      if (matchByPoint && this.isNaturalEarthFeature(matchByPoint)) {\n        return matchByPoint;\n      }\n\n      return null;\n    }\n\n    const collection = await this.ensureRegions();\n    const { iso3166, isoA2, centroid } = descriptor;\n    const matchByCode = collection.features.find(\n      (feature) => iso3166 && feature.properties.iso3166_2?.toUpperCase() === iso3166.toUpperCase(),\n    );\n    if (matchByCode && this.isNaturalEarthFeature(matchByCode)) {\n      return matchByCode;\n    }\n\n    const matchByPoint = collection.features.find((feature) => {\n      if (isoA2 && feature.properties.isoA2?.toUpperCase() !== isoA2.toUpperCase()) {\n        return false;\n      }\n      if (!this.isNaturalEarthFeature(feature)) {\n        return false;\n      }\n      return this.isFeatureContainingPoint(feature, centroid.lat, centroid.lng);\n    });\n    if (matchByPoint && this.isNaturalEarthFeature(matchByPoint)) {\n      return matchByPoint;\n    }\n\n    return null;\n  }\n\n  private async ensureCountries(): Promise<NaturalEarthCollection> {\n    if (!this.countryCollectionPromise) {\n      this.countryCollectionPromise = loadNaturalEarthCountries();\n    }\n    return this.countryCollectionPromise;\n  }\n\n  private async ensureRegions(): Promise<NaturalEarthCollection> {\n    if (!this.regionCollectionPromise) {\n      this.regionCollectionPromise = loadNaturalEarthRegions();\n    }\n    return this.regionCollectionPromise;\n  }\n\n  private isFeatureContainingPoint(feature: NaturalEarthFeature, lat: number, lng: number): boolean {\n    const [minLng, minLat, maxLng, maxLat] = feature.bbox;\n    if (lat < minLat || lat > maxLat || lng < minLng || lng > maxLng) {\n      return false;\n    }\n    try {\n      return booleanPointInPolygon(point([lng, lat]), feature as any);\n    } catch (error) {\n      console.warn(\"Failed to evaluate Natural Earth polygon\", error);\n      return false;\n    }\n  }\n\n  private isNaturalEarthFeature(\n    feature: Feature<Geometry, NaturalEarthFeatureProperties> | NaturalEarthFeature,\n  ): feature is NaturalEarthFeature {\n    const bbox = (feature as NaturalEarthFeature).bbox;\n    return Array.isArray(bbox) && bbox.length === 4;\n  }\n\n  private applyMaterial(source: GeoJsonDataSource, fill: Color, stroke: Color): void {\n    source.entities.values.forEach((entity) => {\n      if (entity.polygon) {\n        entity.polygon.material = new ColorMaterialProperty(fill);\n        entity.polygon.outlineColor = new ConstantProperty(stroke);\n        entity.polygon.outlineWidth = new ConstantProperty(2);\n      }\n      if (entity.polyline) {\n        entity.polyline.material = new ColorMaterialProperty(stroke);\n        entity.polyline.width = new ConstantProperty(2);\n      }\n    });\n  }\n}\n"],"names":["DEFAULT_FILL","fromCssColorString","withAlpha","DEFAULT_STROKE","SECONDARY_FILL","SECONDARY_STROKE","CesiumRegionOverlayManager","viewer","cache","Map","activeKeys","countryCollectionPromise","regionCollectionPromise","highlightStation","station","hideActiveSources","location","wof","detail","centroid","lat","lng","highlightQueue","countryIsoA3","countryIsoA2","push","descriptor","key","countryId","type","isoA2","isoA3","fill","stroke","regionIso3166","regionId","iso3166","item","source","ensureSource","show","dispose","forEach","entry","dataSources","remove","clear","get","cached","applyMaterial","feature","findFeature","collection","features","load","strokeWidth","clampToGround","add","set","ensureCountries","matchByIso","find","props","properties","toUpperCase","name","toLowerCase","replace","isNaturalEarthFeature","matchByPoint","isFeatureContainingPoint","ensureRegions","matchByCode","iso3166_2","minLng","minLat","maxLng","maxLat","bbox","error","console","warn","Array","isArray","length","entities","values","entity","polygon","material","outlineColor","outlineWidth","polyline","width"],"mappings":"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"}},
    {"offset": {"line": 1040, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/components/CesiumGlobeRenderer.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef, useCallback, RefObject } from \"react\";\nimport {\n  Ion,\n  Viewer,\n  Cartesian3,\n} from \"cesium\";\n// import 'cesium/Build/Cesium/Widgets/widgets.css'\nimport { useGlobeStore } from \"../stores/globe-store\";\nimport { createStationLoadingUseCase } from \"../infrastructure/ServiceContainer\";\nimport { radioDiscoveryService } from \"../services/radioDiscoveryService\";\nimport { createCameraDestination } from \"../utils/cesiumUtils\";\nimport { CesiumEntityManager } from \"../utils/cesiumEntityManager\";\nimport {\n  createCesiumViewer,\n  createEventHandlers,\n} from \"../utils/cesiumViewerConfig\";\nimport { CesiumRegionOverlayManager } from \"../utils/cesiumRegionOverlay\";\nimport type { RadioStation } from \"../types\";\n\n// Set Cesium base URL as early as possible\nif (typeof window !== \"undefined\") {\n  (window as any).CESIUM_BASE_URL = \"/cesium/\";\n\n  // Add global error handler for Cesium imagery errors specifically\n  window.addEventListener(\"unhandledrejection\", (event) => {\n    const reason = event.reason;\n    if (reason) {\n      const errorStr = reason.toString ? reason.toString() : String(reason);\n      const message = reason.message || errorStr;\n      \n      // Suppress Cesium-related imagery/tile loading errors\n      if (\n        errorStr.includes(\"ImageryLayer\") ||\n        errorStr.includes(\"cesium\") ||\n        errorStr.includes(\"imagery\") ||\n        errorStr.includes(\"tile\") ||\n        errorStr.includes(\"Tile\") ||\n        message.includes(\"ImageryLayer\") ||\n        message.includes(\"Failed to load\")\n      ) {\n        // Silently handle - these are usually transient network issues\n        event.preventDefault();\n        return;\n      }\n    }\n  });\n\n  // Also catch regular errors from Cesium\n  window.addEventListener(\"error\", (event) => {\n    if (event.message && (\n      event.message.includes(\"cesium\") ||\n      event.message.includes(\"Cesium\") ||\n      event.message.includes(\"ImageryLayer\") ||\n      event.message.includes(\"tile\")\n    )) {\n      event.preventDefault();\n      return;\n    }\n  });\n}\n\n// Set Cesium Ion access token\nIon.defaultAccessToken =\n  process.env.NEXT_PUBLIC_CESIUM_ION_TOKEN ||\n  \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJlYWE1NGU5Ny05OGNlLTQ4Y2MtOGEyNC0yOGQ1NGM2YmJmMzgiLCJpZCI6MjU5LCJzY29wZXMiOlsiYXNyIiwiZ2MiXSwiaWF0IjoxNzM2NjkwMzIxfQ.aF1ggEQ-dJfCOoAGiU5pynhQD7q4aaUOMkFD2C7sZS8\";\n\ninterface CesiumGlobeRendererProps {\n  containerRef: RefObject<HTMLDivElement>;\n}\n\nexport default function CesiumGlobeRenderer({\n  containerRef,\n}: CesiumGlobeRendererProps) {\n  const viewerRef = useRef<Viewer | null>(null);\n  const entityManagerRef = useRef<CesiumEntityManager | null>(null);\n  const handlerRef = useRef<any>(null);\n  const overlayManagerRef = useRef<CesiumRegionOverlayManager | null>(null);\n\n  const {\n    selectedStation,\n    hoveredStation,\n    selectStation,\n    hoverStation,\n    addMarker,\n    flyToTarget,\n    clearFlyToTarget,\n    selectCluster,\n  } = useGlobeStore();\n\n  // Load radio stations using the comprehensive country-based system\n  const loadStations = useCallback(async () => {\n    console.log(\"Loading stations with country-based organization...\", {\n      entityManager: !!entityManagerRef.current,\n    });\n    if (!entityManagerRef.current) {\n      console.warn(\"Entity manager not available\");\n      return;\n    }\n\n    try {\n      // Create service instances\n      const stationLoader = createStationLoadingUseCase();\n\n      // Get current camera height and calculate proper zoom level\n      const cameraHeight = viewerRef.current?.camera.positionCartographic.height || 15000000;\n      console.log(\"Camera height:\", cameraHeight);\n      \n      // More conservative zoom levels to prevent overcrowding\n      let currentZoom = 1; // Default to country level\n      if (cameraHeight < 2000000) currentZoom = 5; // Very close - individual stations\n      else if (cameraHeight < 5000000) currentZoom = 4; // Close - city clusters\n      else if (cameraHeight < 10000000) currentZoom = 3; // Medium - city clusters\n      else if (cameraHeight < 20000000) currentZoom = 2; // Far - country clusters\n      else currentZoom = 1; // Very far - country clusters only\n      \n      console.log(\"Loading stations for zoom level:\", currentZoom);\n      const markerData = await stationLoader.loadStationsForView(currentZoom);\n      console.log(\"Received marker data:\", markerData.length, \"markers\");\n\n      if (markerData.length === 0) {\n        console.warn(\"No markers received from station loader - trying fallback\");\n        // Fallback: try to load some test stations directly\n        try {\n          const fallbackStations = await radioDiscoveryService.getTopStations(20);\n          console.log(\"Loaded fallback stations:\", fallbackStations.length);\n          \n          fallbackStations.forEach((station, index) => {\n            try {\n              if (station.location?.lat && station.location?.lng) {\n                console.log(`Creating entity ${index + 1}/${fallbackStations.length}: ${station.name}`);\n                entityManagerRef.current!.createStationEntity(station);\n                addMarker(station);\n              } else {\n                console.warn(`Station ${station.name} has no valid coordinates`);\n              }\n            } catch (entityError) {\n              console.error(`Failed to create entity for ${station.name}:`, entityError);\n            }\n          });\n          \n          return;\n        } catch (fallbackError) {\n          console.error(\"Fallback station loading failed:\", fallbackError);\n        }\n        return;\n      }\n\n      // Clear existing entities before adding new ones\n      entityManagerRef.current.clearAll();\n      console.log(\"Cleared existing entities\");\n\n      // Add marker entities based on the new system with better validation\n      let successCount = 0;\n      let errorCount = 0;\n      \n      markerData.forEach((marker, index) => {\n        try {\n          console.log(`Processing marker ${index + 1}/${markerData.length}:`, marker.id, marker.type);\n          \n          // Validate marker position\n          if (!marker.position || marker.position.length !== 3) {\n            console.error(`Invalid position for marker ${marker.id}:`, marker.position);\n            errorCount++;\n            return;\n          }\n          \n          const [lng, lat, height] = marker.position;\n          \n          // Validate coordinates\n          if (isNaN(lat) || isNaN(lng) || lat < -90 || lat > 90 || lng < -180 || lng > 180) {\n            console.error(`Invalid coordinates for marker ${marker.id}: lat=${lat}, lng=${lng}`);\n            errorCount++;\n            return;\n          }\n          \n          // Create appropriate station data for the entity\n          if (marker.type === 'cluster' || marker.type === 'city') {\n            const stationData = {\n              id: marker.id,\n              name: marker.metadata.name || `Cluster ${marker.metadata.stationCount}`,\n              location: {\n                lat: lat,\n                lng: lng,\n                country: marker.metadata.country || 'Unknown',\n                city: marker.metadata.city || 'Unknown',\n              },\n              url: marker.stations[0]?.url || 'http://example.com',\n              genre: marker.metadata.type === 'country' ? 'Country Cluster' : 'City Cluster',\n              language: 'Multiple',\n              listeners: (marker.metadata.stationCount || 1) * 1000,\n              stationCount: marker.metadata.stationCount,\n              isCluster: true,\n              stations: marker.stations, // Store the list of stations\n              type: marker.type\n            };\n            \n            console.log(`Creating cluster entity: ${stationData.name} ${marker.type === 'city' ? '(City)' : '(Country)'}`);\n            entityManagerRef.current!.createStationEntity(stationData as any);\n            addMarker(stationData as any);\n          } else {\n            // Individual station\n            const station = marker.stations[0];\n            if (station && station.location?.lat && station.location?.lng) {\n              console.log(`Creating individual station entity: ${station.name}`);\n              entityManagerRef.current!.createStationEntity(station);\n              addMarker(station);\n            } else {\n              console.error(`Invalid station data for marker ${marker.id}:`, station);\n              errorCount++;\n              return;\n            }\n          }\n          successCount++;\n        } catch (err) {\n          console.error(\n            `Failed to create entity for marker ${marker.id}:`,\n            err\n          );\n          errorCount++;\n        }\n      });\n\n      console.log(`Marker creation complete: ${successCount} successful, ${errorCount} errors`);\n      console.log(`Total stations represented: ${markerData.reduce((sum, m) => sum + (m.metadata.stationCount || 1), 0)}`);\n      \n      if (successCount === 0) {\n        console.error(\"No markers were successfully created! Trying emergency fallback...\");\n        // Emergency fallback - add a few test markers\n        const testStations = [\n          {\n            id: 'test-1',\n            name: 'Test Station NYC',\n            location: { lat: 40.7128, lng: -74.0060, country: 'US', city: 'New York' },\n            url: 'http://test.com',\n            genre: 'Test',\n            language: 'English',\n            listeners: 1000\n          },\n          {\n            id: 'test-2', \n            name: 'Test Station London',\n            location: { lat: 51.5074, lng: -0.1278, country: 'GB', city: 'London' },\n            url: 'http://test.com',\n            genre: 'Test',\n            language: 'English',\n            listeners: 1000\n          }\n        ];\n        \n        testStations.forEach(station => {\n          try {\n            entityManagerRef.current!.createStationEntity(station as any);\n            addMarker(station as any);\n            console.log(`Added emergency test station: ${station.name}`);\n          } catch (testError) {\n            console.error(`Failed to add test station ${station.name}:`, testError);\n          }\n        });\n      }\n    } catch (error) {\n      console.error(\"Failed to load comprehensive station system:\", error);\n      // Try a simple test to add one marker\n      try {\n        const testStation: RadioStation = {\n          id: \"test-station\",\n          name: \"Test Station\",\n          location: {\n            lat: 40.7128,\n            lng: -74.006,\n            country: \"USA\",\n            city: \"New York\",\n          },\n          url: \"http://test.com\",\n          genre: \"Test\",\n          language: \"English\",\n          listeners: 1000,\n        };\n        addMarker(testStation);\n        console.log(\"Added test station\");\n      } catch (testError) {\n        console.error(\"Failed to add test station:\", testError);\n      }\n    }\n  }, [addMarker]);\n\n  // Initialize Cesium viewer and entity manager\n  useEffect(() => {\n    console.log(\"Initializing Cesium...\", {\n      container: !!containerRef.current,\n      viewer: !!viewerRef.current,\n    });\n    if (!containerRef.current || viewerRef.current) return;\n\n    let cancelled = false;\n\n    const initViewer = async () => {\n      try {\n        console.log(\"Creating Cesium viewer...\");\n\n        const viewer = await createCesiumViewer(containerRef.current!);\n\n        if (cancelled) {\n          viewer.destroy();\n          return;\n        }\n\n        viewerRef.current = viewer;\n        console.log(\"Cesium viewer created successfully\");\n\n        // Hide loading indicator\n        const loadingEl = document.getElementById(\"cesium-loading\");\n        if (loadingEl) {\n          loadingEl.style.display = \"none\";\n        }\n\n        // Add error event listeners but don't let them break the app\n        viewer.scene.renderError.addEventListener((scene, error) => {\n          console.warn(\"Cesium render error (handled):\", error);\n        });\n\n        viewer.scene.debugShowFramesPerSecond = false;\n\n        // Create entity manager\n        console.log(\"Creating entity manager...\");\n        entityManagerRef.current = new CesiumEntityManager(viewer);\n        console.log(\"Entity manager created\");\n\n        overlayManagerRef.current = new CesiumRegionOverlayManager(viewer);\n\n        const resolveStation = (stationId: string | null): RadioStation | null => {\n          if (!stationId || !entityManagerRef.current) return null;\n          const entity = entityManagerRef.current.getEntity(stationId);\n          const station = entity ? ((entity as any).station as RadioStation | undefined) : undefined;\n          return station ?? null;\n        };\n\n        handlerRef.current = createEventHandlers(\n          viewer,\n          (stationId) => {\n            const station = resolveStation(stationId);\n            const isCluster = station && ((station as any).isCluster || (station as any).type === 'cluster' || (station as any).type === 'city');\n            \n            if (isCluster && (station as any).stations) {\n              console.log(\"Cluster selected:\", (station as any).stations.length, \"stations\");\n              selectCluster((station as any).stations);\n              // Also select the first station to play music immediately\n              if ((station as any).stations.length > 0) {\n                 selectStation((station as any).stations[0]);\n              }\n            } else {\n              selectStation(station);\n            }\n          },\n          (stationId) => {\n            const station = resolveStation(stationId);\n            hoverStation(station);\n          },\n        );\n\n        // Add camera movement event listener for dynamic loading\n        let lastZoomLevel = 1;\n        viewer.camera.moveEnd.addEventListener(() => {\n          const height = viewer.camera.positionCartographic.height;\n          let newZoom = 1;\n          if (height < 2000000) newZoom = 5;\n          else if (height < 5000000) newZoom = 4;\n          else if (height < 10000000) newZoom = 3;\n          else if (height < 20000000) newZoom = 2;\n          else newZoom = 1;\n          \n          console.log(`Camera moved to height: ${height}, zoom level: ${newZoom}`);\n          \n          // Only reload if zoom level actually changed\n          if (newZoom !== lastZoomLevel) {\n            lastZoomLevel = newZoom;\n            setTimeout(() => {\n              loadStations();\n            }, 300);\n          }\n        });\n\n        // Load initial stations after a brief delay to ensure viewer is ready\n        console.log(\"Loading stations...\");\n        setTimeout(() => {\n          loadStations();\n        }, 500);\n\n      } catch (error) {\n        console.error(\"Failed to initialize Cesium viewer:\", error);\n        \n        let errorMessage = \"Unknown error\";\n        if (error instanceof Error) {\n          errorMessage = error.message;\n          console.error(\"Error details:\", error.stack);\n        } else if (typeof error === \"string\") {\n          errorMessage = error;\n        } else {\n          try {\n            errorMessage = JSON.stringify(error);\n          } catch (e) {\n            errorMessage = String(error);\n          }\n        }\n\n        // Try to show fallback content\n        const loadingEl = document.getElementById(\"cesium-loading\");\n        if (loadingEl) {\n          loadingEl.innerHTML = `\n            <div class=\"text-white text-center\">\n              <div class=\"text-red-500 mb-2\">Failed to initialize 3D Globe</div>\n              <div class=\"text-sm\">Error: ${errorMessage}</div>\n            </div>\n          `;\n        }\n      }\n    };\n\n    initViewer();\n\n    return () => {\n      cancelled = true;\n      cleanup();\n    };\n  }, [containerRef, selectStation, hoverStation, loadStations]);\n\n  // Update entity appearance based on selection/hover state\n  useEffect(() => {\n    if (!entityManagerRef.current) return;\n\n    entityManagerRef.current.getAllEntities().forEach((entity, stationId) => {\n      const isSelected = selectedStation?.id === stationId;\n      const isHovered = hoveredStation?.id === stationId;\n\n      entityManagerRef.current!.updateEntityAppearance(\n        stationId,\n        isSelected,\n        isHovered,\n      );\n    });\n  }, [selectedStation, hoveredStation]);\n\n  // Animate camera to selected station\n  useEffect(() => {\n    if (overlayManagerRef.current) {\n      void overlayManagerRef.current.highlightStation(selectedStation ?? null);\n    }\n\n    if (!viewerRef.current || !selectedStation) return;\n\n    const viewer = viewerRef.current;\n    const destination = createCameraDestination(selectedStation);\n\n    viewer.camera.flyTo({\n      destination: destination.destination,\n      orientation: destination.orientation,\n      duration: destination.duration,\n    });\n  }, [selectedStation]);\n\n  // Handle flyToTarget from store (for search/discovery)\n  useEffect(() => {\n    if (!viewerRef.current || !flyToTarget) return;\n\n    const viewer = viewerRef.current;\n    const { latitude, longitude, height = 2000000, duration = 2 } = flyToTarget;\n\n    viewer.camera.flyTo({\n      destination: Cartesian3.fromDegrees(longitude, latitude, height),\n      duration: duration,\n      complete: () => {\n        // Clear the target after animation completes\n        clearFlyToTarget();\n      },\n    });\n  }, [flyToTarget, clearFlyToTarget]);\n\n  // Cleanup function\n  const cleanup = () => {\n    if (handlerRef.current) {\n      handlerRef.current.destroy();\n      handlerRef.current = null;\n    }\n    if (viewerRef.current) {\n      viewerRef.current.destroy();\n      viewerRef.current = null;\n    }\n    entityManagerRef.current = null;\n    if (overlayManagerRef.current) {\n      overlayManagerRef.current.dispose();\n      overlayManagerRef.current = null;\n    }\n  };\n\n  return null;\n}\n"],"names":["window","CESIUM_BASE_URL","addEventListener","event","reason","errorStr","toString","String","message","includes","preventDefault","defaultAccessToken","CesiumGlobeRenderer","containerRef","viewerRef","entityManagerRef","handlerRef","overlayManagerRef","selectedStation","hoveredStation","selectStation","hoverStation","addMarker","flyToTarget","clearFlyToTarget","selectCluster","loadStations","console","log","entityManager","current","warn","stationLoader","cameraHeight","camera","positionCartographic","height","currentZoom","markerData","loadStationsForView","length","fallbackStations","getTopStations","forEach","station","index","location","lat","lng","name","createStationEntity","entityError","error","fallbackError","clearAll","successCount","errorCount","marker","id","type","position","isNaN","stationData","metadata","stationCount","country","city","url","stations","genre","language","listeners","isCluster","err","reduce","sum","m","testStations","testError","testStation","container","viewer","cancelled","initViewer","destroy","loadingEl","document","getElementById","style","display","scene","renderError","debugShowFramesPerSecond","resolveStation","stationId","entity","getEntity","undefined","lastZoomLevel","moveEnd","newZoom","setTimeout","errorMessage","Error","stack","JSON","stringify","e","innerHTML","cleanup","getAllEntities","isSelected","isHovered","updateEntityAppearance","highlightStation","destination","flyTo","orientation","duration","latitude","longitude","fromDegrees","complete","dispose"],"mappings":"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"}}]
}