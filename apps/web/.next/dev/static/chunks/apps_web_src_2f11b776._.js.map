{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/components/Earth.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRef, useMemo } from \"react\";\nimport { useFrame } from \"@react-three/fiber\";\nimport { Sphere } from \"@react-three/drei\";\nimport * as THREE from \"three\";\n\nexport function Earth() {\n  const earthRef = useRef<THREE.Mesh>(null);\n  const nightLightsRef = useRef<THREE.Mesh>(null);\n  const cloudsRef = useRef<THREE.Mesh>(null);\n  const atmosphereRef = useRef<THREE.Mesh>(null);\n\n  // Load real Earth day texture using NASA-style satellite imagery\n  const dayTexture = useMemo(() => {\n    const canvas = document.createElement(\"canvas\");\n    const ctx = canvas.getContext(\"2d\")!;\n    canvas.width = 2048;\n    canvas.height = 1024;\n\n    // Create high-contrast realistic Earth texture\n    createSatelliteEarthTexture(ctx, canvas.width, canvas.height);\n\n    const texture = new THREE.CanvasTexture(canvas);\n    texture.wrapS = THREE.RepeatWrapping;\n    texture.wrapT = THREE.ClampToEdgeWrapping;\n    texture.generateMipmaps = false;\n    texture.minFilter = THREE.LinearFilter;\n    texture.magFilter = THREE.LinearFilter;\n    return texture;\n  }, []);\n\n  // Create realistic night lights from satellite data\n  const nightTexture = useMemo(() => {\n    const canvas = document.createElement(\"canvas\");\n    const ctx = canvas.getContext(\"2d\")!;\n    canvas.width = 2048;\n    canvas.height = 1024;\n\n    // Black background\n    ctx.fillStyle = \"#000000\";\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n    // Add NASA-style night lights\n    addNASAStyleNightLights(ctx, canvas.width, canvas.height);\n\n    const texture = new THREE.CanvasTexture(canvas);\n    texture.wrapS = THREE.RepeatWrapping;\n    texture.wrapT = THREE.ClampToEdgeWrapping;\n    return texture;\n  }, []);\n\n  // Create realistic cloud texture\n  const cloudTexture = useMemo(() => {\n    const canvas = document.createElement(\"canvas\");\n    const ctx = canvas.getContext(\"2d\")!;\n    canvas.width = 1024;\n    canvas.height = 512;\n\n    createRealisticClouds(ctx, canvas.width, canvas.height);\n\n    const texture = new THREE.CanvasTexture(canvas);\n    texture.wrapS = THREE.RepeatWrapping;\n    texture.wrapT = THREE.ClampToEdgeWrapping;\n    return texture;\n  }, []);\n\n  // Create topographical normal map\n  const normalTexture = useMemo(() => {\n    const canvas = document.createElement(\"canvas\");\n    const ctx = canvas.getContext(\"2d\")!;\n    canvas.width = 1024;\n    canvas.height = 512;\n\n    createTopographicalNormalMap(ctx, canvas.width, canvas.height);\n\n    const texture = new THREE.CanvasTexture(canvas);\n    texture.wrapS = THREE.RepeatWrapping;\n    texture.wrapT = THREE.ClampToEdgeWrapping;\n    return texture;\n  }, []);\n\n  // Animation with realistic rotation speed\n  useFrame((state, delta) => {\n    if (earthRef.current && nightLightsRef.current && cloudsRef.current) {\n      // Earth rotates once every 24 hours - scale it for demo (much faster)\n      earthRef.current.rotation.y += delta * 0.1;\n      nightLightsRef.current.rotation.y += delta * 0.1;\n      cloudsRef.current.rotation.y += delta * 0.12; // Clouds move slightly faster\n\n      // Dynamic atmosphere\n      if (atmosphereRef.current && atmosphereRef.current.material) {\n        const material = atmosphereRef.current.material as THREE.ShaderMaterial;\n        if (material.uniforms) {\n          material.uniforms.time.value = state.clock.getElapsedTime();\n        }\n      }\n    }\n  });\n\n  return (\n    <group>\n      {/* Main Earth sphere with enhanced contrast */}\n      <Sphere ref={earthRef} args={[2, 128, 64]}>\n        <meshPhongMaterial\n          map={dayTexture}\n          normalMap={normalTexture}\n          normalScale={new THREE.Vector2(1.2, 1.2)}\n          shininess={0.5}\n          specular={new THREE.Color(0x000000)}\n          transparent={false}\n          flatShading={false}\n        />\n      </Sphere>\n\n      {/* Night lights layer */}\n      <Sphere ref={nightLightsRef} args={[2.001, 64, 32]}>\n        <meshBasicMaterial\n          map={nightTexture}\n          transparent={true}\n          opacity={1}\n          blending={THREE.AdditiveBlending}\n        />\n      </Sphere>\n\n      {/* Realistic cloud layer */}\n      <Sphere ref={cloudsRef} args={[2.008, 64, 32]}>\n        <meshLambertMaterial\n          map={cloudTexture}\n          transparent={true}\n          opacity={0.4}\n          alphaTest={0.1}\n        />\n      </Sphere>\n\n      {/* Enhanced atmospheric glow */}\n      <Sphere ref={atmosphereRef} args={[2.15, 64, 32]}>\n        <shaderMaterial\n          uniforms={{\n            time: { value: 0 },\n            color: { value: new THREE.Color(0.4, 0.7, 1.0) },\n          }}\n          vertexShader={`\n            varying vec3 vNormal;\n            varying vec3 vPositionNormal;\n            \n            void main() {\n              vNormal = normalize(normalMatrix * normal);\n              vPositionNormal = normalize((modelViewMatrix * vec4(position, 1.0)).xyz);\n              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            }\n          `}\n          fragmentShader={`\n            uniform float time;\n            uniform vec3 color;\n            varying vec3 vNormal;\n            varying vec3 vPositionNormal;\n            \n            void main() {\n              float intensity = pow(0.6 - dot(vNormal, vPositionNormal), 2.0);\n              vec3 atmosphere = color * pow(intensity, 0.8);\n              float alpha = intensity * 0.4;\n              gl_FragColor = vec4(atmosphere, alpha);\n            }\n          `}\n          side={THREE.BackSide}\n          transparent={true}\n        />\n      </Sphere>\n    </group>\n  );\n}\n\n// Create satellite-style Earth texture with high contrast between land and water\nfunction createSatelliteEarthTexture(ctx: CanvasRenderingContext2D, width: number, height: number) {\n  // Create ultra-realistic ocean background with deep blue-black gradients\n  const oceanGradient = ctx.createLinearGradient(0, 0, 0, height);\n  oceanGradient.addColorStop(0, \"#000814\");    // Arctic black-blue\n  oceanGradient.addColorStop(0.15, \"#001d3d\"); // Northern deep blue  \n  oceanGradient.addColorStop(0.35, \"#003566\"); // Temperate ocean blue\n  oceanGradient.addColorStop(0.5, \"#0a4f8c\");  // Equatorial bright blue\n  oceanGradient.addColorStop(0.65, \"#003566\"); // Southern temperate\n  oceanGradient.addColorStop(0.85, \"#001d3d\"); // Southern deep blue\n  oceanGradient.addColorStop(1, \"#000814\");    // Antarctic black-blue\n  \n  ctx.fillStyle = oceanGradient;\n  ctx.fillRect(0, 0, width, height);\n\n  // Add ultra-detailed, photorealistic continent definitions\n  const continents = [\n    {\n      name: \"North America\",\n      regions: [\n        // Canadian Arctic Archipelago\n        { x: 0.08, y: 0.08, w: 0.28, h: 0.08, color: \"#c8d5b9\", type: \"arctic_tundra\" },\n        \n        // Boreal Forest Belt (Canada)\n        { x: 0.06, y: 0.15, w: 0.30, h: 0.12, color: \"#2d5016\", type: \"boreal_forest\" },\n        \n        // Great Lakes Region\n        { x: 0.18, y: 0.28, w: 0.12, h: 0.08, color: \"#4a7c59\", type: \"temperate_forest\" },\n        \n        // Eastern Deciduous Forest\n        { x: 0.20, y: 0.32, w: 0.10, h: 0.15, color: \"#6b8e23\", type: \"deciduous_forest\" },\n        \n        // Great Plains\n        { x: 0.14, y: 0.35, w: 0.12, h: 0.15, color: \"#daa520\", type: \"grassland\" },\n        \n        // Rocky Mountains\n        { x: 0.10, y: 0.30, w: 0.04, h: 0.20, color: \"#8b7355\", type: \"mountains\" },\n        \n        // Pacific Northwest\n        { x: 0.02, y: 0.30, w: 0.08, h: 0.15, color: \"#355e3b\", type: \"temperate_rainforest\" },\n        \n        // California Central Valley\n        { x: 0.04, y: 0.42, w: 0.06, h: 0.10, color: \"#9acd32\", type: \"mediterranean\" },\n        \n        // Southwest Desert\n        { x: 0.08, y: 0.45, w: 0.12, h: 0.12, color: \"#cd853f\", type: \"desert\" },\n        \n        // Mexican Highland\n        { x: 0.12, y: 0.50, w: 0.10, h: 0.08, color: \"#d2b48c\", type: \"highland\" },\n        \n        // Central America\n        { x: 0.15, y: 0.55, w: 0.08, h: 0.08, color: \"#228b22\", type: \"tropical_forest\" },\n      ]\n    },\n    {\n      name: \"South America\",\n      regions: [\n        // Amazon Basin - The lung of the Earth\n        { x: 0.22, y: 0.58, w: 0.18, h: 0.15, color: \"#013220\", type: \"amazon_rainforest\" },\n        \n        // Brazilian Highlands (Cerrado)\n        { x: 0.30, y: 0.62, w: 0.10, h: 0.12, color: \"#8fbc8f\", type: \"cerrado_savanna\" },\n        \n        // Andes Mountain Chain\n        { x: 0.18, y: 0.58, w: 0.04, h: 0.28, color: \"#696969\", type: \"andes_mountains\" },\n        \n        // Patagonian Steppe\n        { x: 0.20, y: 0.82, w: 0.12, h: 0.12, color: \"#bdb76b\", type: \"patagonian_steppe\" },\n        \n        // Pampas Grassland\n        { x: 0.25, y: 0.78, w: 0.10, h: 0.08, color: \"#9acd32\", type: \"pampas\" },\n        \n        // Atlantic Coastal Forest\n        { x: 0.32, y: 0.68, w: 0.06, h: 0.15, color: \"#2e8b57\", type: \"atlantic_forest\" },\n        \n        // Guiana Highlands\n        { x: 0.28, y: 0.54, w: 0.08, h: 0.06, color: \"#8b4513\", type: \"guiana_highlands\" },\n      ]\n    },\n    {\n      name: \"Europe\",\n      regions: [\n        // Scandinavian Peninsula\n        { x: 0.48, y: 0.15, w: 0.08, h: 0.12, color: \"#2f4f2f\", type: \"taiga\" },\n        \n        // British Isles\n        { x: 0.45, y: 0.22, w: 0.03, h: 0.06, color: \"#6b8e23\", type: \"maritime_temperate\" },\n        \n        // Central European Plain\n        { x: 0.48, y: 0.25, w: 0.15, h: 0.08, color: \"#90ee90\", type: \"temperate_broadleaf\" },\n        \n        // Mediterranean Basin\n        { x: 0.48, y: 0.33, w: 0.18, h: 0.06, color: \"#daa520\", type: \"mediterranean_shrubland\" },\n        \n        // Eastern European Forest\n        { x: 0.58, y: 0.22, w: 0.12, h: 0.12, color: \"#556b2f\", type: \"mixed_forest\" },\n        \n        // Iberian Peninsula\n        { x: 0.46, y: 0.36, w: 0.06, h: 0.06, color: \"#cd853f\", type: \"iberian_plateau\" },\n        \n        // Italian Peninsula\n        { x: 0.52, y: 0.36, w: 0.02, h: 0.08, color: \"#daa520\", type: \"mediterranean\" },\n      ]\n    },\n    {\n      name: \"Africa\", \n      regions: [\n        // Sahara Desert\n        { x: 0.48, y: 0.38, w: 0.22, h: 0.12, color: \"#faa460\", type: \"sahara_desert\" },\n        \n        // Sahel Transition Zone\n        { x: 0.48, y: 0.48, w: 0.20, h: 0.04, color: \"#ddbf94\", type: \"sahel\" },\n        \n        // Central African Rainforest\n        { x: 0.52, y: 0.52, w: 0.15, h: 0.10, color: \"#013220\", type: \"congo_rainforest\" },\n        \n        // East African Rift Valley\n        { x: 0.60, y: 0.48, w: 0.08, h: 0.18, color: \"#cd853f\", type: \"savanna\" },\n        \n        // Kalahari Desert\n        { x: 0.52, y: 0.72, w: 0.08, h: 0.08, color: \"#d2b48c\", type: \"kalahari\" },\n        \n        // Ethiopian Highlands\n        { x: 0.62, y: 0.50, w: 0.06, h: 0.08, color: \"#8fbc8f\", type: \"highlands\" },\n        \n        // Madagascar\n        { x: 0.68, y: 0.72, w: 0.02, h: 0.08, color: \"#228b22\", type: \"tropical_highland\" },\n        \n        // Atlas Mountains\n        { x: 0.48, y: 0.35, w: 0.12, h: 0.03, color: \"#a0522d\", type: \"atlas_mountains\" },\n        \n        // Cape Region\n        { x: 0.52, y: 0.82, w: 0.04, h: 0.03, color: \"#daa520\", type: \"fynbos\" },\n      ]\n    },\n    {\n      name: \"Asia\",\n      regions: [\n        // Siberian Taiga\n        { x: 0.65, y: 0.12, w: 0.32, h: 0.20, color: \"#1a4f2b\", type: \"siberian_taiga\" },\n        \n        // Central Asian Steppes\n        { x: 0.68, y: 0.30, w: 0.18, h: 0.10, color: \"#ddd08b\", type: \"steppe\" },\n        \n        // Gobi Desert\n        { x: 0.78, y: 0.35, w: 0.12, h: 0.06, color: \"#c19a6b\", type: \"gobi_desert\" },\n        \n        // Tibetan Plateau\n        { x: 0.74, y: 0.38, w: 0.10, h: 0.08, color: \"#8b7355\", type: \"tibetan_plateau\" },\n        \n        // Himalayas\n        { x: 0.72, y: 0.42, w: 0.12, h: 0.04, color: \"#696969\", type: \"himalayas\" },\n        \n        // Indian Subcontinent\n        { x: 0.70, y: 0.46, w: 0.12, h: 0.12, color: \"#9acd32\", type: \"indian_plains\" },\n        \n        // Indochina Peninsula\n        { x: 0.78, y: 0.52, w: 0.08, h: 0.10, color: \"#228b22\", type: \"monsoon_forest\" },\n        \n        // East China Plains\n        { x: 0.82, y: 0.38, w: 0.12, h: 0.15, color: \"#adff2f\", type: \"temperate_plains\" },\n        \n        // Southeast Asian Islands\n        { x: 0.82, y: 0.58, w: 0.15, h: 0.12, color: \"#32cd32\", type: \"tropical_rainforest\" },\n        \n        // Japanese Archipelago\n        { x: 0.90, y: 0.40, w: 0.04, h: 0.10, color: \"#2e8b57\", type: \"temperate_forest\" },\n        \n        // Arabian Peninsula\n        { x: 0.58, y: 0.40, w: 0.12, h: 0.10, color: \"#daa520\", type: \"arabian_desert\" },\n        \n        // Anatolia and Levant\n        { x: 0.55, y: 0.36, w: 0.08, h: 0.06, color: \"#d2b48c\", type: \"mediterranean_highland\" },\n        \n        // Iranian Plateau\n        { x: 0.62, y: 0.36, w: 0.10, h: 0.08, color: \"#bc9a6a\", type: \"iranian_plateau\" },\n      ]\n    },\n    {\n      name: \"Australia and Oceania\",\n      regions: [\n        // Australian Outback\n        { x: 0.82, y: 0.70, w: 0.15, h: 0.12, color: \"#cd853f\", type: \"outback_desert\" },\n        \n        // Eastern Australian Forests\n        { x: 0.92, y: 0.72, w: 0.04, h: 0.12, color: \"#228b22\", type: \"eucalyptus_forest\" },\n        \n        // New Zealand\n        { x: 0.96, y: 0.78, w: 0.02, h: 0.06, color: \"#2e8b57\", type: \"temperate_oceanic\" },\n        \n        // Great Dividing Range\n        { x: 0.90, y: 0.70, w: 0.02, h: 0.15, color: \"#8b7355\", type: \"australian_alps\" },\n        \n        // Tropical North Australia\n        { x: 0.84, y: 0.68, w: 0.12, h: 0.04, color: \"#9acd32\", type: \"tropical_savanna\" },\n      ]\n    },\n    {\n      name: \"Antarctica\",\n      regions: [\n        // Antarctic Ice Sheet\n        { x: 0.0, y: 0.92, w: 1.0, h: 0.08, color: \"#f0f8ff\", type: \"ice_sheet\" },\n      ]\n    }\n  ];\n\n  // Render continents with photorealistic detail\n  continents.forEach(continent => {\n    continent.regions.forEach(region => {\n      renderPhotorealisticTerrain(ctx, region, width, height);\n    });\n  });\n\n  // Add atmospheric perspective\n  addAtmosphericHaze(ctx, width, height);\n}\n\nfunction renderPhotorealisticTerrain(ctx: CanvasRenderingContext2D, region: any, width: number, height: number) {\n  const x = region.x * width;\n  const y = region.y * height;\n  const w = region.w * width;\n  const h = region.h * height;\n  \n  ctx.save();\n  \n  // Create highly irregular, coastline-like shapes\n  drawNaturalCoastline(ctx, x, y, w, h, region.type);\n  \n  // Apply terrain-specific rendering\n  switch(region.type) {\n    case \"amazon_rainforest\":\n    case \"congo_rainforest\":\n      renderDenseRainforest(ctx, x, y, w, h, region.color);\n      break;\n    case \"sahara_desert\":\n    case \"gobi_desert\":\n    case \"arabian_desert\":\n    case \"outback_desert\":\n      renderDesertTerrain(ctx, x, y, w, h, region.color);\n      break;\n    case \"himalayas\":\n    case \"andes_mountains\":\n    case \"atlas_mountains\":\n      renderMountainTerrain(ctx, x, y, w, h, region.color);\n      break;\n    case \"ice_sheet\":\n      renderIceSheet(ctx, x, y, w, h, region.color);\n      break;\n    case \"siberian_taiga\":\n    case \"boreal_forest\":\n      renderBorealForest(ctx, x, y, w, h, region.color);\n      break;\n    default:\n      renderStandardTerrain(ctx, x, y, w, h, region.color, region.type);\n  }\n  \n  ctx.restore();\n}\n\nfunction drawNaturalCoastline(ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number, terrainType: string) {\n  ctx.beginPath();\n  \n  // Determine irregularity based on terrain type\n  let irregularity = 0.3;\n  if (terrainType.includes(\"mountain\")) irregularity = 0.5;\n  if (terrainType.includes(\"island\")) irregularity = 0.6;\n  if (terrainType.includes(\"arctic\")) irregularity = 0.4;\n  \n  const numPoints = Math.max(16, Math.floor((w + h) / 8));\n  \n  for (let i = 0; i <= numPoints; i++) {\n    const angle = (i / numPoints) * Math.PI * 2;\n    const baseRadius = Math.min(w, h) / 2;\n    \n    // Multiple levels of coastal variation\n    const largeScale = Math.sin(angle * 3) * 0.3;\n    const mediumScale = Math.sin(angle * 8) * 0.15;\n    const smallScale = (Math.random() - 0.5) * irregularity;\n    \n    const radiusVariation = 1 + largeScale + mediumScale + smallScale;\n    const px = x + w/2 + Math.cos(angle) * (w/2) * radiusVariation;\n    const py = y + h/2 + Math.sin(angle) * (h/2) * radiusVariation;\n    \n    if (i === 0) {\n      ctx.moveTo(px, py);\n    } else {\n      ctx.lineTo(px, py);\n    }\n  }\n  \n  ctx.closePath();\n}\n\nfunction renderDenseRainforest(ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number, baseColor: string) {\n  // Create canopy gradient\n  const canopyGrad = ctx.createRadialGradient(x + w/2, y + h/2, 0, x + w/2, y + h/2, Math.max(w, h)/2);\n  canopyGrad.addColorStop(0, lightenColor(baseColor, 0.2));\n  canopyGrad.addColorStop(0.7, baseColor);\n  canopyGrad.addColorStop(1, darkenColor(baseColor, 0.3));\n  \n  ctx.fillStyle = canopyGrad;\n  ctx.fill();\n  \n  // Add dense tree texture\n  ctx.fillStyle = darkenColor(baseColor, 0.2);\n  for (let i = 0; i < w * h / 100; i++) {\n    const tx = x + Math.random() * w;\n    const ty = y + Math.random() * h;\n    const size = 1 + Math.random() * 2;\n    ctx.fillRect(tx, ty, size, size);\n  }\n  \n  // River patterns\n  ctx.strokeStyle = darkenColor(baseColor, 0.5);\n  ctx.lineWidth = 0.5;\n  for (let r = 0; r < 3; r++) {\n    ctx.beginPath();\n    ctx.moveTo(x + Math.random() * w, y);\n    ctx.quadraticCurveTo(\n      x + Math.random() * w, \n      y + h/2 + (Math.random() - 0.5) * h/3,\n      x + Math.random() * w, \n      y + h\n    );\n    ctx.stroke();\n  }\n}\n\nfunction renderDesertTerrain(ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number, baseColor: string) {\n  // Desert base with heat shimmer effect\n  const desertGrad = ctx.createLinearGradient(x, y, x + w, y + h);\n  desertGrad.addColorStop(0, lightenColor(baseColor, 0.3));\n  desertGrad.addColorStop(0.5, baseColor);\n  desertGrad.addColorStop(1, darkenColor(baseColor, 0.2));\n  \n  ctx.fillStyle = desertGrad;\n  ctx.fill();\n  \n  // Sand dune patterns\n  for (let d = 0; d < 8; d++) {\n    const duneX = x + Math.random() * w;\n    const duneY = y + Math.random() * h;\n    const duneW = 20 + Math.random() * 40;\n    const duneH = 5 + Math.random() * 15;\n    \n    ctx.fillStyle = lightenColor(baseColor, 0.1);\n    ctx.beginPath();\n    ctx.ellipse(duneX, duneY, duneW/2, duneH/2, Math.random() * Math.PI, 0, Math.PI * 2);\n    ctx.fill();\n  }\n  \n  // Sand particle texture\n  ctx.fillStyle = lightenColor(baseColor, 0.15);\n  for (let p = 0; p < w * h / 150; p++) {\n    const px = x + Math.random() * w;\n    const py = y + Math.random() * h;\n    ctx.fillRect(px, py, Math.random() * 3, Math.random() * 2);\n  }\n}\n\nfunction renderMountainTerrain(ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number, baseColor: string) {\n  // Mountain base\n  ctx.fillStyle = baseColor;\n  ctx.fill();\n  \n  // Create mountain peaks\n  const numPeaks = Math.floor(w / 15) + 2;\n  for (let p = 0; p < numPeaks; p++) {\n    const peakX = x + (p / numPeaks) * w + (Math.random() - 0.5) * w/numPeaks;\n    const peakY = y + h * (0.3 + Math.random() * 0.4);\n    const peakW = 8 + Math.random() * 20;\n    const peakH = h * (0.2 + Math.random() * 0.6);\n    \n    // Mountain shadow gradient\n    const peakGrad = ctx.createLinearGradient(peakX, peakY, peakX + peakW, peakY + peakH);\n    peakGrad.addColorStop(0, lightenColor(baseColor, 0.4));\n    peakGrad.addColorStop(0.3, baseColor);\n    peakGrad.addColorStop(1, darkenColor(baseColor, 0.4));\n    \n    ctx.fillStyle = peakGrad;\n    ctx.beginPath();\n    ctx.moveTo(peakX, peakY + peakH);\n    ctx.lineTo(peakX + peakW/2, peakY);\n    ctx.lineTo(peakX + peakW, peakY + peakH);\n    ctx.closePath();\n    ctx.fill();\n  }\n  \n  // Snow caps for high peaks\n  if (h > 20) {\n    ctx.fillStyle = \"#f0f8ff\";\n    for (let s = 0; s < numPeaks / 2; s++) {\n      const snowX = x + Math.random() * w;\n      const snowY = y + h * 0.1;\n      const snowSize = 3 + Math.random() * 8;\n      ctx.fillRect(snowX, snowY, snowSize, snowSize/2);\n    }\n  }\n}\n\nfunction renderIceSheet(ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number, baseColor: string) {\n  // Ice gradient\n  const iceGrad = ctx.createLinearGradient(x, y, x + w, y + h);\n  iceGrad.addColorStop(0, baseColor);\n  iceGrad.addColorStop(0.5, lightenColor(baseColor, 0.1));\n  iceGrad.addColorStop(1, darkenColor(baseColor, 0.1));\n  \n  ctx.fillStyle = iceGrad;\n  ctx.fill();\n  \n  // Ice cracks and crevasses\n  ctx.strokeStyle = darkenColor(baseColor, 0.2);\n  ctx.lineWidth = 1;\n  for (let c = 0; c < 10; c++) {\n    ctx.beginPath();\n    ctx.moveTo(x + Math.random() * w, y + Math.random() * h);\n    ctx.lineTo(x + Math.random() * w, y + Math.random() * h);\n    ctx.stroke();\n  }\n  \n  // Glacial texture\n  ctx.fillStyle = lightenColor(baseColor, 0.05);\n  for (let g = 0; g < w * h / 200; g++) {\n    const gx = x + Math.random() * w;\n    const gy = y + Math.random() * h;\n    ctx.fillRect(gx, gy, 2, 1);\n  }\n}\n\nfunction renderBorealForest(ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number, baseColor: string) {\n  // Forest gradient\n  const forestGrad = ctx.createLinearGradient(x, y, x, y + h);\n  forestGrad.addColorStop(0, lightenColor(baseColor, 0.1));\n  forestGrad.addColorStop(1, darkenColor(baseColor, 0.2));\n  \n  ctx.fillStyle = forestGrad;\n  ctx.fill();\n  \n  // Coniferous tree texture pattern\n  ctx.fillStyle = darkenColor(baseColor, 0.3);\n  for (let t = 0; t < w * h / 80; t++) {\n    const treeX = x + Math.random() * w;\n    const treeY = y + Math.random() * h;\n    \n    // Draw small triangular trees\n    ctx.beginPath();\n    ctx.moveTo(treeX, treeY + 3);\n    ctx.lineTo(treeX + 1.5, treeY);\n    ctx.lineTo(treeX + 3, treeY + 3);\n    ctx.closePath();\n    ctx.fill();\n  }\n  \n  // Forest clearings and lakes\n  ctx.fillStyle = darkenColor(baseColor, 0.4);\n  for (let l = 0; l < 3; l++) {\n    const lakeX = x + Math.random() * w;\n    const lakeY = y + Math.random() * h;\n    const lakeSize = 3 + Math.random() * 8;\n    ctx.beginPath();\n    ctx.arc(lakeX, lakeY, lakeSize, 0, Math.PI * 2);\n    ctx.fill();\n  }\n}\n\nfunction renderStandardTerrain(ctx: CanvasRenderingContext2D, x: number, y: number, w: number, h: number, baseColor: string, terrainType: string) {\n  // Standard terrain with elevation shading\n  const terrainGrad = ctx.createRadialGradient(x + w/2, y + h/3, 0, x + w/2, y + h/2, Math.max(w, h)/2);\n  terrainGrad.addColorStop(0, lightenColor(baseColor, 0.2));\n  terrainGrad.addColorStop(0.6, baseColor);\n  terrainGrad.addColorStop(1, darkenColor(baseColor, 0.2));\n  \n  ctx.fillStyle = terrainGrad;\n  ctx.fill();\n  \n  // Add terrain-specific details\n  if (terrainType.includes(\"temperate\") || terrainType.includes(\"forest\")) {\n    // Forest texture\n    ctx.fillStyle = darkenColor(baseColor, 0.2);\n    for (let f = 0; f < w * h / 120; f++) {\n      const fx = x + Math.random() * w;\n      const fy = y + Math.random() * h;\n      ctx.fillRect(fx, fy, 1 + Math.random(), 1 + Math.random());\n    }\n  } else if (terrainType.includes(\"grassland\") || terrainType.includes(\"plains\") || terrainType.includes(\"savanna\")) {\n    // Grassland texture\n    ctx.strokeStyle = darkenColor(baseColor, 0.1);\n    ctx.lineWidth = 0.5;\n    for (let g = 0; g < w * h / 300; g++) {\n      const gx = x + Math.random() * w;\n      const gy = y + Math.random() * h;\n      ctx.beginPath();\n      ctx.moveTo(gx, gy);\n      ctx.lineTo(gx + Math.random() * 3, gy + Math.random() * 2);\n      ctx.stroke();\n    }\n  }\n}\n\nfunction addAtmosphericHaze(ctx: CanvasRenderingContext2D, width: number, height: number) {\n  // Add subtle atmospheric perspective\n  const atmosphere = ctx.createLinearGradient(0, 0, 0, height);\n  atmosphere.addColorStop(0, \"rgba(135, 206, 235, 0.05)\");    // Sky blue at top\n  atmosphere.addColorStop(0.5, \"rgba(255, 255, 255, 0.02)\");  // Slight haze in middle\n  atmosphere.addColorStop(1, \"rgba(135, 206, 235, 0.05)\");    // Sky blue at bottom\n  \n  ctx.fillStyle = atmosphere;\n  ctx.fillRect(0, 0, width, height);\n}\n\n// Enhanced color utility functions\nfunction darkenColor(color: string, factor: number): string {\n  const hex = color.replace('#', '');\n  const r = Math.max(0, Math.floor(parseInt(hex.substr(0, 2), 16) * (1 - factor)));\n  const g = Math.max(0, Math.floor(parseInt(hex.substr(2, 2), 16) * (1 - factor)));\n  const b = Math.max(0, Math.floor(parseInt(hex.substr(4, 2), 16) * (1 - factor)));\n  return `rgb(${r}, ${g}, ${b})`;\n}\n\nfunction lightenColor(color: string, factor: number): string {\n  const hex = color.replace('#', '');\n  const r = Math.min(255, Math.floor(parseInt(hex.substr(0, 2), 16) * (1 + factor)));\n  const g = Math.min(255, Math.floor(parseInt(hex.substr(2, 2), 16) * (1 + factor)));\n  const b = Math.min(255, Math.floor(parseInt(hex.substr(4, 2), 16) * (1 + factor)));\n  return `rgb(${r}, ${g}, ${b})`;\n}\n\nfunction drawSatelliteRegion(ctx: CanvasRenderingContext2D, region: any, width: number, height: number) {\n  // Base terrain color with enhanced contrast\n  ctx.fillStyle = region.color;\n  drawOrganicShape(ctx, region, width, height, 0.4);\n\n  // Add strong border for maximum definition\n  ctx.strokeStyle = region.color;\n  ctx.lineWidth = 2;\n  ctx.stroke();\n  \n  // Add a darker outline for even more contrast\n  ctx.strokeStyle = '#000000';\n  ctx.lineWidth = 1;\n  ctx.stroke();\n\n  // Add terrain texture variation with higher contrast\n  const imageData = ctx.getImageData(\n    region.x * width - region.w * width * 0.1,\n    region.y * height - region.h * height * 0.1,\n    region.w * width * 1.2,\n    region.h * height * 1.2\n  );\n  \n  const data = imageData.data;\n  \n  for (let i = 0; i < data.length; i += 4) {\n    // Add much more pronounced terrain variation\n    const variation = (Math.random() - 0.5) * 60;\n    data[i] = Math.max(0, Math.min(255, data[i] + variation));\n    data[i + 1] = Math.max(0, Math.min(255, data[i + 1] + variation));\n    data[i + 2] = Math.max(0, Math.min(255, data[i + 2] + variation));\n  }\n  \n  ctx.putImageData(imageData, \n    region.x * width - region.w * width * 0.1,\n    region.y * height - region.h * height * 0.1\n  );\n}\n\nfunction drawOrganicShape(ctx: CanvasRenderingContext2D, shape: any, canvasWidth: number, canvasHeight: number, variation: number = 0.4) {\n  const centerX = shape.x * canvasWidth;\n  const centerY = shape.y * canvasHeight;\n  const radiusX = (shape.w * canvasWidth) / 2;\n  const radiusY = (shape.h * canvasHeight) / 2;\n\n  ctx.beginPath();\n  \n  // Create irregular, realistic coastlines\n  for (let i = 0; i <= 64; i++) {\n    const angle = (i / 64) * Math.PI * 2;\n    const randomVariation = 0.5 + Math.random() * variation;\n    const x = centerX + Math.cos(angle) * radiusX * randomVariation;\n    const y = centerY + Math.sin(angle) * radiusY * randomVariation;\n    \n    if (i === 0) {\n      ctx.moveTo(x, y);\n    } else {\n      ctx.lineTo(x, y);\n    }\n  }\n  \n  ctx.closePath();\n  ctx.fill();\n}\n\nfunction addMountainRanges(ctx: CanvasRenderingContext2D, width: number, height: number) {\n  const mountains = [\n    // Himalayas\n    { x: 0.72, y: 0.42, w: 0.12, h: 0.03, color: \"#8b7355\" },\n    // Andes\n    { x: 0.22, y: 0.55, w: 0.02, h: 0.35, color: \"#a0522d\" },\n    // Rocky Mountains\n    { x: 0.16, y: 0.32, w: 0.03, h: 0.18, color: \"#696969\" },\n    // Alps\n    { x: 0.51, y: 0.31, w: 0.06, h: 0.02, color: \"#708090\" },\n    // Urals\n    { x: 0.58, y: 0.25, w: 0.01, h: 0.15, color: \"#778899\" },\n  ];\n\n  mountains.forEach(range => {\n    ctx.fillStyle = range.color;\n    drawOrganicShape(ctx, range, width, height, 0.2);\n  });\n}\n\nfunction addRiverSystems(ctx: CanvasRenderingContext2D, width: number, height: number) {\n  ctx.strokeStyle = \"#4169e1\";\n  ctx.lineWidth = 1;\n  \n  // Amazon River\n  ctx.beginPath();\n  ctx.moveTo(0.18 * width, 0.62 * height);\n  ctx.quadraticCurveTo(0.25 * width, 0.60 * height, 0.32 * width, 0.62 * height);\n  ctx.stroke();\n  \n  // Nile River\n  ctx.beginPath();\n  ctx.moveTo(0.54 * width, 0.38 * height);\n  ctx.quadraticCurveTo(0.55 * width, 0.50 * height, 0.54 * width, 0.65 * height);\n  ctx.stroke();\n  \n  // Mississippi River\n  ctx.beginPath();\n  ctx.moveTo(0.20 * width, 0.32 * height);\n  ctx.quadraticCurveTo(0.21 * width, 0.40 * height, 0.23 * width, 0.48 * height);\n  ctx.stroke();\n}\n\nfunction addDesertDetails(ctx: CanvasRenderingContext2D, width: number, height: number) {\n  const deserts = [\n    // Sahara with dune patterns\n    { x: 0.50, y: 0.40, w: 0.18, h: 0.08, color: \"#f4e4bc\" },\n    // Arabian Desert\n    { x: 0.58, y: 0.42, w: 0.08, h: 0.06, color: \"#ddbf94\" },\n    // Gobi Desert\n    { x: 0.78, y: 0.35, w: 0.12, h: 0.06, color: \"#c19a6b\" },\n    // Mojave\n    { x: 0.14, y: 0.43, w: 0.06, h: 0.04, color: \"#d2b48c\" },\n  ];\n\n  deserts.forEach(desert => {\n    ctx.fillStyle = desert.color;\n    drawOrganicShape(ctx, desert, width, height, 0.3);\n    \n    // Add dune patterns\n    for (let i = 0; i < 5; i++) {\n      const duneX = (desert.x + (Math.random() - 0.5) * desert.w) * width;\n      const duneY = (desert.y + (Math.random() - 0.5) * desert.h) * height;\n      \n      ctx.fillStyle = `rgba(240, 230, 180, 0.3)`;\n      ctx.beginPath();\n      ctx.ellipse(duneX, duneY, 8, 4, Math.random() * Math.PI, 0, Math.PI * 2);\n      ctx.fill();\n    }\n  });\n}\n\n// Enhanced night lights based on NASA satellite imagery patterns\nfunction addNASAStyleNightLights(ctx: CanvasRenderingContext2D, width: number, height: number) {\n  // Major megalopolis regions with accurate light distribution\n  const lightRegions = [\n    // Northeast US Corridor (Boston-NYC-Washington)\n    { centerX: 0.22, centerY: 0.39, density: 80, spread: 0.08, intensity: 1.0 },\n    // California Coast (SF-LA)\n    { centerX: 0.13, centerY: 0.45, density: 60, spread: 0.06, intensity: 0.9 },\n    // European Megalopolis (London-Paris-Amsterdam-Ruhr)\n    { centerX: 0.51, centerY: 0.30, density: 100, spread: 0.12, intensity: 1.0 },\n    // Tokyo-Osaka Corridor\n    { centerX: 0.89, centerY: 0.43, density: 70, spread: 0.08, intensity: 1.0 },\n    // East China Coast (Shanghai-Beijing corridor)\n    { centerX: 0.84, centerY: 0.40, density: 120, spread: 0.15, intensity: 1.1 },\n    // Delhi-Mumbai Corridor\n    { centerX: 0.77, centerY: 0.47, density: 90, spread: 0.10, intensity: 0.8 },\n    // SÃ£o Paulo-Rio de Janeiro\n    { centerX: 0.28, centerY: 0.72, density: 50, spread: 0.06, intensity: 0.8 },\n    // Cairo-Nile Delta\n    { centerX: 0.54, centerY: 0.45, density: 40, spread: 0.04, intensity: 0.7 },\n    // Mexico City\n    { centerX: 0.18, centerY: 0.52, density: 30, spread: 0.04, intensity: 0.8 },\n    // Nigeria Coast (Lagos)\n    { centerX: 0.51, centerY: 0.58, density: 25, spread: 0.03, intensity: 0.6 },\n  ];\n\n  lightRegions.forEach(region => {\n    for (let i = 0; i < region.density; i++) {\n      // Use normal distribution for realistic city clustering\n      const angle = Math.random() * Math.PI * 2;\n      const distance = Math.abs(normalRandom()) * region.spread * 0.5;\n      const x = (region.centerX + Math.cos(angle) * distance) * width;\n      const y = (region.centerY + Math.sin(angle) * distance) * height;\n      \n      // Variable light sizes for cities, towns, and suburbs\n      const lightType = Math.random();\n      let size, brightness, color;\n      \n      if (lightType < 0.1) {\n        // Major cities - bright white/blue\n        size = 3 + Math.random() * 5;\n        brightness = 0.9 * region.intensity;\n        color = [255, 245, 220]; // Warm white\n      } else if (lightType < 0.3) {\n        // Medium cities - yellow-white\n        size = 2 + Math.random() * 3;\n        brightness = 0.7 * region.intensity;\n        color = [255, 220, 180]; // Warm yellow\n      } else {\n        // Towns and suburbs - orange\n        size = 1 + Math.random() * 2;\n        brightness = 0.4 * region.intensity;\n        color = [255, 180, 120]; // Orange\n      }\n      \n      // Create realistic light bloom effect\n      const maxRadius = size * 12;\n      const gradient = ctx.createRadialGradient(x, y, 0, x, y, maxRadius);\n      gradient.addColorStop(0, `rgba(${color[0]}, ${color[1]}, ${color[2]}, ${brightness})`);\n      gradient.addColorStop(0.2, `rgba(${color[0]}, ${color[1] * 0.9}, ${color[2] * 0.8}, ${brightness * 0.8})`);\n      gradient.addColorStop(0.5, `rgba(${color[0] * 0.9}, ${color[1] * 0.7}, ${color[2] * 0.5}, ${brightness * 0.4})`);\n      gradient.addColorStop(0.8, `rgba(${color[0] * 0.8}, ${color[1] * 0.5}, ${color[2] * 0.3}, ${brightness * 0.1})`);\n      gradient.addColorStop(1, \"transparent\");\n      \n      ctx.fillStyle = gradient;\n      ctx.beginPath();\n      ctx.arc(x, y, maxRadius, 0, Math.PI * 2);\n      ctx.fill();\n      \n      // Bright core\n      ctx.fillStyle = `rgba(${color[0]}, ${color[1]}, ${color[2]}, ${brightness})`;\n      ctx.beginPath();\n      ctx.arc(x, y, size * 0.8, 0, Math.PI * 2);\n      ctx.fill();\n    }\n  });\n}\n\n// Create realistic cloud patterns using multiple noise octaves\nfunction createRealisticClouds(ctx: CanvasRenderingContext2D, width: number, height: number) {\n  const imageData = ctx.createImageData(width, height);\n  const data = imageData.data;\n\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      const i = (y * width + x) * 4;\n      \n      // Multiple octaves of noise for realistic cloud formation\n      const scale1 = 0.005;\n      const scale2 = 0.01;\n      const scale3 = 0.02;\n      const scale4 = 0.04;\n      \n      const noise = \n        Math.sin(x * scale1) * Math.cos(y * scale1) * 0.4 +\n        Math.sin(x * scale2) * Math.cos(y * scale2) * 0.3 +\n        Math.sin(x * scale3) * Math.cos(y * scale3) * 0.2 +\n        Math.sin(x * scale4) * Math.cos(y * scale4) * 0.1;\n      \n      // Create realistic cloud density\n      let cloudDensity = Math.max(0, noise + 0.2);\n      \n      // Add weather patterns - more clouds in certain latitudes\n      const latitude = Math.abs((y / height) - 0.5) * 2; // 0 at equator, 1 at poles\n      if (latitude > 0.3 && latitude < 0.7) {\n        cloudDensity *= 1.3; // More clouds in temperate zones\n      }\n      \n      const alpha = cloudDensity * 255;\n      const brightness = Math.min(255, alpha * 1.2);\n      \n      data[i] = brightness;     // Red\n      data[i + 1] = brightness; // Green\n      data[i + 2] = brightness; // Blue\n      data[i + 3] = alpha;      // Alpha\n    }\n  }\n\n  ctx.putImageData(imageData, 0, 0);\n}\n\n// Enhanced topographical normal map with real elevation data patterns\nfunction createTopographicalNormalMap(ctx: CanvasRenderingContext2D, width: number, height: number) {\n  const imageData = ctx.createImageData(width, height);\n  const data = imageData.data;\n\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      const i = (y * width + x) * 4;\n      \n      // Create elevation-based normal mapping\n      const elevation = \n        Math.sin(x * 0.02) * Math.sin(y * 0.02) * 0.3 +  // Large features\n        Math.sin(x * 0.05) * Math.sin(y * 0.05) * 0.2 +  // Medium features\n        Math.sin(x * 0.1) * Math.sin(y * 0.1) * 0.1;     // Fine detail\n      \n      const normalizedElevation = (elevation + 0.6) * 0.8;\n      const normalValue = normalizedElevation * 255;\n      \n      data[i] = normalValue * 0.6 + 127;     // Red (X normal)\n      data[i + 1] = normalValue * 0.6 + 127; // Green (Y normal)\n      data[i + 2] = 255;                     // Blue (Z normal)\n      data[i + 3] = 255;                     // Alpha\n    }\n  }\n\n  ctx.putImageData(imageData, 0, 0);\n}\n\n// Helper function for normal distribution (Box-Muller transform)\nfunction normalRandom(): number {\n  const u1 = Math.random();\n  const u2 = Math.random();\n  return Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);\n}\n"],"names":["Earth","earthRef","nightLightsRef","cloudsRef","atmosphereRef","dayTexture","canvas","document","createElement","ctx","getContext","width","height","createSatelliteEarthTexture","texture","wrapS","wrapT","generateMipmaps","minFilter","magFilter","nightTexture","fillStyle","fillRect","addNASAStyleNightLights","cloudTexture","createRealisticClouds","normalTexture","createTopographicalNormalMap","state","delta","current","rotation","y","material","uniforms","time","value","clock","getElapsedTime","ref","args","map","normalMap","normalScale","shininess","specular","transparent","flatShading","opacity","blending","alphaTest","color","vertexShader","fragmentShader","side","oceanGradient","createLinearGradient","addColorStop","continents","name","regions","x","w","h","type","forEach","continent","region","renderPhotorealisticTerrain","addAtmosphericHaze","save","drawNaturalCoastline","renderDenseRainforest","renderDesertTerrain","renderMountainTerrain","renderIceSheet","renderBorealForest","renderStandardTerrain","restore","terrainType","beginPath","irregularity","includes","numPoints","Math","max","floor","i","angle","PI","baseRadius","min","largeScale","sin","mediumScale","smallScale","random","radiusVariation","px","cos","py","moveTo","lineTo","closePath","baseColor","canopyGrad","createRadialGradient","lightenColor","darkenColor","fill","tx","ty","size","strokeStyle","lineWidth","r","quadraticCurveTo","stroke","desertGrad","d","duneX","duneY","duneW","duneH","ellipse","p","numPeaks","peakX","peakY","peakW","peakH","peakGrad","s","snowX","snowY","snowSize","iceGrad","c","g","gx","gy","forestGrad","t","treeX","treeY","l","lakeX","lakeY","lakeSize","arc","terrainGrad","f","fx","fy","atmosphere","factor","hex","replace","parseInt","substr","b","drawSatelliteRegion","drawOrganicShape","imageData","getImageData","data","length","variation","putImageData","shape","canvasWidth","canvasHeight","centerX","centerY","radiusX","radiusY","randomVariation","addMountainRanges","mountains","range","addRiverSystems","addDesertDetails","deserts","desert","lightRegions","density","spread","intensity","distance","abs","normalRandom","lightType","brightness","maxRadius","gradient","createImageData","scale1","scale2","scale3","scale4","noise","cloudDensity","latitude","alpha","elevation","normalizedElevation","normalValue","u1","u2","sqrt","log"],"mappings":"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"}},
    {"offset": {"line": 1412, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/events/GlobeEventBus.ts"],"sourcesContent":["/**\n * Event types for the Globe Observer system\n */\nexport enum GlobeEventType {\n  STATION_SELECTED = 'station_selected',\n  STATION_HOVERED = 'station_hovered',\n  STATIONS_LOADED = 'stations_loaded',\n  ZOOM_CHANGED = 'zoom_changed',\n  LOCATION_CHANGED = 'location_changed',\n  AUDIO_STATE_CHANGED = 'audio_state_changed',\n  ERROR_OCCURRED = 'error_occurred'\n}\n\n/**\n * Base event interface\n */\nexport interface GlobeEvent {\n  type: GlobeEventType;\n  timestamp: number;\n  data?: any;\n}\n\n/**\n * Specific event interfaces\n */\nexport interface StationSelectedEvent extends GlobeEvent {\n  type: GlobeEventType.STATION_SELECTED;\n  data: {\n    stationId: string;\n    station: any;\n  };\n}\n\nexport interface StationsLoadedEvent extends GlobeEvent {\n  type: GlobeEventType.STATIONS_LOADED;\n  data: {\n    count: number;\n    region?: string;\n    zoomLevel: number;\n  };\n}\n\nexport interface ZoomChangedEvent extends GlobeEvent {\n  type: GlobeEventType.ZOOM_CHANGED;\n  data: {\n    oldZoom: number;\n    newZoom: number;\n    cameraDistance: number;\n  };\n}\n\nexport interface ErrorOccurredEvent extends GlobeEvent {\n  type: GlobeEventType.ERROR_OCCURRED;\n  data: {\n    message: string;\n    source: string;\n    error?: Error;\n  };\n}\n\n/**\n * Observer interface for subscribing to globe events\n */\nexport interface IGlobeObserver {\n  onEvent(event: GlobeEvent): void;\n  getObserverId(): string;\n}\n\n/**\n * Observable interface for publishing globe events\n */\nexport interface IGlobeObservable {\n  subscribe(observer: IGlobeObserver, eventTypes?: GlobeEventType[]): void;\n  unsubscribe(observerId: string): void;\n  notify(event: GlobeEvent): void;\n}\n\n/**\n * Implementation of Observable pattern for Globe events\n * Provides decoupled communication between components\n */\nexport class GlobeEventBus implements IGlobeObservable {\n  private observers = new Map<string, {\n    observer: IGlobeObserver;\n    eventTypes: Set<GlobeEventType>;\n  }>();\n  \n  private eventHistory: GlobeEvent[] = [];\n  private readonly maxHistorySize = 100;\n\n  /**\n   * Subscribe an observer to specific event types\n   */\n  subscribe(observer: IGlobeObserver, eventTypes?: GlobeEventType[]): void {\n    const observerId = observer.getObserverId();\n    const subscribedTypes = new Set(eventTypes || Object.values(GlobeEventType));\n    \n    this.observers.set(observerId, {\n      observer,\n      eventTypes: subscribedTypes\n    });\n\n    console.log(`Observer ${observerId} subscribed to events:`, Array.from(subscribedTypes));\n  }\n\n  /**\n   * Unsubscribe an observer\n   */\n  unsubscribe(observerId: string): void {\n    if (this.observers.delete(observerId)) {\n      console.log(`Observer ${observerId} unsubscribed`);\n    }\n  }\n\n  /**\n   * Notify all subscribed observers of an event\n   */\n  notify(event: GlobeEvent): void {\n    // Add to event history\n    this.addToHistory(event);\n\n    // Notify relevant observers\n    Array.from(this.observers.entries()).forEach(([observerId, { observer, eventTypes }]) => {\n      if (eventTypes.has(event.type)) {\n        try {\n          observer.onEvent(event);\n        } catch (error) {\n          console.error(`Error in observer ${observerId}:`, error);\n          \n          // Emit error event\n          this.notify({\n            type: GlobeEventType.ERROR_OCCURRED,\n            timestamp: Date.now(),\n            data: {\n              message: `Observer ${observerId} error`,\n              source: 'GlobeEventBus',\n              error: error instanceof Error ? error : new Error(String(error))\n            }\n          });\n        }\n      }\n    });\n  }\n\n  /**\n   * Get list of active observers\n   */\n  getObservers(): string[] {\n    return Array.from(this.observers.keys());\n  }\n\n  /**\n   * Get event history\n   */\n  getEventHistory(eventType?: GlobeEventType): GlobeEvent[] {\n    if (eventType) {\n      return this.eventHistory.filter(event => event.type === eventType);\n    }\n    return [...this.eventHistory];\n  }\n\n  /**\n   * Clear event history\n   */\n  clearHistory(): void {\n    this.eventHistory = [];\n  }\n\n  /**\n   * Get statistics about event bus usage\n   */\n  getStats(): {\n    observerCount: number;\n    eventHistorySize: number;\n    eventTypeCounts: Record<string, number>;\n  } {\n    const eventTypeCounts: Record<string, number> = {};\n    \n    this.eventHistory.forEach(event => {\n      eventTypeCounts[event.type] = (eventTypeCounts[event.type] || 0) + 1;\n    });\n\n    return {\n      observerCount: this.observers.size,\n      eventHistorySize: this.eventHistory.length,\n      eventTypeCounts\n    };\n  }\n\n  private addToHistory(event: GlobeEvent): void {\n    this.eventHistory.push(event);\n    \n    // Maintain max history size\n    if (this.eventHistory.length > this.maxHistorySize) {\n      this.eventHistory.shift();\n    }\n  }\n}\n\n/**\n * Singleton event bus instance\n */\nexport const globeEventBus = new GlobeEventBus();\n\n/**\n * Base class for components that need to observe globe events\n */\nexport abstract class GlobeObserver implements IGlobeObserver {\n  protected eventBus: GlobeEventBus;\n  private observerId: string;\n\n  constructor(observerId: string, eventBus: GlobeEventBus = globeEventBus) {\n    this.observerId = observerId;\n    this.eventBus = eventBus;\n  }\n\n  getObserverId(): string {\n    return this.observerId;\n  }\n\n  abstract onEvent(event: GlobeEvent): void;\n\n  protected subscribe(eventTypes?: GlobeEventType[]): void {\n    this.eventBus.subscribe(this, eventTypes);\n  }\n\n  protected unsubscribe(): void {\n    this.eventBus.unsubscribe(this.observerId);\n  }\n\n  protected emit(event: Omit<GlobeEvent, 'timestamp'>): void {\n    this.eventBus.notify({\n      ...event,\n      timestamp: Date.now()\n    });\n  }\n}\n\n/**\n * Utility functions for creating common events\n */\nexport const createGlobeEvent = {\n  stationSelected: (stationId: string, station: any): StationSelectedEvent => ({\n    type: GlobeEventType.STATION_SELECTED,\n    timestamp: Date.now(),\n    data: { stationId, station }\n  }),\n\n  stationsLoaded: (count: number, region?: string, zoomLevel = 1): StationsLoadedEvent => ({\n    type: GlobeEventType.STATIONS_LOADED,\n    timestamp: Date.now(),\n    data: { count, region, zoomLevel }\n  }),\n\n  zoomChanged: (oldZoom: number, newZoom: number, cameraDistance: number): ZoomChangedEvent => ({\n    type: GlobeEventType.ZOOM_CHANGED,\n    timestamp: Date.now(),\n    data: { oldZoom, newZoom, cameraDistance }\n  }),\n\n  error: (message: string, source: string, error?: Error): ErrorOccurredEvent => ({\n    type: GlobeEventType.ERROR_OCCURRED,\n    timestamp: Date.now(),\n    data: { message, source, error }\n  })\n};"],"names":["GlobeEventType","GlobeEventBus","observers","Map","eventHistory","maxHistorySize","subscribe","observer","eventTypes","observerId","getObserverId","subscribedTypes","Set","Object","values","set","console","log","Array","from","unsubscribe","delete","notify","event","addToHistory","entries","forEach","has","type","onEvent","error","timestamp","Date","now","data","message","source","Error","String","getObservers","keys","getEventHistory","eventType","filter","clearHistory","getStats","eventTypeCounts","observerCount","size","eventHistorySize","length","push","shift","globeEventBus","GlobeObserver","eventBus","emit","createGlobeEvent","stationSelected","stationId","station","stationsLoaded","count","region","zoomLevel","zoomChanged","oldZoom","newZoom","cameraDistance"],"mappings":"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"}},
    {"offset": {"line": 1593, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/commands/GlobeCommands.ts"],"sourcesContent":["/**\n * Command pattern implementation for Globe actions\n * Provides undo/redo functionality and action queuing\n */\n\nexport interface ICommand {\n  execute(): Promise<void> | void;\n  undo(): Promise<void> | void;\n  canUndo(): boolean;\n  getDescription(): string;\n}\n\n/**\n * Abstract base command with common functionality\n */\nexport abstract class BaseCommand implements ICommand {\n  protected timestamp: number;\n  protected executed = false;\n\n  constructor() {\n    this.timestamp = Date.now();\n  }\n\n  abstract execute(): Promise<void> | void;\n  abstract undo(): Promise<void> | void;\n  abstract getDescription(): string;\n\n  canUndo(): boolean {\n    return this.executed;\n  }\n\n  protected markExecuted(): void {\n    this.executed = true;\n  }\n\n  protected markUndo(): void {\n    this.executed = false;\n  }\n\n  getTimestamp(): number {\n    return this.timestamp;\n  }\n}\n\n/**\n * Station selection command\n */\nexport class SelectStationCommand extends BaseCommand {\n  constructor(\n    private stationId: string,\n    private station: any,\n    private onExecute: (stationId: string, station: any) => void,\n    private onUndo: () => void,\n    private previousSelection?: { stationId: string; station: any }\n  ) {\n    super();\n  }\n\n  execute(): void {\n    this.onExecute(this.stationId, this.station);\n    this.markExecuted();\n  }\n\n  undo(): void {\n    if (this.previousSelection) {\n      this.onExecute(this.previousSelection.stationId, this.previousSelection.station);\n    } else {\n      this.onUndo();\n    }\n    this.markUndo();\n  }\n\n  getDescription(): string {\n    return `Select station: ${this.station?.name || this.stationId}`;\n  }\n}\n\n/**\n * Camera position command\n */\nexport class SetCameraPositionCommand extends BaseCommand {\n  constructor(\n    private newPosition: [number, number, number],\n    private setCameraPosition: (position: [number, number, number]) => void,\n    private previousPosition: [number, number, number]\n  ) {\n    super();\n  }\n\n  execute(): void {\n    this.setCameraPosition(this.newPosition);\n    this.markExecuted();\n  }\n\n  undo(): void {\n    this.setCameraPosition(this.previousPosition);\n    this.markUndo();\n  }\n\n  getDescription(): string {\n    return `Move camera to ${this.newPosition.join(', ')}`;\n  }\n}\n\n/**\n * Load stations command\n */\nexport class LoadStationsCommand extends BaseCommand {\n  constructor(\n    private region: string,\n    private onLoad: (region: string) => Promise<void>,\n    private onUnload: () => void\n  ) {\n    super();\n  }\n\n  async execute(): Promise<void> {\n    await this.onLoad(this.region);\n    this.markExecuted();\n  }\n\n  undo(): void {\n    this.onUnload();\n    this.markUndo();\n  }\n\n  getDescription(): string {\n    return `Load stations for region: ${this.region}`;\n  }\n}\n\n/**\n * Filter stations command\n */\nexport class FilterStationsCommand extends BaseCommand {\n  constructor(\n    private filterCriteria: any,\n    private onFilter: (criteria: any) => void,\n    private onClearFilter: () => void\n  ) {\n    super();\n  }\n\n  execute(): void {\n    this.onFilter(this.filterCriteria);\n    this.markExecuted();\n  }\n\n  undo(): void {\n    this.onClearFilter();\n    this.markUndo();\n  }\n\n  getDescription(): string {\n    return `Apply filter: ${JSON.stringify(this.filterCriteria)}`;\n  }\n}\n\n/**\n * Batch command for executing multiple commands together\n */\nexport class BatchCommand extends BaseCommand {\n  constructor(\n    private commands: ICommand[],\n    private description: string\n  ) {\n    super();\n  }\n\n  async execute(): Promise<void> {\n    for (const command of this.commands) {\n      await command.execute();\n    }\n    this.markExecuted();\n  }\n\n  async undo(): Promise<void> {\n    // Undo in reverse order\n    for (let i = this.commands.length - 1; i >= 0; i--) {\n      const command = this.commands[i];\n      if (command.canUndo()) {\n        await command.undo();\n      }\n    }\n    this.markUndo();\n  }\n\n  canUndo(): boolean {\n    return this.executed && this.commands.some(cmd => cmd.canUndo());\n  }\n\n  getDescription(): string {\n    return this.description;\n  }\n}\n\n/**\n * Command invoker with undo/redo history\n */\nexport class CommandInvoker {\n  private history: ICommand[] = [];\n  private currentPosition = -1;\n  private readonly maxHistorySize: number;\n\n  constructor(maxHistorySize = 50) {\n    this.maxHistorySize = maxHistorySize;\n  }\n\n  /**\n   * Execute a command and add it to history\n   */\n  async execute(command: ICommand): Promise<void> {\n    try {\n      await command.execute();\n      \n      // Remove any commands after current position (when doing new action after undo)\n      this.history = this.history.slice(0, this.currentPosition + 1);\n      \n      // Add new command\n      this.history.push(command);\n      this.currentPosition++;\n      \n      // Maintain max history size\n      if (this.history.length > this.maxHistorySize) {\n        this.history.shift();\n        this.currentPosition--;\n      }\n      \n      console.log(`Executed command: ${command.getDescription()}`);\n    } catch (error) {\n      console.error(`Failed to execute command: ${command.getDescription()}`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Undo the last command\n   */\n  async undo(): Promise<boolean> {\n    if (!this.canUndo()) {\n      return false;\n    }\n\n    const command = this.history[this.currentPosition];\n    try {\n      await command.undo();\n      this.currentPosition--;\n      console.log(`Undid command: ${command.getDescription()}`);\n      return true;\n    } catch (error) {\n      console.error(`Failed to undo command: ${command.getDescription()}`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Redo the next command\n   */\n  async redo(): Promise<boolean> {\n    if (!this.canRedo()) {\n      return false;\n    }\n\n    this.currentPosition++;\n    const command = this.history[this.currentPosition];\n    try {\n      await command.execute();\n      console.log(`Redid command: ${command.getDescription()}`);\n      return true;\n    } catch (error) {\n      console.error(`Failed to redo command: ${command.getDescription()}`, error);\n      this.currentPosition--;\n      return false;\n    }\n  }\n\n  /**\n   * Check if undo is possible\n   */\n  canUndo(): boolean {\n    return this.currentPosition >= 0 && \n           this.history[this.currentPosition]?.canUndo();\n  }\n\n  /**\n   * Check if redo is possible\n   */\n  canRedo(): boolean {\n    return this.currentPosition < this.history.length - 1;\n  }\n\n  /**\n   * Get command history\n   */\n  getHistory(): Array<{ description: string; canUndo: boolean; timestamp: number }> {\n    return this.history.map((cmd, index) => ({\n      description: cmd.getDescription(),\n      canUndo: cmd.canUndo(),\n      timestamp: (cmd as BaseCommand).getTimestamp?.() || 0,\n      isCurrent: index === this.currentPosition\n    }));\n  }\n\n  /**\n   * Clear command history\n   */\n  clearHistory(): void {\n    this.history = [];\n    this.currentPosition = -1;\n  }\n\n  /**\n   * Get current command\n   */\n  getCurrentCommand(): ICommand | undefined {\n    return this.history[this.currentPosition];\n  }\n\n  /**\n   * Get statistics\n   */\n  getStats(): { \n    totalCommands: number; \n    currentPosition: number; \n    canUndo: boolean; \n    canRedo: boolean; \n  } {\n    return {\n      totalCommands: this.history.length,\n      currentPosition: this.currentPosition,\n      canUndo: this.canUndo(),\n      canRedo: this.canRedo()\n    };\n  }\n}\n\n/**\n * Singleton command invoker\n */\nexport const globeCommandInvoker = new CommandInvoker();\n\n/**\n * Command factory for creating common commands\n */\nexport const createCommand = {\n  selectStation: (\n    stationId: string, \n    station: any, \n    onExecute: (stationId: string, station: any) => void,\n    onUndo: () => void,\n    previousSelection?: { stationId: string; station: any }\n  ) => new SelectStationCommand(stationId, station, onExecute, onUndo, previousSelection),\n\n  setCameraPosition: (\n    newPosition: [number, number, number],\n    setCameraPosition: (position: [number, number, number]) => void,\n    previousPosition: [number, number, number]\n  ) => new SetCameraPositionCommand(newPosition, setCameraPosition, previousPosition),\n\n  loadStations: (\n    region: string,\n    onLoad: (region: string) => Promise<void>,\n    onUnload: () => void\n  ) => new LoadStationsCommand(region, onLoad, onUnload),\n\n  filterStations: (\n    filterCriteria: any,\n    onFilter: (criteria: any) => void,\n    onClearFilter: () => void\n  ) => new FilterStationsCommand(filterCriteria, onFilter, onClearFilter),\n\n  batch: (commands: ICommand[], description: string) => \n    new BatchCommand(commands, description)\n};"],"names":["BaseCommand","timestamp","executed","Date","now","canUndo","markExecuted","markUndo","getTimestamp","SelectStationCommand","stationId","station","onExecute","onUndo","previousSelection","execute","undo","getDescription","name","SetCameraPositionCommand","newPosition","setCameraPosition","previousPosition","join","LoadStationsCommand","region","onLoad","onUnload","FilterStationsCommand","filterCriteria","onFilter","onClearFilter","JSON","stringify","BatchCommand","commands","description","command","i","length","some","cmd","CommandInvoker","history","currentPosition","maxHistorySize","slice","push","shift","console","log","error","redo","canRedo","getHistory","map","index","isCurrent","clearHistory","getCurrentCommand","getStats","totalCommands","globeCommandInvoker","createCommand","selectStation","loadStations","filterStations","batch"],"mappings":"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"}},
    {"offset": {"line": 1866, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/utils/coordinates.ts"],"sourcesContent":["/**\n * Coordinate conversion utilities for geographic calculations\n * Compatible with both Cesium and general 3D applications\n */\n\n/**\n * Convert latitude/longitude to 3D Cartesian coordinates\n */\nexport function latLngToPosition(\n  lat: number,\n  lng: number,\n  radius: number = 1,\n): [number, number, number] {\n  const phi = (90 - lat) * (Math.PI / 180);\n  const theta = (lng + 180) * (Math.PI / 180);\n\n  const x = -(radius * Math.sin(phi) * Math.cos(theta));\n  const z = radius * Math.sin(phi) * Math.sin(theta);\n  const y = radius * Math.cos(phi);\n\n  return [x, y, z];\n}\n\n/**\n * Convert 3D Cartesian coordinates to latitude/longitude\n */\nexport function positionToLatLng(\n  x: number,\n  y: number,\n  z: number,\n): { lat: number; lng: number } {\n  const radius = Math.sqrt(x * x + y * y + z * z);\n  const lat = 90 - (Math.acos(y / radius) * 180) / Math.PI;\n  const lng = (Math.atan2(z, -x) * 180) / Math.PI - 180;\n\n  return { lat, lng };\n}\n\n/**\n * Calculate distance between two geographic points using Haversine formula\n */\nexport function calculateDistance(\n  lat1: number,\n  lon1: number,\n  lat2: number,\n  lon2: number,\n): number {\n  const R = 6371; // Earth's radius in kilometers\n  const dLat = ((lat2 - lat1) * Math.PI) / 180;\n  const dLon = ((lon2 - lon1) * Math.PI) / 180;\n  const a =\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos((lat1 * Math.PI) / 180) *\n      Math.cos((lat2 * Math.PI) / 180) *\n      Math.sin(dLon / 2) *\n      Math.sin(dLon / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c;\n}\n\n/**\n * Normalize longitude to [-180, 180] range\n */\nexport function normalizeLongitude(lng: number): number {\n  while (lng > 180) lng -= 360;\n  while (lng < -180) lng += 360;\n  return lng;\n}\n\n/**\n * Normalize latitude to [-90, 90] range\n */\nexport function normalizeLatitude(lat: number): number {\n  return Math.max(-90, Math.min(90, lat));\n}\n"],"names":["latLngToPosition","lat","lng","radius","phi","Math","PI","theta","x","sin","cos","z","y","positionToLatLng","sqrt","acos","atan2","calculateDistance","lat1","lon1","lat2","lon2","R","dLat","dLon","a","c","normalizeLongitude","normalizeLatitude","max","min"],"mappings":"AAAA;;;CAGC,GAED;;CAEC;;;;;;;;;;;;AACM,SAASA,iBACdC,GAAW,EACXC,GAAW,EACXC,SAAiB,CAAC;IAElB,MAAMC,MAAM,CAAC,KAAKH,GAAG,IAAI,CAACI,KAAKC,EAAE,GAAG,GAAG;IACvC,MAAMC,QAAQ,CAACL,MAAM,GAAG,IAAI,CAACG,KAAKC,EAAE,GAAG,GAAG;IAE1C,MAAME,IAAI,CAAC,CAACL,SAASE,KAAKI,GAAG,CAACL,OAAOC,KAAKK,GAAG,CAACH,MAAM;IACpD,MAAMI,IAAIR,SAASE,KAAKI,GAAG,CAACL,OAAOC,KAAKI,GAAG,CAACF;IAC5C,MAAMK,IAAIT,SAASE,KAAKK,GAAG,CAACN;IAE5B,OAAO;QAACI;QAAGI;QAAGD;KAAE;AAClB;AAKO,SAASE,iBACdL,CAAS,EACTI,CAAS,EACTD,CAAS;IAET,MAAMR,SAASE,KAAKS,IAAI,CAACN,IAAIA,IAAII,IAAIA,IAAID,IAAIA;IAC7C,MAAMV,MAAM,KAAK,AAACI,KAAKU,IAAI,CAACH,IAAIT,UAAU,MAAOE,KAAKC,EAAE;IACxD,MAAMJ,MAAM,AAACG,KAAKW,KAAK,CAACL,GAAG,CAACH,KAAK,MAAOH,KAAKC,EAAE,GAAG;IAElD,OAAO;QAAEL;QAAKC;IAAI;AACpB;AAKO,SAASe,kBACdC,IAAY,EACZC,IAAY,EACZC,IAAY,EACZC,IAAY;IAEZ,MAAMC,IAAI,MAAM,+BAA+B;IAC/C,MAAMC,OAAO,AAAC,CAACH,OAAOF,IAAI,IAAIb,KAAKC,EAAE,GAAI;IACzC,MAAMkB,OAAO,AAAC,CAACH,OAAOF,IAAI,IAAId,KAAKC,EAAE,GAAI;IACzC,MAAMmB,IACJpB,KAAKI,GAAG,CAACc,OAAO,KAAKlB,KAAKI,GAAG,CAACc,OAAO,KACrClB,KAAKK,GAAG,CAAC,AAACQ,OAAOb,KAAKC,EAAE,GAAI,OAC1BD,KAAKK,GAAG,CAAC,AAACU,OAAOf,KAAKC,EAAE,GAAI,OAC5BD,KAAKI,GAAG,CAACe,OAAO,KAChBnB,KAAKI,GAAG,CAACe,OAAO;IACpB,MAAME,IAAI,IAAIrB,KAAKW,KAAK,CAACX,KAAKS,IAAI,CAACW,IAAIpB,KAAKS,IAAI,CAAC,IAAIW;IACrD,OAAOH,IAAII;AACb;AAKO,SAASC,mBAAmBzB,GAAW;IAC5C,MAAOA,MAAM,IAAKA,OAAO;IACzB,MAAOA,MAAM,CAAC,IAAKA,OAAO;IAC1B,OAAOA;AACT;AAKO,SAAS0B,kBAAkB3B,GAAW;IAC3C,OAAOI,KAAKwB,GAAG,CAAC,CAAC,IAAIxB,KAAKyB,GAAG,CAAC,IAAI7B;AACpC"}},
    {"offset": {"line": 1927, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/usecases/StationUseCases.ts"],"sourcesContent":["import { IStationLoadingUseCase, IStationSelectionUseCase } from \"../domain/usecases\";\nimport { MarkerData } from \"../strategies/MarkerStrategy\";\nimport { StationRepository } from \"../repositories/StationRepository\";\nimport { GlobeEventBus, createGlobeEvent, GlobeEventType } from \"../events/GlobeEventBus\";\nimport { CommandInvoker, createCommand } from \"../commands/GlobeCommands\";\nimport { latLngToPosition } from \"../utils/coordinates\";\n\n\n/**\n * Station Loading Use Case\n * Handles progressive loading and clustering of radio stations\n */\nexport class StationLoadingUseCase implements IStationLoadingUseCase {\n  constructor(\n    private stationRepository: StationRepository,\n    private eventBus: GlobeEventBus\n  ) {}\n\n  async loadStationsForView(zoomLevel: number): Promise<MarkerData[]> {\n    try {\n      this.eventBus.notify(createGlobeEvent.zoomChanged(0, zoomLevel, zoomLevel * 2));\n\n      // Load comprehensive global station data with country distribution\n      const stations = await this.stationRepository.getGlobalStationsWithDistribution();\n      console.log(`Loaded ${stations.length} stations from global distribution`);\n\n      // If no stations or stations without coordinates, add enhanced test data\n      if (stations.length === 0 || stations.every(s => !s.location?.lat && !s.location?.lng)) {\n        console.log('Adding enhanced fallback test stations with real coordinates');\n        const enhancedTestStations = this.getEnhancedTestStations();\n        return this.clusterStationsByCountryAndCity(enhancedTestStations, zoomLevel);\n      }\n\n      // Group stations by country and city for intelligent clustering\n      const clusteredMarkers = this.clusterStationsByCountryAndCity(stations, zoomLevel);\n      \n      const totalStations = clusteredMarkers.reduce((sum, marker) => sum + marker.stations.length, 0);\n      console.log(`Created ${clusteredMarkers.length} marker clusters with ${totalStations} total stations`);\n      \n      this.eventBus.notify(createGlobeEvent.stationsLoaded(\n        totalStations,\n        'global',\n        zoomLevel\n      ));\n\n      return clusteredMarkers;\n    } catch (error) {\n      console.error('Error in loadStationsForView:', error);\n      \n      // Enhanced fallback with comprehensive test data\n      const testStations = this.getEnhancedTestStations();\n      const clusteredMarkers = this.clusterStationsByCountryAndCity(testStations, zoomLevel);\n      \n      const totalStations = clusteredMarkers.reduce((sum, marker) => sum + marker.stations.length, 0);\n      \n      this.eventBus.notify(createGlobeEvent.stationsLoaded(\n        totalStations,\n        'global',\n        zoomLevel\n      ));\n      \n      this.eventBus.notify(createGlobeEvent.error(\n        'Failed to load stations, using fallback',\n        'StationLoadingUseCase',\n        error instanceof Error ? error : new Error(String(error))\n      ));\n      return clusteredMarkers;\n    }\n  }\n\n  /**\n   * Enhanced clustering by country first, then by city for better organization\n   */\n  private clusterStationsByCountryAndCity(stations: any[], zoomLevel: number): MarkerData[] {\n    const markers: MarkerData[] = [];\n    \n    // Group by country first, then by city/region within country\n    const stationsByCountry = new Map<string, any[]>();\n    stations.forEach(station => {\n      const country = station.location?.country || station.country || 'Unknown';\n      if (!stationsByCountry.has(country)) {\n        stationsByCountry.set(country, []);\n      }\n      stationsByCountry.get(country)!.push(station);\n    });\n\n    // Process each country based on zoom level with more conservative clustering\n    stationsByCountry.forEach((countryStations, country) => {\n      if (zoomLevel <= 2) {\n        // Country-level clustering for far zoom - always cluster\n        const countryCenter = this.getCountryCenter(country);\n        if (countryCenter && countryStations.length > 0) {\n          markers.push({\n            id: `country-${country}`,\n            type: 'cluster',\n            position: countryCenter,\n            stations: countryStations,\n            metadata: {\n              name: `${country} (${countryStations.length} stations)`,\n              country: country,\n              stationCount: countryStations.length,\n              density: this.getDensityLevel(countryStations.length),\n              type: 'country' as const\n            }\n          });\n        }\n      } else if (zoomLevel <= 4) {\n        // City-level clustering for medium zoom - be more conservative\n        if (countryStations.length <= 3) {\n          // If very few stations, still cluster at country level\n          const countryCenter = this.getCountryCenter(country);\n          if (countryCenter) {\n            markers.push({\n              id: `country-${country}`,\n              type: 'cluster',\n              position: countryCenter,\n              stations: countryStations,\n              metadata: {\n                name: `${country} (${countryStations.length} stations)`,\n                country: country,\n                stationCount: countryStations.length,\n                density: this.getDensityLevel(countryStations.length),\n                type: 'country' as const\n              }\n            });\n          }\n        } else {\n          // City-level clustering for countries with many stations\n          // Group by major cities and towns within the country\n          const cityClusters = this.clusterStationsByCity(countryStations, country, zoomLevel);\n          markers.push(...cityClusters);\n        }\n      } else {\n        // Individual stations for close zoom - but limit to prevent overcrowding\n        const maxIndividualStations = 15; // Limit individual stations per country\n        const stationsToShow = countryStations.slice(0, maxIndividualStations);\n        \n        if (countryStations.length > maxIndividualStations) {\n          // If too many stations, show a few individuals plus a cluster for the rest\n          stationsToShow.forEach(station => {\n            if (station.location?.lat && station.location?.lng) {\n              markers.push({\n                id: `station-${station.id}`,\n                type: 'single',\n                position: [station.location.lng, station.location.lat, 0],\n                stations: [station],\n                metadata: {\n                  name: station.name,\n                  country: station.location.country,\n                  city: station.location.city,\n                  stationCount: 1,\n                  density: 'low' as const,\n                  type: 'cluster' as const\n                }\n              });\n            }\n          });\n          \n          // Add a cluster for remaining stations\n          const remaining = countryStations.slice(maxIndividualStations);\n          const countryCenter = this.getCountryCenter(country);\n          if (countryCenter && remaining.length > 0) {\n            markers.push({\n              id: `country-overflow-${country}`,\n              type: 'cluster',\n              position: countryCenter,\n              stations: remaining,\n              metadata: {\n                name: `${country} (+${remaining.length} more)`,\n                country: country,\n                stationCount: remaining.length,\n                density: this.getDensityLevel(remaining.length),\n                type: 'country' as const\n              }\n            });\n          }\n        } else {\n          // Show all individual stations if manageable count\n          stationsToShow.forEach(station => {\n            if (station.location?.lat && station.location?.lng) {\n              markers.push({\n                id: `station-${station.id}`,\n                type: 'single',\n                position: [station.location.lng, station.location.lat, 0],\n                stations: [station],\n                metadata: {\n                  name: station.name,\n                  country: station.location.country,\n                  city: station.location.city,\n                  stationCount: 1,\n                  density: 'low' as const,\n                  type: 'cluster' as const\n                }\n              });\n            }\n          });\n        }\n      }\n    });\n\n    return markers;\n  }\n\n  /**\n   * Get approximate center coordinates for major countries\n   */\n  private getCountryCenter(country: string): [number, number, number] | null {\n    const countryCenters: Record<string, [number, number, number]> = {\n      'US': [-98.5, 39.8, 0], 'United States': [-98.5, 39.8, 0],\n      'GB': [-3.4, 55.4, 0], 'United Kingdom': [-3.4, 55.4, 0],\n      'DE': [10.5, 51.2, 0], 'Germany': [10.5, 51.2, 0],\n      'FR': [2.2, 46.2, 0], 'France': [2.2, 46.2, 0],\n      'ES': [-3.7, 40.5, 0], 'Spain': [-3.7, 40.5, 0],\n      'IT': [12.6, 41.9, 0], 'Italy': [12.6, 41.9, 0],\n      'NL': [5.3, 52.1, 0], 'Netherlands': [5.3, 52.1, 0],\n      'SE': [18.6, 60.1, 0], 'Sweden': [18.6, 60.1, 0],\n      'NO': [10.7, 59.9, 0], 'Norway': [10.7, 59.9, 0],\n      'DK': [9.5, 56.3, 0], 'Denmark': [9.5, 56.3, 0],\n      'JP': [138.3, 36.2, 0], 'Japan': [138.3, 36.2, 0],\n      'KR': [127.8, 35.9, 0], 'South Korea': [127.8, 35.9, 0],\n      'CN': [104.2, 35.9, 0], 'China': [104.2, 35.9, 0],\n      'IN': [78.9, 20.6, 0], 'India': [78.9, 20.6, 0],\n      'AU': [133.8, -25.3, 0], 'Australia': [133.8, -25.3, 0],\n      'NZ': [174.9, -40.9, 0], 'New Zealand': [174.9, -40.9, 0],\n      'BR': [-51.9, -14.2, 0], 'Brazil': [-51.9, -14.2, 0],\n      'MX': [-102.6, 23.6, 0], 'Mexico': [-102.6, 23.6, 0],\n      'CA': [-106.3, 56.1, 0], 'Canada': [-106.3, 56.1, 0],\n      'RU': [105.3, 61.5, 0], 'Russia': [105.3, 61.5, 0],\n      'ZA': [22.9, -30.6, 0], 'South Africa': [22.9, -30.6, 0],\n      'AR': [-63.6, -38.4, 0], 'Argentina': [-63.6, -38.4, 0],\n      'CL': [-71.5, -35.7, 0], 'Chile': [-71.5, -35.7, 0],\n      'EG': [30.8, 26.8, 0], 'Egypt': [30.8, 26.8, 0],\n      'NG': [8.7, 9.1, 0], 'Nigeria': [8.7, 9.1, 0],\n      'TR': [35.2, 39.0, 0], 'Turkey': [35.2, 39.0, 0],\n    };\n\n    return countryCenters[country] || null;\n  }\n\n  /**\n   * Calculate density level based on station count\n   */\n  private getDensityLevel(stationCount: number): 'low' | 'medium' | 'high' | 'very-high' {\n    if (stationCount > 20) return 'very-high';\n    if (stationCount > 10) return 'high';\n    if (stationCount > 5) return 'medium';\n    return 'low';\n  }\n\n  /**\n   * Get coordinates for major cities worldwide\n   */\n  private getCityCoordinates(cityName: string, country: string): { lat: number; lng: number } | null {\n    const cityCoords: Record<string, Record<string, { lat: number; lng: number }>> = {\n      'Zambia': {\n        'Lusaka': { lat: -15.3875, lng: 28.3228 },\n        'Ndola': { lat: -12.9687, lng: 28.6366 },\n        'Kitwe': { lat: -12.8024, lng: 28.2132 },\n        'Kabwe': { lat: -14.4469, lng: 28.4464 },\n        'Chingola': { lat: -12.5289, lng: 27.8811 },\n        'Mufulira': { lat: -12.5443, lng: 28.2405 },\n        'Livingstone': { lat: -17.8419, lng: 25.8544 }\n      },\n      'Nigeria': {\n        'Lagos': { lat: 6.5244, lng: 3.3792 },\n        'Abuja': { lat: 9.0765, lng: 7.3986 },\n        'Kano': { lat: 12.0022, lng: 8.5920 },\n        'Ibadan': { lat: 7.3775, lng: 3.9470 },\n        'Port Harcourt': { lat: 4.8156, lng: 7.0498 }\n      },\n      'Kenya': {\n        'Nairobi': { lat: -1.2921, lng: 36.8219 },\n        'Mombasa': { lat: -4.0435, lng: 39.6682 },\n        'Kisumu': { lat: -0.0917, lng: 34.7680 },\n        'Eldoret': { lat: 0.5143, lng: 35.2698 }\n      },\n      'South Africa': {\n        'Johannesburg': { lat: -26.2041, lng: 28.0473 },\n        'Cape Town': { lat: -33.9249, lng: 18.4241 },\n        'Durban': { lat: -29.8587, lng: 31.0218 },\n        'Pretoria': { lat: -25.7479, lng: 28.2293 }\n      },\n      'United States': {\n        'New York': { lat: 40.7128, lng: -74.0060 },\n        'Los Angeles': { lat: 34.0522, lng: -118.2437 },\n        'Chicago': { lat: 41.8781, lng: -87.6298 },\n        'Houston': { lat: 29.7604, lng: -95.3698 }\n      },\n      'United Kingdom': {\n        'London': { lat: 51.5074, lng: -0.1278 },\n        'Manchester': { lat: 53.4808, lng: -2.2426 },\n        'Birmingham': { lat: 52.4862, lng: -1.8904 },\n        'Liverpool': { lat: 53.4084, lng: -2.9916 }\n      }\n    };\n\n    return cityCoords[country]?.[cityName] || null;\n  }\n\n  /**\n   * Get approximate country boundaries for coordinate generation\n   */\n  private getCountryBounds(country: string): { minLat: number; maxLat: number; minLng: number; maxLng: number } | null {\n    const countryBounds: Record<string, { minLat: number; maxLat: number; minLng: number; maxLng: number }> = {\n      'Zambia': { minLat: -18.0, maxLat: -8.2, minLng: 21.9, maxLng: 33.7 },\n      'Nigeria': { minLat: 4.3, maxLat: 13.9, minLng: 2.7, maxLng: 14.7 },\n      'Kenya': { minLat: -4.7, maxLat: 5.5, minLng: 33.9, maxLng: 41.9 },\n      'South Africa': { minLat: -34.8, maxLat: -22.1, minLng: 16.3, maxLng: 32.9 },\n      'United States': { minLat: 25.0, maxLat: 49.0, minLng: -125.0, maxLng: -66.0 },\n      'United Kingdom': { minLat: 49.9, maxLat: 58.7, minLng: -8.6, maxLng: 1.8 },\n      'Germany': { minLat: 47.3, maxLat: 55.1, minLng: 5.9, maxLng: 15.0 },\n      'France': { minLat: 41.3, maxLat: 51.1, minLng: -5.1, maxLng: 9.6 },\n      'Brazil': { minLat: -33.7, maxLat: 5.3, minLng: -73.9, maxLng: -28.8 },\n      'Australia': { minLat: -43.6, maxLat: -10.7, minLng: 113.3, maxLng: 153.6 }\n    };\n\n    return countryBounds[country] || null;\n  }\n\n  /**\n   * Enhanced test stations with global coverage\n   */\n  private getEnhancedTestStations(): any[] {\n    return [\n      // North America\n      { id: 'test-us-1', name: 'KQED FM', url: 'http://kqed.org/stream', country: 'US', city: 'San Francisco', genre: 'News', location: { lat: 37.7749, lng: -122.4194 } },\n      { id: 'test-us-2', name: 'WNYC FM', url: 'http://wnyc.org/stream', country: 'US', city: 'New York', genre: 'News', location: { lat: 40.7589, lng: -73.9851 } },\n      { id: 'test-us-3', name: 'WXPN', url: 'http://wxpn.org/stream', country: 'US', city: 'Philadelphia', genre: 'Music', location: { lat: 39.9526, lng: -75.1652 } },\n      { id: 'test-ca-1', name: 'CBC Radio One', url: 'http://cbc.ca/stream', country: 'CA', city: 'Toronto', genre: 'News', location: { lat: 43.6532, lng: -79.3832 } },\n      { id: 'test-ca-2', name: 'Radio-Canada', url: 'http://radio-canada.ca/stream', country: 'CA', city: 'Montreal', genre: 'News', location: { lat: 45.5017, lng: -73.5673 } },\n      \n      // Europe\n      { id: 'test-gb-1', name: 'BBC Radio 1', url: 'http://bbc.co.uk/stream', country: 'GB', city: 'London', genre: 'Music', location: { lat: 51.5074, lng: -0.1278 } },\n      { id: 'test-gb-2', name: 'BBC Radio 4', url: 'http://bbc.co.uk/radio4', country: 'GB', city: 'London', genre: 'News', location: { lat: 51.5074, lng: -0.1278 } },\n      { id: 'test-de-1', name: 'Deutschlandfunk', url: 'http://dradio.de/stream', country: 'DE', city: 'Berlin', genre: 'News', location: { lat: 52.5200, lng: 13.4050 } },\n      { id: 'test-de-2', name: 'Bayern 3', url: 'http://br.de/stream', country: 'DE', city: 'Munich', genre: 'Music', location: { lat: 48.1351, lng: 11.5820 } },\n      { id: 'test-fr-1', name: 'France Inter', url: 'http://radiofrance.fr/stream', country: 'FR', city: 'Paris', genre: 'News', location: { lat: 48.8566, lng: 2.3522 } },\n      { id: 'test-es-1', name: 'RNE Radio 1', url: 'http://rtve.es/stream', country: 'ES', city: 'Madrid', genre: 'News', location: { lat: 40.4168, lng: -3.7038 } },\n      { id: 'test-it-1', name: 'RAI Radio 1', url: 'http://rai.it/stream', country: 'IT', city: 'Rome', genre: 'News', location: { lat: 41.9028, lng: 12.4964 } },\n      { id: 'test-nl-1', name: 'NPO Radio 1', url: 'http://npo.nl/stream', country: 'NL', city: 'Amsterdam', genre: 'News', location: { lat: 52.3676, lng: 4.9041 } },\n      { id: 'test-se-1', name: 'SVT P1', url: 'http://svt.se/stream', country: 'SE', city: 'Stockholm', genre: 'News', location: { lat: 59.3293, lng: 18.0686 } },\n      { id: 'test-no-1', name: 'NRK P1', url: 'http://nrk.no/stream', country: 'NO', city: 'Oslo', genre: 'News', location: { lat: 59.9139, lng: 10.7522 } },\n      \n      // Asia-Pacific\n      { id: 'test-jp-1', name: 'NHK Radio', url: 'http://nhk.or.jp/stream', country: 'JP', city: 'Tokyo', genre: 'News', location: { lat: 35.6762, lng: 139.6503 } },\n      { id: 'test-jp-2', name: 'J-Wave', url: 'http://j-wave.co.jp/stream', country: 'JP', city: 'Tokyo', genre: 'Music', location: { lat: 35.6762, lng: 139.6503 } },\n      { id: 'test-kr-1', name: 'KBS Radio', url: 'http://kbs.co.kr/stream', country: 'KR', city: 'Seoul', genre: 'News', location: { lat: 37.5665, lng: 126.9780 } },\n      { id: 'test-au-1', name: 'ABC Radio', url: 'http://abc.net.au/stream', country: 'AU', city: 'Sydney', genre: 'News', location: { lat: -33.8688, lng: 151.2093 } },\n      { id: 'test-au-2', name: 'Triple J', url: 'http://triplej.net.au/stream', country: 'AU', city: 'Sydney', genre: 'Music', location: { lat: -33.8688, lng: 151.2093 } },\n      { id: 'test-nz-1', name: 'RNZ National', url: 'http://rnz.co.nz/stream', country: 'NZ', city: 'Wellington', genre: 'News', location: { lat: -41.2865, lng: 174.7762 } },\n      { id: 'test-in-1', name: 'All India Radio', url: 'http://allindiaradio.gov.in/stream', country: 'IN', city: 'New Delhi', genre: 'News', location: { lat: 28.7041, lng: 77.1025 } },\n      { id: 'test-in-2', name: 'Radio City', url: 'http://radiocity.in/stream', country: 'IN', city: 'Mumbai', genre: 'Music', location: { lat: 19.0760, lng: 72.8777 } },\n      \n      // Latin America\n      { id: 'test-br-1', name: 'CBN Radio', url: 'http://cbn.globoradio.globo.com/stream', country: 'BR', city: 'SÃ£o Paulo', genre: 'News', location: { lat: -23.5558, lng: -46.6396 } },\n      { id: 'test-br-2', name: 'RÃ¡dio Nacional', url: 'http://radios.ebc.com.br/stream', country: 'BR', city: 'Rio de Janeiro', genre: 'Music', location: { lat: -22.9068, lng: -43.1729 } },\n      { id: 'test-mx-1', name: 'Radio Universidad', url: 'http://radio.unam.mx/stream', country: 'MX', city: 'Mexico City', genre: 'Culture', location: { lat: 19.4326, lng: -99.1332 } },\n      { id: 'test-ar-1', name: 'Radio Nacional', url: 'http://radionacional.com.ar/stream', country: 'AR', city: 'Buenos Aires', genre: 'News', location: { lat: -34.6118, lng: -58.3960 } },\n      { id: 'test-cl-1', name: 'Radio Cooperativa', url: 'http://cooperativa.cl/stream', country: 'CL', city: 'Santiago', genre: 'News', location: { lat: -33.4489, lng: -70.6693 } },\n      \n      // Africa & Middle East\n      { id: 'test-za-1', name: 'SAfm', url: 'http://sabc.co.za/stream', country: 'ZA', city: 'Johannesburg', genre: 'News', location: { lat: -26.2041, lng: 28.0473 } },\n      { id: 'test-eg-1', name: 'Radio Cairo', url: 'http://ertu.org/stream', country: 'EG', city: 'Cairo', genre: 'News', location: { lat: 30.0444, lng: 31.2357 } },\n      { id: 'test-ng-1', name: 'Radio Nigeria', url: 'http://frcn.gov.ng/stream', country: 'NG', city: 'Lagos', genre: 'News', location: { lat: 6.5244, lng: 3.3792 } },\n      { id: 'test-il-1', name: 'Kol Israel', url: 'http://kan.org.il/stream', country: 'IL', city: 'Tel Aviv', genre: 'News', location: { lat: 32.0853, lng: 34.7818 } },\n      \n      // Russia & Eastern Europe\n      { id: 'test-ru-1', name: 'Radio Russia', url: 'http://radiorus.ru/stream', country: 'RU', city: 'Moscow', genre: 'News', location: { lat: 55.7558, lng: 37.6173 } },\n      { id: 'test-ru-2', name: 'Echo Moscow', url: 'http://echo.msk.ru/stream', country: 'RU', city: 'Moscow', genre: 'Talk', location: { lat: 55.7558, lng: 37.6173 } },\n      { id: 'test-tr-1', name: 'TRT Radyo 1', url: 'http://trt.net.tr/stream', country: 'TR', city: 'Istanbul', genre: 'News', location: { lat: 41.0082, lng: 28.9784 } },\n    ];\n  }\n\n  private clusterStationsByCity(stations: any[], country: string, zoomLevel: number): MarkerData[] {\n    const cityGroups = new Map<string, any[]>();\n    \n    console.log(`Clustering ${stations.length} stations for ${country}`);\n    \n    // Group stations by city, creating major urban centers as cluster points\n    stations.forEach((station, index) => {\n      const city = station.location?.city || 'Unknown City';\n      const cityKey = `${city}-${country}`;\n      \n      if (!cityGroups.has(cityKey)) {\n        cityGroups.set(cityKey, []);\n      }\n      cityGroups.get(cityKey)!.push(station);\n      \n      // Log first few stations to debug location data\n      if (index < 3) {\n        console.log(`Station ${index} in ${country}:`, {\n          name: station.name,\n          city,\n          lat: station.location?.lat,\n          lng: station.location?.lng\n        });\n      }\n    });\n\n    console.log(`Created ${cityGroups.size} city clusters for ${country}`);\n\n    // Convert city groups to marker data representing urban centers\n    return Array.from(cityGroups.entries()).map(([cityKey, groupStations]) => {\n      const representative = groupStations[0];\n      const cityName = cityKey.split('-')[0];\n      let lat = representative.location?.lat || 0;\n      let lng = representative.location?.lng || 0;\n      \n      // If no coordinates, use enhanced city coordinate lookup\n      if (lat === 0 && lng === 0) {\n        const cityCoords = this.getCityCoordinates(cityName, country);\n        if (cityCoords) {\n          lat = cityCoords.lat;\n          lng = cityCoords.lng;\n        } else {\n          // Fallback: generate realistic coordinates within country bounds\n          const countryBounds = this.getCountryBounds(country);\n          if (countryBounds) {\n            const hash = this.hashString(cityKey);\n            lat = countryBounds.minLat + ((hash % 100) / 100) * (countryBounds.maxLat - countryBounds.minLat);\n            lng = countryBounds.minLng + (((hash * 7) % 100) / 100) * (countryBounds.maxLng - countryBounds.minLng);\n          }\n        }\n      }\n      \n      const position = latLngToPosition(lat, lng, 1.01) as [number, number, number];\n      \n      return {\n        id: cityKey,\n        position,\n        stations: groupStations,\n        type: 'city' as const,\n        metadata: {\n          name: `${cityName} (${groupStations.length} stations)`,\n          city: cityName,\n          country: country,\n          stationCount: groupStations.length,\n          density: this.getDensityLevel(groupStations.length),\n          type: 'city' as const\n        }\n      };\n    }).filter(marker => \n      // Filter out markers with invalid coordinates\n      marker.position[0] !== 0 || marker.position[1] !== 0\n    );\n  }\n\n  private hashString(str: string): number {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n      const char = str.charCodeAt(i);\n      hash = ((hash << 5) - hash) + char;\n      hash = hash & hash; // Convert to 32-bit integer\n    }\n    return Math.abs(hash);\n  }\n}\n\n/**\n * Station Selection Use Case  \n * Handles station selection with command pattern and events\n */\nexport class StationSelectionUseCase implements IStationSelectionUseCase {\n  private currentSelection: { stationId: string; station: any } | null = null;\n\n  constructor(\n    private eventBus: GlobeEventBus,\n    private commandInvoker: CommandInvoker\n  ) {}\n\n  async selectStation(stationId: string, station: any): Promise<void> {\n    const previousSelection = this.currentSelection;\n    \n    // Create selection command\n    const command = createCommand.selectStation(\n      stationId,\n      station,\n      (id, st) => this.executeSelection(id, st),\n      () => this.clearSelection(),\n      previousSelection || undefined\n    );\n\n    // Execute through command invoker for undo/redo support\n    await this.commandInvoker.execute(command);\n  }\n\n  async clearSelection(): Promise<void> {\n    if (!this.currentSelection) return;\n\n    const previousSelection = this.currentSelection;\n    this.currentSelection = null;\n\n    // Emit selection cleared event\n    this.eventBus.notify({\n      type: GlobeEventType.STATION_SELECTED,\n      timestamp: Date.now(),\n      data: { stationId: null, station: null, previousSelection }\n    });\n  }\n\n  getCurrentSelection(): { stationId: string; station: any } | null {\n    return this.currentSelection;\n  }\n\n  async hoverStation(stationId: string | null): Promise<void> {\n    this.eventBus.notify({\n      type: GlobeEventType.STATION_HOVERED,\n      timestamp: Date.now(),\n      data: { stationId }\n    });\n  }\n\n  private executeSelection(stationId: string, station: any): void {\n    this.currentSelection = { stationId, station };\n\n    // Emit selection event\n    this.eventBus.notify(createGlobeEvent.stationSelected(stationId, station));\n  }\n}"],"names":["StationLoadingUseCase","stationRepository","eventBus","loadStationsForView","zoomLevel","notify","zoomChanged","stations","getGlobalStationsWithDistribution","console","log","length","every","s","location","lat","lng","enhancedTestStations","getEnhancedTestStations","clusterStationsByCountryAndCity","clusteredMarkers","totalStations","reduce","sum","marker","stationsLoaded","error","testStations","Error","String","markers","stationsByCountry","Map","forEach","station","country","has","set","get","push","countryStations","countryCenter","getCountryCenter","id","type","position","metadata","name","stationCount","density","getDensityLevel","cityClusters","clusterStationsByCity","maxIndividualStations","stationsToShow","slice","city","remaining","countryCenters","getCityCoordinates","cityName","cityCoords","getCountryBounds","countryBounds","minLat","maxLat","minLng","maxLng","url","genre","cityGroups","index","cityKey","size","Array","from","entries","map","groupStations","representative","split","hash","hashString","filter","str","i","char","charCodeAt","Math","abs","StationSelectionUseCase","currentSelection","commandInvoker","selectStation","stationId","previousSelection","command","st","executeSelection","clearSelection","undefined","execute","STATION_SELECTED","timestamp","Date","now","data","getCurrentSelection","hoverStation","STATION_HOVERED","stationSelected"],"mappings":"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"}},
    {"offset": {"line": 3149, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/strategies/MarkerStrategy.ts"],"sourcesContent":["import * as THREE from \"three\";\nimport { RadioStation } from \"../types\";\n\nexport interface MarkerData {\n  id: string;\n  position: [number, number, number];\n  stations: RadioStation[];\n  type: 'single' | 'cluster' | 'city' | 'country';\n  metadata: {\n    city?: string;\n    country?: string;\n    density?: 'low' | 'medium' | 'high' | 'very-high';\n    zoomLevel?: number;\n    name?: string;\n    stationCount?: number;\n    type?: 'country' | 'city' | 'cluster';\n  };\n}\n\nexport interface MarkerStyle {\n  size: number;\n  color: string;\n  opacity: number;\n  hasLabel: boolean;\n  labelText?: string;\n  pulseEffect?: boolean;\n  glowEffect?: boolean;\n}\n\nexport abstract class BaseMarkerStrategy {\n  abstract calculateStyle(data: MarkerData, cameraDistance: number): MarkerStyle;\n  abstract shouldShow(data: MarkerData, zoomLevel: number): boolean;\n  abstract handleInteraction(data: MarkerData, interactionType: 'click' | 'hover'): void;\n}\n\nexport class SingleStationMarkerStrategy extends BaseMarkerStrategy {\n  calculateStyle(data: MarkerData, cameraDistance: number): MarkerStyle {\n    // Much smaller markers when zoomed in\n    const baseSize = Math.max(0.015, Math.min(0.05, 0.1 / cameraDistance));\n    \n    return {\n      size: baseSize,\n      color: \"#5f72ff\",\n      opacity: 0.9,\n      // Only show labels when extremely close\n      hasLabel: cameraDistance < 2.0,\n      labelText: data.stations[0]?.name,\n      pulseEffect: false,\n      glowEffect: false\n    };\n  }\n\n  shouldShow(data: MarkerData, zoomLevel: number): boolean {\n    return zoomLevel > 3.5; // Show individual stations at closer zoom\n  }\n\n  handleInteraction(data: MarkerData, interactionType: 'click' | 'hover'): void {\n    if (interactionType === 'click' && data.stations[0]) {\n      // Dispatch station selection event\n      window.dispatchEvent(new CustomEvent('stationSelected', { \n        detail: data.stations[0] \n      }));\n    }\n  }\n}\n\nexport class ClusterMarkerStrategy extends BaseMarkerStrategy {\n  calculateStyle(data: MarkerData, cameraDistance: number): MarkerStyle {\n    const stationCount = data.stations.length;\n    // Even more conservative base size\n    const baseSize = Math.max(0.025, Math.min(0.1, 0.18 / cameraDistance));\n    // Further reduce size multiplier to prevent huge markers\n    const sizeMultiplier = Math.log(stationCount + 1) * 0.08;\n    \n    const densityColors = {\n      'low': \"#5f72ff\",\n      'medium': \"#ffde59\", \n      'high': \"#ffa502\",\n      'very-high': \"#ff4757\"\n    };\n\n    // Special styling for country-level clusters\n    const isCountryCluster = data.metadata.type === 'country';\n    const color = isCountryCluster ? this.getCountryColor(data.metadata.country || 'Unknown') : densityColors[data.metadata.density || 'low'];\n\n    return {\n      size: baseSize + sizeMultiplier,\n      color: color,\n      opacity: isCountryCluster ? 0.8 : 0.9,\n      // More restrictive label showing - show country names for country clusters\n      hasLabel: cameraDistance < (isCountryCluster ? 4.0 : 2.5) && stationCount <= (isCountryCluster ? 200 : 5),\n      labelText: isCountryCluster ? data.metadata.name : (data.metadata.city || `${stationCount}`),\n      pulseEffect: false,\n      glowEffect: true\n    };\n  }\n\n  private getCountryColor(country: string): string {\n    // Assign distinctive colors to major countries\n    const countryColors: Record<string, string> = {\n      'US': '#ff6b6b', 'United States': '#ff6b6b',\n      'GB': '#4ecdc4', 'United Kingdom': '#4ecdc4',\n      'DE': '#45b7d1', 'Germany': '#45b7d1',\n      'FR': '#96ceb4', 'France': '#96ceb4',\n      'JP': '#ffeaa7', 'Japan': '#ffeaa7',\n      'AU': '#fd79a8', 'Australia': '#fd79a8',\n      'BR': '#00b894', 'Brazil': '#00b894',\n      'CA': '#e17055', 'Canada': '#e17055',\n      'IN': '#a29bfe', 'India': '#a29bfe',\n      'RU': '#636e72', 'Russia': '#636e72',\n      'CN': '#fd63a3', 'China': '#fd63a3',\n      'KR': '#fdcb6e', 'South Korea': '#fdcb6e',\n      'ES': '#e84393', 'Spain': '#e84393',\n      'IT': '#00cec9', 'Italy': '#00cec9',\n    };\n    \n    return countryColors[country] || '#74b9ff'; // Default blue\n  }\n\n  shouldShow(data: MarkerData, zoomLevel: number): boolean {\n    return zoomLevel >= 1 && zoomLevel <= 4; // Stop showing clusters before single stations appear\n  }\n\n  handleInteraction(data: MarkerData, interactionType: 'click' | 'hover'): void {\n    if (interactionType === 'click') {\n      if (data.stations.length === 1) {\n        // Handle single station case - dispatch selection event directly\n        window.dispatchEvent(new CustomEvent('stationSelected', { \n          detail: data.stations[0] \n        }));\n      } else {\n        // Show cluster expansion or select most popular\n        const popularStation = data.stations.reduce((prev, current) => \n          (current.listeners > prev.listeners) ? current : prev\n        );\n        window.dispatchEvent(new CustomEvent('stationSelected', { \n          detail: popularStation \n        }));\n      }\n    }\n  }\n}\n\nexport class MarkerFactory {\n  private strategies = new Map<string, BaseMarkerStrategy>();\n\n  constructor() {\n    this.strategies.set('single', new SingleStationMarkerStrategy());\n    this.strategies.set('cluster', new ClusterMarkerStrategy());\n  }\n\n  createMarker(data: MarkerData, cameraDistance: number): {\n    style: MarkerStyle;\n    strategy: BaseMarkerStrategy;\n  } {\n    const strategy = this.strategies.get(data.type) || this.strategies.get('single')!;\n    \n    return {\n      style: strategy.calculateStyle(data, cameraDistance),\n      strategy\n    };\n  }\n\n  shouldShowMarker(data: MarkerData, zoomLevel: number): boolean {\n    const strategy = this.strategies.get(data.type) || this.strategies.get('single')!;\n    return strategy.shouldShow(data, zoomLevel);\n  }\n}"],"names":["BaseMarkerStrategy","SingleStationMarkerStrategy","calculateStyle","data","cameraDistance","baseSize","Math","max","min","size","color","opacity","hasLabel","labelText","stations","name","pulseEffect","glowEffect","shouldShow","zoomLevel","handleInteraction","interactionType","window","dispatchEvent","CustomEvent","detail","ClusterMarkerStrategy","stationCount","length","sizeMultiplier","log","densityColors","isCountryCluster","metadata","type","getCountryColor","country","density","city","countryColors","popularStation","reduce","prev","current","listeners","MarkerFactory","strategies","Map","set","createMarker","strategy","get","style","shouldShowMarker"],"mappings":"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"}},
    {"offset": {"line": 3294, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/services/stationCacheHelpers.ts"],"sourcesContent":["import { RadioStation } from \"../types\";\n\nexport type StationIndex = Map<string, RadioStation[]>;\n\nconst UNKNOWN = \"unknown\";\n\nexport function buildCountryIndex(stations: RadioStation[]): StationIndex {\n  const byCountry = new Map<string, RadioStation[]>();\n  stations.forEach((station) => {\n    const key = station.location.country?.toLowerCase() || UNKNOWN;\n    if (!byCountry.has(key)) {\n      byCountry.set(key, []);\n    }\n    byCountry.get(key)!.push(station);\n  });\n  return byCountry;\n}\n\nexport function buildCityIndex(stations: RadioStation[]): StationIndex {\n  const byCity = new Map<string, RadioStation[]>();\n  stations.forEach((station) => {\n    const city = station.location.city?.toLowerCase();\n    if (!city) return;\n    if (!byCity.has(city)) {\n      byCity.set(city, []);\n    }\n    byCity.get(city)!.push(station);\n  });\n  return byCity;\n}\n\nexport function buildGenreIndex(stations: RadioStation[]): StationIndex {\n  const byGenre = new Map<string, RadioStation[]>();\n  stations.forEach((station) => {\n    const genre = station.genre?.toLowerCase() || UNKNOWN;\n    if (!byGenre.has(genre)) {\n      byGenre.set(genre, []);\n    }\n    byGenre.get(genre)!.push(station);\n\n    station.tags?.forEach((tag) => {\n      const key = tag.toLowerCase();\n      if (!byGenre.has(key)) {\n        byGenre.set(key, []);\n      }\n      byGenre.get(key)!.push(station);\n    });\n  });\n  return byGenre;\n}\n\nexport function filterStationsByCountry(\n  stations: RadioStation[],\n  normalizedCountry: string,\n): RadioStation[] {\n  return stations\n    .filter((station) => {\n      const name = station.location?.country?.toLowerCase() || \"\";\n      const code = station.location?.countryCode?.toLowerCase() || \"\";\n      return (\n        name === normalizedCountry ||\n        name.startsWith(normalizedCountry) ||\n        code === normalizedCountry\n      );\n    })\n    .sort((a, b) => (b.listeners || 0) - (a.listeners || 0));\n}\n\nexport function filterStationsByCity(\n  stations: RadioStation[],\n  normalizedCity: string,\n): RadioStation[] {\n  return stations\n    .filter((station) => station.location.city?.toLowerCase().includes(normalizedCity))\n    .sort((a, b) => (b.listeners || 0) - (a.listeners || 0));\n}\n\nexport function filterStationsByTag(\n  stations: RadioStation[],\n  normalizedTag: string,\n): RadioStation[] {\n  return stations\n    .filter((station) => {\n      const genre = station.genre?.toLowerCase() || \"\";\n      const tags = station.tags?.map((tag) => tag.toLowerCase()) || [];\n      return genre.includes(normalizedTag) || tags.some((tag) => tag.includes(normalizedTag));\n    })\n    .sort((a, b) => (b.listeners || 0) - (a.listeners || 0));\n}\n\nexport function searchStationsInCache(stations: RadioStation[], query: string): RadioStation[] {\n  const searchTerm = query.trim().toLowerCase();\n  if (!searchTerm) return [];\n\n  const results = stations.filter((station) =>\n    station.name?.toLowerCase().includes(searchTerm) ||\n    station.location?.country?.toLowerCase().includes(searchTerm) ||\n    station.location?.city?.toLowerCase().includes(searchTerm) ||\n    station.genre?.toLowerCase().includes(searchTerm) ||\n    station.language?.toLowerCase().includes(searchTerm) ||\n    station.description?.toLowerCase().includes(searchTerm) ||\n    station.tags?.some((tag) => tag.toLowerCase().includes(searchTerm))\n  );\n\n  return results.sort((a, b) => {\n    const aExact = a.name?.toLowerCase() === searchTerm;\n    const bExact = b.name?.toLowerCase() === searchTerm;\n    if (aExact && !bExact) return -1;\n    if (!aExact && bExact) return 1;\n    return (b.listeners || 0) - (a.listeners || 0);\n  });\n}\n\nexport function distributeStationsByCountry(\n  stations: RadioStation[],\n  targetLimit: number,\n): RadioStation[] {\n  const byCountry = buildCountryIndex(stations);\n  const result: RadioStation[] = [];\n  const maxPerCountry = Math.min(20, Math.ceil(targetLimit / Math.max(byCountry.size, 1)));\n\n  const countryGroups = Array.from(byCountry.values());\n  for (let index = 0; index < countryGroups.length; index += 1) {\n    const selected = countryGroups[index].slice(0, maxPerCountry);\n    result.push(...selected);\n    if (result.length >= targetLimit) break;\n  }\n\n  return result.slice(0, targetLimit);\n}\n\nexport function summarizeCountries(stations: RadioStation[]): Array<{ name: string; iso: string; stationcount: number }> {\n  const counts = new Map<string, { name: string; iso: string; stationcount: number }>();\n  stations.forEach((station) => {\n    const country = station.location.country || \"Unknown\";\n    const iso = station.location.countryCode || \"\";\n    if (!counts.has(country)) {\n      counts.set(country, { name: country, iso, stationcount: 0 });\n    }\n    counts.get(country)!.stationcount += 1;\n  });\n  return Array.from(counts.values()).sort((a, b) => b.stationcount - a.stationcount);\n}\n\nexport function summarizeTags(stations: RadioStation[]): Array<{ name: string; stationcount: number }> {\n  const counts = new Map<string, number>();\n\n  stations.forEach((station) => {\n    if (station.genre) {\n      const key = station.genre.toLowerCase();\n      counts.set(key, (counts.get(key) || 0) + 1);\n    }\n    station.tags?.forEach((tag) => {\n      const key = tag.toLowerCase();\n      counts.set(key, (counts.get(key) || 0) + 1);\n    });\n  });\n\n  return Array.from(counts.entries())\n    .map(([name, stationcount]) => ({ name, stationcount }))\n    .sort((a, b) => b.stationcount - a.stationcount);\n}\n"],"names":["UNKNOWN","buildCountryIndex","stations","byCountry","Map","forEach","station","key","location","country","toLowerCase","has","set","get","push","buildCityIndex","byCity","city","buildGenreIndex","byGenre","genre","tags","tag","filterStationsByCountry","normalizedCountry","filter","name","code","countryCode","startsWith","sort","a","b","listeners","filterStationsByCity","normalizedCity","includes","filterStationsByTag","normalizedTag","map","some","searchStationsInCache","query","searchTerm","trim","results","language","description","aExact","bExact","distributeStationsByCountry","targetLimit","result","maxPerCountry","Math","min","ceil","max","size","countryGroups","Array","from","values","index","length","selected","slice","summarizeCountries","counts","iso","stationcount","summarizeTags","entries"],"mappings":"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"}},
    {"offset": {"line": 3439, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/services/location/wofEnrichmentService.ts"],"sourcesContent":["import booleanPointInPolygon from \"@turf/boolean-point-in-polygon\";\nimport { point } from \"@turf/helpers\";\nimport type { Feature, Geometry } from \"geojson\";\nimport type { RadioStation, WofHierarchyEntry, WofLocationDetail } from \"../../types\";\nimport type {\n  NaturalEarthCollection,\n  NaturalEarthFeature,\n  NaturalEarthFeatureProperties,\n} from \"./naturalEarthService\";\n\ninterface Bounds {\n  minLat: number;\n  minLng: number;\n  maxLat: number;\n  maxLng: number;\n}\n\nfunction getBoundsFromFeature(feature: NaturalEarthFeature): Bounds {\n  const [minLng, minLat, maxLng, maxLat] = feature.bbox;\n  return {\n    minLat,\n    minLng,\n    maxLat,\n    maxLng,\n  };\n}\n\nfunction isWithinBounds(bounds: Bounds, lat: number, lng: number): boolean {\n  return lat >= bounds.minLat && lat <= bounds.maxLat && lng >= bounds.minLng && lng <= bounds.maxLng;\n}\n\nfunction containsPoint(feature: NaturalEarthFeature, lat: number, lng: number): boolean {\n  try {\n    return booleanPointInPolygon(point([lng, lat]), feature as any);\n  } catch (error) {\n    console.warn(\"Failed to evaluate Natural Earth polygon\", error);\n    return false;\n  }\n}\n\nfunction ensureNaturalEarthFeature(\n  feature: Feature<Geometry, NaturalEarthFeatureProperties> | NaturalEarthFeature | null | undefined,\n): NaturalEarthFeature | null {\n  if (!feature) return null;\n  const candidate = feature as NaturalEarthFeature;\n  if (Array.isArray(candidate.bbox) && candidate.bbox.length === 4) {\n    return candidate;\n  }\n  return null;\n}\n\nfunction hashIdentifier(value: string): number {\n  let hash = 0;\n  for (let index = 0; index < value.length; index += 1) {\n    hash = (hash * 31 + value.charCodeAt(index)) | 0;\n  }\n  return Math.abs(hash) || 1;\n}\n\nfunction buildHierarchyEntry(\n  id: number,\n  placetype: string,\n  name: string,\n  feature: NaturalEarthFeature,\n): WofHierarchyEntry {\n  const [minLng, minLat, maxLng, maxLat] = feature.bbox;\n  return {\n    id,\n    placetype,\n    name,\n    bbox: [minLng, minLat, maxLng, maxLat],\n  };\n}\n\nfunction pickCountryFeature(\n  station: RadioStation,\n  countries: NaturalEarthCollection,\n): NaturalEarthFeature | null {\n  const isoCandidates = [\n    station.location.countryCode?.toUpperCase(),\n  ].filter(Boolean) as string[];\n\n  for (const iso of isoCandidates) {\n    const match = countries.features.find((feature) => {\n      const props = feature.properties;\n      return props.isoA2?.toUpperCase() === iso || props.isoA3?.toUpperCase() === iso;\n    });\n    const natural = ensureNaturalEarthFeature(match);\n    if (natural) {\n      return natural;\n    }\n  }\n\n  const name = station.location.country.trim().toLowerCase();\n  if (name) {\n    const byName = ensureNaturalEarthFeature(\n      countries.features.find((feature) => feature.properties.name.toLowerCase() === name),\n    );\n    if (byName) return byName;\n  }\n\n  const { lat, lng } = station.location;\n  const fallback = countries.features.find((feature) => {\n      const candidate = ensureNaturalEarthFeature(feature);\n      if (!candidate) {\n        return false;\n      }\n      const bounds = getBoundsFromFeature(candidate);\n      return isWithinBounds(bounds, lat, lng) && containsPoint(candidate, lat, lng);\n    });\n\n  return ensureNaturalEarthFeature(fallback);\n}\n\nfunction pickRegionFeature(\n  station: RadioStation,\n  regions: NaturalEarthCollection,\n  countryFeature: NaturalEarthFeature | null,\n): NaturalEarthFeature | null {\n  if (!countryFeature) return null;\n  const iso3166Candidate = station.location.city ? `${countryFeature.properties.isoA2}-${station.location.city}` : null;\n  if (iso3166Candidate) {\n    const match = ensureNaturalEarthFeature(\n      regions.features.find((feature) => feature.properties.iso3166_2?.toUpperCase() === iso3166Candidate.toUpperCase()),\n    );\n    if (match) return match;\n  }\n\n  const { lat, lng } = station.location;\n  const countryIso = countryFeature.properties.isoA2?.toUpperCase();\n\n  const fallback = regions.features.find((feature) => {\n      const props = feature.properties;\n      if (countryIso && props.isoA2?.toUpperCase() !== countryIso) {\n        return false;\n      }\n      const candidate = ensureNaturalEarthFeature(feature);\n      if (!candidate) {\n        return false;\n      }\n      const bounds = getBoundsFromFeature(candidate);\n      return isWithinBounds(bounds, lat, lng) && containsPoint(candidate, lat, lng);\n    });\n\n  return ensureNaturalEarthFeature(fallback);\n}\n\nfunction createLocationDetail(\n  country: NaturalEarthFeature | null,\n  region: NaturalEarthFeature | null,\n): WofLocationDetail {\n  if (!country) {\n    return { hierarchy: [], source: \"natural-earth\" };\n  }\n\n  const countryId = hashIdentifier(country.properties.isoA3 || country.properties.name);\n  const hierarchy: WofHierarchyEntry[] = [\n    buildHierarchyEntry(countryId, \"country\", country.properties.name, country),\n  ];\n\n  const detail: WofLocationDetail = {\n    countryId,\n    hierarchy,\n    centroid: country.properties.centroid,\n    bbox: getBoundsFromFeature(country),\n    countryIsoA2: country.properties.isoA2 ?? undefined,\n    countryIsoA3: country.properties.isoA3 ?? undefined,\n    source: \"natural-earth\",\n  };\n\n  if (region) {\n    const regionId = hashIdentifier(region.properties.iso3166_2 || region.properties.name);\n    detail.regionId = regionId;\n    detail.regionIso3166 = region.properties.iso3166_2 ?? undefined;\n    detail.hierarchy.push(buildHierarchyEntry(regionId, \"region\", region.properties.name, region));\n    detail.bbox = getBoundsFromFeature(region);\n    detail.centroid = region.properties.centroid;\n  }\n\n  return detail;\n}\n\nexport async function enrichStationsWithWof(\n  stations: RadioStation[],\n  countries: NaturalEarthCollection,\n  regions: NaturalEarthCollection,\n): Promise<RadioStation[]> {\n  return stations.map((station) => {\n    if (station.location.wof?.source === \"natural-earth\") {\n      return station;\n    }\n\n    const countryFeature = pickCountryFeature(station, countries);\n    const regionFeature = pickRegionFeature(station, regions, countryFeature);\n    const wofDetail = createLocationDetail(countryFeature, regionFeature);\n\n    return {\n      ...station,\n      location: {\n        ...station.location,\n        wof: wofDetail,\n      },\n    };\n  });\n}\n"],"names":["getBoundsFromFeature","feature","minLng","minLat","maxLng","maxLat","bbox","isWithinBounds","bounds","lat","lng","containsPoint","error","console","warn","ensureNaturalEarthFeature","candidate","Array","isArray","length","hashIdentifier","value","hash","index","charCodeAt","Math","abs","buildHierarchyEntry","id","placetype","name","pickCountryFeature","station","countries","isoCandidates","location","countryCode","toUpperCase","filter","Boolean","iso","match","features","find","props","properties","isoA2","isoA3","natural","country","trim","toLowerCase","byName","fallback","pickRegionFeature","regions","countryFeature","iso3166Candidate","city","iso3166_2","countryIso","createLocationDetail","region","hierarchy","source","countryId","detail","centroid","countryIsoA2","undefined","countryIsoA3","regionId","regionIso3166","push","enrichStationsWithWof","stations","map","wof","regionFeature","wofDetail"],"mappings":"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"}},
    {"offset": {"line": 3606, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/services/location/naturalEarthService.ts"],"sourcesContent":["import type { Feature, FeatureCollection, Geometry } from \"geojson\";\n\nexport interface NaturalEarthFeatureProperties {\n  name: string;\n  isoA2?: string | null;\n  isoA3?: string | null;\n  iso3166_2?: string | null;\n  parentA3?: string | null;\n  type?: string | null;\n  population?: number | null;\n  source: \"natural-earth\";\n  centroid: { lat: number; lng: number };\n}\n\nexport type NaturalEarthFeature = Feature<Geometry, NaturalEarthFeatureProperties> & {\n  bbox: [number, number, number, number];\n};\n\nexport type NaturalEarthCollection = FeatureCollection<Geometry, NaturalEarthFeatureProperties> & {\n  features: NaturalEarthFeature[];\n};\n\nconst NATURAL_EARTH_BASE_PATH = \"/naturalearth\";\nconst COUNTRIES_PATH = `${NATURAL_EARTH_BASE_PATH}/admin0-countries.json`;\nconst REGIONS_PATH = `${NATURAL_EARTH_BASE_PATH}/admin1-regions.json`;\n\nlet countryCache: NaturalEarthCollection | null = null;\nlet regionCache: NaturalEarthCollection | null = null;\n\nfunction normalizeCollection(parsed: NaturalEarthCollection): NaturalEarthCollection {\n  return {\n    ...parsed,\n    features: parsed.features ?? [],\n  };\n}\n\nasync function fetchCollection(path: string): Promise<NaturalEarthCollection> {\n  if (typeof window === \"undefined\") {\n    const relative = path.startsWith(\"/\") ? path.slice(1) : path;\n    const [{ readFile }, { join }] = await Promise.all([\n      import(\"node:fs/promises\"),\n      import(\"node:path\"),\n    ]);\n    const absolutePath = join(process.cwd(), \"public\", relative);\n    const contents = await readFile(absolutePath, \"utf8\");\n    const parsed = JSON.parse(contents) as NaturalEarthCollection;\n    return normalizeCollection(parsed);\n  }\n\n  const response = await fetch(path, { cache: \"force-cache\" });\n  if (!response.ok) {\n    throw new Error(`Failed to load Natural Earth data from ${path}: ${response.status} ${response.statusText}`);\n  }\n\n  const parsed = (await response.json()) as NaturalEarthCollection;\n  return normalizeCollection(parsed);\n}\n\nexport async function loadNaturalEarthCountries(): Promise<NaturalEarthCollection> {\n  if (!countryCache) {\n    countryCache = await fetchCollection(COUNTRIES_PATH);\n  }\n  return countryCache;\n}\n\nexport async function loadNaturalEarthRegions(): Promise<NaturalEarthCollection> {\n  if (!regionCache) {\n    regionCache = await fetchCollection(REGIONS_PATH);\n  }\n  return regionCache;\n}\n\nfunction ensureFeature(feature: Feature<Geometry, NaturalEarthFeatureProperties> | null | undefined): NaturalEarthFeature | null {\n  if (!feature) return null;\n  const candidate = feature as NaturalEarthFeature;\n  return Array.isArray(candidate.bbox) && candidate.bbox.length === 4 ? candidate : null;\n}\n\nexport function findCountryFeatureByIso(isoCode: string | null | undefined): NaturalEarthFeature | null {\n  if (!countryCache || !isoCode) return null;\n  const normalized = isoCode.trim().toUpperCase();\n  const byIsoA2 = ensureFeature(\n    countryCache.features.find((feature) => feature.properties.isoA2?.toUpperCase() === normalized),\n  );\n  if (byIsoA2) return byIsoA2;\n\n  return ensureFeature(\n    countryCache.features.find((feature) => feature.properties.isoA3?.toUpperCase() === normalized),\n  );\n}\n\nexport function findRegionFeature(\n  isoA2: string | null | undefined,\n  iso3166_2: string | null | undefined,\n): NaturalEarthFeature | null {\n  if (!regionCache) return null;\n  const inCountry = isoA2 ? isoA2.trim().toUpperCase() : null;\n  const normalizedIso3166 = iso3166_2 ? iso3166_2.trim().toUpperCase() : null;\n\n  const directMatch = ensureFeature(\n    regionCache.features.find((feature) => {\n      const props = feature.properties;\n      if (normalizedIso3166 && props.iso3166_2?.toUpperCase() === normalizedIso3166) {\n        return true;\n      }\n      if (normalizedIso3166 && props.isoA3?.toUpperCase() === normalizedIso3166) {\n        return true;\n      }\n      return false;\n    }),\n  );\n  if (directMatch) return directMatch;\n\n  const fallback = ensureFeature(\n    regionCache.features.find((feature) => {\n      const props = feature.properties;\n      if (inCountry && props.isoA2?.toUpperCase() !== inCountry) {\n        return false;\n      }\n      return true;\n    }),\n  );\n\n  return fallback;\n}\n"],"names":["NATURAL_EARTH_BASE_PATH","COUNTRIES_PATH","REGIONS_PATH","countryCache","regionCache","normalizeCollection","parsed","features","fetchCollection","path","response","fetch","cache","ok","Error","status","statusText","json","loadNaturalEarthCountries","loadNaturalEarthRegions","ensureFeature","feature","candidate","Array","isArray","bbox","length","findCountryFeatureByIso","isoCode","normalized","trim","toUpperCase","byIsoA2","find","properties","isoA2","isoA3","findRegionFeature","iso3166_2","inCountry","normalizedIso3166","directMatch","props","fallback"],"mappings":";;;;;;;;;;AAsBA,MAAMA,0BAA0B;AAChC,MAAMC,iBAAiB,GAAGD,wBAAwB,sBAAsB,CAAC;AACzE,MAAME,eAAe,GAAGF,wBAAwB,oBAAoB,CAAC;AAErE,IAAIG,eAA8C;AAClD,IAAIC,cAA6C;AAEjD,SAASC,oBAAoBC,MAA8B;IACzD,OAAO;QACL,GAAGA,MAAM;QACTC,UAAUD,OAAOC,QAAQ,IAAI,EAAE;IACjC;AACF;AAEA,eAAeC,gBAAgBC,IAAY;IACzC;;IAYA,MAAMC,WAAW,MAAMC,MAAMF,MAAM;QAAEG,OAAO;IAAc;IAC1D,IAAI,CAACF,SAASG,EAAE,EAAE;QAChB,MAAM,IAAIC,MAAM,CAAC,uCAAuC,EAAEL,KAAK,EAAE,EAAEC,SAASK,MAAM,CAAC,CAAC,EAAEL,SAASM,UAAU,EAAE;IAC7G;IAEA,MAAMV,SAAU,MAAMI,SAASO,IAAI;IACnC,OAAOZ,oBAAoBC;AAC7B;AAEO,eAAeY;IACpB,IAAI,CAACf,cAAc;QACjBA,eAAe,MAAMK,gBAAgBP;IACvC;IACA,OAAOE;AACT;AAEO,eAAegB;IACpB,IAAI,CAACf,aAAa;QAChBA,cAAc,MAAMI,gBAAgBN;IACtC;IACA,OAAOE;AACT;AAEA,SAASgB,cAAcC,OAA4E;IACjG,IAAI,CAACA,SAAS,OAAO;IACrB,MAAMC,YAAYD;IAClB,OAAOE,MAAMC,OAAO,CAACF,UAAUG,IAAI,KAAKH,UAAUG,IAAI,CAACC,MAAM,KAAK,IAAIJ,YAAY;AACpF;AAEO,SAASK,wBAAwBC,OAAkC;IACxE,IAAI,CAACzB,gBAAgB,CAACyB,SAAS,OAAO;IACtC,MAAMC,aAAaD,QAAQE,IAAI,GAAGC,WAAW;IAC7C,MAAMC,UAAUZ,cACdjB,aAAaI,QAAQ,CAAC0B,IAAI,CAAC,CAACZ,UAAYA,QAAQa,UAAU,CAACC,KAAK,EAAEJ,kBAAkBF;IAEtF,IAAIG,SAAS,OAAOA;IAEpB,OAAOZ,cACLjB,aAAaI,QAAQ,CAAC0B,IAAI,CAAC,CAACZ,UAAYA,QAAQa,UAAU,CAACE,KAAK,EAAEL,kBAAkBF;AAExF;AAEO,SAASQ,kBACdF,KAAgC,EAChCG,SAAoC;IAEpC,IAAI,CAAClC,aAAa,OAAO;IACzB,MAAMmC,YAAYJ,QAAQA,MAAML,IAAI,GAAGC,WAAW,KAAK;IACvD,MAAMS,oBAAoBF,YAAYA,UAAUR,IAAI,GAAGC,WAAW,KAAK;IAEvE,MAAMU,cAAcrB,cAClBhB,YAAYG,QAAQ,CAAC0B,IAAI,CAAC,CAACZ;QACzB,MAAMqB,QAAQrB,QAAQa,UAAU;QAChC,IAAIM,qBAAqBE,MAAMJ,SAAS,EAAEP,kBAAkBS,mBAAmB;YAC7E,OAAO;QACT;QACA,IAAIA,qBAAqBE,MAAMN,KAAK,EAAEL,kBAAkBS,mBAAmB;YACzE,OAAO;QACT;QACA,OAAO;IACT;IAEF,IAAIC,aAAa,OAAOA;IAExB,MAAME,WAAWvB,cACfhB,YAAYG,QAAQ,CAAC0B,IAAI,CAAC,CAACZ;QACzB,MAAMqB,QAAQrB,QAAQa,UAAU;QAChC,IAAIK,aAAaG,MAAMP,KAAK,EAAEJ,kBAAkBQ,WAAW;YACzD,OAAO;QACT;QACA,OAAO;IACT;IAGF,OAAOI;AACT"}},
    {"offset": {"line": 3694, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/services/radioDiscoveryService.ts"],"sourcesContent":["import { RadioStation } from \"../types\";\nimport {\n  buildCityIndex,\n  buildCountryIndex,\n  buildGenreIndex,\n  distributeStationsByCountry,\n  filterStationsByCity,\n  filterStationsByCountry,\n  filterStationsByTag,\n  searchStationsInCache,\n  summarizeCountries,\n  summarizeTags,\n} from \"./stationCacheHelpers\";\nimport { enrichStationsWithWof } from \"./location/wofEnrichmentService\";\nimport { loadNaturalEarthCountries, loadNaturalEarthRegions } from \"./location/naturalEarthService\";\n\ninterface CachedStations {\n  data: RadioStation[];\n  timestamp: number;\n  source: \"file\" | \"fallback\" | \"api\";\n}\n\ninterface CatalogMeta {\n  total: number;\n  version: string | null;\n  generatedAt: number | null;\n}\n\ntype CacheKey = \"all\" |\n  `country:${string}` |\n  `genre:${string}` |\n  `city:${string}` |\n  `tag:${string}` |\n  `search:${string}` |\n  `region:${string}` |\n  `top:${number}` |\n  `progressive:${number}` |\n  `global_distributed`;\n\nfunction resolveApiUrl(path: string): string {\n  if (typeof window !== \"undefined\") {\n    return path;\n  }\n\n  const envBase = process.env.NEXT_PUBLIC_APP_URL\n    || process.env.NEXT_PUBLIC_SITE_URL\n    || process.env.NEXTAUTH_URL\n    || (process.env.VERCEL_URL ? `https://${process.env.VERCEL_URL}` : undefined);\n\n  const fallbackBase = `http://localhost:${process.env.PORT ?? \"3000\"}`;\n  const base = envBase ?? fallbackBase;\n  const normalizedBase = base.includes(\"://\") ? base : `http://${base}`;\n  return new URL(path, normalizedBase).toString();\n}\n\n/**\n * Radio discovery service that favours our server-side JSON cache before hitting the public API.\n * This reduces latency, avoids rate limits, and keeps the UI snappy even with large datasets.\n */\nexport class RadioDiscoveryService {\n  private readonly cache = new Map<CacheKey, CachedStations>();\n  private readonly meta = new Map<string, CatalogMeta>();\n  private readonly cacheExpiryMs = 5 * 60 * 1000;\n  private readonly cacheWarmupPromise: Promise<void>;\n  private hydrated = false;\n\n  constructor() {\n    this.cacheWarmupPromise = this.hydrateFromServerCache();\n  }\n\n  /**\n   * Get ALL stations from server-side cache (JSON file)\n   */\n  async getAllStations(): Promise<RadioStation[]> {\n    await this.cacheWarmupPromise;\n    const cached = this.cache.get(\"all\");\n    if (cached) {\n      return cached.data;\n    }\n    return this.getFallbackStations();\n  }\n\n  /**\n   * Force refresh the server cache\n   */\n  async refreshCache(): Promise<void> {\n    try {\n      const response = await fetch(resolveApiUrl(\"/api/stations/refresh\"), {\n        method: \"POST\",\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to trigger cache refresh\");\n      }\n\n      await this.hydrateFromServerCache(true);\n    } catch (error) {\n      console.warn(\"Failed to refresh cache:\", error);\n    }\n  }\n\n  /**\n   * Search radio stations from Radio Browser API\n   */\n  async searchOnlineStations(\n    query: string,\n    limit: number = 50,\n  ): Promise<RadioStation[]> {\n    await this.cacheWarmupPromise;\n    const cacheKey = `search:${query.toLowerCase()}` as CacheKey;\n    const cached = this.getFromCache(cacheKey);\n    if (cached) {\n      return cached.slice(0, limit);\n    }\n\n    const stations = searchStationsInCache(this.getAllCachedStations(), query);\n    this.setCache(cacheKey, stations);\n    return stations.slice(0, limit);\n  }\n\n  /**\n   * Get stations by country from Radio Browser API\n   */\n  async getStationsByCountry(\n    country: string,\n    limit: number = 100,\n  ): Promise<RadioStation[]> {\n    await this.cacheWarmupPromise;\n    const normalized = this.normalizeCountryKey(country);\n    const cacheKey = `country:${normalized}` as CacheKey;\n    const cached = this.getFromCache(cacheKey);\n    const base = cached || filterStationsByCountry(this.getAllCachedStations(), normalized);\n    this.setCache(cacheKey, base);\n    return base.slice(0, limit);\n  }\n\n  /**\n   * Get top stations globally with country-based distribution\n   */\n  async getTopStations(limit: number = 5000): Promise<RadioStation[]> {\n    await this.cacheWarmupPromise;\n    const cacheKey = `top:${limit}` as CacheKey;\n    const cached = this.getFromCache(cacheKey);\n    if (cached) {\n      return cached;\n    }\n\n    const sorted = this.getAllCachedStations()\n      .slice()\n      .sort((a, b) => (b.listeners || 0) - (a.listeners || 0));\n\n    const result = sorted.slice(0, limit);\n    this.setCache(cacheKey, result);\n    return result;\n  }\n\n  /**\n   * Load stations with geographic distribution for better global coverage\n   */\n  async getGlobalStationsWithDistribution(): Promise<RadioStation[]> {\n    await this.cacheWarmupPromise;\n    const cacheKey = \"global_distributed\" as CacheKey;\n    const cached = this.getFromCache(cacheKey);\n    if (cached) return cached;\n\n    const distributed = distributeStationsByCountry(this.getAllCachedStations(), 5000);\n\n    this.setCache(cacheKey, distributed);\n    return distributed;\n  }\n\n  /**\n   * Get stations within a geographic region\n   */\n  async getStationsByRegion(\n    bounds: {\n      north: number;\n      south: number;\n      east: number;\n      west: number;\n    },\n    limit: number = 500\n  ): Promise<RadioStation[]> {\n    const cacheKey = `region:${bounds.north}:${bounds.south}:${bounds.east}:${bounds.west}:${limit}` as CacheKey;\n    const cached = this.getFromCache(cacheKey);\n    if (cached) return cached.slice(0, limit);\n\n    try {\n      // Radio Browser doesn't have direct geographic bounds API, so we'll get by popular countries in region\n      const countriesInRegion = this.getCountriesInBounds(bounds);\n      const allStations: RadioStation[] = [];\n\n      for (const country of countriesInRegion) {\n        const countryStations = await this.getStationsByCountry(country, Math.floor(limit / countriesInRegion.length));\n        allStations.push(...countryStations);\n      }\n\n      // Filter stations that are actually within bounds\n      const stationsInBounds = allStations.filter(station => \n        station.location.lat >= bounds.south &&\n        station.location.lat <= bounds.north &&\n        station.location.lng >= bounds.west &&\n        station.location.lng <= bounds.east\n      );\n\n      this.setCache(cacheKey, stationsInBounds);\n      return stationsInBounds.slice(0, limit);\n    } catch (error) {\n      console.warn(\"Failed to fetch regional stations:\", error);\n      return [];\n    }\n  }\n\n  /**\n   * Get progressive stations based on zoom level\n   */\n  async getProgressiveStations(\n    zoomLevel: number,\n    visibleRegion?: {\n      north: number;\n      south: number; \n      east: number;\n      west: number;\n    }\n  ): Promise<RadioStation[]> {\n    // Adjust station count based on zoom level\n    const stationCount = Math.min(2000, Math.max(100, Math.floor(zoomLevel * 300)));\n\n    if (visibleRegion && zoomLevel > 3) {\n      // High zoom - get regional stations\n      return this.getStationsByRegion(visibleRegion, stationCount);\n    } else {\n      // Low zoom - get global top stations\n      return this.getTopStations(stationCount);\n    }\n  }\n\n  /**\n   * Get stations by tag/genre\n   */\n  async getStationsByTag(\n    tag: string,\n    limit: number = 50,\n  ): Promise<RadioStation[]> {\n    const normalized = tag.trim().toLowerCase();\n    const cacheKey = `tag:${normalized}` as CacheKey;\n    const cached = this.getFromCache(cacheKey);\n    if (cached) return cached.slice(0, limit);\n\n    const sorted = filterStationsByTag(this.getAllCachedStations(), normalized);\n    this.setCache(cacheKey, sorted);\n    return sorted.slice(0, limit);\n  }\n\n  /**\n   * Get stations by city from Radio Browser API\n   */\n  async getStationsByCity(\n    city: string,\n    limit: number = 50,\n  ): Promise<RadioStation[]> {\n    const normalized = city.trim().toLowerCase();\n    const cacheKey = `city:${normalized}` as CacheKey;\n    const cached = this.getFromCache(cacheKey);\n    if (cached) return cached.slice(0, limit);\n\n    const sorted = filterStationsByCity(this.getAllCachedStations(), normalized);\n    this.setCache(cacheKey, sorted);\n    return sorted.slice(0, limit);\n  }\n\n  /**\n   * Get available countries\n   */\n  async getCountries(): Promise<\n    Array<{ name: string; iso: string; stationcount: number }>\n  > {\n    await this.cacheWarmupPromise;\n    return summarizeCountries(this.getAllCachedStations());\n  }\n\n  /**\n   * Get available tags/genres\n   */\n  async getTags(): Promise<Array<{ name: string; stationcount: number }>> {\n    await this.cacheWarmupPromise;\n    return summarizeTags(this.getAllCachedStations());\n  }\n\n  /**\n   * Map Radio Browser API response to our RadioStation format\n   */\n  private mapRadioBrowserStations(data: any[]): RadioStation[] {\n    return data\n      .filter((station) => station.url && station.name)\n      .map((station, index) => {\n        let lat = parseFloat(station.geo_lat) || 0;\n        let lng = parseFloat(station.geo_long) || 0;\n\n        // If no coordinates, assign default location based on country\n        if (lat === 0 && lng === 0) {\n          const defaultCoords = this.getDefaultCountryCoordinates(\n            station.country,\n          );\n          lat = defaultCoords.lat + (Math.random() - 0.5) * 2; // Add small random offset\n          lng = defaultCoords.lng + (Math.random() - 0.5) * 2;\n        }\n\n        return {\n          id: station.stationuuid || `station-${index}`,\n          name: station.name || \"Unknown Station\",\n          url: station.url,\n          location: {\n            city: station.state || \"Unknown\",\n            country: station.country || \"Unknown\",\n            countryCode: station.countrycode || undefined,\n            lat,\n            lng,\n          },\n          genre: station.tags || station.genre || \"Various\",\n          language: station.language || \"Unknown\",\n          listeners: station.clickcount || 0,\n          bitrate: station.bitrate || 128,\n          description: station.homepage || \"\",\n          isPublic: true,\n          source: \"radio-browser\" as const,\n        };\n      })\n      .filter(\n        (station) => station.location.lat !== 0 || station.location.lng !== 0,\n      ); // Filter out stations without coordinates\n  }\n\n  /**\n   * Cache management\n   */\n  private wrap(data: RadioStation[], source: CachedStations[\"source\"]): CachedStations {\n    return {\n      data,\n      timestamp: Date.now(),\n      source,\n    };\n  }\n\n  private getAllCachedStations(): RadioStation[] {\n    return this.cache.get(\"all\")?.data || [];\n  }\n\n  private getFromCache(key: CacheKey): RadioStation[] | null {\n    const cached = this.cache.get(key);\n    if (!cached) return null;\n    if (Date.now() - cached.timestamp > this.cacheExpiryMs) {\n      this.cache.delete(key);\n      return null;\n    }\n    return cached.data;\n  }\n\n  private setCache(key: CacheKey, data: RadioStation[], source: CachedStations[\"source\"] = \"file\"): void {\n    this.cache.set(key, this.wrap(data, source));\n  }\n\n  private async hydrateFromServerCache(force = false): Promise<void> {\n    if (this.hydrated && !force) return;\n\n    const [countries, regions] = await Promise.all([\n      loadNaturalEarthCountries(),\n      loadNaturalEarthRegions(),\n    ]);\n\n    try {\n      const response = await fetch(resolveApiUrl(\"/api/stations\"));\n      if (!response.ok) {\n        throw new Error(\"Failed to fetch stations from cache API\");\n      }\n\n      const payload = await response.json();\n      const mappedStations = this.mapRadioBrowserStations(payload.stations || []);\n      const stations = await enrichStationsWithWof(mappedStations, countries, regions);\n      this.setCache(\"all\", stations, payload.cached ? \"file\" : \"api\");\n      this.meta.set(\"all\", {\n        total: stations.length,\n        version: payload.version ?? null,\n        generatedAt: payload.timestamp ?? null,\n      });\n\n      // Precompute indexes for quicker lookups\n      this.indexCountries(stations);\n      this.indexGenres(stations);\n      this.indexCities(stations);\n\n      this.hydrated = true;\n    } catch (error) {\n      console.warn(\"Failed to hydrate cache:\", error);\n      const fallback = await enrichStationsWithWof(this.getFallbackStations(), countries, regions);\n      this.setCache(\"all\", fallback, \"fallback\");\n    }\n  }\n\n  private indexCountries(stations: RadioStation[]): void {\n    const countryIndex = buildCountryIndex(stations);\n    countryIndex.forEach((list, key) => {\n      this.setCache(`country:${key}` as CacheKey, list);\n    });\n  }\n\n  private indexGenres(stations: RadioStation[]): void {\n    const genreIndex = buildGenreIndex(stations);\n    genreIndex.forEach((list, key) => {\n      this.setCache(`genre:${key}` as CacheKey, list);\n      this.setCache(`tag:${key}` as CacheKey, list);\n    });\n  }\n\n  private indexCities(stations: RadioStation[]): void {\n    const cityIndex = buildCityIndex(stations);\n    cityIndex.forEach((list, key) => {\n      this.setCache(`city:${key}` as CacheKey, list);\n    });\n  }\n\n  /**\n   * Get default coordinates for a country\n   */\n  private getDefaultCountryCoordinates(country: string): {\n    lat: number;\n    lng: number;\n  } {\n    const countryDefaults: { [key: string]: { lat: number; lng: number } } = {\n      Germany: { lat: 51.1657, lng: 10.4515 },\n      \"United States\": { lat: 39.8283, lng: -98.5795 },\n      USA: { lat: 39.8283, lng: -98.5795 },\n      \"United Kingdom\": { lat: 55.3781, lng: -3.436 },\n      UK: { lat: 55.3781, lng: -3.436 },\n      France: { lat: 46.2276, lng: 2.2137 },\n      Italy: { lat: 41.8719, lng: 12.5674 },\n      Spain: { lat: 40.4637, lng: -3.7492 },\n      Canada: { lat: 56.1304, lng: -106.3468 },\n      Australia: { lat: -25.2744, lng: 133.7751 },\n      Japan: { lat: 36.2048, lng: 138.2529 },\n      Brazil: { lat: -14.235, lng: -51.9253 },\n      Netherlands: { lat: 52.1326, lng: 5.2913 },\n      Austria: { lat: 47.5162, lng: 14.5501 },\n      Switzerland: { lat: 46.8182, lng: 8.2275 },\n    };\n\n    return countryDefaults[country] || { lat: 0, lng: 0 };\n  }\n\n  /**\n   * Calculate distance between two coordinates\n   */\n  private calculateDistance(\n    lat1: number,\n    lon1: number,\n    lat2: number,\n    lon2: number,\n  ): number {\n    const R = 6371; // Earth's radius in kilometers\n    const dLat = ((lat2 - lat1) * Math.PI) / 180;\n    const dLon = ((lon2 - lon1) * Math.PI) / 180;\n    const a =\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n      Math.cos((lat1 * Math.PI) / 180) *\n        Math.cos((lat2 * Math.PI) / 180) *\n        Math.sin(dLon / 2) *\n        Math.sin(dLon / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    return R * c;\n  }\n\n  /**\n   * Get countries that intersect with geographic bounds\n   */\n  private getCountriesInBounds(bounds: {\n    north: number;\n    south: number;\n    east: number;\n    west: number;\n  }): string[] {\n    // Simplified region to country mapping\n    const allCountries = [\n      \"United States\", \"Canada\", \"Mexico\", \"Brazil\", \"Argentina\", \"Chile\",\n      \"United Kingdom\", \"France\", \"Germany\", \"Italy\", \"Spain\", \"Netherlands\",\n      \"Russia\", \"China\", \"Japan\", \"South Korea\", \"India\", \"Australia\",\n      \"South Africa\", \"Egypt\", \"Nigeria\", \"Kenya\"\n    ];\n\n    // For now, return all major countries. In a real implementation,\n    // you'd have a proper geographic database\n    return allCountries.slice(0, 8);\n  }\n\n  /**\n   * Get fallback stations when API fails\n   */\n  private getFallbackStations(): RadioStation[] {\n    // Return a small set of popular global stations as fallback\n    return [\n      {\n        id: \"fallback-bbc1\",\n        name: \"BBC Radio 1\",\n        url: \"http://stream.live.vc.bbcmedia.co.uk/bbc_radio_one\",\n        location: { city: \"London\", country: \"United Kingdom\", lat: 51.5074, lng: -0.1278 },\n        genre: \"Pop\",\n        language: \"English\",\n        listeners: 1000000,\n        source: \"curated\" as const\n      },\n      {\n        id: \"fallback-npr\",\n        name: \"NPR News\",\n        url: \"https://npr-ice.streamguys1.com/live.mp3\",\n        location: { city: \"Washington DC\", country: \"United States\", lat: 38.9072, lng: -77.0369 },\n        genre: \"News\",\n        language: \"English\", \n        listeners: 500000,\n        source: \"curated\" as const\n      }\n    ];\n  }\n\n  private normalizeCountryKey(country: string): string {\n    return country.trim().toLowerCase();\n  }\n}\n\n// Singleton instance\nexport const radioDiscoveryService = new RadioDiscoveryService();\n"],"names":["resolveApiUrl","path","envBase","fallbackBase","base","normalizedBase","RadioDiscoveryService","cache","Map","meta","cacheExpiryMs","cacheWarmupPromise","hydrated","hydrateFromServerCache","getAllStations","cached","get","data","getFallbackStations","refreshCache","response","fetch","method","ok","Error","error","console","warn","searchOnlineStations","query","limit","cacheKey","toLowerCase","getFromCache","slice","stations","getAllCachedStations","setCache","getStationsByCountry","country","normalized","normalizeCountryKey","getTopStations","sorted","sort","a","b","listeners","result","getGlobalStationsWithDistribution","distributed","getStationsByRegion","bounds","north","south","east","west","countriesInRegion","getCountriesInBounds","allStations","countryStations","Math","floor","length","push","stationsInBounds","filter","station","location","lat","lng","getProgressiveStations","zoomLevel","visibleRegion","stationCount","min","max","getStationsByTag","tag","trim","getStationsByCity","city","getCountries","getTags","mapRadioBrowserStations","url","name","map","index","parseFloat","geo_lat","geo_long","defaultCoords","getDefaultCountryCoordinates","random","id","stationuuid","state","countryCode","countrycode","undefined","genre","tags","language","clickcount","bitrate","description","homepage","isPublic","source","wrap","timestamp","Date","now","key","delete","set","force","countries","regions","Promise","all","payload","json","mappedStations","total","version","generatedAt","indexCountries","indexGenres","indexCities","fallback","countryIndex","forEach","list","genreIndex","cityIndex","countryDefaults","Germany","USA","UK","France","Italy","Spain","Canada","Australia","Japan","Brazil","Netherlands","Austria","Switzerland","calculateDistance","lat1","lon1","lat2","lon2","R","dLat","PI","dLon","sin","cos","c","atan2","sqrt","allCountries","radioDiscoveryService"],"mappings":"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"}},
    {"offset": {"line": 4138, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/repositories/StationRepository.ts"],"sourcesContent":["import { IStationRepository } from \"../domain/interfaces\";\nimport { RadioStation } from \"../types\";\nimport { radioDiscoveryService } from \"../services/radioDiscoveryService\";\n\n/**\n * Concrete implementation of station repository using radioDiscoveryService\n * Follows Repository pattern to abstract data access\n */\nexport class StationRepository implements IStationRepository {\n  private cache = new Map<string, RadioStation[]>();\n  private readonly cacheTimeout = 5 * 60 * 1000; // 5 minutes\n  private cacheTimestamps = new Map<string, number>();\n\n  async getStationsByRegion(region: string): Promise<RadioStation[]> {\n    const cacheKey = `region:${region}`;\n    \n    if (this.isValidCache(cacheKey)) {\n      return this.cache.get(cacheKey) || [];\n    }\n\n    try {\n      // For better distribution, get diverse global stations\n      const stations = await radioDiscoveryService.getGlobalStationsWithDistribution();\n      this.updateCache(cacheKey, stations);\n      return stations;\n    } catch (error) {\n      console.error(`Failed to fetch stations for region ${region}:`, error);\n      return this.cache.get(cacheKey) || [];\n    }\n  }\n\n  async getGlobalStationsWithDistribution(): Promise<RadioStation[]> {\n    const cacheKey = 'global_distribution';\n    \n    if (this.isValidCache(cacheKey)) {\n      return this.cache.get(cacheKey) || [];\n    }\n\n    try {\n      // Use the new getAllStations method with IndexedDB caching\n      const stations = await radioDiscoveryService.getAllStations();\n      this.updateCache(cacheKey, stations);\n      console.log(`StationRepository: Loaded ${stations.length} stations`);\n      return stations;\n    } catch (error) {\n      console.error('Failed to fetch all stations:', error);\n      // Try cache first before falling back\n      const cached = this.cache.get(cacheKey);\n      if (cached) return cached;\n      \n      // Last resort fallback\n      const fallback = await radioDiscoveryService.getTopStations(5000);\n      this.updateCache(cacheKey, fallback);\n      return fallback;\n    }\n  }\n\n  async getStationsByCountry(country: string): Promise<RadioStation[]> {\n    const cacheKey = `country:${country}`;\n    \n    if (this.isValidCache(cacheKey)) {\n      return this.cache.get(cacheKey) || [];\n    }\n\n    try {\n      const stations = await radioDiscoveryService.getStationsByCountry(country);\n      this.updateCache(cacheKey, stations);\n      return stations;\n    } catch (error) {\n      console.error(`Failed to fetch stations for country ${country}:`, error);\n      return this.cache.get(cacheKey) || [];\n    }\n  }\n\n  async getStationsByGenre(genre: string): Promise<RadioStation[]> {\n    const cacheKey = `genre:${genre}`;\n    \n    if (this.isValidCache(cacheKey)) {\n      return this.cache.get(cacheKey) || [];\n    }\n\n    try {\n      const stations = await radioDiscoveryService.getStationsByTag(genre);\n      this.updateCache(cacheKey, stations);\n      return stations;\n    } catch (error) {\n      console.error(`Failed to fetch stations for genre ${genre}:`, error);\n      return this.cache.get(cacheKey) || [];\n    }\n  }\n\n  async searchStations(query: string): Promise<RadioStation[]> {\n    const cacheKey = `search:${query.toLowerCase()}`;\n    \n    if (this.isValidCache(cacheKey)) {\n      return this.cache.get(cacheKey) || [];\n    }\n\n    try {\n      const stations = await radioDiscoveryService.searchOnlineStations(query);\n      this.updateCache(cacheKey, stations);\n      return stations;\n    } catch (error) {\n      console.error(`Failed to search stations for query ${query}:`, error);\n      return this.cache.get(cacheKey) || [];\n    }\n  }\n\n  async getProgressiveStations(limit: number, offset: number): Promise<RadioStation[]> {\n    const cacheKey = `progressive:${limit}:${offset}`;\n    \n    if (this.isValidCache(cacheKey)) {\n      return this.cache.get(cacheKey) || [];\n    }\n\n    try {\n      // Use zoomLevel calculation based on limit for progressive loading\n      const zoomLevel = Math.max(1, Math.floor(limit / 100));\n      const stations = await radioDiscoveryService.getProgressiveStations(zoomLevel);\n      \n      // Apply offset and limit manually since the service doesn't support it directly\n      const paginatedStations = stations.slice(offset, offset + limit);\n      \n      this.updateCache(cacheKey, paginatedStations);\n      return paginatedStations;\n    } catch (error) {\n      console.error(`Failed to fetch progressive stations:`, error);\n      return this.cache.get(cacheKey) || [];\n    }\n  }\n\n  async getPopularStations(limit: number = 50): Promise<RadioStation[]> {\n    const cacheKey = `popular:${limit}`;\n    \n    if (this.isValidCache(cacheKey)) {\n      return this.cache.get(cacheKey) || [];\n    }\n\n    try {\n      const stations = await radioDiscoveryService.getTopStations(limit);\n      this.updateCache(cacheKey, stations);\n      return stations;\n    } catch (error) {\n      console.error(`Failed to fetch popular stations:`, error);\n      return this.cache.get(cacheKey) || [];\n    }\n  }\n\n  /**\n   * Clear cache for specific key or all cache\n   */\n  clearCache(key?: string): void {\n    if (key) {\n      this.cache.delete(key);\n      this.cacheTimestamps.delete(key);\n    } else {\n      this.cache.clear();\n      this.cacheTimestamps.clear();\n    }\n  }\n\n  /**\n   * Get cache statistics for monitoring\n   */\n  getCacheStats(): { size: number; keys: string[] } {\n    return {\n      size: this.cache.size,\n      keys: Array.from(this.cache.keys())\n    };\n  }\n\n  private isValidCache(key: string): boolean {\n    const timestamp = this.cacheTimestamps.get(key);\n    if (!timestamp) return false;\n    \n    const now = Date.now();\n    return (now - timestamp) < this.cacheTimeout;\n  }\n\n  private updateCache(key: string, data: RadioStation[]): void {\n    this.cache.set(key, data);\n    this.cacheTimestamps.set(key, Date.now());\n  }\n}\n\n// Export singleton instance\nexport const stationRepository = new StationRepository();"],"names":["StationRepository","cache","Map","cacheTimeout","cacheTimestamps","getStationsByRegion","region","cacheKey","isValidCache","get","stations","getGlobalStationsWithDistribution","updateCache","error","console","getAllStations","log","length","cached","fallback","getTopStations","getStationsByCountry","country","getStationsByGenre","genre","getStationsByTag","searchStations","query","toLowerCase","searchOnlineStations","getProgressiveStations","limit","offset","zoomLevel","Math","max","floor","paginatedStations","slice","getPopularStations","clearCache","key","delete","clear","getCacheStats","size","keys","Array","from","timestamp","now","Date","data","set","stationRepository"],"mappings":"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"}},
    {"offset": {"line": 4299, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/infrastructure/ServiceContainer.ts"],"sourcesContent":["import { IStationLoadingUseCase, IStationSelectionUseCase } from \"../domain/usecases\";\nimport { StationLoadingUseCase, StationSelectionUseCase } from \"../usecases/StationUseCases\";\nimport { MarkerFactory } from \"../strategies/MarkerStrategy\";\nimport { StationRepository } from \"../repositories/StationRepository\";\nimport { GlobeEventBus } from \"../events/GlobeEventBus\";\nimport { CommandInvoker } from \"../commands/GlobeCommands\";\n\n/**\n * Dependency Injection Container\n * Manages service instances and their dependencies using Singleton pattern\n * Implements Inversion of Control (IoC) principle\n */\nclass ServiceContainer {\n  private static instance: ServiceContainer;\n  private services = new Map<string, any>();\n  private singletons = new Map<string, any>();\n\n  private constructor() {\n    this.registerServices();\n  }\n\n  static getInstance(): ServiceContainer {\n    if (!ServiceContainer.instance) {\n      ServiceContainer.instance = new ServiceContainer();\n    }\n    return ServiceContainer.instance;\n  }\n\n  private registerServices(): void {\n    // Register Repositories (Singleton)\n    this.registerSingleton(\"StationRepository\", () => new StationRepository());\n    \n    // Register Event Bus (Singleton)\n    this.registerSingleton(\"GlobeEventBus\", () => new GlobeEventBus());\n    \n    // Register Command Invoker (Singleton)\n    this.registerSingleton(\"CommandInvoker\", () => new CommandInvoker());\n    \n    // Register Use Cases (Factory - new instance each time)\n    this.register(\"StationLoadingUseCase\", () => \n      new StationLoadingUseCase(\n        this.resolveSingleton(\"StationRepository\"),\n        this.resolveSingleton(\"GlobeEventBus\")\n      )\n    );\n    \n    this.register(\"StationSelectionUseCase\", () => \n      new StationSelectionUseCase(\n        this.resolveSingleton(\"GlobeEventBus\"),\n        this.resolveSingleton(\"CommandInvoker\")\n      )\n    );\n    \n    // Register Factories (Factory - new instance each time)\n    this.register(\"MarkerFactory\", () => new MarkerFactory());\n  }\n\n  /**\n   * Register a factory function for transient services (new instance each time)\n   */\n  register<T>(key: string, factory: () => T): void {\n    this.services.set(key, factory);\n  }\n\n  /**\n   * Register a factory function for singleton services (same instance always)\n   */\n  registerSingleton<T>(key: string, factory: () => T): void {\n    this.services.set(key, factory);\n  }\n\n  /**\n   * Resolve a transient service (new instance each time)\n   */\n  resolve<T>(key: string): T {\n    const factory = this.services.get(key);\n    if (!factory) {\n      throw new Error(`Service ${key} not registered`);\n    }\n    return factory();\n  }\n\n  /**\n   * Resolve a singleton service (cached instance)\n   */\n  resolveSingleton<T>(key: string): T {\n    // Check if already instantiated\n    if (this.singletons.has(key)) {\n      return this.singletons.get(key);\n    }\n\n    // Create and cache instance\n    const factory = this.services.get(key);\n    if (!factory) {\n      throw new Error(`Service ${key} not registered`);\n    }\n    \n    const instance = factory();\n    this.singletons.set(key, instance);\n    return instance;\n  }\n\n  /**\n   * Clear all singleton instances (useful for testing)\n   */\n  clearSingletons(): void {\n    this.singletons.clear();\n  }\n\n  /**\n   * Get service registry information\n   */\n  getServiceInfo(): { \n    registeredServices: string[]; \n    activeSingletons: string[];\n    totalServices: number;\n  } {\n    return {\n      registeredServices: Array.from(this.services.keys()),\n      activeSingletons: Array.from(this.singletons.keys()),\n      totalServices: this.services.size\n    };\n  }\n\n  // Legacy methods for backward compatibility\n  get<T>(key: string): T {\n    if (this.services.has(key)) {\n      return this.resolve(key);\n    }\n    throw new Error(`Service ${key} not found`);\n  }\n\n  // Convenience methods for common services\n  getStationLoadingUseCase(): IStationLoadingUseCase {\n    return this.resolve(\"StationLoadingUseCase\");\n  }\n\n  getStationSelectionUseCase(): IStationSelectionUseCase {\n    return this.resolve(\"StationSelectionUseCase\");\n  }\n\n  getMarkerFactory(): MarkerFactory {\n    return this.resolve(\"MarkerFactory\");\n  }\n\n  getStationRepository(): StationRepository {\n    return this.resolveSingleton(\"StationRepository\");\n  }\n\n  getGlobeEventBus(): GlobeEventBus {\n    return this.resolveSingleton(\"GlobeEventBus\");\n  }\n\n  getCommandInvoker(): CommandInvoker {\n    return this.resolveSingleton(\"CommandInvoker\");\n  }\n}\n\n// Export factory functions for clean dependency injection\nexport const createStationLoadingUseCase = (): IStationLoadingUseCase => \n  ServiceContainer.getInstance().getStationLoadingUseCase();\n\nexport const createStationSelectionUseCase = (): IStationSelectionUseCase =>\n  ServiceContainer.getInstance().getStationSelectionUseCase();\n\nexport const createMarkerFactory = (): MarkerFactory =>\n  ServiceContainer.getInstance().getMarkerFactory();\n\nexport const createStationRepository = (): StationRepository =>\n  ServiceContainer.getInstance().getStationRepository();\n\nexport const createGlobeEventBus = (): GlobeEventBus => {\n  const eventBus = ServiceContainer.getInstance().getGlobeEventBus();\n  console.log('ServiceContainer: Creating/returning GlobeEventBus instance:', eventBus);\n  return eventBus;\n}\n\nexport const createCommandInvoker = (): CommandInvoker =>\n  ServiceContainer.getInstance().getCommandInvoker();"],"names":["ServiceContainer","instance","services","Map","singletons","registerServices","getInstance","registerSingleton","register","resolveSingleton","key","factory","set","resolve","get","Error","has","clearSingletons","clear","getServiceInfo","registeredServices","Array","from","keys","activeSingletons","totalServices","size","getStationLoadingUseCase","getStationSelectionUseCase","getMarkerFactory","getStationRepository","getGlobeEventBus","getCommandInvoker","createStationLoadingUseCase","createStationSelectionUseCase","createMarkerFactory","createStationRepository","createGlobeEventBus","eventBus","console","log","createCommandInvoker"],"mappings":"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"}},
    {"offset": {"line": 4446, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/components/ClusteredStationMarkers.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRef, useMemo, useState, useEffect } from \"react\";\nimport { useFrame, useThree } from \"@react-three/fiber\";\nimport { Text } from \"@react-three/drei\";\nimport * as THREE from \"three\";\nimport { MarkerData } from \"../strategies/MarkerStrategy\";\nimport { createStationLoadingUseCase, createStationSelectionUseCase, createMarkerFactory } from \"../infrastructure/ServiceContainer\";\n\nexport function ClusteredStationMarkers() {\n  const markersRef = useRef<THREE.Group>(null);\n  const { camera } = useThree();\n  \n  // Use cases (clean architecture) - memoized to prevent infinite loops\n  const stationLoadingUseCase = useMemo(() => createStationLoadingUseCase(), []);\n  const stationSelectionUseCase = useMemo(() => createStationSelectionUseCase(), []);\n  const markerFactory = useMemo(() => createMarkerFactory(), []);\n\n  // Local state\n  const [markers, setMarkers] = useState<MarkerData[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [hoveredMarkerId, setHoveredMarkerId] = useState<string | null>(null);\n\n  // Calculate camera distance and zoom level - throttled to prevent constant updates\n  const [cameraDistance, setCameraDistance] = useState(4);\n  const [zoomLevel, setZoomLevel] = useState(1);\n  \n  // Throttled camera distance calculation\n  useEffect(() => {\n    const updateCameraDistance = () => {\n      const distance = camera.position.length();\n      const zoom = Math.max(1, 8 - distance);\n      const roundedZoom = Math.round(zoom * 2) / 2; // Round to nearest 0.5\n      \n      setCameraDistance(distance);\n      if (Math.abs(roundedZoom - zoomLevel) > 0.25) {\n        setZoomLevel(roundedZoom);\n      }\n    };\n    \n    const interval = setInterval(updateCameraDistance, 500); // Update every 500ms\n    return () => clearInterval(interval);\n  }, [camera, zoomLevel]);\n\n\n\n  // Load markers based on zoom level\n  useEffect(() => {\n    const loadMarkers = async () => {\n      setIsLoading(true);\n      try {\n        const newMarkers = await stationLoadingUseCase.loadStationsForView(zoomLevel);\n        setMarkers(newMarkers);\n      } catch (error) {\n        console.error('Failed to load markers:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadMarkers();\n  }, [zoomLevel, stationLoadingUseCase]);\n\n  // Handle marker interactions\n  const handleMarkerClick = (markerData: MarkerData, event: any) => {\n    event.stopPropagation();\n    \n    const { strategy } = markerFactory.createMarker(markerData, cameraDistance);\n    strategy.handleInteraction(markerData, 'click');\n  };\n\n  const handleMarkerHover = (markerId: string | null) => {\n    setHoveredMarkerId(markerId);\n  };\n\n  // Update marker facing direction\n  useFrame(() => {\n    if (!markersRef.current) return;\n\n    markersRef.current.children.forEach((marker) => {\n      if (marker.children.length > 0) {\n        marker.children.forEach(child => {\n          if (child.type === 'Mesh') {\n            child.lookAt(camera.position);\n          }\n        });\n      }\n    });\n  });\n\n  // Filter and style markers\n  const visibleMarkers = useMemo(() => {\n    return markers\n      .filter(marker => markerFactory.shouldShowMarker(marker, zoomLevel))\n      .map(marker => ({\n        data: marker,\n        ...markerFactory.createMarker(marker, cameraDistance)\n      }));\n  }, [markers, zoomLevel, cameraDistance, markerFactory]);\n\n  return (\n    <group ref={markersRef}>\n      {visibleMarkers.map(({ data, style, strategy }) => {\n        const isHovered = hoveredMarkerId === data.id;\n        const stationCount = data.stations.length;\n        \n        return (\n          <group\n            key={data.id}\n            position={data.position}\n            onClick={(e) => handleMarkerClick(data, e)}\n            onPointerOver={(e) => {\n              e.stopPropagation();\n              handleMarkerHover(data.id);\n              document.body.style.cursor = \"pointer\";\n            }}\n            onPointerOut={() => {\n              handleMarkerHover(null);\n              document.body.style.cursor = \"auto\";\n            }}\n          >\n            {/* Main marker */}\n            <mesh>\n              <circleGeometry args={[style.size, 32]} />\n              <meshBasicMaterial\n                color={style.color}\n                transparent\n                opacity={style.opacity}\n              />\n            </mesh>\n\n            {/* Inner core */}\n            <mesh>\n              <circleGeometry args={[style.size * 0.6, 16]} />\n              <meshBasicMaterial\n                color=\"#ffffff\"\n                transparent\n                opacity={0.8}\n              />\n            </mesh>\n\n            {/* Station count for clusters */}\n            {stationCount > 1 && (\n              <>\n                <mesh position={[0, 0, 0.001]}>\n                  <circleGeometry args={[style.size * 0.35, 16]} />\n                  <meshBasicMaterial\n                    color={style.color}\n                    transparent\n                    opacity={1}\n                  />\n                </mesh>\n\n                <Text\n                  position={[0, 0, 0.002]}\n                  fontSize={style.size * 0.4}\n                  color=\"white\"\n                  anchorX=\"center\"\n                  anchorY=\"middle\"\n                >\n                  {stationCount}\n                </Text>\n              </>\n            )}\n\n            {/* Glow effect */}\n            {style.glowEffect && (\n              <mesh>\n                <ringGeometry args={[style.size * 1.2, style.size * 1.5, 32]} />\n                <meshBasicMaterial\n                  color={style.color}\n                  transparent\n                  opacity={0.3}\n                  side={THREE.DoubleSide}\n                />\n              </mesh>\n            )}\n\n            {/* Hover ring */}\n            {isHovered && (\n              <mesh>\n                <ringGeometry args={[style.size * 1.1, style.size * 1.3, 32]} />\n                <meshBasicMaterial\n                  color={style.color}\n                  transparent\n                  opacity={0.5}\n                  side={THREE.DoubleSide}\n                />\n              </mesh>\n            )}\n\n            {/* Labels */}\n            {style.hasLabel && style.labelText && (\n              <Text\n                position={[0, -style.size * 1.8, 0]}\n                fontSize={style.size * 0.3}\n                color=\"rgba(255, 255, 255, 0.9)\"\n                anchorX=\"center\"\n                anchorY=\"middle\"\n                maxWidth={2}\n                textAlign=\"center\"\n              >\n                {style.labelText}\n              </Text>\n            )}\n          </group>\n        );\n      })}\n\n      {/* Loading indicator */}\n      {isLoading && (\n        <mesh position={[0, 3, 0]}>\n          <sphereGeometry args={[0.05, 16, 16]} />\n          <meshBasicMaterial color=\"#00d4ff\" />\n        </mesh>\n      )}\n    </group>\n  );\n}"],"names":["ClusteredStationMarkers","markersRef","camera","stationLoadingUseCase","stationSelectionUseCase","markerFactory","markers","setMarkers","isLoading","setIsLoading","hoveredMarkerId","setHoveredMarkerId","cameraDistance","setCameraDistance","zoomLevel","setZoomLevel","updateCameraDistance","distance","position","length","zoom","Math","max","roundedZoom","round","abs","interval","setInterval","clearInterval","loadMarkers","newMarkers","loadStationsForView","error","console","handleMarkerClick","markerData","event","stopPropagation","strategy","createMarker","handleInteraction","handleMarkerHover","markerId","current","children","forEach","marker","child","type","lookAt","visibleMarkers","filter","shouldShowMarker","map","data","ref","style","isHovered","id","stationCount","stations","onClick","e","onPointerOver","document","body","cursor","onPointerOut","args","size","color","transparent","opacity","fontSize","anchorX","anchorY","glowEffect","side","hasLabel","labelText","maxWidth","textAlign"],"mappings":"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"}},
    {"offset": {"line": 4839, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/stores/globe-store.ts"],"sourcesContent":["import { create } from \"zustand\";\nimport { subscribeWithSelector } from \"zustand/middleware\";\nimport type { GlobeState, RadioStation, StationMarker } from \"../types\";\nimport { latLngToPosition } from \"../utils/coordinates\";\n\n// Cesium-compatible camera position type\nexport interface CesiumCameraPosition {\n  longitude: number;\n  latitude: number;\n  height: number;\n  heading?: number;\n  pitch?: number;\n  roll?: number;\n}\n\ninterface GlobeStore extends GlobeState {\n  // Cesium-specific state\n  cesiumCameraPosition?: CesiumCameraPosition;\n\n  // Actions\n  selectStation: (station: RadioStation | null) => void;\n  hoverStation: (station: RadioStation | null) => void;\n  setCameraPosition: (position: [number, number, number]) => void;\n  setCesiumCameraPosition: (position: CesiumCameraPosition) => void;\n  setAutoRotating: (isAutoRotating: boolean) => void;\n  addMarker: (station: RadioStation) => void;\n  clearMarkers: () => void;\n  removeMarker: (stationId: string) => void;\n  updateMarkerVisibility: (stationId: string, isVisible: boolean) => void;\n  getStationsByRegion: (region: string) => RadioStation[];\n  searchStations: (query: string) => RadioStation[];\n}\n\nexport const useGlobeStore = create<GlobeStore>()(\n  subscribeWithSelector((set, get) => ({\n    // Initial state\n    selectedStation: null,\n    hoveredStation: null,\n    cameraPosition: [0, 0, 2.5],\n    isAutoRotating: true,\n    markers: [],\n\n    // Actions\n    selectStation: (station) => {\n      set((state) => ({\n        selectedStation: station,\n        markers: state.markers.map((marker) => ({\n          ...marker,\n          isSelected: marker.station.id === station?.id,\n        })),\n      }));\n    },\n\n    hoverStation: (station) => {\n      set((state) => ({\n        hoveredStation: station,\n        markers: state.markers.map((marker) => ({\n          ...marker,\n          isHovered: marker.station.id === station?.id,\n        })),\n      }));\n    },\n\n    setCameraPosition: (position) => {\n      set({ cameraPosition: position });\n    },\n\n    setCesiumCameraPosition: (position) => {\n      set({\n        cesiumCameraPosition: position,\n        // Also update legacy camera position for compatibility\n        cameraPosition: [\n          position.longitude,\n          position.latitude,\n          position.height,\n        ],\n      });\n    },\n\n    setAutoRotating: (isAutoRotating) => {\n      set({ isAutoRotating });\n    },\n\n    addMarker: (station) => {\n      const position = latLngToPosition(\n        station.location.lat,\n        station.location.lng,\n      );\n      const marker: StationMarker = {\n        station,\n        position,\n        isVisible: true,\n        isHovered: false,\n        isSelected: false,\n      };\n\n      set((state) => ({\n        markers: [\n          ...state.markers.filter((m) => m.station.id !== station.id),\n          marker,\n        ],\n      }));\n    },\n\n    clearMarkers: () => {\n      set({ markers: [] });\n    },\n\n    removeMarker: (stationId) => {\n      set((state) => ({\n        markers: state.markers.filter((m) => m.station.id !== stationId),\n      }));\n    },\n\n    updateMarkerVisibility: (stationId, isVisible) => {\n      set((state) => ({\n        markers: state.markers.map((marker) =>\n          marker.station.id === stationId ? { ...marker, isVisible } : marker,\n        ),\n      }));\n    },\n\n    getStationsByRegion: (region: string) => {\n      const { markers } = get();\n      return markers\n        .filter(\n          (marker) =>\n            marker.station.location.country\n              .toLowerCase()\n              .includes(region.toLowerCase()) ||\n            marker.station.location.city\n              .toLowerCase()\n              .includes(region.toLowerCase()),\n        )\n        .map((marker) => marker.station);\n    },\n\n    searchStations: (query: string) => {\n      const { markers } = get();\n      const searchTerm = query.toLowerCase();\n      return markers\n        .filter(\n          (marker) =>\n            marker.station.name.toLowerCase().includes(searchTerm) ||\n            marker.station.location.city.toLowerCase().includes(searchTerm) ||\n            marker.station.location.country\n              .toLowerCase()\n              .includes(searchTerm) ||\n            marker.station.genre.toLowerCase().includes(searchTerm) ||\n            marker.station.language.toLowerCase().includes(searchTerm),\n        )\n        .map((marker) => marker.station);\n    },\n  })),\n);\n\n// Subscribe to state changes for analytics or side effects\nuseGlobeStore.subscribe(\n  (state) => state.selectedStation,\n  (selectedStation) => {\n    if (selectedStation) {\n      console.log(\"Station selected:\", selectedStation.name);\n      // Track analytics, update URL, etc.\n    }\n  },\n);\n"],"names":["useGlobeStore","set","get","selectedStation","hoveredStation","cameraPosition","isAutoRotating","markers","selectStation","station","state","map","marker","isSelected","id","hoverStation","isHovered","setCameraPosition","position","setCesiumCameraPosition","cesiumCameraPosition","longitude","latitude","height","setAutoRotating","addMarker","location","lat","lng","isVisible","filter","m","clearMarkers","removeMarker","stationId","updateMarkerVisibility","getStationsByRegion","region","country","toLowerCase","includes","city","searchStations","query","searchTerm","name","genre","language","subscribe","console","log"],"mappings":"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"}},
    {"offset": {"line": 4958, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/components/GlobeControls.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRef, useEffect, useState } from \"react\";\nimport { useThree, useFrame } from \"@react-three/fiber\";\nimport { OrbitControls } from \"@react-three/drei\";\nimport { useGlobeStore } from \"../stores/globe-store\";\n\nexport function GlobeControls() {\n  const controlsRef = useRef<any>();\n  const { camera } = useThree();\n  const { isAutoRotating, setCameraPosition } = useGlobeStore();\n  const [isMobile, setIsMobile] = useState(false);\n\n  // Detect mobile device\n  useEffect(() => {\n    const checkIfMobile = () => {\n      setIsMobile(window.innerWidth < 768 || \"ontouchstart\" in window);\n    };\n\n    checkIfMobile();\n    window.addEventListener(\"resize\", checkIfMobile);\n    return () => window.removeEventListener(\"resize\", checkIfMobile);\n  }, []);\n\n  useFrame(() => {\n    if (controlsRef.current) {\n      // Update camera position in store\n      setCameraPosition([\n        camera.position.x,\n        camera.position.y,\n        camera.position.z,\n      ]);\n    }\n  });\n\n  return (\n    <OrbitControls\n      ref={controlsRef}\n      enablePan={false}\n      enableZoom={true}\n      enableRotate={true}\n      autoRotate={isAutoRotating}\n      autoRotateSpeed={isMobile ? 0.3 : 0.5}\n      minDistance={isMobile ? 2.5 : 1.5}\n      maxDistance={isMobile ? 8 : 5}\n      minPolarAngle={Math.PI / 6}\n      maxPolarAngle={Math.PI - Math.PI / 6}\n      zoomSpeed={isMobile ? 1.2 : 0.8}\n      rotateSpeed={isMobile ? 0.8 : 0.5}\n      enableDamping={true}\n      dampingFactor={isMobile ? 0.1 : 0.05}\n      touches={{\n        ONE: isMobile ? 2 : 2, // ROTATE\n        TWO: isMobile ? 1 : 1, // DOLLY/ZOOM\n      }}\n      mouseButtons={{\n        LEFT: 2, // ROTATE\n        MIDDLE: 1, // DOLLY\n        RIGHT: undefined, // No right-click action\n      }}\n    />\n  );\n}\n"],"names":["GlobeControls","controlsRef","camera","isAutoRotating","setCameraPosition","isMobile","setIsMobile","checkIfMobile","window","innerWidth","addEventListener","removeEventListener","current","position","x","y","z","ref","enablePan","enableZoom","enableRotate","autoRotate","autoRotateSpeed","minDistance","maxDistance","minPolarAngle","Math","PI","maxPolarAngle","zoomSpeed","rotateSpeed","enableDamping","dampingFactor","touches","ONE","TWO","mouseButtons","LEFT","MIDDLE","RIGHT","undefined"],"mappings":";;;;;AAEA;AACA;AAAA;AACA;AACA;;;AALA;;;;;AAOO,SAASA;;IACd,MAAMC,cAAc,IAAA,sLAAM;IAC1B,MAAM,EAAEC,MAAM,EAAE,GAAG,IAAA,8NAAQ;IAC3B,MAAM,EAAEC,cAAc,EAAEC,iBAAiB,EAAE,GAAG,IAAA,kKAAa;IAC3D,MAAM,CAACC,UAAUC,YAAY,GAAG,IAAA,wLAAQ,EAAC;IAEzC,uBAAuB;IACvB,IAAA,yLAAS;mCAAC;YACR,MAAMC;yDAAgB;oBACpBD,YAAYE,OAAOC,UAAU,GAAG,OAAO,kBAAkBD;gBAC3D;;YAEAD;YACAC,OAAOE,gBAAgB,CAAC,UAAUH;YAClC;2CAAO,IAAMC,OAAOG,mBAAmB,CAAC,UAAUJ;;QACpD;kCAAG,EAAE;IAEL,IAAA,8NAAQ;kCAAC;YACP,IAAIN,YAAYW,OAAO,EAAE;gBACvB,kCAAkC;gBAClCR,kBAAkB;oBAChBF,OAAOW,QAAQ,CAACC,CAAC;oBACjBZ,OAAOW,QAAQ,CAACE,CAAC;oBACjBb,OAAOW,QAAQ,CAACG,CAAC;iBAClB;YACH;QACF;;IAEA,qBACE,4MAAC,qLAAa;QACZC,KAAKhB;QACLiB,WAAW;QACXC,YAAY;QACZC,cAAc;QACdC,YAAYlB;QACZmB,iBAAiBjB,WAAW,MAAM;QAClCkB,aAAalB,WAAW,MAAM;QAC9BmB,aAAanB,WAAW,IAAI;QAC5BoB,eAAeC,KAAKC,EAAE,GAAG;QACzBC,eAAeF,KAAKC,EAAE,GAAGD,KAAKC,EAAE,GAAG;QACnCE,WAAWxB,WAAW,MAAM;QAC5ByB,aAAazB,WAAW,MAAM;QAC9B0B,eAAe;QACfC,eAAe3B,WAAW,MAAM;QAChC4B,SAAS;YACPC,KAAK7B,WAAW,IAAI;YACpB8B,KAAK9B,WAAW,IAAI;QACtB;QACA+B,cAAc;YACZC,MAAM;YACNC,QAAQ;YACRC,OAAOC;QACT;;;;;;AAGN;GAvDgBxC;;QAEK,8NAAQ;QACmB,kKAAa;QAc3D,8NAAQ;;;KAjBMA"}},
    {"offset": {"line": 5055, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/components/Globe.tsx"],"sourcesContent":["\"use client\";\n\nimport { Canvas } from \"@react-three/fiber\";\nimport { Suspense, useState, useEffect, Component, ReactNode } from \"react\";\nimport { Earth } from \"./Earth\";\nimport { ClusteredStationMarkers } from \"./ClusteredStationMarkers\";\nimport { GlobeControls } from \"./GlobeControls\";\nimport { Stars } from \"@react-three/drei\";\nimport { useGlobeStore } from \"../stores/globe-store\";\nimport { StationDirectory } from \"./StationDirectory\";\n\n// Simple WebGL detection\nfunction canCreateWebGLContext(): boolean {\n  try {\n    const canvas = document.createElement('canvas');\n    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\n    return !!gl;\n  } catch {\n    return false;\n  }\n}\n\n// Simple fallback component\nfunction WebGLFallback({ onEnable2D }: { onEnable2D: () => void }) {\n  return (\n    <div className=\"w-full h-screen relative overflow-hidden bg-gradient-to-b from-blue-900 to-black flex items-center justify-center z-50\">\n      <div className=\"text-center text-white p-8 bg-black/40 rounded-xl backdrop-blur-md max-w-lg border border-white/10 shadow-2xl\">\n        <div className=\"text-6xl mb-6 animate-pulse\">ð</div>\n        <h2 className=\"text-2xl font-bold mb-4\">3D Globe Unavailable</h2>\n        <p className=\"text-gray-300 mb-8\">\n          Your browser (or this specific browser mode) doesn't support WebGL hardware acceleration.\n        </p>\n        \n        <div className=\"space-y-4\">\n          <button \n            className=\"w-full bg-blue-600 hover:bg-blue-500 text-white font-semibold py-4 px-6 rounded-lg transition-all transform hover:scale-105 shadow-lg flex items-center justify-center space-x-2\"\n            onClick={onEnable2D}\n          >\n            <span>ð±</span>\n            <span>Switch to Lite Mode (2D)</span>\n          </button>\n          \n          <button \n            className=\"w-full bg-white/10 hover:bg-white/20 text-white py-3 px-6 rounded-lg transition-colors text-sm\"\n            onClick={() => window.location.reload()}\n          >\n            ð Retry 3D Version\n          </button>\n        </div>\n\n        <div className=\"text-xs text-gray-500 mt-8 pt-6 border-t border-white/10\">\n          <p className=\"mb-2 uppercase tracking-wider font-semibold\">Troubleshooting</p>\n          <ul className=\"space-y-1 text-left px-4\">\n            <li>â¢ Enable hardware acceleration in settings</li>\n            <li>â¢ Update browser to latest version</li>\n            <li>â¢ Try Chrome, Firefox, or Safari</li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Error boundary for Canvas errors\ninterface WebGLErrorBoundaryState {\n  hasError: boolean;\n}\n\nclass WebGLErrorBoundary extends Component<{children: ReactNode, onFallback: () => void}, WebGLErrorBoundaryState> {\n  constructor(props: {children: ReactNode, onFallback: () => void}) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError(): WebGLErrorBoundaryState {\n    return { hasError: true };\n  }\n\n  componentDidCatch(error: Error, errorInfo: any) {\n    console.error('WebGL Error:', error, errorInfo);\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return <WebGLFallback onEnable2D={this.props.onFallback} />;\n    }\n    return this.props.children;\n  }\n}\n\nexport function Globe() {\n  const [webglSupported, setWebglSupported] = useState<boolean | null>(null);\n  \n  useEffect(() => {\n    // Check WebGL support after component mounts\n    setWebglSupported(canCreateWebGLContext());\n  }, []);\n  \n  // Loading state\n  if (webglSupported === null) {\n    return (\n      <div className=\"w-full h-screen relative overflow-hidden bg-black flex items-center justify-center\">\n        <div className=\"text-white text-xl\">Loading Globe...</div>\n      </div>\n    );\n  }\n  \n  // WebGL not supported\n  if (!webglSupported) {\n    return <WebGLFallback />;\n  }\n  \n  return (\n    <div className=\"w-full h-screen relative overflow-hidden bg-black\">\n      <WebGLErrorBoundary>\n        <Canvas\n          camera={{ position: [0, 0, 4], fov: 60 }}\n          gl={{ \n            antialias: false, // Disable for better compatibility\n            alpha: false,\n            powerPreference: \"default\",\n            failIfMajorPerformanceCaveat: false\n          }}\n          onCreated={({ gl }) => {\n            gl.setClearColor(\"#000000\", 1);\n          }}\n        >\n          <ambientLight intensity={0.6} />\n          <pointLight position={[10, 10, 10]} intensity={1.5} />\n          <pointLight position={[-10, -10, 5]} intensity={0.8} color=\"#ffffff\" />\n          \n          <Suspense fallback={null}>\n            <Stars radius={300} depth={60} count={20000} factor={7} />\n            <Earth />\n            <ClusteredStationMarkers />\n            <GlobeControls />\n          </Suspense>\n        </Canvas>\n      </WebGLErrorBoundary>\n      \n      <div className=\"absolute top-4 left-4 text-white z-10\">\n        <h1 className=\"text-2xl font-bold mb-2\">Radio Globe</h1>\n        <p className=\"text-sm opacity-75\">Explore radio stations around the world</p>\n      </div>\n    </div>\n  );\n}\n"],"names":["canCreateWebGLContext","canvas","document","createElement","gl","getContext","WebGLFallback","onEnable2D","className","onClick","window","location","reload","WebGLErrorBoundary","props","state","hasError","getDerivedStateFromError","componentDidCatch","error","errorInfo","console","render","onFallback","children","Globe","webglSupported","setWebglSupported","camera","position","fov","antialias","alpha","powerPreference","failIfMajorPerformanceCaveat","onCreated","setClearColor","intensity","color","fallback","radius","depth","count","factor"],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAPA;;;;;;;AAWA,yBAAyB;AACzB,SAASA;IACP,IAAI;QACF,MAAMC,SAASC,SAASC,aAAa,CAAC;QACtC,MAAMC,KAAKH,OAAOI,UAAU,CAAC,YAAYJ,OAAOI,UAAU,CAAC;QAC3D,OAAO,CAAC,CAACD;IACX,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEA,4BAA4B;AAC5B,SAASE,cAAc,EAAEC,UAAU,EAA8B;IAC/D,qBACE,4MAAC;QAAIC,WAAU;kBACb,cAAA,4MAAC;YAAIA,WAAU;;8BACb,4MAAC;oBAAIA,WAAU;8BAA8B;;;;;;8BAC7C,4MAAC;oBAAGA,WAAU;8BAA0B;;;;;;8BACxC,4MAAC;oBAAEA,WAAU;8BAAqB;;;;;;8BAIlC,4MAAC;oBAAIA,WAAU;;sCACb,4MAAC;4BACCA,WAAU;4BACVC,SAASF;;8CAET,4MAAC;8CAAK;;;;;;8CACN,4MAAC;8CAAK;;;;;;;;;;;;sCAGR,4MAAC;4BACCC,WAAU;4BACVC,SAAS,IAAMC,OAAOC,QAAQ,CAACC,MAAM;sCACtC;;;;;;;;;;;;8BAKH,4MAAC;oBAAIJ,WAAU;;sCACb,4MAAC;4BAAEA,WAAU;sCAA8C;;;;;;sCAC3D,4MAAC;4BAAGA,WAAU;;8CACZ,4MAAC;8CAAG;;;;;;8CACJ,4MAAC;8CAAG;;;;;;8CACJ,4MAAC;8CAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMhB;KAtCSF;AA6CT,MAAMO,2BAA2B,yLAAS;IACxCA,YAAYC,KAAoD,CAAE;QAChE,KAAK,CAACA;QACN,IAAI,CAACC,KAAK,GAAG;YAAEC,UAAU;QAAM;IACjC;IAEA,OAAOC,2BAAoD;QACzD,OAAO;YAAED,UAAU;QAAK;IAC1B;IAEAE,kBAAkBC,KAAY,EAAEC,SAAc,EAAE;QAC9CC,QAAQF,KAAK,CAAC,gBAAgBA,OAAOC;IACvC;IAEAE,SAAS;QACP,IAAI,IAAI,CAACP,KAAK,CAACC,QAAQ,EAAE;YACvB,qBAAO,4MAACV;gBAAcC,YAAY,IAAI,CAACO,KAAK,CAACS,UAAU;;;;;;QACzD;QACA,OAAO,IAAI,CAACT,KAAK,CAACU,QAAQ;IAC5B;AACF;AAEO,SAASC;;IACd,MAAM,CAACC,gBAAgBC,kBAAkB,GAAG,IAAA,wLAAQ,EAAiB;IAErE,IAAA,yLAAS;2BAAC;YACR,6CAA6C;YAC7CA,kBAAkB3B;QACpB;0BAAG,EAAE;IAEL,gBAAgB;IAChB,IAAI0B,mBAAmB,MAAM;QAC3B,qBACE,4MAAC;YAAIlB,WAAU;sBACb,cAAA,4MAAC;gBAAIA,WAAU;0BAAqB;;;;;;;;;;;IAG1C;IAEA,sBAAsB;IACtB,IAAI,CAACkB,gBAAgB;QACnB,qBAAO,4MAACpB;;;;;IACV;IAEA,qBACE,4MAAC;QAAIE,WAAU;;0BACb,4MAACK;0BACC,cAAA,4MAAC,gNAAM;oBACLe,QAAQ;wBAAEC,UAAU;4BAAC;4BAAG;4BAAG;yBAAE;wBAAEC,KAAK;oBAAG;oBACvC1B,IAAI;wBACF2B,WAAW;wBACXC,OAAO;wBACPC,iBAAiB;wBACjBC,8BAA8B;oBAChC;oBACAC,WAAW,CAAC,EAAE/B,EAAE,EAAE;wBAChBA,GAAGgC,aAAa,CAAC,WAAW;oBAC9B;;sCAEA,4MAAC;4BAAaC,WAAW;;;;;;sCACzB,4MAAC;4BAAWR,UAAU;gCAAC;gCAAI;gCAAI;6BAAG;4BAAEQ,WAAW;;;;;;sCAC/C,4MAAC;4BAAWR,UAAU;gCAAC,CAAC;gCAAI,CAAC;gCAAI;6BAAE;4BAAEQ,WAAW;4BAAKC,OAAM;;;;;;sCAE3D,4MAAC,wLAAQ;4BAACC,UAAU;;8CAClB,4MAAC,qKAAK;oCAACC,QAAQ;oCAAKC,OAAO;oCAAIC,OAAO;oCAAOC,QAAQ;;;;;;8CACrD,4MAAC,sJAAK;;;;;8CACN,4MAAC,0LAAuB;;;;;8CACxB,4MAAC,sKAAa;;;;;;;;;;;;;;;;;;;;;;0BAKpB,4MAAC;gBAAInC,WAAU;;kCACb,4MAAC;wBAAGA,WAAU;kCAA0B;;;;;;kCACxC,4MAAC;wBAAEA,WAAU;kCAAqB;;;;;;;;;;;;;;;;;;AAI1C;GAxDgBiB;MAAAA"}},
    {"offset": {"line": 5425, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/services/audioService.ts"],"sourcesContent":["import { RadioStation } from \"../types\";\n\nexport type AudioState = \"idle\" | \"loading\" | \"playing\" | \"paused\" | \"error\";\n\nexport interface AudioPlayerConfig {\n  volume: number;\n  crossOrigin: \"anonymous\" | \"use-credentials\";\n  preload: \"none\" | \"metadata\" | \"auto\";\n  retryAttempts: number;\n  retryDelay: number;\n}\n\nexport interface AudioPlayerEvents {\n  stateChange: (state: AudioState) => void;\n  error: (error: string) => void;\n  loadStart: () => void;\n  canPlay: () => void;\n  volumeChange: (volume: number) => void;\n  timeUpdate: (currentTime: number) => void;\n}\n\nexport class AudioService {\n  private audio: HTMLAudioElement | null = null;\n  private state: AudioState = \"idle\";\n  private config: AudioPlayerConfig;\n  private listeners: Partial<AudioPlayerEvents> = {};\n  private retryCount = 0;\n  private currentStation: RadioStation | null = null;\n  private lastTimeUpdate = 0;\n  private readonly TIME_UPDATE_THROTTLE = 100; // ms\n\n  constructor(config: Partial<AudioPlayerConfig> = {}) {\n    this.config = {\n      volume: 0.7,\n      crossOrigin: \"anonymous\",\n      preload: \"none\",\n      retryAttempts: 3,\n      retryDelay: 2000,\n      ...config,\n    };\n\n    this.initializeAudio();\n  }\n\n  private initializeAudio() {\n    this.audio = new Audio();\n    this.audio.volume = this.config.volume;\n    this.audio.crossOrigin = this.config.crossOrigin;\n    this.audio.preload = this.config.preload;\n\n    // Set up event listeners\n    this.audio.addEventListener(\"loadstart\", this.handleLoadStart.bind(this));\n    this.audio.addEventListener(\"canplay\", this.handleCanPlay.bind(this));\n    this.audio.addEventListener(\"play\", this.handlePlay.bind(this));\n    this.audio.addEventListener(\"pause\", this.handlePause.bind(this));\n    this.audio.addEventListener(\"error\", this.handleError.bind(this));\n    this.audio.addEventListener(\n      \"volumechange\",\n      this.handleVolumeChange.bind(this),\n    );\n    this.audio.addEventListener(\"timeupdate\", this.handleTimeUpdate.bind(this));\n  }\n\n  private handleLoadStart() {\n    this.setState(\"loading\");\n    this.listeners.loadStart?.();\n  }\n\n  private handleCanPlay() {\n    this.setState(\"paused\");\n    this.listeners.canPlay?.();\n  }\n\n  private handlePlay() {\n    this.setState(\"playing\");\n  }\n\n  private handlePause() {\n    this.setState(\"paused\");\n  }\n\n  private handleError() {\n    this.setState(\"error\");\n    const errorMessage = this.getErrorMessage();\n    \n    // specialized retry for protocol issues (http vs https)\n    if (this.audio && this.audio.error && this.audio.error.code === MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED) {\n       const currentSrc = this.audio.src;\n       if (currentSrc.startsWith('http://') && !this.listeners.error) { // Only if we haven't given up yet\n           // Try upgrading to HTTPS\n           console.log('Audio source not supported, trying HTTPS upgrade...');\n           const secureUrl = currentSrc.replace('http://', 'https://');\n           if (this.retryCount < this.config.retryAttempts) {\n             this.retryCount++;\n             this.audio.src = secureUrl;\n             this.audio.load();\n             return;\n           }\n       }\n    }\n\n    this.listeners.error?.(errorMessage);\n\n    // Attempt standard retry if configured\n    if (this.retryCount < this.config.retryAttempts) {\n      this.scheduleRetry();\n    }\n  }\n\n  private handleVolumeChange() {\n    if (this.audio) {\n      this.listeners.volumeChange?.(this.audio.volume);\n    }\n  }\n\n  private handleTimeUpdate() {\n    if (this.audio) {\n      const now = Date.now();\n      if (now - this.lastTimeUpdate >= this.TIME_UPDATE_THROTTLE) {\n        this.lastTimeUpdate = now;\n        this.listeners.timeUpdate?.(this.audio.currentTime);\n      }\n    }\n  }\n\n  private getErrorMessage(): string {\n    if (!this.audio?.error) return \"Unknown audio error\";\n\n    switch (this.audio.error.code) {\n      case MediaError.MEDIA_ERR_ABORTED:\n        return \"Audio loading was aborted\";\n      case MediaError.MEDIA_ERR_NETWORK:\n        return \"Network error occurred while loading audio\";\n      case MediaError.MEDIA_ERR_DECODE:\n        return \"Audio format not supported\";\n      case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:\n        return \"Audio source not supported\";\n      default:\n        return \"Audio playback failed\";\n    }\n  }\n\n  private scheduleRetry() {\n    setTimeout(() => {\n      if (this.audio && this.currentStation) {\n        this.retryCount++;\n        console.log(\n          `Retrying audio load (attempt ${this.retryCount}/${this.config.retryAttempts})`,\n        );\n        this.audio.load();\n      }\n    }, this.config.retryDelay);\n  }\n\n  private setState(state: AudioState) {\n    this.state = state;\n    this.listeners.stateChange?.(state);\n  }\n\n  // Public API\n  public on<T extends keyof AudioPlayerEvents>(\n    event: T,\n    callback: AudioPlayerEvents[T],\n  ) {\n    this.listeners[event] = callback as any;\n  }\n\n  public off<T extends keyof AudioPlayerEvents>(event: T) {\n    delete this.listeners[event];\n  }\n\n  public async loadStation(\n    station: RadioStation,\n    streamUrl?: string,\n  ): Promise<void> {\n    if (!this.audio) return;\n\n    this.currentStation = station;\n    this.retryCount = 0;\n\n    const url = streamUrl || station.url;\n    if (this.audio.src !== url) {\n      this.audio.src = url;\n      this.audio.load();\n    }\n  }\n\n  public async play(): Promise<void> {\n    if (!this.audio) return;\n\n    try {\n      await this.audio.play();\n    } catch (error) {\n      this.setState(\"error\");\n      throw error;\n    }\n  }\n\n  public pause(): void {\n    if (this.audio) {\n      this.audio.pause();\n    }\n  }\n\n  public setVolume(volume: number): void {\n    if (this.audio) {\n      this.audio.volume = Math.max(0, Math.min(1, volume));\n    }\n  }\n\n  public getVolume(): number {\n    return this.audio?.volume || 0;\n  }\n\n  public mute(): void {\n    this.setVolume(0);\n  }\n\n  public unmute(): void {\n    this.setVolume(this.config.volume);\n  }\n\n  public getState(): AudioState {\n    return this.state;\n  }\n\n  public getCurrentStation(): RadioStation | null {\n    return this.currentStation;\n  }\n\n  public getAudioElement(): HTMLAudioElement | null {\n    return this.audio;\n  }\n\n  public destroy(): void {\n    if (this.audio) {\n      this.audio.pause();\n      this.audio.removeAttribute(\"src\");\n      this.audio.load();\n      this.audio = null;\n    }\n    this.listeners = {};\n    this.currentStation = null;\n  }\n}\n"],"names":["AudioService","audio","state","config","listeners","retryCount","currentStation","lastTimeUpdate","TIME_UPDATE_THROTTLE","volume","crossOrigin","preload","retryAttempts","retryDelay","initializeAudio","Audio","addEventListener","handleLoadStart","bind","handleCanPlay","handlePlay","handlePause","handleError","handleVolumeChange","handleTimeUpdate","setState","loadStart","canPlay","errorMessage","getErrorMessage","error","code","MediaError","MEDIA_ERR_SRC_NOT_SUPPORTED","currentSrc","src","startsWith","console","log","secureUrl","replace","load","scheduleRetry","volumeChange","now","Date","timeUpdate","currentTime","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","setTimeout","stateChange","on","event","callback","off","loadStation","station","streamUrl","url","play","pause","setVolume","Math","max","min","getVolume","mute","unmute","getState","getCurrentStation","getAudioElement","destroy","removeAttribute"],"mappings":"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"}},
    {"offset": {"line": 5615, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/services/radioStationService.ts"],"sourcesContent":["// import { globalRadioStations } from '../data/globalRadioStations'\nimport { RadioStation } from \"../types/index\";\nimport { radioDiscoveryService } from \"./radioDiscoveryService\";\n\nexport class RadioStationService {\n  private stations: RadioStation[] = [];\n  private proxyUrl = \"/api/proxy/audio\";\n  private discoveredStations: RadioStation[] = [];\n  private isDiscoveryEnabled = true;\n  private allCachedStations: RadioStation[] = [];\n  private cacheLoaded = false;\n\n  /**\n   * Load all stations from cache (once per session)\n   */\n  private async ensureCacheLoaded(): Promise<void> {\n    if (this.cacheLoaded) return;\n    \n    try {\n      this.allCachedStations = await radioDiscoveryService.getAllStations();\n      this.cacheLoaded = true;\n      console.log(`Loaded ${this.allCachedStations.length} stations into search cache`);\n    } catch (error) {\n      console.warn('Failed to load station cache:', error);\n      this.allCachedStations = [];\n    }\n  }\n\n  /**\n   * Get all radio stations (curated + discovered)\n   */\n  getAllStations(): RadioStation[] {\n    return [...this.stations, ...this.discoveredStations];\n  }\n\n  /**\n   * Get curated stations only\n   */\n  getCuratedStations(): RadioStation[] {\n    return this.stations;\n  }\n\n  /**\n   * Enhanced search that searches ALL cached stations (fast, comprehensive)\n   */\n  async searchStations(\n    query: string,\n    includeOnline: boolean = true,\n  ): Promise<RadioStation[]> {\n    await this.ensureCacheLoaded();\n    \n    const searchTerm = query.toLowerCase().trim();\n    if (!searchTerm) return [];\n\n    // Search across ALL cached stations (fast in-memory search)\n    const results = this.allCachedStations.filter(\n      (station) =>\n        station.name.toLowerCase().includes(searchTerm) ||\n        station.location?.country?.toLowerCase().includes(searchTerm) ||\n        station.location?.city?.toLowerCase().includes(searchTerm) ||\n        station.genre?.toLowerCase().includes(searchTerm) ||\n        station.language?.toLowerCase().includes(searchTerm) ||\n        (station.description && station.description.toLowerCase().includes(searchTerm))\n    );\n\n    // Sort by relevance: exact matches first, then by listeners/popularity\n    const sorted = results.sort((a, b) => {\n      const aExact = a.name.toLowerCase() === searchTerm;\n      const bExact = b.name.toLowerCase() === searchTerm;\n      if (aExact && !bExact) return -1;\n      if (!aExact && bExact) return 1;\n      return (b.listeners || 0) - (a.listeners || 0);\n    });\n\n    return sorted.slice(0, 100); // Return top 100 matches\n  }\n\n  /**\n   * Search only local curated stations\n   */\n  private searchLocalStations(query: string): RadioStation[] {\n    const searchTerm = query.toLowerCase();\n\n    return this.stations.filter(\n      (station) =>\n        station.name.toLowerCase().includes(searchTerm) ||\n        station.location.city.toLowerCase().includes(searchTerm) ||\n        station.location.country.toLowerCase().includes(searchTerm) ||\n        station.genre.toLowerCase().includes(searchTerm) ||\n        station.language.toLowerCase().includes(searchTerm) ||\n        (station.description &&\n          station.description.toLowerCase().includes(searchTerm)),\n    );\n  }\n\n  /**\n   * Enhanced country search that works with comprehensive cached data\n   */\n  async getStationsByCountry(\n    country: string,\n    includeOnline: boolean = true,\n  ): Promise<RadioStation[]> {\n    await this.ensureCacheLoaded();\n    \n    const countryLower = country.trim().toLowerCase();\n    const normalizedCode = this.getCountryCode(countryLower) || (countryLower.length > 0 && countryLower.length <= 3 ? countryLower.toUpperCase() : null);\n    const normalizedCodeLower = normalizedCode?.toLowerCase() || null;\n\n    const countryStations = this.allCachedStations.filter((station) => {\n      const name = station.location?.country?.toLowerCase() || \"\";\n      const code = station.location?.countryCode?.toLowerCase() || \"\";\n\n      if (normalizedCodeLower && code === normalizedCodeLower) {\n        return true;\n      }\n\n      if (name === countryLower) {\n        return true;\n      }\n\n      // Support partial matches while avoiding overly broad contains() matches\n      return !normalizedCodeLower && name.startsWith(countryLower);\n    });\n    \n    // Sort by popularity (listeners/clicks)\n    const sorted = countryStations.sort((a, b) => (b.listeners || 0) - (a.listeners || 0));\n    \n    console.log(`Found ${sorted.length} stations for country: ${country}`);\n    return sorted.slice(0, 100); // Return top 100\n  }\n\n  /**\n   * Get popular/top stations with online integration\n   */\n  async getPopularStations(\n    limit: number = 20,\n    includeOnline: boolean = true,\n  ): Promise<RadioStation[]> {\n    const localPopular = [...this.stations]\n      .sort((a, b) => b.listeners - a.listeners)\n      .slice(0, limit);\n\n    if (!includeOnline || !this.isDiscoveryEnabled) {\n      return localPopular;\n    }\n\n    try {\n      const onlineTop = await radioDiscoveryService.getTopStations(limit);\n      return this.mergeStationResults(localPopular, onlineTop).slice(0, limit);\n    } catch (error) {\n      console.warn(\"Failed to fetch online top stations:\", error);\n      return localPopular;\n    }\n  }\n\n  /**\n   * Get stations by genre from cached data (fast search)\n   */\n  async getStationsByGenre(\n    genre: string,\n    includeOnline: boolean = true,\n  ): Promise<RadioStation[]> {\n    await this.ensureCacheLoaded();\n    \n    const genreLower = genre.toLowerCase();\n    const genreStations = this.allCachedStations.filter((station) =>\n      station.genre?.toLowerCase().includes(genreLower) ||\n      station.tags?.some(tag => tag.toLowerCase().includes(genreLower))\n    );\n    \n    // Sort by popularity\n    const sorted = genreStations.sort((a, b) => (b.listeners || 0) - (a.listeners || 0));\n    \n    console.log(`Found ${sorted.length} stations for genre: ${genre}`);\n    return sorted.slice(0, 100);\n  }\n\n  /**\n   * Get all unique cities from cached stations\n   */\n  async getAvailableCities(): Promise<string[]> {\n    await this.ensureCacheLoaded();\n    \n    const cities = Array.from(\n      new Set(\n        this.allCachedStations\n          .map((station) => station.location?.city)\n          .filter(city => city && city.trim() !== '')\n      )\n    );\n    \n    return cities.sort();\n  }\n\n  /**\n   * Get stations by city from cached data (fast search)\n   */\n  async getStationsByCity(\n    city: string,\n    includeOnline: boolean = true,\n  ): Promise<RadioStation[]> {\n    await this.ensureCacheLoaded();\n    \n    const cityLower = city.toLowerCase();\n    const cityStations = this.allCachedStations.filter(\n      (station) =>\n        station.location?.city?.toLowerCase().includes(cityLower)\n    );\n    \n    // Sort by popularity\n    const sorted = cityStations.sort((a, b) => (b.listeners || 0) - (a.listeners || 0));\n    \n    console.log(`Found ${sorted.length} stations for city: ${city}`);\n    return sorted.slice(0, 100);\n  }\n\n  /**\n   * Private helper methods\n   */\n  private mergeStationResults(\n    local: RadioStation[],\n    online: RadioStation[],\n  ): RadioStation[] {\n    const merged = [...local];\n    const existingUrls = new Set(local.map((s) => s.url));\n\n    for (const station of online) {\n      if (!existingUrls.has(station.url)) {\n        merged.push(station);\n      }\n    }\n\n    return merged;\n  }\n\n  private getCountryCode(countryName: string): string | null {\n    // Comprehensive country code mapping for global radio stations\n    const countryMap: Record<string, string> = {\n      // North America\n      \"united states\": \"US\", \"usa\": \"US\", \"us\": \"US\",\n      \"canada\": \"CA\", \"ca\": \"CA\",\n      \"mexico\": \"MX\", \"mx\": \"MX\",\n      \n      // Europe\n      \"united kingdom\": \"GB\", \"uk\": \"GB\", \"gb\": \"GB\", \"britain\": \"GB\",\n      \"germany\": \"DE\", \"de\": \"DE\",\n      \"france\": \"FR\", \"fr\": \"FR\",\n      \"italy\": \"IT\", \"it\": \"IT\",\n      \"spain\": \"ES\", \"es\": \"ES\",\n      \"netherlands\": \"NL\", \"nl\": \"NL\", \"holland\": \"NL\",\n      \"sweden\": \"SE\", \"se\": \"SE\",\n      \"norway\": \"NO\", \"no\": \"NO\",\n      \"denmark\": \"DK\", \"dk\": \"DK\",\n      \"finland\": \"FI\", \"fi\": \"FI\",\n      \"switzerland\": \"CH\", \"ch\": \"CH\",\n      \"austria\": \"AT\", \"at\": \"AT\",\n      \"belgium\": \"BE\", \"be\": \"BE\",\n      \"poland\": \"PL\", \"pl\": \"PL\",\n      \"russia\": \"RU\", \"ru\": \"RU\",\n      \"turkey\": \"TR\", \"tr\": \"TR\",\n      \n      // Asia-Pacific\n      \"japan\": \"JP\", \"jp\": \"JP\",\n      \"south korea\": \"KR\", \"korea\": \"KR\", \"kr\": \"KR\",\n      \"china\": \"CN\", \"cn\": \"CN\",\n      \"india\": \"IN\", \"in\": \"IN\",\n      \"australia\": \"AU\", \"au\": \"AU\",\n      \"new zealand\": \"NZ\", \"nz\": \"NZ\",\n      \"singapore\": \"SG\", \"sg\": \"SG\",\n      \"thailand\": \"TH\", \"th\": \"TH\",\n      \"malaysia\": \"MY\", \"my\": \"MY\",\n      \"indonesia\": \"ID\", \"id\": \"ID\",\n      \"philippines\": \"PH\", \"ph\": \"PH\",\n      \n      // Latin America\n      \"brazil\": \"BR\", \"br\": \"BR\",\n      \"argentina\": \"AR\", \"ar\": \"AR\",\n      \"chile\": \"CL\", \"cl\": \"CL\",\n      \"colombia\": \"CO\", \"co\": \"CO\",\n      \"peru\": \"PE\", \"pe\": \"PE\",\n      \"venezuela\": \"VE\", \"ve\": \"VE\",\n      \"uruguay\": \"UY\", \"uy\": \"UY\",\n      \n      // Africa\n      \"south africa\": \"ZA\", \"za\": \"ZA\",\n      \"nigeria\": \"NG\", \"ng\": \"NG\",\n      \"egypt\": \"EG\", \"eg\": \"EG\",\n      \"kenya\": \"KE\", \"ke\": \"KE\",\n      \"ethiopia\": \"ET\", \"et\": \"ET\",\n      \"ghana\": \"GH\", \"gh\": \"GH\",\n      \"tunisia\": \"TN\", \"tn\": \"TN\",\n      \"morocco\": \"MA\", \"ma\": \"MA\",\n      \"zambia\": \"ZM\", \"zm\": \"ZM\",\n      \"zimbabwe\": \"ZW\", \"zw\": \"ZW\",\n      \"tanzania\": \"TZ\", \"tz\": \"TZ\",\n      \"uganda\": \"UG\", \"ug\": \"UG\",\n      \"mozambique\": \"MZ\", \"mz\": \"MZ\",\n      \"botswana\": \"BW\", \"bw\": \"BW\",\n      \"namibia\": \"NA\", \"na\": \"NA\",\n      \"angola\": \"AO\", \"ao\": \"AO\",\n      \"mali\": \"ML\", \"ml\": \"ML\",\n      \"senegal\": \"SN\", \"sn\": \"SN\",\n      \"burkina faso\": \"BF\", \"bf\": \"BF\",\n      \"ivory coast\": \"CI\", \"ci\": \"CI\", \"cote divoire\": \"CI\",\n      \"cameroon\": \"CM\", \"cm\": \"CM\",\n      \"democratic republic of congo\": \"CD\", \"drc\": \"CD\", \"congo\": \"CG\",\n      \"rwanda\": \"RW\", \"rw\": \"RW\",\n      \"madagascar\": \"MG\", \"mg\": \"MG\",\n      \"algeria\": \"DZ\", \"dz\": \"DZ\",\n      \"libya\": \"LY\", \"ly\": \"LY\",\n      \"sudan\": \"SD\", \"sd\": \"SD\",\n      \"chad\": \"TD\", \"td\": \"TD\",\n      \"niger\": \"NE\", \"ne\": \"NE\",\n      \n      // Middle East\n      \"israel\": \"IL\", \"il\": \"IL\",\n      \"saudi arabia\": \"SA\", \"sa\": \"SA\",\n      \"united arab emirates\": \"AE\", \"uae\": \"AE\", \"ae\": \"AE\",\n      \"qatar\": \"QA\", \"qa\": \"QA\",\n      \"kuwait\": \"KW\", \"kw\": \"KW\",\n      \"iran\": \"IR\", \"ir\": \"IR\"\n    };\n\n    return countryMap[countryName.toLowerCase()] || null;\n  }\n\n  /**\n   * Get stations by continent\n   */\n  getStationsByContinent(continent: string): RadioStation[] {\n    const continentCountries: Record<string, string[]> = {\n      \"north-america\": [\"United States\", \"Canada\", \"Mexico\"],\n      \"south-america\": [\"Brazil\", \"Argentina\", \"Chile\", \"Colombia\", \"Peru\"],\n      europe: [\n        \"United Kingdom\",\n        \"France\",\n        \"Germany\",\n        \"Italy\",\n        \"Spain\",\n        \"Netherlands\",\n        \"Switzerland\",\n      ],\n      asia: [\"Japan\", \"South Korea\", \"China\", \"India\", \"Singapore\", \"Thailand\"],\n      africa: [\"South Africa\", \"Nigeria\", \"Kenya\", \"Egypt\", \"Zambia\", \"Zimbabwe\", \"Tanzania\", \"Uganda\", \"Ghana\", \"Ethiopia\", \"Morocco\", \"Algeria\", \"Tunisia\", \"Rwanda\", \"Botswana\", \"Namibia\", \"Angola\", \"Mozambique\", \"Mali\", \"Senegal\", \"Cameroon\", \"Madagascar\"],\n      oceania: [\"Australia\", \"New Zealand\"],\n    };\n\n    const countries = continentCountries[continent.toLowerCase()] || [];\n    return this.stations.filter((station) =>\n      countries.includes(station.location.country),\n    );\n  }\n\n  /**\n   * Get unique countries from cached stations\n   */\n  async getAvailableCountries(): Promise<string[]> {\n    await this.ensureCacheLoaded();\n    \n    const countries = Array.from(\n      new Set(\n        this.allCachedStations\n          .map((station) => station.location?.country)\n          .filter(country => country && country !== 'Unknown')\n      )\n    );\n    \n    return countries.sort((a, b) => a.localeCompare(b));\n  }\n\n  /**\n   * Get unique countries\n   */\n  getCountries(): string[] {\n    const countries = Array.from(\n      new Set(this.stations.map((station) => station.location.country)),\n    );\n    return countries.sort();\n  }\n\n  /**\n   * Get unique cities for a country\n   */\n  getCitiesInCountry(country: string): string[] {\n    const cities = this.stations\n      .filter((station) => station.location.country === country)\n      .map((station) => station.location.city);\n\n    return Array.from(new Set(cities)).sort();\n  }\n\n  /**\n   * Get unique genres\n   */\n  getGenres(): string[] {\n    const genres = Array.from(\n      new Set(this.stations.map((station) => station.genre)),\n    );\n    return genres.sort();\n  }\n\n  /**\n   * Get unique languages\n   */\n  getLanguages(): string[] {\n    const languages = Array.from(\n      new Set(this.stations.map((station) => station.language)),\n    );\n    return languages.sort();\n  }\n\n  /**\n   * Get proxied stream URL to avoid CORS issues\n   */\n  getProxiedStreamUrl(station: RadioStation): string {\n    // For known CORS-free streams, return direct URL\n    const corsFreeHosts = [\n      \"ice1.somafm.com\",\n      \"stream.srg-ssr.ch\",\n      \"streams.kqed.org\",\n    ];\n\n    try {\n      const url = new URL(station.url);\n      if (corsFreeHosts.some((host) => url.hostname.includes(host))) {\n        return station.url;\n      }\n    } catch {\n      // Invalid URL, use proxy\n    }\n\n    // Use proxy for potentially CORS-blocked streams\n    return `${this.proxyUrl}?url=${encodeURIComponent(station.url)}`;\n  }\n\n  /**\n   * Get station by ID\n   */\n  getStationById(id: string): RadioStation | undefined {\n    return this.stations.find((station) => station.id === id);\n  }\n\n  /**\n   * Get random stations\n   */\n  getRandomStations(count: number = 5): RadioStation[] {\n    const shuffled = [...this.stations].sort(() => 0.5 - Math.random());\n    return shuffled.slice(0, count);\n  }\n\n  /**\n   * Calculate distance between two points (Haversine formula)\n   */\n  private calculateDistance(\n    lat1: number,\n    lng1: number,\n    lat2: number,\n    lng2: number,\n  ): number {\n    const R = 6371; // Earth's radius in km\n    const dLat = this.toRad(lat2 - lat1);\n    const dLng = this.toRad(lng2 - lng1);\n\n    const a =\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n      Math.cos(this.toRad(lat1)) *\n        Math.cos(this.toRad(lat2)) *\n        Math.sin(dLng / 2) *\n        Math.sin(dLng / 2);\n\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    return R * c;\n  }\n\n  private toRad(degrees: number): number {\n    return degrees * (Math.PI / 180);\n  }\n}\n\n// Export singleton instance\nexport const radioStationService = new RadioStationService();\n"],"names":["RadioStationService","stations","proxyUrl","discoveredStations","isDiscoveryEnabled","allCachedStations","cacheLoaded","ensureCacheLoaded","getAllStations","console","log","length","error","warn","getCuratedStations","searchStations","query","includeOnline","searchTerm","toLowerCase","trim","results","filter","station","name","includes","location","country","city","genre","language","description","sorted","sort","a","b","aExact","bExact","listeners","slice","searchLocalStations","getStationsByCountry","countryLower","normalizedCode","getCountryCode","toUpperCase","normalizedCodeLower","countryStations","code","countryCode","startsWith","getPopularStations","limit","localPopular","onlineTop","getTopStations","mergeStationResults","getStationsByGenre","genreLower","genreStations","tags","some","tag","getAvailableCities","cities","Array","from","Set","map","getStationsByCity","cityLower","cityStations","local","online","merged","existingUrls","s","url","has","push","countryName","countryMap","getStationsByContinent","continent","continentCountries","europe","asia","africa","oceania","countries","getAvailableCountries","localeCompare","getCountries","getCitiesInCountry","getGenres","genres","getLanguages","languages","getProxiedStreamUrl","corsFreeHosts","URL","host","hostname","encodeURIComponent","getStationById","id","find","getRandomStations","count","shuffled","Math","random","calculateDistance","lat1","lng1","lat2","lng2","R","dLat","toRad","dLng","sin","cos","c","atan2","sqrt","degrees","PI","radioStationService"],"mappings":"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"}},
    {"offset": {"line": 6080, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/hooks/useModularAudio.ts"],"sourcesContent":["import { useState, useRef, useEffect, useCallback, useMemo } from \"react\";\nimport { RadioStation } from \"../types\";\nimport { AudioService, AudioState } from \"../services/audioService\";\nimport { radioStationService } from \"../services/radioStationService\";\n\ninterface UseModularAudioOptions {\n  volume?: number;\n  autoPlay?: boolean;\n  retryAttempts?: number;\n  retryDelay?: number;\n}\n\ninterface ModularAudioState {\n  isPlaying: boolean;\n  isLoading: boolean;\n  error: string | null;\n  volume: number;\n  isMuted: boolean;\n  currentTime: number;\n  state: AudioState;\n  currentStation: RadioStation | null;\n}\n\ninterface ModularAudioActions {\n  play: () => Promise<void>;\n  pause: () => void;\n  setVolume: (volume: number) => void;\n  toggleMute: () => void;\n  loadStation: (station: RadioStation) => Promise<void>;\n  clearError: () => void;\n  getAudioElement: () => HTMLAudioElement | null;\n}\n\nexport function useModularAudio(\n  options: UseModularAudioOptions = {},\n): [ModularAudioState, ModularAudioActions] {\n  const audioServiceRef = useRef<AudioService | null>(null);\n\n  // Memoize options to prevent infinite loops\n  const memoizedOptions = useMemo(\n    () => ({\n      volume: options.volume || 0.7,\n      autoPlay: options.autoPlay || false,\n      retryAttempts: options.retryAttempts || 3,\n      retryDelay: options.retryDelay || 2000,\n    }),\n    [\n      options.volume,\n      options.autoPlay,\n      options.retryAttempts,\n      options.retryDelay,\n    ],\n  );\n\n  const [state, setState] = useState<ModularAudioState>(() => ({\n    isPlaying: false,\n    isLoading: false,\n    error: null,\n    volume: memoizedOptions.volume,\n    isMuted: false,\n    currentTime: 0,\n    state: \"idle\",\n    currentStation: null,\n  }));\n\n  // Initialize audio service\n  useEffect(() => {\n    audioServiceRef.current = new AudioService({\n      volume: memoizedOptions.volume,\n      retryAttempts: memoizedOptions.retryAttempts,\n      retryDelay: memoizedOptions.retryDelay,\n    });\n\n    const service = audioServiceRef.current;\n\n    // Set up event listeners\n    service.on(\"stateChange\", (audioState) => {\n      setState((prev) => ({\n        ...prev,\n        state: audioState,\n        isPlaying: audioState === \"playing\",\n        isLoading: audioState === \"loading\",\n      }));\n    });\n\n    service.on(\"error\", (error) => {\n      setState((prev) => ({\n        ...prev,\n        error,\n        isLoading: false,\n        isPlaying: false,\n      }));\n    });\n\n    service.on(\"volumeChange\", (volume) => {\n      setState((prev) => ({\n        ...prev,\n        volume,\n        isMuted: volume === 0,\n      }));\n    });\n\n    service.on(\"timeUpdate\", (currentTime) => {\n      setState((prev) => ({\n        ...prev,\n        currentTime,\n      }));\n    });\n\n    return () => {\n      service.destroy();\n    };\n  }, [\n    memoizedOptions.volume,\n    memoizedOptions.retryAttempts,\n    memoizedOptions.retryDelay,\n  ]);\n\n  const play = useCallback(async () => {\n    if (!audioServiceRef.current) return;\n\n    try {\n      await audioServiceRef.current.play();\n      setState((prev) => ({ ...prev, error: null }));\n    } catch (error) {\n      setState((prev) => ({\n        ...prev,\n        error: \"Failed to play audio. Please try again.\",\n      }));\n    }\n  }, []);\n\n  const pause = useCallback(() => {\n    if (!audioServiceRef.current) return;\n    audioServiceRef.current.pause();\n  }, []);\n\n  const setVolume = useCallback((volume: number) => {\n    if (!audioServiceRef.current) return;\n    audioServiceRef.current.setVolume(volume);\n  }, []);\n\n  const toggleMute = useCallback(() => {\n    if (!audioServiceRef.current) return;\n\n    if (state.isMuted) {\n      audioServiceRef.current.setVolume(state.volume > 0 ? state.volume : 0.7);\n    } else {\n      audioServiceRef.current.mute();\n    }\n  }, [state.isMuted, state.volume]);\n\n  const loadStation = useCallback(\n    async (station: RadioStation) => {\n      if (!audioServiceRef.current) return;\n\n      try {\n        setState((prev) => ({\n          ...prev,\n          error: null,\n          currentStation: station,\n        }));\n\n        // Get proxied URL to avoid CORS issues\n        const streamUrl = radioStationService.getProxiedStreamUrl(station);\n\n        await audioServiceRef.current.loadStation(station, streamUrl);\n\n        // Auto-play if enabled\n        if (memoizedOptions.autoPlay) {\n          await play();\n        }\n      } catch (error) {\n        setState((prev) => ({\n          ...prev,\n          error: \"Failed to load radio station.\",\n        }));\n      }\n    },\n    [memoizedOptions.autoPlay, play],\n  );\n\n  const clearError = useCallback(() => {\n    setState((prev) => ({ ...prev, error: null }));\n  }, []);\n\n  const getAudioElement = useCallback((): HTMLAudioElement | null => {\n    return audioServiceRef.current?.getAudioElement() || null;\n  }, []);\n\n  const playerState: ModularAudioState = useMemo(\n    () => ({\n      ...state,\n      currentStation:\n        audioServiceRef.current?.getCurrentStation() || state.currentStation,\n    }),\n    [state],\n  );\n\n  const actions: ModularAudioActions = useMemo(\n    () => ({\n      play,\n      pause,\n      setVolume,\n      toggleMute,\n      loadStation,\n      clearError,\n      getAudioElement,\n    }),\n    [\n      play,\n      pause,\n      setVolume,\n      toggleMute,\n      loadStation,\n      clearError,\n      getAudioElement,\n    ],\n  );\n\n  return [playerState, actions];\n}\n"],"names":["useModularAudio","options","audioServiceRef","memoizedOptions","volume","autoPlay","retryAttempts","retryDelay","state","setState","isPlaying","isLoading","error","isMuted","currentTime","currentStation","current","service","on","audioState","prev","destroy","play","pause","setVolume","toggleMute","mute","loadStation","station","streamUrl","getProxiedStreamUrl","clearError","getAudioElement","playerState","getCurrentStation","actions"],"mappings":"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"}},
    {"offset": {"line": 6318, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/services/audioVisualizationService.ts"],"sourcesContent":["export type VisualizationType = \"bars\" | \"waveform\" | \"circular\" | \"particles\";\n\nexport interface VisualizerConfig {\n  fftSize: number;\n  smoothingTimeConstant: number;\n  minDecibels: number;\n  maxDecibels: number;\n  backgroundColor: string;\n  primaryColor: string;\n  secondaryColor: string;\n}\n\nexport interface VisualizerRenderer {\n  render(\n    data: Uint8Array,\n    canvas: HTMLCanvasElement,\n    config: VisualizerConfig,\n  ): void;\n}\n\nexport class BarsRenderer implements VisualizerRenderer {\n  render(\n    data: Uint8Array,\n    canvas: HTMLCanvasElement,\n    config: VisualizerConfig,\n  ): void {\n    const ctx = canvas.getContext(\"2d\")!;\n    const width = canvas.width;\n    const height = canvas.height;\n    const barWidth = (width / data.length) * 2;\n\n    // Clear canvas with fade effect\n    ctx.fillStyle = config.backgroundColor;\n    ctx.fillRect(0, 0, width, height);\n\n    // Draw bars\n    for (let i = 0; i < data.length; i++) {\n      const barHeight = (data[i] / 255) * height * 0.8;\n      const x = i * barWidth;\n      const y = height - barHeight;\n\n      // Create gradient\n      const gradient = ctx.createLinearGradient(0, y, 0, height);\n      gradient.addColorStop(0, config.primaryColor);\n      gradient.addColorStop(0.5, config.secondaryColor);\n      gradient.addColorStop(1, config.primaryColor);\n\n      ctx.fillStyle = gradient;\n      ctx.fillRect(x, y, barWidth - 1, barHeight);\n    }\n  }\n}\n\nexport class WaveformRenderer implements VisualizerRenderer {\n  render(\n    data: Uint8Array,\n    canvas: HTMLCanvasElement,\n    config: VisualizerConfig,\n  ): void {\n    const ctx = canvas.getContext(\"2d\")!;\n    const width = canvas.width;\n    const height = canvas.height;\n\n    // Clear canvas with fade effect\n    ctx.fillStyle = config.backgroundColor;\n    ctx.fillRect(0, 0, width, height);\n\n    // Draw waveform\n    ctx.lineWidth = 2;\n    ctx.strokeStyle = config.primaryColor;\n    ctx.beginPath();\n\n    const sliceWidth = width / data.length;\n    let x = 0;\n\n    for (let i = 0; i < data.length; i++) {\n      const v = data[i] / 128.0;\n      const y = (v * height) / 2;\n\n      if (i === 0) {\n        ctx.moveTo(x, y);\n      } else {\n        ctx.lineTo(x, y);\n      }\n\n      x += sliceWidth;\n    }\n\n    ctx.stroke();\n  }\n}\n\nexport class CircularRenderer implements VisualizerRenderer {\n  render(\n    data: Uint8Array,\n    canvas: HTMLCanvasElement,\n    config: VisualizerConfig,\n  ): void {\n    const ctx = canvas.getContext(\"2d\")!;\n    const width = canvas.width;\n    const height = canvas.height;\n    const centerX = width / 2;\n    const centerY = height / 2;\n    const radius = Math.min(width, height) * 0.3;\n\n    // Clear canvas with fade effect\n    ctx.fillStyle = config.backgroundColor;\n    ctx.fillRect(0, 0, width, height);\n\n    // Draw center circle\n    ctx.fillStyle = config.primaryColor + \"40\";\n    ctx.beginPath();\n    ctx.arc(centerX, centerY, radius * 0.8, 0, Math.PI * 2);\n    ctx.fill();\n\n    // Draw circular visualization\n    const angleStep = (Math.PI * 2) / data.length;\n\n    for (let i = 0; i < data.length; i++) {\n      const amplitude = (data[i] / 255) * radius;\n      const angle = i * angleStep;\n\n      const x1 = centerX + Math.cos(angle) * radius;\n      const y1 = centerY + Math.sin(angle) * radius;\n      const x2 = centerX + Math.cos(angle) * (radius + amplitude);\n      const y2 = centerY + Math.sin(angle) * (radius + amplitude);\n\n      // Create gradient\n      const gradient = ctx.createLinearGradient(x1, y1, x2, y2);\n      gradient.addColorStop(0, config.primaryColor + \"CC\");\n      gradient.addColorStop(1, config.secondaryColor + \"66\");\n\n      ctx.strokeStyle = gradient;\n      ctx.lineWidth = 2;\n      ctx.beginPath();\n      ctx.moveTo(x1, y1);\n      ctx.lineTo(x2, y2);\n      ctx.stroke();\n    }\n  }\n}\n\nexport class ParticlesRenderer implements VisualizerRenderer {\n  private particles: Array<{\n    x: number;\n    y: number;\n    vx: number;\n    vy: number;\n    life: number;\n  }> = [];\n\n  render(\n    data: Uint8Array,\n    canvas: HTMLCanvasElement,\n    config: VisualizerConfig,\n  ): void {\n    const ctx = canvas.getContext(\"2d\")!;\n    const width = canvas.width;\n    const height = canvas.height;\n\n    // Clear canvas\n    ctx.fillStyle = config.backgroundColor;\n    ctx.fillRect(0, 0, width, height);\n\n    // Calculate average amplitude\n    const avgAmplitude = data.reduce((sum, val) => sum + val, 0) / data.length;\n\n    // Generate new particles based on audio intensity\n    if (avgAmplitude > 50) {\n      for (let i = 0; i < Math.floor(avgAmplitude / 20); i++) {\n        this.particles.push({\n          x: Math.random() * width,\n          y: height,\n          vx: (Math.random() - 0.5) * 4,\n          vy: -Math.random() * 5 - 2,\n          life: 1.0,\n        });\n      }\n    }\n\n    // Update and draw particles\n    this.particles = this.particles.filter((particle) => {\n      particle.x += particle.vx;\n      particle.y += particle.vy;\n      particle.vy += 0.1; // gravity\n      particle.life -= 0.02;\n\n      if (particle.life > 0) {\n        ctx.fillStyle =\n          config.primaryColor +\n          Math.floor(particle.life * 255)\n            .toString(16)\n            .padStart(2, \"0\");\n        ctx.beginPath();\n        ctx.arc(particle.x, particle.y, 2, 0, Math.PI * 2);\n        ctx.fill();\n        return true;\n      }\n      return false;\n    });\n  }\n}\n\nexport class AudioVisualizationService {\n  private audioContext: AudioContext | null = null;\n  private analyser: AnalyserNode | null = null;\n  private source: MediaElementAudioSourceNode | null = null;\n  private dataArray: Uint8Array | null = null;\n  private animationFrame: number | null = null;\n  private renderers: Map<VisualizationType, VisualizerRenderer>;\n  private currentRenderer: VisualizerRenderer | null = null;\n  private currentType: VisualizationType = \"bars\";\n  private config: VisualizerConfig;\n  private initialized: boolean = false;\n\n  constructor(config: Partial<VisualizerConfig> = {}) {\n    this.config = {\n      fftSize: 256,\n      smoothingTimeConstant: 0.8,\n      minDecibels: -90,\n      maxDecibels: -10,\n      backgroundColor: \"rgba(0, 0, 0, 0.1)\",\n      primaryColor: \"#60a5fa\",\n      secondaryColor: \"#3b82f6\",\n      ...config,\n    };\n\n    this.renderers = new Map([\n      [\"bars\", new BarsRenderer()],\n      [\"waveform\", new WaveformRenderer()],\n      [\"circular\", new CircularRenderer()],\n      [\"particles\", new ParticlesRenderer()],\n    ]);\n  }\n\n  public initialize(audioElement: HTMLAudioElement): boolean {\n    // Prevent re-initialization\n    if (this.initialized) {\n      return true;\n    }\n\n    try {\n      this.audioContext = new (\n        window.AudioContext || (window as any).webkitAudioContext\n      )();\n      \n      // Create source node only once\n      // Note: This will fail if the element is already connected to a source\n      try {\n        this.source = this.audioContext.createMediaElementSource(audioElement);\n      } catch (sourceError) {\n        console.warn(\"Cannot create media element source (already in use). Visualization disabled.\");\n        // Clean up and return true - audio will still work without visualization\n        this.audioContext.close();\n        this.audioContext = null;\n        this.initialized = true; // Mark as initialized to prevent retrying\n        return true; // Return true so audio continues to work\n      }\n      \n      this.analyser = this.audioContext.createAnalyser();\n\n      // Configure analyser\n      this.analyser.fftSize = this.config.fftSize;\n      this.analyser.smoothingTimeConstant = this.config.smoothingTimeConstant;\n      this.analyser.minDecibels = this.config.minDecibels;\n      this.analyser.maxDecibels = this.config.maxDecibels;\n\n      // Connect audio graph: source -> analyser -> destination\n      // This ensures audio passes through the analyser but still plays\n      this.source.connect(this.analyser);\n      this.analyser.connect(this.audioContext.destination);\n\n      this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n\n      // Resume audio context if suspended\n      if (this.audioContext.state === \"suspended\") {\n        this.audioContext.resume();\n      }\n\n      this.initialized = true;\n      return true;\n    } catch (error) {\n      console.warn(\"Audio visualization initialization failed:\", error);\n      this.initialized = true; // Mark as initialized to prevent retrying\n      return true; // Return true so audio continues to work\n    }\n  }\n\n  public start(\n    canvas: HTMLCanvasElement,\n    type: VisualizationType = \"bars\",\n  ): void {\n    this.currentType = type;\n    this.currentRenderer = this.renderers.get(type) || null;\n\n    if (!this.analyser || !this.dataArray || !this.currentRenderer) {\n      return;\n    }\n\n    // Resume audio context if suspended (required for iOS and other browsers)\n    if (this.audioContext && this.audioContext.state === \"suspended\") {\n      this.audioContext.resume();\n    }\n\n    const animate = () => {\n      if (!this.analyser || !this.dataArray || !this.currentRenderer) return;\n\n      if (this.dataArray) {\n        if (this.currentType === \"waveform\") {\n          this.analyser.getByteTimeDomainData(this.dataArray as any);\n        } else {\n          this.analyser.getByteFrequencyData(this.dataArray as any);\n        }\n      }\n      this.currentRenderer.render(this.dataArray, canvas, this.config);\n\n      this.animationFrame = requestAnimationFrame(animate);\n    };\n\n    animate();\n  }\n\n  public stop(): void {\n    if (this.animationFrame) {\n      cancelAnimationFrame(this.animationFrame);\n      this.animationFrame = null;\n    }\n  }\n\n  public changeType(type: VisualizationType): void {\n    this.currentType = type;\n    this.currentRenderer = this.renderers.get(type) || null;\n  }\n\n  public updateConfig(newConfig: Partial<VisualizerConfig>): void {\n    const oldFftSize = this.config.fftSize;\n    this.config = { ...this.config, ...newConfig };\n\n    if (this.analyser) {\n      this.analyser.smoothingTimeConstant = this.config.smoothingTimeConstant;\n      this.analyser.minDecibels = this.config.minDecibels;\n      this.analyser.maxDecibels = this.config.maxDecibels;\n\n      if (this.config.fftSize !== oldFftSize) {\n        this.analyser.fftSize = this.config.fftSize;\n        this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n      }\n    }\n  }\n\n  // Get available visualization types\n  public getAvailableTypes(): VisualizationType[] {\n    return Array.from(this.renderers.keys());\n  }\n\n  public destroy(): void {\n    this.stop();\n    \n    // Disconnect audio nodes\n    if (this.source) {\n      this.source.disconnect();\n      this.source = null;\n    }\n    \n    if (this.analyser) {\n      this.analyser.disconnect();\n      this.analyser = null;\n    }\n    \n    if (this.audioContext) {\n      this.audioContext.close();\n      this.audioContext = null;\n    }\n    \n    this.dataArray = null;\n    this.currentRenderer = null;\n    this.initialized = false;\n  }\n}\n"],"names":["BarsRenderer","render","data","canvas","config","ctx","getContext","width","height","barWidth","length","fillStyle","backgroundColor","fillRect","i","barHeight","x","y","gradient","createLinearGradient","addColorStop","primaryColor","secondaryColor","WaveformRenderer","lineWidth","strokeStyle","beginPath","sliceWidth","v","moveTo","lineTo","stroke","CircularRenderer","centerX","centerY","radius","Math","min","arc","PI","fill","angleStep","amplitude","angle","x1","cos","y1","sin","x2","y2","ParticlesRenderer","particles","avgAmplitude","reduce","sum","val","floor","push","random","vx","vy","life","filter","particle","toString","padStart","AudioVisualizationService","audioContext","analyser","source","dataArray","animationFrame","renderers","currentRenderer","currentType","initialized","fftSize","smoothingTimeConstant","minDecibels","maxDecibels","Map","initialize","audioElement","window","AudioContext","webkitAudioContext","createMediaElementSource","sourceError","console","warn","close","createAnalyser","connect","destination","Uint8Array","frequencyBinCount","state","resume","error","start","type","get","animate","getByteTimeDomainData","getByteFrequencyData","requestAnimationFrame","stop","cancelAnimationFrame","changeType","updateConfig","newConfig","oldFftSize","getAvailableTypes","Array","from","keys","destroy","disconnect"],"mappings":"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"}},
    {"offset": {"line": 6623, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/components/ModularAudioVisualizer.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\nimport { motion } from \"framer-motion\";\nimport {\n  AudioVisualizationService,\n  VisualizationType,\n} from \"../services/audioVisualizationService\";\n\ninterface ModularAudioVisualizerProps {\n  audioElement?: HTMLAudioElement | null;\n  isPlaying: boolean;\n  className?: string;\n  type?: VisualizationType;\n  width?: number;\n  height?: number;\n  colors?: {\n    primary?: string;\n    secondary?: string;\n    background?: string;\n  };\n}\n\nexport function ModularAudioVisualizer({\n  audioElement,\n  isPlaying,\n  className = \"\",\n  type = \"bars\",\n  width = 300,\n  height = 100,\n  colors = {},\n}: ModularAudioVisualizerProps) {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const visualizationServiceRef = useRef<AudioVisualizationService | null>(\n    null,\n  );\n  const [isSupported, setIsSupported] = useState(true);\n  const [currentType, setCurrentType] = useState<VisualizationType>(type);\n\n  // Initialize visualization service\n  useEffect(() => {\n    visualizationServiceRef.current = new AudioVisualizationService({\n      fftSize: type === \"waveform\" ? 2048 : 256,\n      primaryColor: colors.primary || \"#60a5fa\",\n      secondaryColor: colors.secondary || \"#3b82f6\",\n      backgroundColor: colors.background || \"rgba(0, 0, 0, 0.1)\",\n    });\n\n    return () => {\n      visualizationServiceRef.current?.destroy();\n    };\n  }, []);\n\n  // Handle audio element changes\n  useEffect(() => {\n    if (!audioElement || !visualizationServiceRef.current) {\n      return;\n    }\n\n    const success = visualizationServiceRef.current.initialize(audioElement);\n    if (!success) {\n      console.warn(\"Audio visualization disabled - element already in use\");\n      setIsSupported(false);\n    }\n  }, [audioElement]);\n\n  // Handle playback state changes\n  useEffect(() => {\n    if (!visualizationServiceRef.current || !canvasRef.current) {\n      return;\n    }\n\n    if (isPlaying && isSupported) {\n      visualizationServiceRef.current.start(canvasRef.current, currentType);\n    } else {\n      visualizationServiceRef.current.stop();\n    }\n\n    return () => {\n      visualizationServiceRef.current?.stop();\n    };\n  }, [isPlaying, isSupported, currentType]);\n\n  // Handle prop changes (type, colors)\n  useEffect(() => {\n    if (visualizationServiceRef.current) {\n      visualizationServiceRef.current.updateConfig({\n        fftSize: type === \"waveform\" ? 2048 : 256,\n        primaryColor: colors.primary || \"#60a5fa\",\n        secondaryColor: colors.secondary || \"#3b82f6\",\n        backgroundColor: colors.background || \"rgba(0, 0, 0, 0.1)\",\n      });\n      visualizationServiceRef.current.changeType(type);\n    }\n    setCurrentType(type);\n  }, [type, colors.primary, colors.secondary, colors.background]);\n\n  if (!isSupported) {\n    return (\n      <div className={`flex items-center justify-center ${className}`}>\n        <div className=\"text-gray-500 text-sm\">\n          Audio visualization not supported\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <motion.div\n      className={`relative ${className}`}\n      initial={{ opacity: 0, scale: 0.8 }}\n      animate={{\n        opacity: isPlaying ? 1 : 0.5,\n        scale: 1,\n        filter: isPlaying ? \"blur(0px)\" : \"blur(1px)\",\n      }}\n      transition={{ duration: 0.3 }}\n    >\n      <canvas\n        ref={canvasRef}\n        width={width}\n        height={height}\n        className=\"w-full h-full rounded-lg bg-black/20 backdrop-blur-sm border border-white/10\"\n        style={{\n          imageRendering: \"pixelated\",\n        }}\n      />\n\n      {/* Overlay effects */}\n      {isPlaying && (\n        <>\n          <div className=\"absolute inset-0 rounded-lg bg-gradient-to-t from-blue-500/10 to-transparent pointer-events-none\" />\n          <div className=\"absolute inset-0 rounded-lg shadow-inner pointer-events-none\" />\n        </>\n      )}\n\n      {/* Loading indicator when audio is initializing */}\n      {!isPlaying && (\n        <div className=\"absolute inset-0 flex items-center justify-center\">\n          <div className=\"flex items-center gap-2 text-gray-400 text-xs\">\n            <div className=\"w-3 h-3 border border-gray-400 border-t-transparent rounded-full animate-spin\" />\n            Ready\n          </div>\n        </div>\n      )}\n    </motion.div>\n  );\n}\n\n// Hook for easier visualization type cycling\nexport function useVisualizationType() {\n  const [type, setType] = useState<VisualizationType>(\"bars\");\n  const types: VisualizationType[] = [\n    \"bars\",\n    \"waveform\",\n    \"circular\",\n    \"particles\",\n  ];\n\n  const nextType = () => {\n    const currentIndex = types.indexOf(type);\n    const nextIndex = (currentIndex + 1) % types.length;\n    setType(types[nextIndex]);\n  };\n\n  const setVisualizationType = (newType: VisualizationType) => {\n    setType(newType);\n  };\n\n  return {\n    currentType: type,\n    availableTypes: types,\n    nextType,\n    setType: setVisualizationType,\n  };\n}\n"],"names":["ModularAudioVisualizer","audioElement","isPlaying","className","type","width","height","colors","canvasRef","visualizationServiceRef","isSupported","setIsSupported","currentType","setCurrentType","current","fftSize","primaryColor","primary","secondaryColor","secondary","backgroundColor","background","destroy","success","initialize","console","warn","start","stop","updateConfig","changeType","div","initial","opacity","scale","animate","filter","transition","duration","ref","style","imageRendering","useVisualizationType","setType","types","nextType","currentIndex","indexOf","nextIndex","length","setVisualizationType","newType","availableTypes"],"mappings":";;;;;;;AAEA;AACA;AACA;;;AAJA;;;;AAuBO,SAASA,uBAAuB,EACrCC,YAAY,EACZC,SAAS,EACTC,YAAY,EAAE,EACdC,OAAO,MAAM,EACbC,QAAQ,GAAG,EACXC,SAAS,GAAG,EACZC,SAAS,CAAC,CAAC,EACiB;;IAC5B,MAAMC,YAAY,IAAA,sLAAM,EAAoB;IAC5C,MAAMC,0BAA0B,IAAA,sLAAM,EACpC;IAEF,MAAM,CAACC,aAAaC,eAAe,GAAG,IAAA,wLAAQ,EAAC;IAC/C,MAAM,CAACC,aAAaC,eAAe,GAAG,IAAA,wLAAQ,EAAoBT;IAElE,mCAAmC;IACnC,IAAA,yLAAS;4CAAC;YACRK,wBAAwBK,OAAO,GAAG,IAAI,2LAAyB,CAAC;gBAC9DC,SAASX,SAAS,aAAa,OAAO;gBACtCY,cAAcT,OAAOU,OAAO,IAAI;gBAChCC,gBAAgBX,OAAOY,SAAS,IAAI;gBACpCC,iBAAiBb,OAAOc,UAAU,IAAI;YACxC;YAEA;oDAAO;oBACLZ,wBAAwBK,OAAO,EAAEQ;gBACnC;;QACF;2CAAG,EAAE;IAEL,+BAA+B;IAC/B,IAAA,yLAAS;4CAAC;YACR,IAAI,CAACrB,gBAAgB,CAACQ,wBAAwBK,OAAO,EAAE;gBACrD;YACF;YAEA,MAAMS,UAAUd,wBAAwBK,OAAO,CAACU,UAAU,CAACvB;YAC3D,IAAI,CAACsB,SAAS;gBACZE,QAAQC,IAAI,CAAC;gBACbf,eAAe;YACjB;QACF;2CAAG;QAACV;KAAa;IAEjB,gCAAgC;IAChC,IAAA,yLAAS;4CAAC;YACR,IAAI,CAACQ,wBAAwBK,OAAO,IAAI,CAACN,UAAUM,OAAO,EAAE;gBAC1D;YACF;YAEA,IAAIZ,aAAaQ,aAAa;gBAC5BD,wBAAwBK,OAAO,CAACa,KAAK,CAACnB,UAAUM,OAAO,EAAEF;YAC3D,OAAO;gBACLH,wBAAwBK,OAAO,CAACc,IAAI;YACtC;YAEA;oDAAO;oBACLnB,wBAAwBK,OAAO,EAAEc;gBACnC;;QACF;2CAAG;QAAC1B;QAAWQ;QAAaE;KAAY;IAExC,qCAAqC;IACrC,IAAA,yLAAS;4CAAC;YACR,IAAIH,wBAAwBK,OAAO,EAAE;gBACnCL,wBAAwBK,OAAO,CAACe,YAAY,CAAC;oBAC3Cd,SAASX,SAAS,aAAa,OAAO;oBACtCY,cAAcT,OAAOU,OAAO,IAAI;oBAChCC,gBAAgBX,OAAOY,SAAS,IAAI;oBACpCC,iBAAiBb,OAAOc,UAAU,IAAI;gBACxC;gBACAZ,wBAAwBK,OAAO,CAACgB,UAAU,CAAC1B;YAC7C;YACAS,eAAeT;QACjB;2CAAG;QAACA;QAAMG,OAAOU,OAAO;QAAEV,OAAOY,SAAS;QAAEZ,OAAOc,UAAU;KAAC;IAE9D,IAAI,CAACX,aAAa;QAChB,qBACE,4MAAC;YAAIP,WAAW,CAAC,iCAAiC,EAAEA,WAAW;sBAC7D,cAAA,4MAAC;gBAAIA,WAAU;0BAAwB;;;;;;;;;;;IAK7C;IAEA,qBACE,4MAAC,uLAAM,CAAC4B,GAAG;QACT5B,WAAW,CAAC,SAAS,EAAEA,WAAW;QAClC6B,SAAS;YAAEC,SAAS;YAAGC,OAAO;QAAI;QAClCC,SAAS;YACPF,SAAS/B,YAAY,IAAI;YACzBgC,OAAO;YACPE,QAAQlC,YAAY,cAAc;QACpC;QACAmC,YAAY;YAAEC,UAAU;QAAI;;0BAE5B,4MAAC;gBACCC,KAAK/B;gBACLH,OAAOA;gBACPC,QAAQA;gBACRH,WAAU;gBACVqC,OAAO;oBACLC,gBAAgB;gBAClB;;;;;;YAIDvC,2BACC;;kCACE,4MAAC;wBAAIC,WAAU;;;;;;kCACf,4MAAC;wBAAIA,WAAU;;;;;;;;YAKlB,CAACD,2BACA,4MAAC;gBAAIC,WAAU;0BACb,cAAA,4MAAC;oBAAIA,WAAU;;sCACb,4MAAC;4BAAIA,WAAU;;;;;;wBAAkF;;;;;;;;;;;;;;;;;;AAO7G;GA5HgBH;KAAAA;AA+HT,SAAS0C;;IACd,MAAM,CAACtC,MAAMuC,QAAQ,GAAG,IAAA,wLAAQ,EAAoB;IACpD,MAAMC,QAA6B;QACjC;QACA;QACA;QACA;KACD;IAED,MAAMC,WAAW;QACf,MAAMC,eAAeF,MAAMG,OAAO,CAAC3C;QACnC,MAAM4C,YAAY,CAACF,eAAe,CAAC,IAAIF,MAAMK,MAAM;QACnDN,QAAQC,KAAK,CAACI,UAAU;IAC1B;IAEA,MAAME,uBAAuB,CAACC;QAC5BR,QAAQQ;IACV;IAEA,OAAO;QACLvC,aAAaR;QACbgD,gBAAgBR;QAChBC;QACAF,SAASO;IACX;AACF;IAzBgBR"}},
    {"offset": {"line": 6848, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/components/ModularAudioPlayer.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport {\n  Play,\n  Pause,\n  Volume2,\n  VolumeX,\n  MoreVertical,\n  SkipBack,\n  SkipForward,\n  Settings,\n  Heart,\n  Clock,\n  MapPin,\n} from \"lucide-react\";\nimport { useGlobeStore } from \"../stores/globe-store\";\nimport { useModularAudio } from \"../hooks/useModularAudio\";\nimport {\n  ModularAudioVisualizer,\n  useVisualizationType,\n} from \"./ModularAudioVisualizer\";\n\ninterface ModularAudioPlayerProps {\n  className?: string;\n  showVisualizer?: boolean;\n  compactMode?: boolean;\n  autoPlay?: boolean;\n}\n\nexport function ModularAudioPlayer({\n  className = \"\",\n  showVisualizer = true,\n  compactMode = false,\n  autoPlay = false,\n}: ModularAudioPlayerProps) {\n  const {\n    selectedStation,\n    playlist,\n    playlistIndex,\n    currentRegion,\n    nextStation,\n    previousStation,\n  } = useGlobeStore();\n  const [showSettings, setShowSettings] = useState(false);\n  const [audioState, audioActions] = useModularAudio({ autoPlay, volume: 0.7 });\n  const { currentType, availableTypes, nextType, setType } =\n    useVisualizationType();\n\n  // Enhanced features state\n  const [localTime, setLocalTime] = useState<string>(\"\");\n  const [stationLocalTime, setStationLocalTime] = useState<string>(\"\");\n\n  // Load station when selected\n  useEffect(() => {\n    if (selectedStation) {\n      audioActions.loadStation(selectedStation);\n    }\n  }, [selectedStation, audioActions.loadStation]);\n\n  // Local time updates\n  useEffect(() => {\n    const updateTimes = () => {\n      const now = new Date();\n      setLocalTime(now.toLocaleTimeString('en-US', {\n        hour: '2-digit',\n        minute: '2-digit',\n        hour12: true\n      }));\n      \n      if (selectedStation) {\n        // Calculate estimated local time based on longitude (15 degrees = 1 hour)\n        // This is an approximation of solar time, which is robust offline solution\n        const lng = selectedStation.location.lng;\n        const offsetHours = lng / 15;\n        const utc = now.getTime() + (now.getTimezoneOffset() * 60000);\n        const stationTime = new Date(utc + (3600000 * offsetHours));\n        \n        setStationLocalTime(stationTime.toLocaleTimeString('en-US', {\n          hour: '2-digit',\n          minute: '2-digit',\n          hour12: true\n        }));\n      }\n    };\n    \n    updateTimes();\n    const interval = setInterval(updateTimes, 60000);\n    return () => clearInterval(interval);\n  }, [selectedStation]);\n\n  const formatTime = (time: number): string => {\n    const minutes = Math.floor(time / 60);\n    const seconds = Math.floor(time % 60);\n    return `${minutes}:${seconds.toString().padStart(2, \"0\")}`;\n  };\n\n  if (!selectedStation) {\n    return (\n      <motion.div\n        className={`glass rounded-xl p-6 text-center ${className}`}\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n      >\n        <div className=\"text-gray-400 mb-2\">\n          <Volume2 className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n        </div>\n        <p className=\"text-white text-sm mb-1\">Select a Radio Station</p>\n        <p className=\"text-gray-400 text-xs\">\n          Click on any station marker on the globe\n        </p>\n        <div className=\"mt-3 flex items-center justify-center space-x-1 text-white/60\">\n          <Clock className=\"w-4 h-4\" />\n          <span className=\"text-sm\">Local time: {localTime}</span>\n        </div>\n      </motion.div>\n    );\n  }\n\n  return (\n    <motion.div\n      className={`glass rounded-xl overflow-hidden ${compactMode ? \"p-3\" : \"p-4\"} ${className}`}\n      initial={{ y: 100, opacity: 0 }}\n      animate={{ y: 0, opacity: 1 }}\n      exit={{ y: 100, opacity: 0 }}\n      layout\n    >\n      {/* Station Info Header */}\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className=\"flex items-center space-x-3 flex-1 min-w-0\">\n          {!compactMode && (\n            <div className=\"flex-shrink-0\">\n              <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center\">\n                <span className=\"text-white font-bold text-sm\">\n                  {selectedStation.name.charAt(0)}\n                </span>\n              </div>\n            </div>\n          )}\n\n          <div className=\"min-w-0 flex-1\">\n            <h3\n              className={`text-white font-semibold truncate ${compactMode ? \"text-sm\" : \"\"}`}\n            >\n              {selectedStation.name}\n            </h3>\n            <p\n              className={`text-gray-400 truncate ${compactMode ? \"text-xs\" : \"text-sm\"}`}\n            >\n              {selectedStation.location.city},{\" \"}\n              {selectedStation.location.country} â¢ {selectedStation.genre}\n            </p>\n          </div>\n        </div>\n\n        {/* Time Display */}\n        <div className=\"text-right\">\n          <div className=\"flex items-center space-x-1 text-white text-sm font-medium\">\n            <Clock className=\"w-4 h-4\" />\n            <span>{localTime}</span>\n          </div>\n          {stationLocalTime && stationLocalTime !== localTime && (\n            <div className=\"text-white/60 text-xs\">\n              Station: {stationLocalTime}\n            </div>\n          )}\n        </div>\n\n        {/* Settings Button */}\n        <motion.button\n          onClick={() => setShowSettings(!showSettings)}\n          className=\"text-white/60 hover:text-white transition-colors p-1 rounded ml-2\"\n          whileHover={{ scale: 1.1 }}\n          whileTap={{ scale: 0.9 }}\n        >\n          <Settings className=\"w-4 h-4\" />\n        </motion.button>\n      </div>\n\n      {/* Audio Visualizer - Disabled for now to prevent audio issues */}\n      {/* TODO: Re-implement visualization without Web Audio API interference */}\n      \n      {/* Main Controls */}\n      <div className=\"flex items-center space-x-4\">\n        {/* Previous Station */}\n        <motion.button\n          onClick={previousStation}\n          className=\"text-white hover:text-blue-300 transition-colors p-1\"\n          whileHover={{ scale: 1.1 }}\n          whileTap={{ scale: 0.9 }}\n          title=\"Previous Station\"\n        >\n          <SkipBack className={compactMode ? \"w-5 h-5\" : \"w-6 h-6\"} />\n        </motion.button>\n\n        {/* Play/Pause Button */}\n        <motion.button\n          onClick={\n            audioState.isPlaying ? audioActions.pause : audioActions.play\n          }\n          disabled={audioState.isLoading}\n          className={`flex-shrink-0 ${compactMode ? \"w-10 h-10\" : \"w-12 h-12\"} bg-blue-500 hover:bg-blue-600 disabled:bg-gray-600 rounded-full flex items-center justify-center transition-all shadow-lg shadow-blue-500/30`}\n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n        >\n          {audioState.isLoading ? (\n            <div\n              className={`${compactMode ? \"w-4 h-4\" : \"w-5 h-5\"} border-2 border-white border-t-transparent rounded-full animate-spin`}\n            />\n          ) : audioState.isPlaying ? (\n            <Pause\n              className={`${compactMode ? \"w-4 h-4\" : \"w-5 h-5\"} text-white`}\n            />\n          ) : (\n            <Play\n              className={`${compactMode ? \"w-4 h-4\" : \"w-5 h-5\"} text-white ml-0.5`}\n            />\n          )}\n        </motion.button>\n\n        {/* Next Station */}\n        <motion.button\n          onClick={nextStation}\n          className=\"text-white hover:text-blue-300 transition-colors p-1\"\n          whileHover={{ scale: 1.1 }}\n          whileTap={{ scale: 0.9 }}\n          title=\"Next Station\"\n        >\n          <SkipForward className={compactMode ? \"w-5 h-5\" : \"w-6 h-6\"} />\n        </motion.button>\n\n        {/* Volume Control */}\n        <div className=\"flex items-center space-x-2 flex-1\">\n          <motion.button\n            onClick={audioActions.toggleMute}\n            className=\"text-white hover:text-blue-300 transition-colors\"\n            whileHover={{ scale: 1.1 }}\n          >\n            {audioState.isMuted ? (\n              <VolumeX className={compactMode ? \"w-4 h-4\" : \"w-5 h-5\"} />\n            ) : (\n              <Volume2 className={compactMode ? \"w-4 h-4\" : \"w-5 h-5\"} />\n            )}\n          </motion.button>\n\n          <div className=\"flex-1 max-w-24\">\n            <input\n              type=\"range\"\n              min=\"0\"\n              max=\"100\"\n              value={audioState.isMuted ? 0 : audioState.volume * 100}\n              onChange={(e) =>\n                audioActions.setVolume(Number(e.target.value) / 100)\n              }\n              className=\"w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer\n                        [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 \n                        [&::-webkit-slider-thumb]:bg-blue-500 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer\n                        [&::-moz-range-thumb]:w-3 [&::-moz-range-thumb]:h-3 [&::-moz-range-thumb]:bg-blue-500 [&::-moz-range-thumb]:rounded-full \n                        [&::-moz-range-thumb]:border-0 [&::-moz-range-thumb]:cursor-pointer\"\n            />\n          </div>\n\n          <span className=\"text-white/60 text-xs min-w-8\">\n            {Math.round((audioState.isMuted ? 0 : audioState.volume) * 100)}%\n          </span>\n        </div>\n\n        {/* Now Playing Indicator */}\n        {audioState.isPlaying && !compactMode && (\n          <motion.div\n            className=\"flex items-center space-x-2\"\n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n          >\n            <div className=\"flex space-x-0.5\">\n              {[...Array(3)].map((_, i) => (\n                <motion.div\n                  key={i}\n                  className=\"w-1 bg-green-500 rounded-full\"\n                  animate={{\n                    height: [4, 16, 4],\n                  }}\n                  transition={{\n                    duration: 0.8,\n                    repeat: Infinity,\n                    delay: i * 0.1,\n                  }}\n                />\n              ))}\n            </div>\n            <span className=\"text-green-500 text-xs font-medium\">LIVE</span>\n          </motion.div>\n        )}\n      </div>\n\n      {/* Error Display */}\n      <AnimatePresence>\n        {audioState.error && (\n          <motion.div\n            className=\"mt-3 p-2 bg-red-500/20 border border-red-500/50 rounded text-red-300 text-sm flex items-center justify-between\"\n            initial={{ opacity: 0, height: 0 }}\n            animate={{ opacity: 1, height: \"auto\" }}\n            exit={{ opacity: 0, height: 0 }}\n          >\n            <div className=\"flex-1 flex flex-col\">\n              <span className=\"font-medium\">{audioState.error}</span>\n              {(audioState.error.includes(\"supported\") || audioState.error.includes(\"network\")) && (\n                <span className=\"text-xs opacity-75\">Try another station or check connection</span>\n              )}\n            </div>\n            <div className=\"flex items-center space-x-2\">\n               <button\n                onClick={nextStation}\n                className=\"px-2 py-1 bg-red-500/30 hover:bg-red-500/50 rounded text-xs transition-colors\"\n               >\n                 Next Station\n               </button>\n              <button\n                onClick={audioActions.clearError}\n                className=\"text-red-300 hover:text-red-100 ml-1 p-1\"\n              >\n                Ã\n              </button>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Settings Panel */}\n      <AnimatePresence>\n        {showSettings && (\n          <motion.div\n            initial={{ opacity: 0, height: 0 }}\n            animate={{ opacity: 1, height: \"auto\" }}\n            exit={{ opacity: 0, height: 0 }}\n            className=\"mt-4 p-3 bg-white/5 rounded-lg border border-white/10\"\n          >\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-white text-sm\">Show Visualizer</span>\n                <button\n                  onClick={() => setShowSettings(false)}\n                  className={`w-8 h-4 rounded-full transition-colors ${\n                    showVisualizer ? \"bg-blue-500\" : \"bg-gray-600\"\n                  }`}\n                >\n                  <div\n                    className={`w-3 h-3 bg-white rounded-full transition-transform ${\n                      showVisualizer ? \"translate-x-4\" : \"translate-x-0.5\"\n                    }`}\n                  />\n                </button>\n              </div>\n\n              <div className=\"text-xs text-gray-400\">\n                Station: {selectedStation.name}\n                <br />\n                Genre: {selectedStation.genre}\n                <br />\n                Location: {selectedStation.location.city},{\" \"}\n                {selectedStation.location.country}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n"],"names":["ModularAudioPlayer","className","showVisualizer","compactMode","autoPlay","selectedStation","playlist","playlistIndex","currentRegion","nextStation","previousStation","showSettings","setShowSettings","audioState","audioActions","volume","currentType","availableTypes","nextType","setType","localTime","setLocalTime","stationLocalTime","setStationLocalTime","loadStation","updateTimes","now","Date","toLocaleTimeString","hour","minute","hour12","lng","location","offsetHours","utc","getTime","getTimezoneOffset","stationTime","interval","setInterval","clearInterval","formatTime","time","minutes","Math","floor","seconds","toString","padStart","div","initial","opacity","y","animate","exit","layout","name","charAt","city","country","genre","button","onClick","whileHover","scale","whileTap","title","isPlaying","pause","play","disabled","isLoading","toggleMute","isMuted","type","min","max","value","onChange","e","setVolume","Number","target","round","x","Array","map","_","i","height","transition","duration","repeat","Infinity","delay","error","includes","clearError"],"mappings":"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"}},
    {"offset": {"line": 7567, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/hooks/useUserData.ts"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useCallback } from \"react\";\nimport type { RadioStation } from \"../types\";\n\nconst STORAGE_KEYS = {\n  FAVORITES: \"radioGlobe_favorites\",\n  RECENT: \"radioGlobe_recent\",\n  PREFERENCES: \"radioGlobe_preferences\",\n};\n\nconst MAX_RECENT = 20;\n\ninterface UserPreferences {\n  autoPlay: boolean;\n  defaultVolume: number;\n  preferredGenres: string[];\n  preferredCountries: string[];\n  sleepTimer: number | null; // minutes\n}\n\nconst DEFAULT_PREFERENCES: UserPreferences = {\n  autoPlay: false,\n  defaultVolume: 70,\n  preferredGenres: [],\n  preferredCountries: [],\n  sleepTimer: null,\n};\n\nexport function useFavorites() {\n  const [favorites, setFavorites] = useState<RadioStation[]>([]);\n  const [isLoaded, setIsLoaded] = useState(false);\n\n  // Load favorites from localStorage\n  useEffect(() => {\n    try {\n      const stored = localStorage.getItem(STORAGE_KEYS.FAVORITES);\n      if (stored) {\n        setFavorites(JSON.parse(stored));\n      }\n    } catch (e) {\n      console.error(\"Failed to load favorites:\", e);\n    }\n    setIsLoaded(true);\n  }, []);\n\n  // Save favorites to localStorage\n  useEffect(() => {\n    if (isLoaded) {\n      localStorage.setItem(STORAGE_KEYS.FAVORITES, JSON.stringify(favorites));\n    }\n  }, [favorites, isLoaded]);\n\n  const addFavorite = useCallback((station: RadioStation) => {\n    setFavorites((prev) => {\n      if (prev.some((s) => s.id === station.id)) return prev;\n      return [station, ...prev];\n    });\n  }, []);\n\n  const removeFavorite = useCallback((stationId: string) => {\n    setFavorites((prev) => prev.filter((s) => s.id !== stationId));\n  }, []);\n\n  const isFavorite = useCallback(\n    (stationId: string) => {\n      return favorites.some((s) => s.id === stationId);\n    },\n    [favorites],\n  );\n\n  const toggleFavorite = useCallback(\n    (station: RadioStation) => {\n      if (isFavorite(station.id)) {\n        removeFavorite(station.id);\n      } else {\n        addFavorite(station);\n      }\n    },\n    [isFavorite, removeFavorite, addFavorite],\n  );\n\n  return {\n    favorites,\n    addFavorite,\n    removeFavorite,\n    isFavorite,\n    toggleFavorite,\n    isLoaded,\n  };\n}\n\nexport function useRecentStations() {\n  const [recent, setRecent] = useState<RadioStation[]>([]);\n  const [isLoaded, setIsLoaded] = useState(false);\n\n  // Load recent from localStorage\n  useEffect(() => {\n    try {\n      const stored = localStorage.getItem(STORAGE_KEYS.RECENT);\n      if (stored) {\n        setRecent(JSON.parse(stored));\n      }\n    } catch (e) {\n      console.error(\"Failed to load recent stations:\", e);\n    }\n    setIsLoaded(true);\n  }, []);\n\n  // Save recent to localStorage\n  useEffect(() => {\n    if (isLoaded) {\n      localStorage.setItem(STORAGE_KEYS.RECENT, JSON.stringify(recent));\n    }\n  }, [recent, isLoaded]);\n\n  const addToRecent = useCallback((station: RadioStation) => {\n    setRecent((prev) => {\n      // Remove if already exists\n      const filtered = prev.filter((s) => s.id !== station.id);\n      // Add to front and limit size\n      return [station, ...filtered].slice(0, MAX_RECENT);\n    });\n  }, []);\n\n  const clearRecent = useCallback(() => {\n    setRecent([]);\n  }, []);\n\n  return {\n    recent,\n    addToRecent,\n    clearRecent,\n    isLoaded,\n  };\n}\n\nexport function usePreferences() {\n  const [preferences, setPreferences] =\n    useState<UserPreferences>(DEFAULT_PREFERENCES);\n  const [isLoaded, setIsLoaded] = useState(false);\n\n  // Load preferences from localStorage\n  useEffect(() => {\n    try {\n      const stored = localStorage.getItem(STORAGE_KEYS.PREFERENCES);\n      if (stored) {\n        setPreferences({ ...DEFAULT_PREFERENCES, ...JSON.parse(stored) });\n      }\n    } catch (e) {\n      console.error(\"Failed to load preferences:\", e);\n    }\n    setIsLoaded(true);\n  }, []);\n\n  // Save preferences to localStorage\n  useEffect(() => {\n    if (isLoaded) {\n      localStorage.setItem(\n        STORAGE_KEYS.PREFERENCES,\n        JSON.stringify(preferences),\n      );\n    }\n  }, [preferences, isLoaded]);\n\n  const updatePreference = useCallback(\n    <K extends keyof UserPreferences>(key: K, value: UserPreferences[K]) => {\n      setPreferences((prev) => ({ ...prev, [key]: value }));\n    },\n    [],\n  );\n\n  const addPreferredGenre = useCallback((genre: string) => {\n    setPreferences((prev) => ({\n      ...prev,\n      preferredGenres: Array.from(new Set([...prev.preferredGenres, genre])),\n    }));\n  }, []);\n\n  const removePreferredGenre = useCallback((genre: string) => {\n    setPreferences((prev) => ({\n      ...prev,\n      preferredGenres: prev.preferredGenres.filter((g) => g !== genre),\n    }));\n  }, []);\n\n  return {\n    preferences,\n    updatePreference,\n    addPreferredGenre,\n    removePreferredGenre,\n    isLoaded,\n  };\n}\n\n// Combined hook for all user data\nexport function useUserData() {\n  const favorites = useFavorites();\n  const recent = useRecentStations();\n  const preferences = usePreferences();\n\n  return {\n    favorites,\n    recent,\n    preferences,\n    isLoaded: favorites.isLoaded && recent.isLoaded && preferences.isLoaded,\n  };\n}\n"],"names":["STORAGE_KEYS","FAVORITES","RECENT","PREFERENCES","MAX_RECENT","DEFAULT_PREFERENCES","autoPlay","defaultVolume","preferredGenres","preferredCountries","sleepTimer","useFavorites","favorites","setFavorites","isLoaded","setIsLoaded","stored","localStorage","getItem","JSON","parse","e","console","error","setItem","stringify","addFavorite","station","prev","some","s","id","removeFavorite","stationId","filter","isFavorite","toggleFavorite","useRecentStations","recent","setRecent","addToRecent","filtered","slice","clearRecent","usePreferences","preferences","setPreferences","updatePreference","key","value","addPreferredGenre","genre","Array","from","Set","removePreferredGenre","g","useUserData"],"mappings":"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"}},
    {"offset": {"line": 7840, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/hooks/useUserLocation.ts"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\n\ninterface UserLocation {\n  latitude: number;\n  longitude: number;\n  country?: string;\n  city?: string;\n  timezone?: string;\n}\n\ninterface LocationState {\n  location: UserLocation | null;\n  isLoading: boolean;\n  error: string | null;\n  permissionDenied: boolean;\n}\n\n// Fallback locations by country code\nconst FALLBACK_LOCATIONS: Record<string, UserLocation> = {\n  US: {\n    latitude: 37.7749,\n    longitude: -122.4194,\n    country: \"United States\",\n    city: \"San Francisco\",\n    timezone: \"America/Los_Angeles\",\n  },\n  GB: {\n    latitude: 51.5074,\n    longitude: -0.1278,\n    country: \"United Kingdom\",\n    city: \"London\",\n    timezone: \"Europe/London\",\n  },\n  DE: {\n    latitude: 52.52,\n    longitude: 13.405,\n    country: \"Germany\",\n    city: \"Berlin\",\n    timezone: \"Europe/Berlin\",\n  },\n  FR: {\n    latitude: 48.8566,\n    longitude: 2.3522,\n    country: \"France\",\n    city: \"Paris\",\n    timezone: \"Europe/Paris\",\n  },\n  JP: {\n    latitude: 35.6762,\n    longitude: 139.6503,\n    country: \"Japan\",\n    city: \"Tokyo\",\n    timezone: \"Asia/Tokyo\",\n  },\n  KE: {\n    latitude: -1.2921,\n    longitude: 36.8219,\n    country: \"Kenya\",\n    city: \"Nairobi\",\n    timezone: \"Africa/Nairobi\",\n  },\n  IN: {\n    latitude: 28.6139,\n    longitude: 77.209,\n    country: \"India\",\n    city: \"New Delhi\",\n    timezone: \"Asia/Kolkata\",\n  },\n  BR: {\n    latitude: -23.5505,\n    longitude: -46.6333,\n    country: \"Brazil\",\n    city: \"SÃ£o Paulo\",\n    timezone: \"America/Sao_Paulo\",\n  },\n  AU: {\n    latitude: -33.8688,\n    longitude: 151.2093,\n    country: \"Australia\",\n    city: \"Sydney\",\n    timezone: \"Australia/Sydney\",\n  },\n};\n\nexport function useUserLocation() {\n  const [state, setState] = useState<LocationState>({\n    location: null,\n    isLoading: true,\n    error: null,\n    permissionDenied: false,\n  });\n\n  useEffect(() => {\n    // Try to get from localStorage first (cached location)\n    const cached = localStorage.getItem(\"userLocation\");\n    if (cached) {\n      try {\n        const parsed = JSON.parse(cached);\n        // Use cached if less than 24 hours old\n        if (Date.now() - parsed.timestamp < 24 * 60 * 60 * 1000) {\n          setState({\n            location: parsed.location,\n            isLoading: false,\n            error: null,\n            permissionDenied: false,\n          });\n          return;\n        }\n      } catch (e) {\n        localStorage.removeItem(\"userLocation\");\n      }\n    }\n\n    // Try geolocation API\n    if (\"geolocation\" in navigator) {\n      navigator.geolocation.getCurrentPosition(\n        async (position) => {\n          const { latitude, longitude } = position.coords;\n\n          // Try to get location details via reverse geocoding\n          let locationDetails: UserLocation = { latitude, longitude };\n\n          try {\n            // Using a free reverse geocoding service\n            const response = await fetch(\n              `https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json`,\n              { headers: { \"User-Agent\": \"RadioGlobe/1.0\" } },\n            );\n            if (response.ok) {\n              const data = await response.json();\n              locationDetails = {\n                latitude,\n                longitude,\n                country: data.address?.country,\n                city:\n                  data.address?.city ||\n                  data.address?.town ||\n                  data.address?.village,\n                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,\n              };\n            }\n          } catch (e) {\n            // Reverse geocoding failed, use coordinates only\n            locationDetails.timezone =\n              Intl.DateTimeFormat().resolvedOptions().timeZone;\n          }\n\n          // Cache the location\n          localStorage.setItem(\n            \"userLocation\",\n            JSON.stringify({\n              location: locationDetails,\n              timestamp: Date.now(),\n            }),\n          );\n\n          setState({\n            location: locationDetails,\n            isLoading: false,\n            error: null,\n            permissionDenied: false,\n          });\n        },\n        (error) => {\n          console.warn(\"Geolocation error:\", error.message);\n\n          // Use timezone-based fallback\n          const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n          const fallbackLocation = getFallbackFromTimezone(timezone);\n\n          setState({\n            location: fallbackLocation,\n            isLoading: false,\n            error: error.message,\n            permissionDenied: error.code === error.PERMISSION_DENIED,\n          });\n        },\n        {\n          enableHighAccuracy: false,\n          timeout: 10000,\n          maximumAge: 300000, // 5 minutes\n        },\n      );\n    } else {\n      // Geolocation not supported, use timezone fallback\n      const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n      const fallbackLocation = getFallbackFromTimezone(timezone);\n\n      setState({\n        location: fallbackLocation,\n        isLoading: false,\n        error: \"Geolocation not supported\",\n        permissionDenied: false,\n      });\n    }\n  }, []);\n\n  return state;\n}\n\nfunction getFallbackFromTimezone(timezone: string): UserLocation {\n  // Map timezones to countries\n  if (timezone.startsWith(\"America/\")) {\n    if (timezone.includes(\"Sao_Paulo\") || timezone.includes(\"Brasilia\")) {\n      return FALLBACK_LOCATIONS.BR;\n    }\n    return FALLBACK_LOCATIONS.US;\n  }\n  if (timezone.startsWith(\"Europe/London\")) return FALLBACK_LOCATIONS.GB;\n  if (\n    timezone.startsWith(\"Europe/Berlin\") ||\n    timezone.startsWith(\"Europe/Vienna\")\n  )\n    return FALLBACK_LOCATIONS.DE;\n  if (timezone.startsWith(\"Europe/Paris\")) return FALLBACK_LOCATIONS.FR;\n  if (timezone.startsWith(\"Asia/Tokyo\")) return FALLBACK_LOCATIONS.JP;\n  if (timezone.startsWith(\"Asia/Kolkata\")) return FALLBACK_LOCATIONS.IN;\n  if (timezone.startsWith(\"Africa/Nairobi\")) return FALLBACK_LOCATIONS.KE;\n  if (timezone.startsWith(\"Australia/\")) return FALLBACK_LOCATIONS.AU;\n\n  // Default to US\n  return FALLBACK_LOCATIONS.US;\n}\n\n// Calculate distance between two coordinates in km\nexport function calculateDistance(\n  lat1: number,\n  lon1: number,\n  lat2: number,\n  lon2: number,\n): number {\n  const R = 6371; // Earth's radius in km\n  const dLat = toRad(lat2 - lat1);\n  const dLon = toRad(lon2 - lon1);\n  const a =\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(toRad(lat1)) *\n      Math.cos(toRad(lat2)) *\n      Math.sin(dLon / 2) *\n      Math.sin(dLon / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c;\n}\n\nfunction toRad(deg: number): number {\n  return deg * (Math.PI / 180);\n}\n\n// Get time of day category\nexport function getTimeOfDay(): \"morning\" | \"afternoon\" | \"evening\" | \"night\" {\n  const hour = new Date().getHours();\n  if (hour >= 5 && hour < 12) return \"morning\";\n  if (hour >= 12 && hour < 17) return \"afternoon\";\n  if (hour >= 17 && hour < 21) return \"evening\";\n  return \"night\";\n}\n\n// Get recommended genres based on time of day\nexport function getTimeBasedGenres(): string[] {\n  const timeOfDay = getTimeOfDay();\n  switch (timeOfDay) {\n    case \"morning\":\n      return [\"news\", \"talk\", \"classical\", \"jazz\", \"acoustic\"];\n    case \"afternoon\":\n      return [\"pop\", \"rock\", \"indie\", \"electronic\", \"world\"];\n    case \"evening\":\n      return [\"jazz\", \"soul\", \"r&b\", \"chill\", \"lounge\"];\n    case \"night\":\n      return [\"ambient\", \"electronic\", \"classical\", \"lo-fi\", \"sleep\"];\n  }\n}\n"],"names":["FALLBACK_LOCATIONS","US","latitude","longitude","country","city","timezone","GB","DE","FR","JP","KE","IN","BR","AU","useUserLocation","state","setState","location","isLoading","error","permissionDenied","cached","localStorage","getItem","parsed","JSON","parse","Date","now","timestamp","e","removeItem","navigator","geolocation","getCurrentPosition","position","coords","locationDetails","response","fetch","headers","ok","data","json","address","town","village","Intl","DateTimeFormat","resolvedOptions","timeZone","setItem","stringify","console","warn","message","fallbackLocation","getFallbackFromTimezone","code","PERMISSION_DENIED","enableHighAccuracy","timeout","maximumAge","startsWith","includes","calculateDistance","lat1","lon1","lat2","lon2","R","dLat","toRad","dLon","a","Math","sin","cos","c","atan2","sqrt","deg","PI","getTimeOfDay","hour","getHours","getTimeBasedGenres","timeOfDay"],"mappings":";;;;;;;;;;AAEA;;AAFA;;AAmBA,qCAAqC;AACrC,MAAMA,qBAAmD;IACvDC,IAAI;QACFC,UAAU;QACVC,WAAW,CAAC;QACZC,SAAS;QACTC,MAAM;QACNC,UAAU;IACZ;IACAC,IAAI;QACFL,UAAU;QACVC,WAAW,CAAC;QACZC,SAAS;QACTC,MAAM;QACNC,UAAU;IACZ;IACAE,IAAI;QACFN,UAAU;QACVC,WAAW;QACXC,SAAS;QACTC,MAAM;QACNC,UAAU;IACZ;IACAG,IAAI;QACFP,UAAU;QACVC,WAAW;QACXC,SAAS;QACTC,MAAM;QACNC,UAAU;IACZ;IACAI,IAAI;QACFR,UAAU;QACVC,WAAW;QACXC,SAAS;QACTC,MAAM;QACNC,UAAU;IACZ;IACAK,IAAI;QACFT,UAAU,CAAC;QACXC,WAAW;QACXC,SAAS;QACTC,MAAM;QACNC,UAAU;IACZ;IACAM,IAAI;QACFV,UAAU;QACVC,WAAW;QACXC,SAAS;QACTC,MAAM;QACNC,UAAU;IACZ;IACAO,IAAI;QACFX,UAAU,CAAC;QACXC,WAAW,CAAC;QACZC,SAAS;QACTC,MAAM;QACNC,UAAU;IACZ;IACAQ,IAAI;QACFZ,UAAU,CAAC;QACXC,WAAW;QACXC,SAAS;QACTC,MAAM;QACNC,UAAU;IACZ;AACF;AAEO,SAASS;;IACd,MAAM,CAACC,OAAOC,SAAS,GAAG,IAAA,wLAAQ,EAAgB;QAChDC,UAAU;QACVC,WAAW;QACXC,OAAO;QACPC,kBAAkB;IACpB;IAEA,IAAA,yLAAS;qCAAC;YACR,uDAAuD;YACvD,MAAMC,SAASC,aAAaC,OAAO,CAAC;YACpC,IAAIF,QAAQ;gBACV,IAAI;oBACF,MAAMG,SAASC,KAAKC,KAAK,CAACL;oBAC1B,uCAAuC;oBACvC,IAAIM,KAAKC,GAAG,KAAKJ,OAAOK,SAAS,GAAG,KAAK,KAAK,KAAK,MAAM;wBACvDb,SAAS;4BACPC,UAAUO,OAAOP,QAAQ;4BACzBC,WAAW;4BACXC,OAAO;4BACPC,kBAAkB;wBACpB;wBACA;oBACF;gBACF,EAAE,OAAOU,GAAG;oBACVR,aAAaS,UAAU,CAAC;gBAC1B;YACF;YAEA,sBAAsB;YACtB,IAAI,iBAAiBC,WAAW;gBAC9BA,UAAUC,WAAW,CAACC,kBAAkB;iDACtC,OAAOC;wBACL,MAAM,EAAElC,QAAQ,EAAEC,SAAS,EAAE,GAAGiC,SAASC,MAAM;wBAE/C,oDAAoD;wBACpD,IAAIC,kBAAgC;4BAAEpC;4BAAUC;wBAAU;wBAE1D,IAAI;4BACF,yCAAyC;4BACzC,MAAMoC,WAAW,MAAMC,MACrB,CAAC,gDAAgD,EAAEtC,SAAS,KAAK,EAAEC,UAAU,YAAY,CAAC,EAC1F;gCAAEsC,SAAS;oCAAE,cAAc;gCAAiB;4BAAE;4BAEhD,IAAIF,SAASG,EAAE,EAAE;gCACf,MAAMC,OAAO,MAAMJ,SAASK,IAAI;gCAChCN,kBAAkB;oCAChBpC;oCACAC;oCACAC,SAASuC,KAAKE,OAAO,EAAEzC;oCACvBC,MACEsC,KAAKE,OAAO,EAAExC,QACdsC,KAAKE,OAAO,EAAEC,QACdH,KAAKE,OAAO,EAAEE;oCAChBzC,UAAU0C,KAAKC,cAAc,GAAGC,eAAe,GAAGC,QAAQ;gCAC5D;4BACF;wBACF,EAAE,OAAOpB,GAAG;4BACV,iDAAiD;4BACjDO,gBAAgBhC,QAAQ,GACtB0C,KAAKC,cAAc,GAAGC,eAAe,GAAGC,QAAQ;wBACpD;wBAEA,qBAAqB;wBACrB5B,aAAa6B,OAAO,CAClB,gBACA1B,KAAK2B,SAAS,CAAC;4BACbnC,UAAUoB;4BACVR,WAAWF,KAAKC,GAAG;wBACrB;wBAGFZ,SAAS;4BACPC,UAAUoB;4BACVnB,WAAW;4BACXC,OAAO;4BACPC,kBAAkB;wBACpB;oBACF;;iDACA,CAACD;wBACCkC,QAAQC,IAAI,CAAC,sBAAsBnC,MAAMoC,OAAO;wBAEhD,8BAA8B;wBAC9B,MAAMlD,WAAW0C,KAAKC,cAAc,GAAGC,eAAe,GAAGC,QAAQ;wBACjE,MAAMM,mBAAmBC,wBAAwBpD;wBAEjDW,SAAS;4BACPC,UAAUuC;4BACVtC,WAAW;4BACXC,OAAOA,MAAMoC,OAAO;4BACpBnC,kBAAkBD,MAAMuC,IAAI,KAAKvC,MAAMwC,iBAAiB;wBAC1D;oBACF;gDACA;oBACEC,oBAAoB;oBACpBC,SAAS;oBACTC,YAAY;gBACd;YAEJ,OAAO;gBACL,mDAAmD;gBACnD,MAAMzD,WAAW0C,KAAKC,cAAc,GAAGC,eAAe,GAAGC,QAAQ;gBACjE,MAAMM,mBAAmBC,wBAAwBpD;gBAEjDW,SAAS;oBACPC,UAAUuC;oBACVtC,WAAW;oBACXC,OAAO;oBACPC,kBAAkB;gBACpB;YACF;QACF;oCAAG,EAAE;IAEL,OAAOL;AACT;GAlHgBD;AAoHhB,SAAS2C,wBAAwBpD,QAAgB;IAC/C,6BAA6B;IAC7B,IAAIA,SAAS0D,UAAU,CAAC,aAAa;QACnC,IAAI1D,SAAS2D,QAAQ,CAAC,gBAAgB3D,SAAS2D,QAAQ,CAAC,aAAa;YACnE,OAAOjE,mBAAmBa,EAAE;QAC9B;QACA,OAAOb,mBAAmBC,EAAE;IAC9B;IACA,IAAIK,SAAS0D,UAAU,CAAC,kBAAkB,OAAOhE,mBAAmBO,EAAE;IACtE,IACED,SAAS0D,UAAU,CAAC,oBACpB1D,SAAS0D,UAAU,CAAC,kBAEpB,OAAOhE,mBAAmBQ,EAAE;IAC9B,IAAIF,SAAS0D,UAAU,CAAC,iBAAiB,OAAOhE,mBAAmBS,EAAE;IACrE,IAAIH,SAAS0D,UAAU,CAAC,eAAe,OAAOhE,mBAAmBU,EAAE;IACnE,IAAIJ,SAAS0D,UAAU,CAAC,iBAAiB,OAAOhE,mBAAmBY,EAAE;IACrE,IAAIN,SAAS0D,UAAU,CAAC,mBAAmB,OAAOhE,mBAAmBW,EAAE;IACvE,IAAIL,SAAS0D,UAAU,CAAC,eAAe,OAAOhE,mBAAmBc,EAAE;IAEnE,gBAAgB;IAChB,OAAOd,mBAAmBC,EAAE;AAC9B;AAGO,SAASiE,kBACdC,IAAY,EACZC,IAAY,EACZC,IAAY,EACZC,IAAY;IAEZ,MAAMC,IAAI,MAAM,uBAAuB;IACvC,MAAMC,OAAOC,MAAMJ,OAAOF;IAC1B,MAAMO,OAAOD,MAAMH,OAAOF;IAC1B,MAAMO,IACJC,KAAKC,GAAG,CAACL,OAAO,KAAKI,KAAKC,GAAG,CAACL,OAAO,KACrCI,KAAKE,GAAG,CAACL,MAAMN,SACbS,KAAKE,GAAG,CAACL,MAAMJ,SACfO,KAAKC,GAAG,CAACH,OAAO,KAChBE,KAAKC,GAAG,CAACH,OAAO;IACpB,MAAMK,IAAI,IAAIH,KAAKI,KAAK,CAACJ,KAAKK,IAAI,CAACN,IAAIC,KAAKK,IAAI,CAAC,IAAIN;IACrD,OAAOJ,IAAIQ;AACb;AAEA,SAASN,MAAMS,GAAW;IACxB,OAAOA,MAAM,CAACN,KAAKO,EAAE,GAAG,GAAG;AAC7B;AAGO,SAASC;IACd,MAAMC,OAAO,IAAIzD,OAAO0D,QAAQ;IAChC,IAAID,QAAQ,KAAKA,OAAO,IAAI,OAAO;IACnC,IAAIA,QAAQ,MAAMA,OAAO,IAAI,OAAO;IACpC,IAAIA,QAAQ,MAAMA,OAAO,IAAI,OAAO;IACpC,OAAO;AACT;AAGO,SAASE;IACd,MAAMC,YAAYJ;IAClB,OAAQI;QACN,KAAK;YACH,OAAO;gBAAC;gBAAQ;gBAAQ;gBAAa;gBAAQ;aAAW;QAC1D,KAAK;YACH,OAAO;gBAAC;gBAAO;gBAAQ;gBAAS;gBAAc;aAAQ;QACxD,KAAK;YACH,OAAO;gBAAC;gBAAQ;gBAAQ;gBAAO;gBAAS;aAAS;QACnD,KAAK;YACH,OAAO;gBAAC;gBAAW;gBAAc;gBAAa;gBAAS;aAAQ;IACnE;AACF"}},
    {"offset": {"line": 8106, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/components/StationPanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { motion } from \"framer-motion\";\nimport {\n  MapPin,\n  Clock,\n  Users,\n  ExternalLink,\n  Heart,\n  Share2,\n  X,\n  Wifi,\n  WifiOff,\n  Copy,\n  Check,\n} from \"lucide-react\";\nimport { RadioStation } from \"../types\";\nimport { useFavorites } from \"../hooks/useUserData\";\nimport { useUserLocation, calculateDistance } from \"../hooks/useUserLocation\";\n\ninterface StationPanelProps {\n  station: RadioStation;\n  onClose?: () => void;\n}\n\nexport function StationPanel({ station, onClose }: StationPanelProps) {\n  const { isFavorite, toggleFavorite } = useFavorites();\n  const { location } = useUserLocation();\n  const [copied, setCopied] = useState(false);\n\n  const isStationFavorite = isFavorite(station.id);\n\n  const currentTime = new Date().toLocaleTimeString(\"en-US\", {\n    timeZone: station.location.timezone || \"UTC\",\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n  });\n\n  // Calculate distance from user\n  const distance =\n    location && station.location.lat && station.location.lng\n      ? calculateDistance(\n          location.latitude,\n          location.longitude,\n          station.location.lat,\n          station.location.lng,\n        )\n      : null;\n\n  const formatDistance = (km: number) => {\n    if (km < 1) return `${Math.round(km * 1000)}m`;\n    if (km < 100) return `${km.toFixed(1)}km`;\n    return `${Math.round(km).toLocaleString()}km`;\n  };\n\n  // Get quality indicator\n  const getQualityIndicator = (bitrate?: number) => {\n    if (!bitrate)\n      return { label: \"Unknown\", color: \"text-gray-400\", icon: WifiOff };\n    if (bitrate >= 256)\n      return { label: \"HD\", color: \"text-green-400\", icon: Wifi };\n    if (bitrate >= 128)\n      return { label: \"Good\", color: \"text-blue-400\", icon: Wifi };\n    return { label: \"Low\", color: \"text-yellow-400\", icon: Wifi };\n  };\n\n  const quality = getQualityIndicator(station.bitrate);\n\n  const handleShare = async () => {\n    const shareData = {\n      title: station.name,\n      text: `Listen to ${station.name} on Radio Globe`,\n      url: `${window.location.origin}?station=${station.id}`,\n    };\n\n    if (navigator.share) {\n      try {\n        await navigator.share(shareData);\n      } catch (e) {\n        // User cancelled or share failed\n        copyToClipboard(shareData.url);\n      }\n    } else {\n      copyToClipboard(shareData.url);\n    }\n  };\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.9 }}\n      animate={{ opacity: 1, scale: 1 }}\n      exit={{ opacity: 0, scale: 0.9 }}\n      className=\"glass rounded-xl p-5 w-80 max-w-sm relative\"\n    >\n      {/* Close Button */}\n      {onClose && (\n        <button\n          onClick={onClose}\n          className=\"absolute top-3 right-3 p-1.5 rounded-lg hover:bg-white/10 transition-colors\"\n        >\n          <X className=\"w-4 h-4 text-gray-400\" />\n        </button>\n      )}\n\n      {/* Header */}\n      <div className=\"mb-4 pr-8\">\n        <div className=\"flex items-start gap-3\">\n          <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0\">\n            <span className=\"text-white font-bold text-lg\">\n              {station.name.charAt(0).toUpperCase()}\n            </span>\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <h3 className=\"font-bold text-lg text-white truncate\">\n              {station.name}\n            </h3>\n            <div className=\"flex items-center gap-1.5 text-gray-400 text-sm\">\n              <MapPin className=\"w-3.5 h-3.5 flex-shrink-0\" />\n              <span className=\"truncate\">\n                {station.location.city}, {station.location.country}\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Distance Badge */}\n        {distance !== null && (\n          <div className=\"mt-2 inline-flex items-center gap-1 px-2 py-1 bg-blue-500/20 text-blue-300 rounded-full text-xs\">\n            <MapPin className=\"w-3 h-3\" />\n            {formatDistance(distance)} away\n          </div>\n        )}\n      </div>\n\n      {/* Stats Grid */}\n      <div className=\"grid grid-cols-3 gap-2 mb-4\">\n        <div className=\"text-center p-2.5 bg-white/5 rounded-lg\">\n          <Users className=\"w-4 h-4 mx-auto mb-1 text-blue-400\" />\n          <div className=\"text-sm font-semibold text-white\">\n            {station.listeners >= 1000\n              ? `${(station.listeners / 1000).toFixed(0)}k`\n              : station.listeners}\n          </div>\n          <div className=\"text-[10px] text-gray-500\">Listeners</div>\n        </div>\n        <div className=\"text-center p-2.5 bg-white/5 rounded-lg\">\n          <Clock className=\"w-4 h-4 mx-auto mb-1 text-green-400\" />\n          <div className=\"text-sm font-semibold text-white\">{currentTime}</div>\n          <div className=\"text-[10px] text-gray-500\">Local Time</div>\n        </div>\n        <div className=\"text-center p-2.5 bg-white/5 rounded-lg\">\n          <quality.icon className={`w-4 h-4 mx-auto mb-1 ${quality.color}`} />\n          <div className={`text-sm font-semibold ${quality.color}`}>\n            {quality.label}\n          </div>\n          <div className=\"text-[10px] text-gray-500\">\n            {station.bitrate ? `${station.bitrate}kbps` : \"Quality\"}\n          </div>\n        </div>\n      </div>\n\n      {/* Genre Tags */}\n      {station.genre && (\n        <div className=\"flex flex-wrap gap-1.5 mb-4\">\n          {station.genre\n            .split(\",\")\n            .slice(0, 3)\n            .map((genre, i) => (\n              <span\n                key={i}\n                className=\"px-2 py-0.5 bg-white/10 text-gray-300 rounded-full text-xs\"\n              >\n                {genre.trim()}\n              </span>\n            ))}\n        </div>\n      )}\n\n      {/* Language & Details */}\n      <div className=\"space-y-2 mb-4 text-sm\">\n        {station.language && (\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-gray-500\">Language</span>\n            <span className=\"text-gray-300 capitalize\">{station.language}</span>\n          </div>\n        )}\n      </div>\n\n      {/* Actions */}\n      <div className=\"flex gap-2\">\n        <button\n          onClick={() => toggleFavorite(station)}\n          className={`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg font-medium transition-all ${\n            isStationFavorite\n              ? \"bg-pink-500/20 text-pink-400 border border-pink-500/30\"\n              : \"bg-white/10 text-white hover:bg-white/20\"\n          }`}\n        >\n          <Heart\n            className={`w-4 h-4 ${isStationFavorite ? \"fill-current\" : \"\"}`}\n          />\n          {isStationFavorite ? \"Saved\" : \"Save\"}\n        </button>\n        <button\n          onClick={handleShare}\n          className=\"flex items-center justify-center gap-2 px-4 py-2.5 bg-white/10 text-white rounded-lg hover:bg-white/20 transition-colors\"\n        >\n          {copied ? (\n            <Check className=\"w-4 h-4 text-green-400\" />\n          ) : (\n            <Share2 className=\"w-4 h-4\" />\n          )}\n        </button>\n        {station.website && (\n          <a\n            href={station.website}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className=\"flex items-center justify-center px-3 py-2.5 bg-white/10 text-white rounded-lg hover:bg-white/20 transition-colors\"\n          >\n            <ExternalLink className=\"w-4 h-4\" />\n          </a>\n        )}\n      </div>\n    </motion.div>\n  );\n}\n"],"names":["StationPanel","station","onClose","isFavorite","toggleFavorite","location","copied","setCopied","isStationFavorite","id","currentTime","Date","toLocaleTimeString","timeZone","timezone","hour","minute","distance","lat","lng","latitude","longitude","formatDistance","km","Math","round","toFixed","toLocaleString","getQualityIndicator","bitrate","label","color","icon","quality","handleShare","shareData","title","name","text","url","window","origin","navigator","share","e","copyToClipboard","clipboard","writeText","setTimeout","div","initial","opacity","scale","animate","exit","className","onClick","charAt","toUpperCase","city","country","listeners","genre","split","slice","map","i","trim","language","website","href","target","rel"],"mappings":"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"}},
    {"offset": {"line": 8563, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/components/SearchPanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport {\n  Search,\n  MapPin,\n  Volume2,\n  Heart,\n  Share,\n  Globe,\n  Music,\n  Radio,\n} from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { RadioStation } from \"../types\";\nimport { useGlobeStore } from \"../stores/globe-store\";\nimport { radioStationService } from \"../services/radioStationService\";\n\ninterface SearchPanelProps {\n  className?: string;\n}\n\nexport function SearchPanel({ className = \"\" }: SearchPanelProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [searchResults, setSearchResults] = useState<RadioStation[]>([]);\n  const [fullResults, setFullResults] = useState<RadioStation[]>([]);\n  const [resultLimit, setResultLimit] = useState(20);\n  const [totalResults, setTotalResults] = useState(0);\n  const [popularStations, setPopularStations] = useState<RadioStation[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [searchFilter, setSearchFilter] = useState<\n    \"all\" | \"genre\" | \"country\" | \"city\"\n  >(\"all\");\n  const [availableCountries, setAvailableCountries] = useState<string[]>([]);\n  const [availableCities, setAvailableCities] = useState<string[]>([]);\n  const { selectStation } = useGlobeStore();\n\n  const getDefaultLimit = (filter: \"all\" | \"genre\" | \"country\" | \"city\") => {\n    switch (filter) {\n      case \"country\":\n        return 60;\n      case \"city\":\n        return 40;\n      default:\n        return 20;\n    }\n  };\n\n  // Load popular stations, countries, and cities once\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const stations = await radioStationService.getPopularStations(8);\n        setPopularStations(stations);\n        \n        // Load available countries and cities for filtering (from cache)\n        const countries = await radioStationService.getAvailableCountries();\n        setAvailableCountries(countries);\n        \n        const cities = await radioStationService.getAvailableCities();\n        setAvailableCities(cities);\n        \n        console.log(`Loaded ${countries.length} countries and ${cities.length} cities from cache`);\n      } catch (error) {\n        console.error(\"Failed to load station data:\", error);\n      }\n    };\n    fetchData();\n  }, []);\n\n  // Enhanced smart search with proper filtering logic and faster debounce\n  useEffect(() => {\n    let timer: NodeJS.Timeout;\n\n    // For country/city search, allow shorter search terms\n    const minLength = (searchFilter === \"country\" || searchFilter === \"city\") ? 2 : 3;\n    \n    if (searchTerm.length >= minLength) {\n      setIsLoading(true);\n\n      // Faster debounce for better UX (200ms instead of 300ms)\n      timer = setTimeout(async () => {\n        let results: RadioStation[] = [];\n\n        try {\n          console.log(`ð Smart search: filter=${searchFilter}, term=\"${searchTerm}\"`);\n          const startTime = performance.now();\n          \n          switch (searchFilter) {\n            case \"all\":\n              // Search across all fields: station name, country, city, genre\n              results = await radioStationService.searchStations(searchTerm);\n              break;\n              \n            case \"genre\":\n              // Search specifically by genre/music type\n              results = await radioStationService.getStationsByGenre(searchTerm);\n              break;\n              \n            case \"country\":\n              // Filter stations by country location\n              results = await radioStationService.getStationsByCountry(searchTerm);\n              break;\n              \n            case \"city\":\n              // Filter stations by city location\n              results = await radioStationService.getStationsByCity(searchTerm);\n              break;\n              \n            default:\n              results = await radioStationService.searchStations(searchTerm);\n          }\n\n          const searchTime = (performance.now() - startTime).toFixed(0);\n          console.log(`â Found ${results.length} results in ${searchTime}ms`);\n          \n          // Results are already sorted by relevance in the service\n          const defaultLimit = getDefaultLimit(searchFilter);\n          const limit = Math.min(defaultLimit, results.length);\n          setFullResults(results);\n          setTotalResults(results.length);\n          setResultLimit(limit);\n          setSearchResults(results.slice(0, limit));\n        } catch (error) {\n          console.error(\"Search error:\", error);\n          setFullResults([]);\n          setTotalResults(0);\n          setSearchResults([]);\n        } finally {\n          setIsLoading(false);\n        }\n      }, 200);\n    } else {\n      setSearchResults([]);\n      setFullResults([]);\n      setTotalResults(0);\n      setResultLimit(getDefaultLimit(searchFilter));\n      setIsLoading(false);\n    }\n\n    return () => {\n      if (timer) clearTimeout(timer);\n    };\n  }, [searchTerm, searchFilter]);\n\n  const handleStationSelect = (station: RadioStation) => {\n    selectStation(station);\n    setIsOpen(false);\n    setSearchTerm(\"\");\n    setSearchResults([]);\n    setFullResults([]);\n    setTotalResults(0);\n    setResultLimit(getDefaultLimit(searchFilter));\n  };\n\n  const handleLoadMoreResults = () => {\n    if (fullResults.length === 0) return;\n    const nextLimit = Math.min(resultLimit + 20, fullResults.length);\n    if (nextLimit > resultLimit) {\n      setResultLimit(nextLimit);\n      setSearchResults(fullResults.slice(0, nextLimit));\n    }\n  };\n\n  return (\n    <div className={`relative ${className}`}>\n      {/* Search Input */}\n      <motion.div className=\"flex items-center\" whileHover={{ scale: 1.02 }}>\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-3 w-4 h-4 text-gray-400\" />\n          <input\n            type=\"text\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            onFocus={() => setIsOpen(true)}\n            placeholder={\n              searchFilter === \"country\" ? \"Search countries (e.g. Germany, Japan, Brazil)...\" :\n              searchFilter === \"genre\" ? \"Search genres (e.g. rock, jazz, news, classical)...\" :\n              searchFilter === \"city\" ? `Search cities (e.g. ${availableCities.slice(0, 3).join(\", \") || \"London, Tokyo, New York\"}...)` :\n              \"Search stations, countries, cities, or genres...\"\n            }\n            className=\"glass pl-10 pr-4 py-2 w-64 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          />\n          {isLoading && (\n            <div className=\"absolute right-3 top-3\">\n              <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n            </div>\n          )}\n        </div>\n      </motion.div>\n\n      {/* Search Results Dropdown */}\n      <AnimatePresence>\n        {isOpen && (\n          <motion.div\n            initial={{ opacity: 0, y: -10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: -10 }}\n            className=\"absolute top-full left-0 mt-2 w-80 glass rounded-xl overflow-hidden z-50 max-h-96 overflow-y-auto\"\n          >\n            {/* Search Filters */}\n            <div className=\"p-3 border-b border-white/10\">\n              <div className=\"flex gap-2\">\n                {[\"all\", \"genre\", \"country\", \"city\"].map((filter) => (\n                  <button\n                    key={filter}\n                    onClick={() => {\n                      const nextFilter = filter as \"all\" | \"genre\" | \"country\" | \"city\";\n                      setSearchFilter(nextFilter);\n                      setSearchTerm(\"\"); // Clear search when changing filter\n                      setSearchResults([]);\n                      setFullResults([]);\n                      setTotalResults(0);\n                      setResultLimit(getDefaultLimit(nextFilter));\n                    }}\n                    className={`px-3 py-1 text-xs rounded-full transition-colors ${\n                      searchFilter === filter\n                        ? \"bg-blue-500 text-white shadow-lg\"\n                        : \"bg-white/10 text-gray-300 hover:bg-white/20\"\n                    }`}\n                  >\n                    {filter === \"country\" && \"ð \"}\n                    {filter === \"city\" && \"ðï¸ \"}\n                    {filter === \"genre\" && \"ðµ \"}\n                    {filter === \"all\" && \"ð \"}\n                    {filter.charAt(0).toUpperCase() + filter.slice(1)}\n                  </button>\n                ))}\n              </div>\n            </div>\n\n            {/* Search Results */}\n            {searchResults.length > 0 && (\n              <div className=\"p-2\">\n                <div className=\"text-xs text-gray-400 px-2 py-1 flex items-center gap-2\">\n                  {searchFilter === \"all\" && <Search className=\"w-3 h-3\" />}\n                  {searchFilter === \"country\" && <Globe className=\"w-3 h-3\" />}\n                  {searchFilter === \"city\" && <MapPin className=\"w-3 h-3\" />}\n                  {searchFilter === \"genre\" && <Music className=\"w-3 h-3\" />}\n                  <span>\n                    Showing {searchResults.length}\n                    {totalResults > searchResults.length ? ` of ${totalResults}` : \"\"} {searchFilter === \"all\" ? \"stations\" : searchFilter} results\n                    {searchFilter === \"country\" && searchTerm && ` in ${searchTerm}`}\n                    {searchFilter === \"city\" && searchTerm && ` in ${searchTerm}`}\n                    {searchFilter === \"genre\" && searchTerm && ` for ${searchTerm}`}\n                    {searchFilter === \"all\" && searchTerm && ` for \"${searchTerm}\"`}\n                  </span>\n                </div>\n                {searchResults.map((station) => (\n                  <motion.button\n                    key={station.id}\n                    onClick={() => handleStationSelect(station)}\n                    className=\"w-full p-3 text-left hover:bg-white/10 rounded-lg transition-colors\"\n                    whileHover={{ scale: 1.02 }}\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0\">\n                        <Radio className=\"w-5 h-5 text-white\" />\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"font-medium text-white text-sm truncate\">\n                          {station.name}\n                        </div>\n                        <div className=\"text-xs text-gray-400 flex items-center gap-2\">\n                          <MapPin className=\"w-3 h-3\" />\n                          {station.location.city}, {station.location.country}\n                          <span className=\"bg-blue-500/20 text-blue-300 px-1.5 py-0.5 rounded text-xs\">\n                            {station.genre}\n                          </span>\n                        </div>\n                      </div>\n                      <div className=\"text-xs text-gray-500\">\n                        {(station.listeners / 1000).toFixed(0)}k\n                      </div>\n                    </div>\n                  </motion.button>\n                ))}\n                {totalResults > searchResults.length && (\n                  <div className=\"px-2 pb-2\">\n                    <button\n                      onClick={handleLoadMoreResults}\n                      className=\"w-full py-2 text-xs text-blue-300 bg-white/10 hover:bg-white/20 rounded-lg transition-colors\"\n                    >\n                      Show more stations ({totalResults - searchResults.length} more)\n                    </button>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* Country suggestions (when country filter is selected and no search term) */}\n            {searchFilter === \"country\" && searchTerm.length === 0 && availableCountries.length > 0 && (\n              <div className=\"p-2\">\n                <div className=\"text-xs text-gray-400 px-2 py-2 flex items-center gap-2\">\n                  <Globe className=\"w-3 h-3\" />\n                  Select a Country\n                </div>\n                <div className=\"grid grid-cols-2 gap-1 max-h-48 overflow-y-auto\">\n                  {availableCountries.slice(0, 20).map((country) => (\n                    <button\n                      key={country}\n                      onClick={() => {\n                        setSearchTerm(country);\n                        setSearchFilter(\"country\");\n                        setSearchResults([]);\n                        setFullResults([]);\n                        setTotalResults(0);\n                        setResultLimit(getDefaultLimit(\"country\"));\n                      }}\n                      className=\"p-2 text-left text-sm text-gray-300 hover:bg-white/10 rounded transition-colors truncate\"\n                    >\n                      {country}\n                    </button>\n                  ))}\n                </div>\n                {availableCountries.length > 20 && (\n                  <div className=\"text-xs text-gray-500 px-2 py-1\">\n                    +{availableCountries.length - 20} more countries... Start typing to search\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* Popular Stations (when no search and not country filter) */}\n            {searchTerm.length === 0 && searchFilter !== \"country\" && popularStations.length > 0 && (\n              <div className=\"p-2\">\n                <div className=\"text-xs text-gray-400 px-2 py-2 flex items-center gap-2\">\n                  <Music className=\"w-3 h-3\" />\n                  Popular Stations\n                </div>\n                {popularStations.map((station) => (\n                  <motion.button\n                    key={station.id}\n                    onClick={() => handleStationSelect(station)}\n                    className=\"w-full p-3 text-left hover:bg-white/10 rounded-lg transition-colors\"\n                    whileHover={{ scale: 1.02 }}\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-8 h-8 bg-gradient-to-r from-green-500 to-blue-600 rounded-lg flex items-center justify-center flex-shrink-0\">\n                        <span className=\"text-white text-xs font-bold\">\n                          {station.name.charAt(0)}\n                        </span>\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"font-medium text-white text-sm truncate\">\n                          {station.name}\n                        </div>\n                        <div className=\"text-xs text-gray-400\">\n                          {station.location.city}, {station.location.country}\n                        </div>\n                      </div>\n                      <div className=\"text-xs text-green-400\">\n                        {(station.listeners / 1000).toFixed(0)}k\n                      </div>\n                    </div>\n                  </motion.button>\n                ))}\n              </div>\n            )}\n\n            {/* No Results */}\n            {searchTerm.length > 2 &&\n              searchResults.length === 0 &&\n              !isLoading && (\n                <div className=\"p-6 text-center text-gray-400\">\n                  <Globe className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n                  <div className=\"text-sm\">No stations found</div>\n                  <div className=\"text-xs\">\n                    Try searching by genre or country\n                  </div>\n                </div>\n              )}\n\n            {/* Close Button */}\n            <div className=\"p-2 border-t border-white/10\">\n              <button\n                onClick={() => {\n                  setIsOpen(false);\n                  setSearchTerm(\"\");\n                  setSearchResults([]);\n                  setFullResults([]);\n                  setTotalResults(0);\n                  setResultLimit(getDefaultLimit(searchFilter));\n                }}\n                className=\"w-full py-2 text-xs text-gray-400 hover:text-white transition-colors\"\n              >\n                Close\n              </button>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Click outside to close */}\n      {isOpen && (\n        <div\n          className=\"fixed inset-0 z-40\"\n          onClick={() => {\n            setIsOpen(false);\n            setSearchTerm(\"\");\n            setSearchResults([]);\n            setFullResults([]);\n            setTotalResults(0);\n            setResultLimit(getDefaultLimit(searchFilter));\n          }}\n        />\n      )}\n    </div>\n  );\n}\n"],"names":["SearchPanel","className","isOpen","setIsOpen","searchTerm","setSearchTerm","searchResults","setSearchResults","fullResults","setFullResults","resultLimit","setResultLimit","totalResults","setTotalResults","popularStations","setPopularStations","isLoading","setIsLoading","searchFilter","setSearchFilter","availableCountries","setAvailableCountries","availableCities","setAvailableCities","selectStation","getDefaultLimit","filter","fetchData","stations","getPopularStations","countries","getAvailableCountries","cities","getAvailableCities","console","log","length","error","timer","minLength","setTimeout","results","startTime","performance","now","searchStations","getStationsByGenre","getStationsByCountry","getStationsByCity","searchTime","toFixed","defaultLimit","limit","Math","min","slice","clearTimeout","handleStationSelect","station","handleLoadMoreResults","nextLimit","div","whileHover","scale","type","value","onChange","e","target","onFocus","placeholder","join","initial","opacity","y","animate","exit","map","onClick","nextFilter","charAt","toUpperCase","button","name","location","city","country","genre","listeners","id"],"mappings":"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"}},
    {"offset": {"line": 9271, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/components/StationDirectory.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useMemo, useEffect } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport {\n  Globe,\n  Radio,\n  MapPin,\n  Play,\n  Volume2,\n  Heart,\n  Clock,\n  Compass,\n  TrendingUp,\n  History,\n  Sparkles,\n  Filter,\n  ChevronDown,\n} from \"lucide-react\";\nimport { RadioStation } from \"../types\";\nimport { useGlobeStore } from \"../stores/globe-store\";\nimport { useFavorites, useRecentStations } from \"../hooks/useUserData\";\nimport {\n  useUserLocation,\n  calculateDistance,\n  getTimeOfDay,\n  getTimeBasedGenres,\n} from \"../hooks/useUserLocation\";\nimport { radioDiscoveryService } from \"../services/radioDiscoveryService\";\n\ninterface StationDirectoryProps {\n  className?: string;\n}\n\ntype TabType = \"discover\" | \"nearby\" | \"favorites\" | \"recent\";\n\nexport function StationDirectory({ className = \"\" }: StationDirectoryProps) {\n  const [activeTab, setActiveTab] = useState<TabType>(\"discover\");\n  const [selectedGenre, setSelectedGenre] = useState<string>(\"all\");\n  const [stations, setStations] = useState<RadioStation[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [showFilters, setShowFilters] = useState(false);\n\n  const { selectedStation, selectStation } = useGlobeStore();\n  const { favorites, isFavorite, toggleFavorite } = useFavorites();\n  const { recent, addToRecent } = useRecentStations();\n  const { location, isLoading: locationLoading } = useUserLocation();\n\n  // Load stations\n  useEffect(() => {\n    const loadStations = async () => {\n      setIsLoading(true);\n      try {\n        const data = await radioDiscoveryService.getTopStations(100);\n        setStations(data);\n      } catch (error) {\n        console.error(\"Failed to load stations:\", error);\n      }\n      setIsLoading(false);\n    };\n    loadStations();\n  }, []);\n\n  // Get unique genres\n  const genres = useMemo(() => {\n    const allGenres = stations.flatMap(\n      (s) => s.genre?.split(\",\").map((g) => g.trim().toLowerCase()) || [],\n    );\n    return [\"all\", ...Array.from(new Set(allGenres)).slice(0, 10)];\n  }, [stations]);\n\n  // Time-based recommendations\n  const timeOfDay = getTimeOfDay();\n  const recommendedGenres = getTimeBasedGenres();\n\n  // Sort stations by distance if location available\n  const stationsWithDistance = useMemo(() => {\n    if (!location) return stations.map((s) => ({ station: s, distance: null }));\n\n    return stations\n      .map((station) => {\n        const distance =\n          station.location.lat && station.location.lng\n            ? calculateDistance(\n                location.latitude,\n                location.longitude,\n                station.location.lat,\n                station.location.lng,\n              )\n            : null;\n        return { station, distance };\n      })\n      .sort((a, b) => {\n        if (a.distance === null) return 1;\n        if (b.distance === null) return -1;\n        return a.distance - b.distance;\n      });\n  }, [stations, location]);\n\n  // Filter stations by genre\n  const filteredStations = useMemo(() => {\n    if (selectedGenre === \"all\") return stationsWithDistance;\n    return stationsWithDistance.filter(({ station }) =>\n      station.genre?.toLowerCase().includes(selectedGenre),\n    );\n  }, [stationsWithDistance, selectedGenre]);\n\n  // Get display data based on active tab\n  const displayData = useMemo(() => {\n    switch (activeTab) {\n      case \"nearby\":\n        return filteredStations.slice(0, 20);\n      case \"favorites\":\n        return favorites.map((s) => ({ station: s, distance: null }));\n      case \"recent\":\n        return recent.map((s) => ({ station: s, distance: null }));\n      case \"discover\":\n      default:\n        // Time-based smart discovery\n        const timeFiltered = stationsWithDistance.filter(({ station }) =>\n          recommendedGenres.some((genre) =>\n            station.genre?.toLowerCase().includes(genre),\n          ),\n        );\n        // Mix time-relevant with popular\n        return [\n          ...timeFiltered.slice(0, 5),\n          ...stationsWithDistance\n            .filter((s) => !timeFiltered.includes(s))\n            .sort((a, b) => b.station.listeners - a.station.listeners)\n            .slice(0, 15),\n        ];\n    }\n  }, [\n    activeTab,\n    filteredStations,\n    favorites,\n    recent,\n    stationsWithDistance,\n    recommendedGenres,\n  ]);\n\n  const handleStationSelect = (station: RadioStation) => {\n    selectStation(station);\n    addToRecent(station);\n  };\n\n  const formatDistance = (km: number | null) => {\n    if (km === null) return null;\n    if (km < 1) return `${Math.round(km * 1000)}m`;\n    if (km < 100) return `${km.toFixed(0)}km`;\n    return `${Math.round(km).toLocaleString()}km`;\n  };\n\n  const tabs = [\n    { id: \"discover\" as TabType, label: \"Discover\", icon: Sparkles },\n    { id: \"nearby\" as TabType, label: \"Near Me\", icon: Compass },\n    {\n      id: \"favorites\" as TabType,\n      label: \"Favorites\",\n      icon: Heart,\n      count: favorites.length,\n    },\n    {\n      id: \"recent\" as TabType,\n      label: \"Recent\",\n      icon: History,\n      count: recent.length,\n    },\n  ];\n\n  return (\n    <motion.div\n      className={`glass rounded-xl overflow-hidden flex flex-col h-full ${className}`}\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      {/* Header */}\n      <div className=\"p-6 border-b border-white/10 flex-shrink-0\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"relative\">\n              <Globe className=\"w-6 h-6 text-gradient\" />\n              <div className=\"absolute inset-0 animate-pulse-glow rounded-full bg-blue-400/20\" />\n            </div>\n            <div>\n              <h2 className=\"text-xl font-bold text-white tracking-tight\">\n                Stations\n              </h2>\n              <p className=\"text-sm text-gray-400 font-mono\">\n                {displayData.length} available\n              </p>\n            </div>\n          </div>\n\n          {/* Time-based greeting */}\n          <div className=\"flex items-center gap-2 glass px-3 py-2 rounded-lg\">\n            <span className=\"text-sm text-gray-300 font-medium\">\n              {timeOfDay === \"morning\" && \"âï¸ Good morning\"}\n              {timeOfDay === \"afternoon\" && \"ð¤ï¸ Good afternoon\"}\n              {timeOfDay === \"evening\" && \"ð Good evening\"}\n              {timeOfDay === \"night\" && \"ð Night mode\"}\n            </span>\n          </div>\n        </div>\n\n        {/* Enhanced Tabs */}\n        <div className=\"flex gap-2 bg-surface-card/50 p-1.5 rounded-xl\">\n          {tabs.map((tab) => (\n            <motion.button\n              key={tab.id}\n              onClick={() => setActiveTab(tab.id)}\n              className={`flex-1 flex items-center justify-center gap-2 px-3 py-3 text-sm rounded-lg font-medium transition-all ${\n                activeTab === tab.id\n                  ? \"bg-gradient-to-r from-blue-500 to-cyan-400 text-white shadow-lg\"\n                  : \"text-gray-400 hover:text-white hover:bg-white/5\"\n              }`}\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n            >\n              <tab.icon className=\"w-4 h-4\" />\n              <span className=\"hidden sm:inline tracking-wide\">{tab.label}</span>\n              {tab.count !== undefined && tab.count > 0 && (\n                <span\n                  className={`px-2 py-1 text-xs rounded-full font-mono ${\n                    activeTab === tab.id \n                      ? \"bg-white/20 text-white\" \n                      : \"bg-white/10 text-gray-300\"\n                  }`}\n                >\n                  {tab.count}\n                </span>\n              )}\n            </motion.button>\n          ))}\n        </div>\n      </div>\n\n      {/* Filters - For discover and nearby tabs */}\n      {(activeTab === \"discover\" || activeTab === \"nearby\") && (\n        <div className=\"px-4 py-2 border-b border-white/5 flex-shrink-0\">\n          <button\n            onClick={() => setShowFilters(!showFilters)}\n            className=\"flex items-center gap-2 text-xs text-gray-400 hover:text-white transition-colors\"\n          >\n            <Filter className=\"w-3.5 h-3.5\" />\n            <span>Filter by genre</span>\n            <ChevronDown\n              className={`w-3.5 h-3.5 transition-transform ${showFilters ? \"rotate-180\" : \"\"}`}\n            />\n          </button>\n\n          <AnimatePresence>\n            {showFilters && (\n              <motion.div\n                initial={{ height: 0, opacity: 0 }}\n                animate={{ height: \"auto\", opacity: 1 }}\n                exit={{ height: 0, opacity: 0 }}\n                className=\"overflow-hidden\"\n              >\n                <div className=\"flex flex-wrap gap-1.5 pt-2\">\n                  {genres.map((genre) => (\n                    <button\n                      key={genre}\n                      onClick={() => setSelectedGenre(genre)}\n                      className={`px-2 py-1 text-xs rounded-full transition-colors ${\n                        selectedGenre === genre\n                          ? \"bg-blue-500 text-white\"\n                          : \"bg-white/10 text-gray-400 hover:text-white hover:bg-white/20\"\n                      }`}\n                    >\n                      {genre === \"all\" ? \"All\" : genre}\n                    </button>\n                  ))}\n                </div>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n      )}\n\n      {/* Content Heading */}\n      {activeTab === \"discover\" && (\n        <div className=\"px-4 py-2 flex-shrink-0\">\n          <div className=\"flex items-center gap-2 text-xs text-gray-400\">\n            <TrendingUp className=\"w-3.5 h-3.5 text-green-400\" />\n            <span>\n              Recommended for {timeOfDay}:{\" \"}\n              <span className=\"text-gray-300\">\n                {recommendedGenres.slice(0, 3).join(\", \")}\n              </span>\n            </span>\n          </div>\n        </div>\n      )}\n\n      {activeTab === \"nearby\" && location && (\n        <div className=\"px-4 py-2 flex-shrink-0\">\n          <div className=\"flex items-center gap-2 text-xs text-gray-400\">\n            <MapPin className=\"w-3.5 h-3.5 text-blue-400\" />\n            <span>\n              Stations near{\" \"}\n              <span className=\"text-gray-300\">\n                {location.city || \"your location\"}\n              </span>\n            </span>\n          </div>\n        </div>\n      )}\n\n      {/* Station List */}\n      <div className=\"flex-1 overflow-y-auto\">\n        {isLoading ? (\n          <div className=\"flex items-center justify-center h-32\">\n            <div className=\"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin\" />\n          </div>\n        ) : displayData.length === 0 ? (\n          <div className=\"p-8 text-center text-gray-400\">\n            <Radio className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n            <div className=\"text-sm\">\n              {activeTab === \"favorites\" && \"No favorites yet\"}\n              {activeTab === \"recent\" && \"No recently played\"}\n              {activeTab === \"nearby\" && \"No nearby stations found\"}\n              {activeTab === \"discover\" && \"No stations found\"}\n            </div>\n            <div className=\"text-xs mt-1\">\n              {activeTab === \"favorites\" &&\n                \"Tap the heart icon to save stations\"}\n              {activeTab === \"recent\" && \"Play some stations to see them here\"}\n            </div>\n          </div>\n        ) : (\n          <div className=\"divide-y divide-white/5\">\n            {displayData.map(({ station, distance }) => (\n              <StationListItem\n                key={station.id}\n                station={station}\n                distance={formatDistance(distance)}\n                isSelected={selectedStation?.id === station.id}\n                isFavorite={isFavorite(station.id)}\n                onSelect={() => handleStationSelect(station)}\n                onToggleFavorite={() => toggleFavorite(station)}\n              />\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Footer Stats */}\n      <div className=\"p-3 border-t border-white/10 bg-white/5 flex-shrink-0\">\n        <div className=\"flex justify-between text-xs text-gray-500\">\n          <span>{displayData.length} stations</span>\n          <span>{location?.city && `ð ${location.city}`}</span>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\ninterface StationListItemProps {\n  station: RadioStation;\n  distance: string | null;\n  isSelected: boolean;\n  isFavorite: boolean;\n  onSelect: () => void;\n  onToggleFavorite: () => void;\n}\n\nfunction StationListItem({\n  station,\n  distance,\n  isSelected,\n  isFavorite,\n  onSelect,\n  onToggleFavorite,\n}: StationListItemProps) {\n  return (\n    <motion.div\n      className={`p-3 cursor-pointer transition-colors ${\n        isSelected ? \"bg-blue-500/20\" : \"hover:bg-white/5\"\n      }`}\n      onClick={onSelect}\n      whileTap={{ scale: 0.98 }}\n    >\n      <div className=\"flex items-center gap-3\">\n        {/* Station Icon */}\n        <div\n          className={`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${\n            isSelected\n              ? \"bg-blue-500\"\n              : \"bg-gradient-to-br from-purple-500/30 to-blue-500/30\"\n          }`}\n        >\n          {isSelected ? (\n            <div className=\"flex items-end gap-0.5 h-4\">\n              <div\n                className=\"w-1 bg-white rounded-full animate-pulse\"\n                style={{ height: \"40%\" }}\n              />\n              <div\n                className=\"w-1 bg-white rounded-full animate-pulse\"\n                style={{ height: \"100%\", animationDelay: \"0.1s\" }}\n              />\n              <div\n                className=\"w-1 bg-white rounded-full animate-pulse\"\n                style={{ height: \"60%\", animationDelay: \"0.2s\" }}\n              />\n            </div>\n          ) : (\n            <span className=\"text-white font-bold text-sm\">\n              {station.name.charAt(0).toUpperCase()}\n            </span>\n          )}\n        </div>\n\n        {/* Station Info */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2\">\n            <h3\n              className={`font-medium text-sm truncate ${\n                isSelected ? \"text-blue-300\" : \"text-white\"\n              }`}\n            >\n              {station.name}\n            </h3>\n          </div>\n\n          <div className=\"flex items-center gap-2 text-xs text-gray-500 mt-0.5\">\n            <span className=\"truncate\">{station.location.country}</span>\n            {station.genre && (\n              <>\n                <span className=\"text-gray-600\">â¢</span>\n                <span className=\"truncate text-gray-400\">\n                  {station.genre.split(\",\")[0]}\n                </span>\n              </>\n            )}\n          </div>\n        </div>\n\n        {/* Distance & Stats */}\n        <div className=\"flex items-center gap-2 flex-shrink-0\">\n          {distance && (\n            <span className=\"text-xs text-blue-400 bg-blue-500/10 px-2 py-0.5 rounded-full\">\n              {distance}\n            </span>\n          )}\n\n          <div className=\"flex items-center gap-1 text-xs text-gray-500\">\n            <Volume2 className=\"w-3 h-3\" />\n            <span>\n              {station.listeners >= 1000\n                ? `${(station.listeners / 1000).toFixed(0)}k`\n                : station.listeners}\n            </span>\n          </div>\n\n          {/* Favorite Button */}\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              onToggleFavorite();\n            }}\n            className={`p-1.5 rounded-full transition-colors ${\n              isFavorite\n                ? \"text-pink-400 bg-pink-500/20\"\n                : \"text-gray-500 hover:text-pink-400 hover:bg-white/5\"\n            }`}\n          >\n            <Heart\n              className={`w-3.5 h-3.5 ${isFavorite ? \"fill-current\" : \"\"}`}\n            />\n          </button>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n"],"names":["StationDirectory","className","activeTab","setActiveTab","selectedGenre","setSelectedGenre","stations","setStations","isLoading","setIsLoading","showFilters","setShowFilters","selectedStation","selectStation","favorites","isFavorite","toggleFavorite","recent","addToRecent","location","locationLoading","loadStations","data","getTopStations","error","console","genres","allGenres","flatMap","s","genre","split","map","g","trim","toLowerCase","Array","from","Set","slice","timeOfDay","recommendedGenres","stationsWithDistance","station","distance","lat","lng","latitude","longitude","sort","a","b","filteredStations","filter","includes","displayData","timeFiltered","some","listeners","handleStationSelect","formatDistance","km","Math","round","toFixed","toLocaleString","tabs","id","label","icon","count","length","div","initial","opacity","y","animate","tab","button","onClick","whileHover","scale","whileTap","undefined","height","exit","join","city","StationListItem","isSelected","onSelect","onToggleFavorite","style","animationDelay","name","charAt","toUpperCase","country","e","stopPropagation"],"mappings":"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"}},
    {"offset": {"line": 10127, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/components/UserPanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { User, Settings, LogOut, Heart, History, Globe } from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\nexport function UserPanel() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [isLoggedIn, setIsLoggedIn] = useState(false); // Mock auth state\n\n  if (!isLoggedIn) {\n    return (\n      <div className=\"flex gap-2\">\n        <button className=\"button-secondary text-sm\">Sign In</button>\n        <button className=\"button-primary text-sm\">Sign Up</button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"relative\">\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"flex items-center gap-3 p-3 glass rounded-lg hover:bg-white/20 transition-colors\"\n      >\n        <div className=\"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center\">\n          <User className=\"w-4 h-4 text-white\" />\n        </div>\n        <div className=\"text-left\">\n          <div className=\"text-sm font-medium text-white\">John Doe</div>\n          <div className=\"text-xs text-gray-400\">Premium</div>\n        </div>\n      </button>\n\n      <AnimatePresence>\n        {isOpen && (\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: -10 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: -10 }}\n            className=\"absolute right-0 top-full mt-2 w-64 glass rounded-xl overflow-hidden z-50\"\n          >\n            <div className=\"p-4 border-b border-white/10\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center\">\n                  <User className=\"w-6 h-6 text-white\" />\n                </div>\n                <div>\n                  <div className=\"font-medium text-white\">John Doe</div>\n                  <div className=\"text-sm text-gray-400\">john@example.com</div>\n                  <div className=\"text-xs text-blue-400\">Premium Member</div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"p-2\">\n              <button className=\"w-full flex items-center gap-3 p-3 hover:bg-white/10 rounded-lg transition-colors\">\n                <Heart className=\"w-4 h-4 text-gray-400\" />\n                <span className=\"text-white\">Favorites</span>\n                <span className=\"ml-auto text-xs text-gray-400\">24</span>\n              </button>\n\n              <button className=\"w-full flex items-center gap-3 p-3 hover:bg-white/10 rounded-lg transition-colors\">\n                <History className=\"w-4 h-4 text-gray-400\" />\n                <span className=\"text-white\">Listening History</span>\n              </button>\n\n              <button className=\"w-full flex items-center gap-3 p-3 hover:bg-white/10 rounded-lg transition-colors\">\n                <Globe className=\"w-4 h-4 text-gray-400\" />\n                <span className=\"text-white\">Discover</span>\n              </button>\n\n              <div className=\"border-t border-white/10 my-2\"></div>\n\n              <button className=\"w-full flex items-center gap-3 p-3 hover:bg-white/10 rounded-lg transition-colors\">\n                <Settings className=\"w-4 h-4 text-gray-400\" />\n                <span className=\"text-white\">Settings</span>\n              </button>\n\n              <button className=\"w-full flex items-center gap-3 p-3 hover:bg-white/10 rounded-lg transition-colors text-red-400\">\n                <LogOut className=\"w-4 h-4\" />\n                <span>Sign Out</span>\n              </button>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Click outside to close */}\n      {isOpen && (\n        <div className=\"fixed inset-0 z-40\" onClick={() => setIsOpen(false)} />\n      )}\n    </div>\n  );\n}\n"],"names":["UserPanel","isOpen","setIsOpen","isLoggedIn","setIsLoggedIn","className","onClick","div","initial","opacity","scale","y","animate","exit"],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;;;AAJA;;;;AAMO,SAASA;;IACd,MAAM,CAACC,QAAQC,UAAU,GAAG,IAAA,wLAAQ,EAAC;IACrC,MAAM,CAACC,YAAYC,cAAc,GAAG,IAAA,wLAAQ,EAAC,QAAQ,kBAAkB;IAEvE,IAAI,CAACD,YAAY;QACf,qBACE,4MAAC;YAAIE,WAAU;;8BACb,4MAAC;oBAAOA,WAAU;8BAA2B;;;;;;8BAC7C,4MAAC;oBAAOA,WAAU;8BAAyB;;;;;;;;;;;;IAGjD;IAEA,qBACE,4MAAC;QAAIA,WAAU;;0BACb,4MAAC;gBACCC,SAAS,IAAMJ,UAAU,CAACD;gBAC1BI,WAAU;;kCAEV,4MAAC;wBAAIA,WAAU;kCACb,cAAA,4MAAC,6MAAI;4BAACA,WAAU;;;;;;;;;;;kCAElB,4MAAC;wBAAIA,WAAU;;0CACb,4MAAC;gCAAIA,WAAU;0CAAiC;;;;;;0CAChD,4MAAC;gCAAIA,WAAU;0CAAwB;;;;;;;;;;;;;;;;;;0BAI3C,4MAAC,+MAAe;0BACbJ,wBACC,4MAAC,uLAAM,CAACM,GAAG;oBACTC,SAAS;wBAAEC,SAAS;wBAAGC,OAAO;wBAAMC,GAAG,CAAC;oBAAG;oBAC3CC,SAAS;wBAAEH,SAAS;wBAAGC,OAAO;wBAAGC,GAAG;oBAAE;oBACtCE,MAAM;wBAAEJ,SAAS;wBAAGC,OAAO;wBAAMC,GAAG,CAAC;oBAAG;oBACxCN,WAAU;;sCAEV,4MAAC;4BAAIA,WAAU;sCACb,cAAA,4MAAC;gCAAIA,WAAU;;kDACb,4MAAC;wCAAIA,WAAU;kDACb,cAAA,4MAAC,6MAAI;4CAACA,WAAU;;;;;;;;;;;kDAElB,4MAAC;;0DACC,4MAAC;gDAAIA,WAAU;0DAAyB;;;;;;0DACxC,4MAAC;gDAAIA,WAAU;0DAAwB;;;;;;0DACvC,4MAAC;gDAAIA,WAAU;0DAAwB;;;;;;;;;;;;;;;;;;;;;;;sCAK7C,4MAAC;4BAAIA,WAAU;;8CACb,4MAAC;oCAAOA,WAAU;;sDAChB,4MAAC,gNAAK;4CAACA,WAAU;;;;;;sDACjB,4MAAC;4CAAKA,WAAU;sDAAa;;;;;;sDAC7B,4MAAC;4CAAKA,WAAU;sDAAgC;;;;;;;;;;;;8CAGlD,4MAAC;oCAAOA,WAAU;;sDAChB,4MAAC,sNAAO;4CAACA,WAAU;;;;;;sDACnB,4MAAC;4CAAKA,WAAU;sDAAa;;;;;;;;;;;;8CAG/B,4MAAC;oCAAOA,WAAU;;sDAChB,4MAAC,gNAAK;4CAACA,WAAU;;;;;;sDACjB,4MAAC;4CAAKA,WAAU;sDAAa;;;;;;;;;;;;8CAG/B,4MAAC;oCAAIA,WAAU;;;;;;8CAEf,4MAAC;oCAAOA,WAAU;;sDAChB,4MAAC,yNAAQ;4CAACA,WAAU;;;;;;sDACpB,4MAAC;4CAAKA,WAAU;sDAAa;;;;;;;;;;;;8CAG/B,4MAAC;oCAAOA,WAAU;;sDAChB,4MAAC,uNAAM;4CAACA,WAAU;;;;;;sDAClB,4MAAC;sDAAK;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAQfJ,wBACC,4MAAC;gBAAII,WAAU;gBAAqBC,SAAS,IAAMJ,UAAU;;;;;;;;;;;;AAIrE;GAxFgBF;KAAAA"}},
    {"offset": {"line": 10491, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/hooks/useStationCount.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { GlobeEventType, createGlobeEvent } from '../events/GlobeEventBus';\nimport { createGlobeEventBus } from '../infrastructure/ServiceContainer';\n\n/**\n * Hook to listen to station loading events from the new architecture\n */\nexport function useStationCount() {\n  const [stationCount, setStationCount] = useState(0);\n  \n  useEffect(() => {\n    const eventBus = createGlobeEventBus();\n    \n    // Create observer manually since we're in a React hook\n    const observerId = 'useStationCount-hook';\n    \n    const observer = {\n      getObserverId: () => observerId,\n      onEvent: (event: any) => {\n        if (event.type === GlobeEventType.STATIONS_LOADED) {\n          const count = event.data?.count || 0;\n          setStationCount(count);\n        }\n      }\n    };\n    \n    // Subscribe to station loading events\n    eventBus.subscribe(observer, [GlobeEventType.STATIONS_LOADED]);\n    \n    return () => {\n      eventBus.unsubscribe(observerId);\n    };\n  }, []);\n  \n  return stationCount;\n}"],"names":["useStationCount","stationCount","setStationCount","eventBus","observerId","observer","getObserverId","onEvent","event","type","STATIONS_LOADED","count","data","subscribe","unsubscribe"],"mappings":";;;;AAAA;AACA;AACA;;;;;AAKO,SAASA;;IACd,MAAM,CAACC,cAAcC,gBAAgB,GAAG,IAAA,wLAAQ,EAAC;IAEjD,IAAA,yLAAS;qCAAC;YACR,MAAMC,WAAW,IAAA,kLAAmB;YAEpC,uDAAuD;YACvD,MAAMC,aAAa;YAEnB,MAAMC,WAAW;gBACfC,aAAa;iDAAE,IAAMF;;gBACrBG,OAAO;iDAAE,CAACC;wBACR,IAAIA,MAAMC,IAAI,KAAK,kKAAc,CAACC,eAAe,EAAE;4BACjD,MAAMC,QAAQH,MAAMI,IAAI,EAAED,SAAS;4BACnCT,gBAAgBS;wBAClB;oBACF;;YACF;YAEA,sCAAsC;YACtCR,SAASU,SAAS,CAACR,UAAU;gBAAC,kKAAc,CAACK,eAAe;aAAC;YAE7D;6CAAO;oBACLP,SAASW,WAAW,CAACV;gBACvB;;QACF;oCAAG,EAAE;IAEL,OAAOH;AACT;GA5BgBD"}},
    {"offset": {"line": 10544, "column": 0}, "map": {"version":3,"sources":["file:///Users/ezekiel.mogaka/Desktop/Code/radio-globe-next/apps/web/src/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { Globe } from \"../components/Globe\";\nimport { ModularAudioPlayer } from \"../components/ModularAudioPlayer\";\nimport { StationPanel } from \"../components/StationPanel\";\nimport { SearchPanel } from \"../components/SearchPanel\";\nimport { StationDirectory } from \"../components/StationDirectory\";\nimport { UserPanel } from \"../components/UserPanel\";\nimport { useGlobeStore } from \"../stores/globe-store\";\nimport { useStationCount } from \"../hooks/useStationCount\";\n// import { globalRadioStations } from '../data/globalRadioStations'\nimport { radioDiscoveryService } from \"../services/radioDiscoveryService\";\nimport { motion } from \"framer-motion\";\nimport { Radio, Menu, X, List } from \"lucide-react\";\n\nexport default function Home() {\n  const { selectedStation, addMarker } = useGlobeStore(); // Removed markers from destructuring\n  const stationCount = useStationCount(); // Use new architecture station count\n  const [isMobile, setIsMobile] = useState(false);\n  const [showDirectory, setShowDirectory] = useState(false);\n  const [showMobileMenu, setShowMobileMenu] = useState(false);\n\n  // Detect mobile device and screen size\n  useEffect(() => {\n    const checkIfMobile = () => {\n      setIsMobile(window.innerWidth < 768 || \"ontouchstart\" in window);\n    };\n\n    checkIfMobile();\n    window.addEventListener(\"resize\", checkIfMobile);\n    return () => window.removeEventListener(\"resize\", checkIfMobile);\n  }, []);\n\n  return (\n    <main className=\"relative h-screen w-screen overflow-hidden bg-black\">\n      {/* 3D Globe with Three.js */}\n      <div className=\"absolute inset-0\">\n        <Globe />\n      </div>\n\n      {/* Top Bar */}\n      <motion.div\n        className=\"absolute top-0 left-0 right-0 z-40 p-6\"\n        initial={{ y: -100 }}\n        animate={{ y: 0 }}\n        transition={{ delay: 0.5 }}\n      >\n        <div className=\"flex items-center justify-between\">\n          {/* Logo */}\n          <motion.div\n            className=\"flex items-center gap-3 glass rounded-2xl px-6 py-3\"\n            whileHover={{ scale: 1.02 }}\n            transition={{ type: \"spring\", stiffness: 300 }}\n          >\n            <div className=\"relative\">\n              <Radio className=\"w-8 h-8 text-gradient\" />\n              <div className=\"absolute inset-0 animate-pulse-glow rounded-full bg-blue-400/20\" />\n            </div>\n            <div>\n              <h1 className=\"text-2xl font-bold text-gradient tracking-tight\">\n                Radio Globe\n              </h1>\n              <p className=\"text-sm text-gray-400 font-mono\">\n                Discover global radio stations\n              </p>\n            </div>\n          </motion.div>\n\n          {/* Desktop Navigation */}\n          {!isMobile && (\n            <div className=\"flex items-center gap-4\">\n              <SearchPanel />\n              <motion.button\n                onClick={() => setShowDirectory(!showDirectory)}\n                className={`glass px-6 py-3 rounded-xl flex items-center gap-3 transition-all font-medium ${\n                  showDirectory\n                    ? \"bg-gradient-to-r from-blue-500/30 to-cyan-500/30 text-cyan-300 border-cyan-400/30\"\n                    : \"text-white hover:bg-white/10 border-white/10\"\n                }`}\n                whileHover={{ scale: 1.02 }}\n                whileTap={{ scale: 0.98 }}\n              >\n                <List className=\"w-5 h-5\" />\n                <span className=\"text-sm tracking-wide\">Directory</span>\n                <div className=\"text-xs font-mono opacity-60\">\n                  {stationCount}\n                </div>\n              </motion.button>\n            </div>\n          )}\n\n          {/* Mobile Menu Button */}\n          {isMobile && (\n            <motion.button\n              onClick={() => setShowMobileMenu(!showMobileMenu)}\n              className=\"glass p-3 rounded-lg text-white\"\n              whileHover={{ scale: 1.05 }}\n            >\n              {showMobileMenu ? (\n                <X className=\"w-5 h-5\" />\n              ) : (\n                <Menu className=\"w-5 h-5\" />\n              )}\n            </motion.button>\n          )}\n        </div>\n      </motion.div>\n\n      {/* Station Directory Panel */}\n      {showDirectory && !isMobile && (\n        <motion.div\n          className=\"absolute top-20 left-4 z-50 w-96\"\n          initial={{ x: -400, opacity: 0 }}\n          animate={{ x: 0, opacity: 1 }}\n          exit={{ x: -400, opacity: 0 }}\n        >\n          <StationDirectory />\n        </motion.div>\n      )}\n\n      {/* Station Info Panel */}\n      {selectedStation && (\n        <motion.div\n          className={`absolute ${isMobile ? \"bottom-20 left-3 right-3\" : \"top-20 left-4\"} z-50`}\n          initial={{\n            x: isMobile ? 0 : -400,\n            y: isMobile ? 100 : 0,\n            opacity: 0,\n          }}\n          animate={{ x: 0, y: 0, opacity: 1 }}\n          exit={{ x: isMobile ? 0 : -400, y: isMobile ? 100 : 0, opacity: 0 }}\n        >\n          <StationPanel station={selectedStation} />\n        </motion.div>\n      )}\n\n      {/* Bottom Controls */}\n      <motion.div\n        className=\"absolute bottom-0 left-0 right-0 z-40\"\n        initial={{ y: 100 }}\n        animate={{ y: 0 }}\n        transition={{ delay: 0.7 }}\n      >\n        <div className=\"p-4\">\n          <div className=\"flex items-center justify-between\">\n            {/* User Panel - Desktop */}\n            {!isMobile && <UserPanel />}\n\n            {/* Audio Player */}\n            <div className=\"flex-1 max-w-2xl mx-4\">\n              <ModularAudioPlayer\n                showVisualizer={!isMobile}\n                compactMode={isMobile}\n                autoPlay={false}\n              />\n            </div>\n\n            {/* Mobile Controls */}\n            {isMobile && (\n              <div className=\"flex items-center gap-2\">\n                <motion.button\n                  onClick={() => setShowDirectory(!showDirectory)}\n                  className={`glass p-3 rounded-lg transition-colors ${\n                    showDirectory\n                      ? \"bg-blue-500/20 text-blue-300\"\n                      : \"text-white\"\n                  }`}\n                  whileHover={{ scale: 1.05 }}\n                >\n                  <List className=\"w-5 h-5\" />\n                </motion.button>\n              </div>\n            )}\n\n            {/* Desktop Stats */}\n            {!isMobile && (\n              <motion.div \n                className=\"glass px-6 py-4 rounded-2xl flex-shrink-0 border border-white/10\"\n                whileHover={{ scale: 1.02 }}\n                transition={{ type: \"spring\", stiffness: 300 }}\n              >\n                <div className=\"text-center\">\n                  <div className=\"text-xs text-gray-400 font-mono uppercase tracking-wide\">\n                    Global Stations\n                  </div>\n                  <div className=\"text-3xl font-bold text-gradient mt-1\">\n                    {stationCount}\n                  </div>\n                </div>\n              </motion.div>\n            )}\n          </div>\n        </div>\n      </motion.div>\n\n      {/* Mobile Menu Overlay */}\n      {showMobileMenu && isMobile && (\n        <motion.div\n          className=\"absolute inset-0 z-50\"\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n        >\n          <div\n            className=\"absolute inset-0 bg-black/80\"\n            onClick={() => setShowMobileMenu(false)}\n          />\n          <motion.div\n            className=\"absolute top-0 right-0 h-full w-80 glass p-6\"\n            initial={{ x: 320 }}\n            animate={{ x: 0 }}\n            exit={{ x: 320 }}\n          >\n            <div className=\"space-y-6\">\n              <div className=\"flex items-center justify-between\">\n                <h2 className=\"text-xl font-bold text-white\">Menu</h2>\n                <button\n                  onClick={() => setShowMobileMenu(false)}\n                  className=\"p-2 hover:bg-white/10 rounded-lg transition-colors\"\n                >\n                  <X className=\"w-5 h-5 text-white\" />\n                </button>\n              </div>\n\n              <div className=\"space-y-4\">\n                <SearchPanel />\n\n                <motion.button\n                  onClick={() => {\n                    setShowDirectory(!showDirectory);\n                    setShowMobileMenu(false);\n                  }}\n                  className=\"w-full glass p-4 rounded-lg flex items-center gap-3 text-left\"\n                  whileHover={{ scale: 1.02 }}\n                >\n                  <List className=\"w-5 h-5 text-blue-400\" />\n                  <div>\n                    <div className=\"font-medium text-white\">\n                      Station Directory\n                    </div>\n                    <div className=\"text-xs text-gray-400\">\n                      Browse all stations\n                    </div>\n                  </div>\n                </motion.button>\n\n                <UserPanel />\n              </div>\n            </div>\n          </motion.div>\n        </motion.div>\n      )}\n\n      {/* Mobile Directory Overlay */}\n      {showDirectory && isMobile && (\n        <motion.div\n          className=\"absolute inset-0 z-50\"\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n        >\n          <div\n            className=\"absolute inset-0 bg-black/80\"\n            onClick={() => setShowDirectory(false)}\n          />\n          <motion.div\n            className=\"absolute top-20 bottom-20 left-4 right-4 rounded-xl overflow-hidden\"\n            initial={{ scale: 0.8, opacity: 0 }}\n            animate={{ scale: 1, opacity: 1 }}\n            exit={{ scale: 0.8, opacity: 0 }}\n          >\n            <StationDirectory />\n          </motion.div>\n        </motion.div>\n      )}\n\n      {/* Loading Screen */}\n      <motion.div\n        className=\"absolute inset-0 z-50 bg-black flex items-center justify-center\"\n        initial={{ opacity: 1 }}\n        animate={{ opacity: 0 }}\n        transition={{ delay: 1, duration: 0.5 }}\n        style={{ pointerEvents: \"none\" }}\n      >\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-white text-lg\">Loading Radio Globe...</p>\n          <p className=\"text-gray-400 text-sm\">\n            Connecting to global stations...\n          </p>\n        </div>\n      </motion.div>\n    </main>\n  );\n}\n"],"names":["Home","selectedStation","addMarker","stationCount","isMobile","setIsMobile","showDirectory","setShowDirectory","showMobileMenu","setShowMobileMenu","checkIfMobile","window","innerWidth","addEventListener","removeEventListener","className","div","initial","y","animate","transition","delay","whileHover","scale","type","stiffness","button","onClick","whileTap","x","opacity","exit","station","showVisualizer","compactMode","autoPlay","duration","style","pointerEvents"],"mappings":"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"}}]
}